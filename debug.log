INFO 2025-04-21 22:32:56,567 views 15188 7404 Neo4j服务初始化成功
DEBUG 2025-04-21 22:32:58,638 views 15188 7404 ChatAPI实例初始化完成
INFO 2025-04-21 22:32:58,638 basehttp 15188 7404 "POST /api/chat/create_session/ HTTP/1.1" 200 52
INFO 2025-04-21 22:33:00,973 views 15188 16508 Neo4j服务初始化成功
DEBUG 2025-04-21 22:33:03,014 views 15188 16508 ChatAPI实例初始化完成
INFO 2025-04-21 22:33:03,015 basehttp 15188 16508 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-21 22:33:05,375 views 15188 10700 Neo4j服务初始化成功
DEBUG 2025-04-21 22:33:07,429 views 15188 10700 ChatAPI实例初始化完成
INFO 2025-04-21 22:33:07,431 basehttp 15188 10700 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-21 22:35:30,251 views 15188 12244 Neo4j服务初始化成功
DEBUG 2025-04-21 22:35:32,308 views 15188 12244 ChatAPI实例初始化完成
INFO 2025-04-21 22:35:32,309 basehttp 15188 12244 "POST /api/chat/create_session/ HTTP/1.1" 200 52
INFO 2025-04-21 22:35:34,627 views 15188 14048 Neo4j服务初始化成功
DEBUG 2025-04-21 22:35:36,704 views 15188 14048 ChatAPI实例初始化完成
INFO 2025-04-21 22:35:36,705 basehttp 15188 14048 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-21 22:35:39,035 views 15188 13336 Neo4j服务初始化成功
DEBUG 2025-04-21 22:35:41,094 views 15188 13336 ChatAPI实例初始化完成
INFO 2025-04-21 22:35:41,096 basehttp 15188 13336 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-21 22:35:41,856 views 15188 12400 Neo4j服务初始化成功
DEBUG 2025-04-21 22:35:43,939 views 15188 12400 ChatAPI实例初始化完成
DEBUG 2025-04-21 22:35:43,941 views 15188 12400 收到stream_chat请求: {'message': ['我现在在河北，而且我的小麦的问题主要发生在叶片上'], 'session_id': ['1745246132308']}
DEBUG 2025-04-21 22:35:43,944 views 15188 12400 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-21 22:35:43,948 views 15188 12400 处理消息: 我现在在河北，而且我的小麦的问题主要发生在叶片上, 会话ID: 1745246132308
DEBUG 2025-04-21 22:35:43,949 views 15188 12400 构建的完整消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我现在在河北，而且我的小麦的问题主要发生在叶片上'}]
DEBUG 2025-04-21 22:35:43,951 views 15188 12400 构建的消息列表长度: 2
DEBUG 2025-04-21 22:35:51,179 views 15188 12400 添加历史记录 - 会话ID: 1745246132308, 角色: user
DEBUG 2025-04-21 22:35:51,180 views 15188 12400 消息内容: 我现在在河北，而且我的小麦的问题主要发生在叶片上...
DEBUG 2025-04-21 22:35:51,181 views 15188 12400 历史记录更新成功，当前长度: 1
DEBUG 2025-04-21 22:35:51,182 views 15188 12400 添加历史记录 - 会话ID: 1745246132308, 角色: assistant
DEBUG 2025-04-21 22:35:51,183 views 15188 12400 消息内容: 请您详细描述一下小麦叶片上的症状，比如叶片上是否有斑点，斑点的颜色、形状、大小如何，叶片是否发黄、干枯，有没有霉状物、粉状物等异常情况，以及这种症状大概是小麦在什么生育期出现的，发病前后的气象条件是怎...
DEBUG 2025-04-21 22:35:51,184 views 15188 12400 历史记录更新成功，当前长度: 2
INFO 2025-04-21 22:35:51,185 basehttp 15188 12400 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%8E%B0%E5%9C%A8%E5%9C%A8%E6%B2%B3%E5%8C%97%EF%BC%8C%E8%80%8C%E4%B8%94%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E7%9A%84%E9%97%AE%E9%A2%98%E4%B8%BB%E8%A6%81%E5%8F%91%E7%94%9F%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A&session_id=1745246132308 HTTP/1.1" 200 1105
INFO 2025-04-21 22:35:53,867 views 15188 21584 Neo4j服务初始化成功
DEBUG 2025-04-21 22:35:55,963 views 15188 21584 ChatAPI实例初始化完成
INFO 2025-04-21 22:35:55,964 basehttp 15188 21584 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-21 22:36:08,962 views 15188 5044 Neo4j服务初始化成功
DEBUG 2025-04-21 22:36:11,024 views 15188 5044 ChatAPI实例初始化完成
DEBUG 2025-04-21 22:36:11,025 views 15188 5044 收到stream_chat请求: {'message': ['能不能听懂我说的话'], 'session_id': ['1745246132308']}
DEBUG 2025-04-21 22:36:11,025 views 15188 5044 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-21 22:36:11,026 views 15188 5044 处理消息: 能不能听懂我说的话, 会话ID: 1745246132308
DEBUG 2025-04-21 22:36:11,027 views 15188 5044 构建的完整消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '能不能听懂我说的话'}]
DEBUG 2025-04-21 22:36:11,027 views 15188 5044 构建的消息列表长度: 2
DEBUG 2025-04-21 22:36:14,215 views 15188 5044 添加历史记录 - 会话ID: 1745246132308, 角色: user
DEBUG 2025-04-21 22:36:14,215 views 15188 5044 消息内容: 能不能听懂我说的话...
DEBUG 2025-04-21 22:36:14,215 views 15188 5044 历史记录更新成功，当前长度: 1
DEBUG 2025-04-21 22:36:14,216 views 15188 5044 添加历史记录 - 会话ID: 1745246132308, 角色: assistant
DEBUG 2025-04-21 22:36:14,216 views 15188 5044 消息内容: 我能听懂您说话哦，请详细描述小麦出现的症状，比如小麦哪里不对劲，从哪个部位开始发病，发病时的气象条件，小麦处于什么生育期，在哪个地区发病等，这样我就能准确诊断可能的病害并给出防治建议。 ...
DEBUG 2025-04-21 22:36:14,216 views 15188 5044 历史记录更新成功，当前长度: 2
INFO 2025-04-21 22:36:14,217 basehttp 15188 5044 "GET /api/chat/stream_chat/?message=%E8%83%BD%E4%B8%8D%E8%83%BD%E5%90%AC%E6%87%82%E6%88%91%E8%AF%B4%E7%9A%84%E8%AF%9D&session_id=1745246132308 HTTP/1.1" 200 824
INFO 2025-04-21 22:36:16,898 views 15188 22292 Neo4j服务初始化成功
DEBUG 2025-04-21 22:36:18,957 views 15188 22292 ChatAPI实例初始化完成
INFO 2025-04-21 22:36:18,960 basehttp 15188 22292 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-21 22:39:03,855 autoreload 15188 5244 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-21 22:39:04,657 autoreload 5356 16580 Watching for file changes with StatReloader
INFO 2025-04-21 22:44:28,992 autoreload 5356 16580 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-21 22:44:29,774 autoreload 23824 17080 Watching for file changes with StatReloader
INFO 2025-04-21 22:44:39,280 autoreload 23824 17080 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-21 22:44:40,044 autoreload 15268 16648 Watching for file changes with StatReloader
INFO 2025-04-21 23:18:10,870 autoreload 15268 16648 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-21 23:18:11,656 autoreload 3924 9396 Watching for file changes with StatReloader
INFO 2025-04-21 23:27:03,684 views 3924 12156 Neo4j服务初始化成功
DEBUG 2025-04-21 23:27:05,734 views 3924 12156 ChatAPI实例初始化完成
DEBUG 2025-04-21 23:27:05,734 views 3924 12156 收到stream_chat请求: {'message': ['我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'], 'session_id': ['1745246132308']}
DEBUG 2025-04-21 23:27:05,734 views 3924 12156 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-21 23:27:05,738 views 3924 12156 处理消息: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗, 会话ID: 1745246132308
DEBUG 2025-04-21 23:27:05,738 views 3924 12156 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'}]
DEBUG 2025-04-21 23:27:05,738 views 3924 12156 构建的消息列表长度: 2
DEBUG 2025-04-21 23:27:05,738 views 3924 12156 检查会话状态: 1745246132308
DEBUG 2025-04-21 23:27:05,738 views 3924 12156 当前所有会话: []
DEBUG 2025-04-21 23:27:05,738 views 3924 12156 症状收集状态: {}
INFO 2025-04-21 23:27:05,738 views 3924 12156 创建新会话: 1745246132308
INFO 2025-04-21 23:27:05,738 views 3924 12156 初始化症状收集状态: 1745246132308
DEBUG 2025-04-21 23:27:05,738 views 3924 12156 开始提取症状，输入消息: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗
DEBUG 2025-04-21 23:27:05,742 views 3924 12156 分句结果: ['我现在在河北', '而且我的小麦的问题主要发生在叶片上', '请问我的小麦是有什么症状吗', '我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗']
DEBUG 2025-04-21 23:27:05,742 views 3924 12156 提取到的发病部位: []
DEBUG 2025-04-21 23:27:05,742 views 3924 12156 提取到的气象条件: []
DEBUG 2025-04-21 23:27:05,742 views 3924 12156 提取到的生育期: []
DEBUG 2025-04-21 23:27:05,743 views 3924 12156 提取到的地区: ['河北']
DEBUG 2025-04-21 23:27:05,743 views 3924 12156 提取到的发病部位: ['叶片']
DEBUG 2025-04-21 23:27:05,743 views 3924 12156 提取到的气象条件: []
DEBUG 2025-04-21 23:27:05,743 views 3924 12156 提取到的生育期: []
DEBUG 2025-04-21 23:27:05,743 views 3924 12156 提取到的地区: []
DEBUG 2025-04-21 23:27:05,743 views 3924 12156 提取到的发病部位: []
DEBUG 2025-04-21 23:27:05,744 views 3924 12156 提取到的气象条件: []
DEBUG 2025-04-21 23:27:05,744 views 3924 12156 提取到的生育期: []
DEBUG 2025-04-21 23:27:05,744 views 3924 12156 提取到的地区: []
DEBUG 2025-04-21 23:27:05,744 views 3924 12156 提取到的发病部位: ['叶片']
DEBUG 2025-04-21 23:27:05,744 views 3924 12156 提取到的气象条件: []
DEBUG 2025-04-21 23:27:05,745 views 3924 12156 提取到的生育期: []
DEBUG 2025-04-21 23:27:05,745 views 3924 12156 提取到的地区: ['河北']
INFO 2025-04-21 23:27:05,745 views 3924 12156 症状提取结果: {'plant_part': '叶片', 'region': '河北'}
DEBUG 2025-04-21 23:27:05,745 views 3924 12156 检查会话状态: 1745246132308
DEBUG 2025-04-21 23:27:05,745 views 3924 12156 当前所有会话: ['1745246132308']
DEBUG 2025-04-21 23:27:05,746 views 3924 12156 症状收集状态: {'collecting': True, 'symptoms': {}}
DEBUG 2025-04-21 23:27:12,130 views 3924 12156 添加历史记录 - 会话ID: 1745246132308, 角色: user
DEBUG 2025-04-21 23:27:12,130 views 3924 12156 消息内容: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗...
DEBUG 2025-04-21 23:27:12,130 views 3924 12156 历史记录更新成功，当前长度: 1
DEBUG 2025-04-21 23:27:12,130 views 3924 12156 添加历史记录 - 会话ID: 1745246132308, 角色: assistant
DEBUG 2025-04-21 23:27:12,130 views 3924 12156 消息内容: 根据您提供的所有信息（包括之前提到的发病部位：叶片、地区：河北），我暂时无法确定具体病害。请补充更多信息，特别是：气象条件、生育期...
DEBUG 2025-04-21 23:27:12,130 views 3924 12156 历史记录更新成功，当前长度: 2
INFO 2025-04-21 23:27:12,130 basehttp 3924 12156 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%8E%B0%E5%9C%A8%E5%9C%A8%E6%B2%B3%E5%8C%97%EF%BC%8C%E8%80%8C%E4%B8%94%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E7%9A%84%E9%97%AE%E9%A2%98%E4%B8%BB%E8%A6%81%E5%8F%91%E7%94%9F%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%EF%BC%8C%E8%AF%B7%E9%97%AE%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E6%98%AF%E6%9C%89%E4%BB%80%E4%B9%88%E7%97%87%E7%8A%B6%E5%90%97&session_id=1745246132308 HTTP/1.1" 200 1400
INFO 2025-04-21 23:27:14,519 views 3924 8236 Neo4j服务初始化成功
DEBUG 2025-04-21 23:27:16,564 views 3924 8236 ChatAPI实例初始化完成
INFO 2025-04-21 23:27:16,564 basehttp 3924 8236 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-21 23:39:18,083 autoreload 3924 9396 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-21 23:39:18,979 autoreload 14744 12060 Watching for file changes with StatReloader
INFO 2025-04-21 23:39:22,704 autoreload 14744 12060 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-21 23:39:23,477 autoreload 19364 22712 Watching for file changes with StatReloader
INFO 2025-04-22 13:17:17,334 autoreload 12460 13288 Watching for file changes with StatReloader
INFO 2025-04-22 13:20:52,791 views 12460 12336 Neo4j服务初始化成功
DEBUG 2025-04-22 13:20:54,840 views 12460 12336 ChatAPI实例初始化完成
INFO 2025-04-22 13:20:54,842 basehttp 12460 12336 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 13:20:55,572 views 12460 17212 Neo4j服务初始化成功
INFO 2025-04-22 13:20:57,157 views 12460 12672 Neo4j服务初始化成功
DEBUG 2025-04-22 13:20:57,609 views 12460 17212 ChatAPI实例初始化完成
INFO 2025-04-22 13:20:57,609 basehttp 12460 17212 "POST /api/chat/create_session/ HTTP/1.1" 200 40
DEBUG 2025-04-22 13:20:59,180 views 12460 12672 ChatAPI实例初始化完成
INFO 2025-04-22 13:20:59,180 basehttp 12460 12672 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 13:21:01,510 views 12460 3788 Neo4j服务初始化成功
DEBUG 2025-04-22 13:21:03,554 views 12460 3788 ChatAPI实例初始化完成
INFO 2025-04-22 13:21:03,554 basehttp 12460 3788 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 13:21:05,968 views 12460 17984 Neo4j服务初始化成功
INFO 2025-04-22 13:21:05,987 views 12460 13316 Neo4j服务初始化成功
DEBUG 2025-04-22 13:21:08,018 views 12460 17984 ChatAPI实例初始化完成
INFO 2025-04-22 13:21:08,018 basehttp 12460 17984 "GET /api/chat/get_history/ HTTP/1.1" 200 37
DEBUG 2025-04-22 13:21:08,035 views 12460 13316 ChatAPI实例初始化完成
DEBUG 2025-04-22 13:21:08,036 views 12460 13316 收到stream_chat请求: {'message': ['我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'], 'session_id': ['1']}
DEBUG 2025-04-22 13:21:08,037 views 12460 13316 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 13:21:08,038 views 12460 13316 处理消息: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗, 会话ID: 1
DEBUG 2025-04-22 13:21:08,038 views 12460 13316 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'}]
DEBUG 2025-04-22 13:21:08,039 views 12460 13316 构建的消息列表长度: 2
DEBUG 2025-04-22 13:21:08,039 views 12460 13316 检查会话状态: 1
DEBUG 2025-04-22 13:21:08,040 views 12460 13316 当前所有会话: []
DEBUG 2025-04-22 13:21:08,040 views 12460 13316 症状收集状态: {}
INFO 2025-04-22 13:21:08,040 views 12460 13316 创建新会话: 1
INFO 2025-04-22 13:21:08,040 views 12460 13316 初始化症状收集状态: 1
DEBUG 2025-04-22 13:21:08,040 views 12460 13316 当前症状信息: {}
DEBUG 2025-04-22 13:21:08,041 views 12460 13316 开始提取症状，输入消息: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗
DEBUG 2025-04-22 13:21:08,041 views 12460 13316 分句结果: ['我现在在河北', '而且我的小麦的问题主要发生在叶片上', '请问我的小麦是有什么症状吗', '我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗']
DEBUG 2025-04-22 13:21:08,041 views 12460 13316 提取到的发病部位: []
DEBUG 2025-04-22 13:21:08,041 views 12460 13316 提取到的气象条件: []
DEBUG 2025-04-22 13:21:08,042 views 12460 13316 提取到的生育期: []
DEBUG 2025-04-22 13:21:08,042 views 12460 13316 提取到的地区: ['河北']
DEBUG 2025-04-22 13:21:08,042 views 12460 13316 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 13:21:08,042 views 12460 13316 提取到的气象条件: []
DEBUG 2025-04-22 13:21:08,043 views 12460 13316 提取到的生育期: []
DEBUG 2025-04-22 13:21:08,043 views 12460 13316 提取到的地区: []
DEBUG 2025-04-22 13:21:08,043 views 12460 13316 提取到的发病部位: []
DEBUG 2025-04-22 13:21:08,043 views 12460 13316 提取到的气象条件: []
DEBUG 2025-04-22 13:21:08,043 views 12460 13316 提取到的生育期: []
DEBUG 2025-04-22 13:21:08,044 views 12460 13316 提取到的地区: []
DEBUG 2025-04-22 13:21:08,044 views 12460 13316 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 13:21:08,044 views 12460 13316 提取到的气象条件: []
DEBUG 2025-04-22 13:21:08,044 views 12460 13316 提取到的生育期: []
DEBUG 2025-04-22 13:21:08,044 views 12460 13316 提取到的地区: ['河北']
INFO 2025-04-22 13:21:08,044 views 12460 13316 症状提取结果: {'plant_part': '叶片', 'region': '河北'}
DEBUG 2025-04-22 13:21:08,045 views 12460 13316 检查会话状态: 1
DEBUG 2025-04-22 13:21:08,045 views 12460 13316 当前所有会话: ['1']
DEBUG 2025-04-22 13:21:08,045 views 12460 13316 症状收集状态: {'collecting': True, 'symptoms': {}}
DEBUG 2025-04-22 13:21:14,376 views 12460 13316 添加历史记录 - 会话ID: 1, 角色: user
DEBUG 2025-04-22 13:21:14,376 views 12460 13316 消息内容: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗...
DEBUG 2025-04-22 13:21:14,377 views 12460 13316 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 13:21:14,377 views 12460 13316 添加历史记录 - 会话ID: 1, 角色: assistant
DEBUG 2025-04-22 13:21:14,377 views 12460 13316 消息内容: 根据您提供的所有信息（包括之前提到的发病部位：叶片、地区：河北），我暂时无法确定具体病害。请补充更多信息，特别是：气象条件、生育期...
DEBUG 2025-04-22 13:21:14,378 views 12460 13316 历史记录更新成功，当前长度: 2
INFO 2025-04-22 13:21:14,378 basehttp 12460 13316 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%8E%B0%E5%9C%A8%E5%9C%A8%E6%B2%B3%E5%8C%97%EF%BC%8C%E8%80%8C%E4%B8%94%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E7%9A%84%E9%97%AE%E9%A2%98%E4%B8%BB%E8%A6%81%E5%8F%91%E7%94%9F%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%EF%BC%8C%E8%AF%B7%E9%97%AE%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E6%98%AF%E6%9C%89%E4%BB%80%E4%B9%88%E7%97%87%E7%8A%B6%E5%90%97&session_id=1 HTTP/1.1" 200 1400
INFO 2025-04-22 13:21:17,080 views 12460 22536 Neo4j服务初始化成功
DEBUG 2025-04-22 13:21:19,114 views 12460 22536 ChatAPI实例初始化完成
INFO 2025-04-22 13:21:19,114 basehttp 12460 22536 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 13:31:31,685 autoreload 12460 13288 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 13:31:32,477 autoreload 15848 21428 Watching for file changes with StatReloader
INFO 2025-04-22 13:31:39,421 autoreload 15848 21428 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 13:31:40,191 autoreload 21768 14176 Watching for file changes with StatReloader
INFO 2025-04-22 14:21:08,480 autoreload 21768 14176 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 14:21:09,411 autoreload 17480 22996 Watching for file changes with StatReloader
INFO 2025-04-22 14:21:11,150 autoreload 17480 22996 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 14:21:11,794 autoreload 16108 17744 Watching for file changes with StatReloader
INFO 2025-04-22 14:21:16,646 autoreload 16108 17744 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 14:21:17,463 autoreload 612 12576 Watching for file changes with StatReloader
INFO 2025-04-22 14:21:31,047 autoreload 612 12576 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 14:21:31,834 autoreload 10660 2664 Watching for file changes with StatReloader
INFO 2025-04-22 14:24:30,458 autoreload 10660 2664 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 14:24:31,298 autoreload 12664 2176 Watching for file changes with StatReloader
INFO 2025-04-22 14:25:35,883 autoreload 12664 2176 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 14:25:36,674 autoreload 8208 828 Watching for file changes with StatReloader
INFO 2025-04-22 14:29:28,675 autoreload 8208 828 D:\GraduationProject\wheatdisease\chat\services.py changed, reloading.
INFO 2025-04-22 14:29:29,449 autoreload 8748 6612 Watching for file changes with StatReloader
INFO 2025-04-22 14:29:56,028 autoreload 8748 6612 D:\GraduationProject\wheatdisease\chat\services.py changed, reloading.
INFO 2025-04-22 14:29:56,849 autoreload 18612 21924 Watching for file changes with StatReloader
INFO 2025-04-22 14:30:03,849 autoreload 18612 21924 D:\GraduationProject\wheatdisease\chat\services.py changed, reloading.
INFO 2025-04-22 14:30:04,610 autoreload 2556 11608 Watching for file changes with StatReloader
INFO 2025-04-22 14:31:27,690 autoreload 2556 11608 D:\GraduationProject\wheatdisease\chat\services.py changed, reloading.
INFO 2025-04-22 14:31:28,456 autoreload 13280 22260 Watching for file changes with StatReloader
INFO 2025-04-22 14:34:15,177 autoreload 13280 22260 D:\GraduationProject\wheatdisease\chat\services.py changed, reloading.
INFO 2025-04-22 14:34:15,989 autoreload 4192 2520 Watching for file changes with StatReloader
INFO 2025-04-22 14:35:09,888 autoreload 4192 2520 D:\GraduationProject\wheatdisease\chat\services.py changed, reloading.
INFO 2025-04-22 14:35:10,716 autoreload 9960 15220 Watching for file changes with StatReloader
INFO 2025-04-22 14:35:27,764 autoreload 9960 15220 D:\GraduationProject\wheatdisease\chat\services.py changed, reloading.
INFO 2025-04-22 14:35:28,560 autoreload 14008 6556 Watching for file changes with StatReloader
INFO 2025-04-22 14:35:49,316 views 14008 16740 Neo4j服务初始化成功
DEBUG 2025-04-22 14:35:51,349 views 14008 16740 ChatAPI实例初始化完成
INFO 2025-04-22 14:35:51,350 basehttp 14008 16740 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 14:35:53,666 views 14008 23352 Neo4j服务初始化成功
DEBUG 2025-04-22 14:35:55,706 views 14008 23352 ChatAPI实例初始化完成
INFO 2025-04-22 14:35:55,706 basehttp 14008 23352 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 14:35:55,722 views 14008 16276 Neo4j服务初始化成功
DEBUG 2025-04-22 14:35:57,751 views 14008 16276 ChatAPI实例初始化完成
DEBUG 2025-04-22 14:35:57,751 views 14008 16276 收到stream_chat请求: {'message': ['我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'], 'session_id': ['1']}
DEBUG 2025-04-22 14:35:57,753 views 14008 16276 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 14:35:57,753 views 14008 16276 处理消息: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗, 会话ID: 1
DEBUG 2025-04-22 14:35:57,753 views 14008 16276 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'}]
DEBUG 2025-04-22 14:35:57,753 views 14008 16276 构建的消息列表长度: 2
DEBUG 2025-04-22 14:35:57,753 views 14008 16276 检查会话状态: 1
DEBUG 2025-04-22 14:35:57,753 views 14008 16276 当前所有会话: []
DEBUG 2025-04-22 14:35:57,753 views 14008 16276 症状收集状态: {}
INFO 2025-04-22 14:35:57,753 views 14008 16276 创建新会话: 1
INFO 2025-04-22 14:35:57,753 views 14008 16276 初始化症状收集状态: 1
DEBUG 2025-04-22 14:35:57,753 views 14008 16276 当前症状信息: {}
DEBUG 2025-04-22 14:35:57,757 views 14008 16276 开始提取症状，输入消息: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗
DEBUG 2025-04-22 14:35:57,757 views 14008 16276 分句结果: ['我现在在河北', '而且我的小麦的问题主要发生在叶片上', '请问我的小麦是有什么症状吗', '我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗']
DEBUG 2025-04-22 14:35:57,757 views 14008 16276 提取到的发病部位: []
DEBUG 2025-04-22 14:35:57,757 views 14008 16276 提取到的气象条件: []
DEBUG 2025-04-22 14:35:57,757 views 14008 16276 提取到的生育期: []
DEBUG 2025-04-22 14:35:57,757 views 14008 16276 提取到的地区: ['河北']
DEBUG 2025-04-22 14:35:57,758 views 14008 16276 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 14:35:57,758 views 14008 16276 提取到的气象条件: []
DEBUG 2025-04-22 14:35:57,758 views 14008 16276 提取到的生育期: []
DEBUG 2025-04-22 14:35:57,758 views 14008 16276 提取到的地区: []
DEBUG 2025-04-22 14:35:57,759 views 14008 16276 提取到的发病部位: []
DEBUG 2025-04-22 14:35:57,759 views 14008 16276 提取到的气象条件: []
DEBUG 2025-04-22 14:35:57,759 views 14008 16276 提取到的生育期: []
DEBUG 2025-04-22 14:35:57,759 views 14008 16276 提取到的地区: []
DEBUG 2025-04-22 14:35:57,760 views 14008 16276 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 14:35:57,760 views 14008 16276 提取到的气象条件: []
DEBUG 2025-04-22 14:35:57,760 views 14008 16276 提取到的生育期: []
DEBUG 2025-04-22 14:35:57,760 views 14008 16276 提取到的地区: ['河北']
INFO 2025-04-22 14:35:57,760 views 14008 16276 症状提取结果: {'plant_part': '叶片', 'region': '河北'}
DEBUG 2025-04-22 14:35:57,760 views 14008 16276 检查会话状态: 1
DEBUG 2025-04-22 14:35:57,761 views 14008 16276 当前所有会话: ['1']
DEBUG 2025-04-22 14:35:57,761 views 14008 16276 症状收集状态: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 14:35:57,761 views 14008 16276 更新后的症状信息: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-22 14:35:57,761 views 14008 16276 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片
- 发病地区：河北

还需要补充的信息：
- 气象条件
- 生育期

INFO 2025-04-22 14:35:58,048 views 14008 5272 Neo4j服务初始化成功
DEBUG 2025-04-22 14:36:00,088 views 14008 5272 ChatAPI实例初始化完成
INFO 2025-04-22 14:36:00,092 basehttp 14008 5272 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 14:36:00,642 services 14008 16276 ['plant_part', 'region']
INFO 2025-04-22 14:36:00,642 services 14008 16276 Executing query: MATCH (d:Disease), (d)-[:AFFECTS_PART]->(p:PlantPart), (d)-[:OCCURS_IN_REGION]->(r:Region) WHERE p.name = $plant_part AND r.name = $region
                WITH d, size([x IN [$plant_part, $weather, $growth_stage, $region] WHERE x IS NOT NULL]) as total_symptoms,
                     size([x IN [$plant_part, $weather, $growth_stage, $region] WHERE x IS NOT NULL AND x IN 
                          CASE 
                            WHEN x = $plant_part AND p IS NOT NULL THEN [p.name]
                            WHEN x = $weather AND w IS NOT NULL THEN [w.name]
                            WHEN x = $growth_stage AND s IS NOT NULL THEN [s.name]
                            WHEN x = $region AND r IS NOT NULL THEN [r.name]
                            ELSE []
                          END
                     ]) as matched_symptoms
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       matched_symptoms,
                       toFloat(matched_symptoms) / toFloat(total_symptoms) as match_ratio
                ORDER BY match_ratio DESC
                LIMIT 5
                
INFO 2025-04-22 14:36:00,646 services 14008 16276 With parameters: {'plant_part': '叶片', 'region': '河北'}
DEBUG 2025-04-22 14:36:04,010 views 14008 16276 添加历史记录 - 会话ID: 1, 角色: user
DEBUG 2025-04-22 14:36:04,011 views 14008 16276 消息内容: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗...
DEBUG 2025-04-22 14:36:04,011 views 14008 16276 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 14:36:04,011 views 14008 16276 添加历史记录 - 会话ID: 1, 角色: assistant
DEBUG 2025-04-22 14:36:04,015 views 14008 16276 消息内容: 根据您提供的所有信息（包括之前提到的发病部位：叶片、地区：河北），我暂时无法确定具体病害。请补充更多信息，特别是：气象条件、生育期...
DEBUG 2025-04-22 14:36:04,015 views 14008 16276 历史记录更新成功，当前长度: 2
INFO 2025-04-22 14:36:04,019 basehttp 14008 16276 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%8E%B0%E5%9C%A8%E5%9C%A8%E6%B2%B3%E5%8C%97%EF%BC%8C%E8%80%8C%E4%B8%94%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E7%9A%84%E9%97%AE%E9%A2%98%E4%B8%BB%E8%A6%81%E5%8F%91%E7%94%9F%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%EF%BC%8C%E8%AF%B7%E9%97%AE%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E6%98%AF%E6%9C%89%E4%BB%80%E4%B9%88%E7%97%87%E7%8A%B6%E5%90%97&session_id=1 HTTP/1.1" 200 1358
INFO 2025-04-22 14:36:06,418 views 14008 21420 Neo4j服务初始化成功
DEBUG 2025-04-22 14:36:08,486 views 14008 21420 ChatAPI实例初始化完成
INFO 2025-04-22 14:36:08,486 basehttp 14008 21420 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 14:37:24,822 autoreload 14008 6556 D:\GraduationProject\wheatdisease\chat\services.py changed, reloading.
INFO 2025-04-22 14:37:25,719 autoreload 16084 4640 Watching for file changes with StatReloader
INFO 2025-04-22 14:37:37,117 autoreload 16084 4640 D:\GraduationProject\wheatdisease\chat\services.py changed, reloading.
INFO 2025-04-22 14:37:37,921 autoreload 10876 9476 Watching for file changes with StatReloader
INFO 2025-04-22 14:37:46,343 views 10876 17200 Neo4j服务初始化成功
DEBUG 2025-04-22 14:37:48,400 views 10876 17200 ChatAPI实例初始化完成
DEBUG 2025-04-22 14:37:48,400 views 10876 17200 收到stream_chat请求: {'message': ['我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'], 'session_id': ['1']}
DEBUG 2025-04-22 14:37:48,400 views 10876 17200 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 14:37:48,404 views 10876 17200 处理消息: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗, 会话ID: 1
DEBUG 2025-04-22 14:37:48,404 views 10876 17200 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'}]
DEBUG 2025-04-22 14:37:48,404 views 10876 17200 构建的消息列表长度: 2
DEBUG 2025-04-22 14:37:48,404 views 10876 17200 检查会话状态: 1
DEBUG 2025-04-22 14:37:48,404 views 10876 17200 当前所有会话: []
DEBUG 2025-04-22 14:37:48,404 views 10876 17200 症状收集状态: {}
INFO 2025-04-22 14:37:48,404 views 10876 17200 创建新会话: 1
INFO 2025-04-22 14:37:48,407 views 10876 17200 初始化症状收集状态: 1
DEBUG 2025-04-22 14:37:48,407 views 10876 17200 当前症状信息: {}
DEBUG 2025-04-22 14:37:48,407 views 10876 17200 开始提取症状，输入消息: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗
DEBUG 2025-04-22 14:37:48,407 views 10876 17200 分句结果: ['我现在在河北', '而且我的小麦的问题主要发生在叶片上', '请问我的小麦是有什么症状吗', '我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗']
DEBUG 2025-04-22 14:37:48,408 views 10876 17200 提取到的发病部位: []
DEBUG 2025-04-22 14:37:48,408 views 10876 17200 提取到的气象条件: []
DEBUG 2025-04-22 14:37:48,409 views 10876 17200 提取到的生育期: []
DEBUG 2025-04-22 14:37:48,409 views 10876 17200 提取到的地区: ['河北']
DEBUG 2025-04-22 14:37:48,409 views 10876 17200 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 14:37:48,409 views 10876 17200 提取到的气象条件: []
DEBUG 2025-04-22 14:37:48,409 views 10876 17200 提取到的生育期: []
DEBUG 2025-04-22 14:37:48,410 views 10876 17200 提取到的地区: []
DEBUG 2025-04-22 14:37:48,410 views 10876 17200 提取到的发病部位: []
DEBUG 2025-04-22 14:37:48,410 views 10876 17200 提取到的气象条件: []
DEBUG 2025-04-22 14:37:48,410 views 10876 17200 提取到的生育期: []
DEBUG 2025-04-22 14:37:48,410 views 10876 17200 提取到的地区: []
DEBUG 2025-04-22 14:37:48,410 views 10876 17200 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 14:37:48,411 views 10876 17200 提取到的气象条件: []
DEBUG 2025-04-22 14:37:48,411 views 10876 17200 提取到的生育期: []
DEBUG 2025-04-22 14:37:48,411 views 10876 17200 提取到的地区: ['河北']
INFO 2025-04-22 14:37:48,411 views 10876 17200 症状提取结果: {'plant_part': '叶片', 'region': '河北'}
DEBUG 2025-04-22 14:37:48,411 views 10876 17200 检查会话状态: 1
DEBUG 2025-04-22 14:37:48,412 views 10876 17200 当前所有会话: ['1']
DEBUG 2025-04-22 14:37:48,412 views 10876 17200 症状收集状态: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 14:37:48,412 views 10876 17200 更新后的症状信息: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-22 14:37:48,412 views 10876 17200 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片
- 发病地区：河北

还需要补充的信息：
- 气象条件
- 生育期

INFO 2025-04-22 14:37:51,291 services 10876 17200 ['plant_part', 'region']
INFO 2025-04-22 14:37:51,291 services 10876 17200 Executing query: 
                MATCH (d:Disease)
                OPTIONAL MATCH (d)-[:AFFECTS_PART]->(p:PlantPart)
                OPTIONAL MATCH (d)-[:OCCURS_IN_WEATHER]->(w:Weather)
                OPTIONAL MATCH (d)-[:OCCURS_IN_STAGE]->(s:GrowthStage)
                OPTIONAL MATCH (d)-[:OCCURS_IN_REGION]->(r:Region)
                 WHERE p.name = $plant_part AND r.name = $region
                WITH d, size([x IN [$plant_part, $weather, $growth_stage, $region] WHERE x IS NOT NULL]) as total_symptoms,
                     size([x IN [$plant_part, $weather, $growth_stage, $region] WHERE x IS NOT NULL AND x IN 
                          CASE 
                            WHEN x = $plant_part AND p IS NOT NULL THEN [p.name]
                            WHEN x = $weather AND w IS NOT NULL THEN [w.name]
                            WHEN x = $growth_stage AND s IS NOT NULL THEN [s.name]
                            WHEN x = $region AND r IS NOT NULL THEN [r.name]
                            ELSE []
                          END
                     ]) as matched_symptoms
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       matched_symptoms,
                       toFloat(matched_symptoms) / toFloat(total_symptoms) as match_ratio
                ORDER BY match_ratio DESC
                LIMIT 5
                
INFO 2025-04-22 14:37:51,303 services 10876 17200 With parameters: {'plant_part': '叶片', 'region': '河北'}
DEBUG 2025-04-22 14:37:55,421 views 10876 17200 添加历史记录 - 会话ID: 1, 角色: user
DEBUG 2025-04-22 14:37:55,421 views 10876 17200 消息内容: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗...
DEBUG 2025-04-22 14:37:55,421 views 10876 17200 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 14:37:55,421 views 10876 17200 添加历史记录 - 会话ID: 1, 角色: assistant
DEBUG 2025-04-22 14:37:55,421 views 10876 17200 消息内容: 根据您提供的所有信息（包括之前提到的发病部位：叶片、地区：河北），我暂时无法确定具体病害。请补充更多信息，特别是：气象条件、生育期...
DEBUG 2025-04-22 14:37:55,421 views 10876 17200 历史记录更新成功，当前长度: 2
INFO 2025-04-22 14:37:55,421 basehttp 10876 17200 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%8E%B0%E5%9C%A8%E5%9C%A8%E6%B2%B3%E5%8C%97%EF%BC%8C%E8%80%8C%E4%B8%94%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E7%9A%84%E9%97%AE%E9%A2%98%E4%B8%BB%E8%A6%81%E5%8F%91%E7%94%9F%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%EF%BC%8C%E8%AF%B7%E9%97%AE%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E6%98%AF%E6%9C%89%E4%BB%80%E4%B9%88%E7%97%87%E7%8A%B6%E5%90%97&session_id=1 HTTP/1.1" 200 1358
INFO 2025-04-22 14:37:57,760 views 10876 11420 Neo4j服务初始化成功
DEBUG 2025-04-22 14:37:59,806 views 10876 11420 ChatAPI实例初始化完成
INFO 2025-04-22 14:37:59,807 basehttp 10876 11420 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 14:48:34,158 views 10876 23408 Neo4j服务初始化成功
DEBUG 2025-04-22 14:48:36,192 views 10876 23408 ChatAPI实例初始化完成
DEBUG 2025-04-22 14:48:36,196 views 10876 23408 收到stream_chat请求: {'message': ['我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'], 'session_id': ['1']}
DEBUG 2025-04-22 14:48:36,196 views 10876 23408 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 14:48:36,196 views 10876 23408 处理消息: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗, 会话ID: 1
DEBUG 2025-04-22 14:48:36,196 views 10876 23408 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'}]
DEBUG 2025-04-22 14:48:36,199 views 10876 23408 构建的消息列表长度: 2
DEBUG 2025-04-22 14:48:36,199 views 10876 23408 检查会话状态: 1
DEBUG 2025-04-22 14:48:36,199 views 10876 23408 当前所有会话: []
DEBUG 2025-04-22 14:48:36,199 views 10876 23408 症状收集状态: {}
INFO 2025-04-22 14:48:36,199 views 10876 23408 创建新会话: 1
INFO 2025-04-22 14:48:36,199 views 10876 23408 初始化症状收集状态: 1
DEBUG 2025-04-22 14:48:36,199 views 10876 23408 当前症状信息: {}
DEBUG 2025-04-22 14:48:36,199 views 10876 23408 开始提取症状，输入消息: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗
DEBUG 2025-04-22 14:48:36,201 views 10876 23408 分句结果: ['我现在在河北', '而且我的小麦的问题主要发生在叶片上', '请问我的小麦是有什么症状吗', '我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗']
DEBUG 2025-04-22 14:48:36,201 views 10876 23408 提取到的发病部位: []
DEBUG 2025-04-22 14:48:36,201 views 10876 23408 提取到的气象条件: []
DEBUG 2025-04-22 14:48:36,201 views 10876 23408 提取到的生育期: []
DEBUG 2025-04-22 14:48:36,202 views 10876 23408 提取到的地区: ['河北']
DEBUG 2025-04-22 14:48:36,202 views 10876 23408 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 14:48:36,203 views 10876 23408 提取到的气象条件: []
DEBUG 2025-04-22 14:48:36,203 views 10876 23408 提取到的生育期: []
DEBUG 2025-04-22 14:48:36,203 views 10876 23408 提取到的地区: []
DEBUG 2025-04-22 14:48:36,203 views 10876 23408 提取到的发病部位: []
DEBUG 2025-04-22 14:48:36,203 views 10876 23408 提取到的气象条件: []
DEBUG 2025-04-22 14:48:36,203 views 10876 23408 提取到的生育期: []
DEBUG 2025-04-22 14:48:36,203 views 10876 23408 提取到的地区: []
DEBUG 2025-04-22 14:48:36,203 views 10876 23408 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 14:48:36,203 views 10876 23408 提取到的气象条件: []
DEBUG 2025-04-22 14:48:36,203 views 10876 23408 提取到的生育期: []
DEBUG 2025-04-22 14:48:36,203 views 10876 23408 提取到的地区: ['河北']
INFO 2025-04-22 14:48:36,203 views 10876 23408 症状提取结果: {'plant_part': '叶片', 'region': '河北'}
DEBUG 2025-04-22 14:48:36,203 views 10876 23408 检查会话状态: 1
DEBUG 2025-04-22 14:48:36,203 views 10876 23408 当前所有会话: ['1']
DEBUG 2025-04-22 14:48:36,203 views 10876 23408 症状收集状态: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 14:48:36,203 views 10876 23408 更新后的症状信息: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-22 14:48:36,207 views 10876 23408 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片
- 发病地区：河北

还需要补充的信息：
- 气象条件
- 生育期

INFO 2025-04-22 14:48:39,084 services 10876 23408 ['plant_part', 'region']
INFO 2025-04-22 14:48:39,084 services 10876 23408 Executing query: 
                MATCH (d:Disease)
                OPTIONAL MATCH (d)-[:AFFECTS_PART]->(p:PlantPart)
                OPTIONAL MATCH (d)-[:OCCURS_IN_WEATHER]->(w:Weather)
                OPTIONAL MATCH (d)-[:OCCURS_IN_STAGE]->(s:GrowthStage)
                OPTIONAL MATCH (d)-[:OCCURS_IN_REGION]->(r:Region)
                 WHERE p.name = $plant_part AND r.name = $region
                WITH d, size([x IN [$plant_part, $weather, $growth_stage, $region] WHERE x IS NOT NULL]) as total_symptoms,
                     size([x IN [$plant_part, $weather, $growth_stage, $region] WHERE x IS NOT NULL AND x IN 
                          CASE 
                            WHEN x = $plant_part AND p IS NOT NULL THEN [p.name]
                            WHEN x = $weather AND w IS NOT NULL THEN [w.name]
                            WHEN x = $growth_stage AND s IS NOT NULL THEN [s.name]
                            WHEN x = $region AND r IS NOT NULL THEN [r.name]
                            ELSE []
                          END
                     ]) as matched_symptoms
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       matched_symptoms,
                       toFloat(matched_symptoms) / toFloat(total_symptoms) as match_ratio
                ORDER BY match_ratio DESC
                LIMIT 5
                
INFO 2025-04-22 14:48:39,084 services 10876 23408 With parameters: {'plant_part': '叶片', 'region': '河北'}
DEBUG 2025-04-22 14:48:42,631 views 10876 23408 添加历史记录 - 会话ID: 1, 角色: user
DEBUG 2025-04-22 14:48:42,631 views 10876 23408 消息内容: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗...
DEBUG 2025-04-22 14:48:42,631 views 10876 23408 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 14:48:42,631 views 10876 23408 添加历史记录 - 会话ID: 1, 角色: assistant
DEBUG 2025-04-22 14:48:42,631 views 10876 23408 消息内容: 根据您提供的所有信息（包括之前提到的发病部位：叶片、地区：河北），我暂时无法确定具体病害。请补充更多信息，特别是：气象条件、生育期...
DEBUG 2025-04-22 14:48:42,631 views 10876 23408 历史记录更新成功，当前长度: 2
INFO 2025-04-22 14:48:42,631 basehttp 10876 23408 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%8E%B0%E5%9C%A8%E5%9C%A8%E6%B2%B3%E5%8C%97%EF%BC%8C%E8%80%8C%E4%B8%94%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E7%9A%84%E9%97%AE%E9%A2%98%E4%B8%BB%E8%A6%81%E5%8F%91%E7%94%9F%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%EF%BC%8C%E8%AF%B7%E9%97%AE%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E6%98%AF%E6%9C%89%E4%BB%80%E4%B9%88%E7%97%87%E7%8A%B6%E5%90%97&session_id=1 HTTP/1.1" 200 1358
INFO 2025-04-22 14:48:44,982 views 10876 16708 Neo4j服务初始化成功
DEBUG 2025-04-22 14:48:47,041 views 10876 16708 ChatAPI实例初始化完成
INFO 2025-04-22 14:48:47,041 basehttp 10876 16708 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 14:50:00,722 autoreload 10876 9476 D:\GraduationProject\wheatdisease\chat\services.py changed, reloading.
INFO 2025-04-22 14:50:01,638 autoreload 12292 21800 Watching for file changes with StatReloader
INFO 2025-04-22 14:50:09,344 views 12292 18228 Neo4j服务初始化成功
DEBUG 2025-04-22 14:50:11,368 views 12292 18228 ChatAPI实例初始化完成
DEBUG 2025-04-22 14:50:11,371 views 12292 18228 收到stream_chat请求: {'message': ['我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'], 'session_id': ['1']}
DEBUG 2025-04-22 14:50:11,371 views 12292 18228 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 14:50:11,371 views 12292 18228 处理消息: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗, 会话ID: 1
DEBUG 2025-04-22 14:50:11,371 views 12292 18228 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'}]
DEBUG 2025-04-22 14:50:11,371 views 12292 18228 构建的消息列表长度: 2
DEBUG 2025-04-22 14:50:11,371 views 12292 18228 检查会话状态: 1
DEBUG 2025-04-22 14:50:11,375 views 12292 18228 当前所有会话: []
DEBUG 2025-04-22 14:50:11,375 views 12292 18228 症状收集状态: {}
INFO 2025-04-22 14:50:11,375 views 12292 18228 创建新会话: 1
INFO 2025-04-22 14:50:11,375 views 12292 18228 初始化症状收集状态: 1
DEBUG 2025-04-22 14:50:11,375 views 12292 18228 当前症状信息: {}
DEBUG 2025-04-22 14:50:11,375 views 12292 18228 开始提取症状，输入消息: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗
DEBUG 2025-04-22 14:50:11,375 views 12292 18228 分句结果: ['我现在在河北', '而且我的小麦的问题主要发生在叶片上', '请问我的小麦是有什么症状吗', '我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗']
DEBUG 2025-04-22 14:50:11,375 views 12292 18228 提取到的发病部位: []
DEBUG 2025-04-22 14:50:11,377 views 12292 18228 提取到的气象条件: []
DEBUG 2025-04-22 14:50:11,377 views 12292 18228 提取到的生育期: []
DEBUG 2025-04-22 14:50:11,377 views 12292 18228 提取到的地区: ['河北']
DEBUG 2025-04-22 14:50:11,377 views 12292 18228 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 14:50:11,378 views 12292 18228 提取到的气象条件: []
DEBUG 2025-04-22 14:50:11,378 views 12292 18228 提取到的生育期: []
DEBUG 2025-04-22 14:50:11,378 views 12292 18228 提取到的地区: []
DEBUG 2025-04-22 14:50:11,378 views 12292 18228 提取到的发病部位: []
DEBUG 2025-04-22 14:50:11,378 views 12292 18228 提取到的气象条件: []
DEBUG 2025-04-22 14:50:11,380 views 12292 18228 提取到的生育期: []
DEBUG 2025-04-22 14:50:11,380 views 12292 18228 提取到的地区: []
DEBUG 2025-04-22 14:50:11,380 views 12292 18228 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 14:50:11,380 views 12292 18228 提取到的气象条件: []
DEBUG 2025-04-22 14:50:11,380 views 12292 18228 提取到的生育期: []
DEBUG 2025-04-22 14:50:11,381 views 12292 18228 提取到的地区: ['河北']
INFO 2025-04-22 14:50:11,381 views 12292 18228 症状提取结果: {'plant_part': '叶片', 'region': '河北'}
DEBUG 2025-04-22 14:50:11,381 views 12292 18228 检查会话状态: 1
DEBUG 2025-04-22 14:50:11,381 views 12292 18228 当前所有会话: ['1']
DEBUG 2025-04-22 14:50:11,381 views 12292 18228 症状收集状态: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 14:50:11,382 views 12292 18228 更新后的症状信息: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-22 14:50:11,382 views 12292 18228 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片
- 发病地区：河北

还需要补充的信息：
- 气象条件
- 生育期

INFO 2025-04-22 14:50:14,266 services 12292 18228 ['plant_part', 'region']
INFO 2025-04-22 14:50:14,268 services 12292 18228 Executing query: 
                MATCH (d:Disease)
                OPTIONAL MATCH (d)-[:AFFECTS_PART]->(p:PlantPart)
                OPTIONAL MATCH (d)-[:OCCURS_IN_WEATHER]->(w:Weather)
                OPTIONAL MATCH (d)-[:OCCURS_IN_STAGE]->(s:GrowthStage)
                OPTIONAL MATCH (d)-[:OCCURS_IN_REGION]->(r:Region)
                 WHERE p.name = $plant_part AND r.name = $region
                WITH d, size([x IN [$plant_part, $weather, $growth_stage, $region] WHERE x IS NOT NULL]) as total_symptoms,
                     size([x IN [$plant_part, $weather, $growth_stage, $region] WHERE x IS NOT NULL AND x IN 
                          CASE 
                            WHEN x = $plant_part AND p IS NOT NULL THEN [p.name]
                            WHEN x = $weather AND w IS NOT NULL THEN [w.name]
                            WHEN x = $growth_stage AND s IS NOT NULL THEN [s.name]
                            WHEN x = $region AND r IS NOT NULL THEN [r.name]
                            ELSE []
                          END
                     ]) as matched_symptoms
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       matched_symptoms,
                       toFloat(matched_symptoms) / toFloat(total_symptoms) as match_ratio
                ORDER BY match_ratio DESC
                LIMIT 5
                
INFO 2025-04-22 14:50:14,279 services 12292 18228 With parameters: {'plant_part': '叶片', 'region': '河北'}
DEBUG 2025-04-22 14:50:17,753 views 12292 18228 添加历史记录 - 会话ID: 1, 角色: user
DEBUG 2025-04-22 14:50:17,753 views 12292 18228 消息内容: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗...
DEBUG 2025-04-22 14:50:17,753 views 12292 18228 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 14:50:17,753 views 12292 18228 添加历史记录 - 会话ID: 1, 角色: assistant
DEBUG 2025-04-22 14:50:17,753 views 12292 18228 消息内容: 根据您提供的所有信息（包括之前提到的发病部位：叶片、地区：河北），我暂时无法确定具体病害。请补充更多信息，特别是：气象条件、生育期...
DEBUG 2025-04-22 14:50:17,753 views 12292 18228 历史记录更新成功，当前长度: 2
INFO 2025-04-22 14:50:17,753 basehttp 12292 18228 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%8E%B0%E5%9C%A8%E5%9C%A8%E6%B2%B3%E5%8C%97%EF%BC%8C%E8%80%8C%E4%B8%94%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E7%9A%84%E9%97%AE%E9%A2%98%E4%B8%BB%E8%A6%81%E5%8F%91%E7%94%9F%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%EF%BC%8C%E8%AF%B7%E9%97%AE%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E6%98%AF%E6%9C%89%E4%BB%80%E4%B9%88%E7%97%87%E7%8A%B6%E5%90%97&session_id=1 HTTP/1.1" 200 1358
INFO 2025-04-22 14:50:20,145 views 12292 3804 Neo4j服务初始化成功
DEBUG 2025-04-22 14:50:22,167 views 12292 3804 ChatAPI实例初始化完成
INFO 2025-04-22 14:50:22,167 basehttp 12292 3804 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 14:51:02,592 autoreload 12292 21800 D:\GraduationProject\wheatdisease\chat\services.py changed, reloading.
INFO 2025-04-22 14:51:03,412 autoreload 17056 5044 Watching for file changes with StatReloader
INFO 2025-04-22 14:51:23,588 autoreload 17056 5044 D:\GraduationProject\wheatdisease\chat\services.py changed, reloading.
INFO 2025-04-22 14:51:24,378 autoreload 13536 24124 Watching for file changes with StatReloader
INFO 2025-04-22 14:51:35,892 views 13536 16328 Neo4j服务初始化成功
DEBUG 2025-04-22 14:51:37,950 views 13536 16328 ChatAPI实例初始化完成
DEBUG 2025-04-22 14:51:37,950 views 13536 16328 收到stream_chat请求: {'message': ['我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'], 'session_id': ['1']}
DEBUG 2025-04-22 14:51:37,950 views 13536 16328 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 14:51:37,954 views 13536 16328 处理消息: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗, 会话ID: 1
DEBUG 2025-04-22 14:51:37,954 views 13536 16328 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'}]
DEBUG 2025-04-22 14:51:37,954 views 13536 16328 构建的消息列表长度: 2
DEBUG 2025-04-22 14:51:37,954 views 13536 16328 检查会话状态: 1
DEBUG 2025-04-22 14:51:37,954 views 13536 16328 当前所有会话: []
DEBUG 2025-04-22 14:51:37,954 views 13536 16328 症状收集状态: {}
INFO 2025-04-22 14:51:37,954 views 13536 16328 创建新会话: 1
INFO 2025-04-22 14:51:37,954 views 13536 16328 初始化症状收集状态: 1
DEBUG 2025-04-22 14:51:37,954 views 13536 16328 当前症状信息: {}
DEBUG 2025-04-22 14:51:37,954 views 13536 16328 开始提取症状，输入消息: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗
DEBUG 2025-04-22 14:51:37,957 views 13536 16328 分句结果: ['我现在在河北', '而且我的小麦的问题主要发生在叶片上', '请问我的小麦是有什么症状吗', '我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗']
DEBUG 2025-04-22 14:51:37,957 views 13536 16328 提取到的发病部位: []
DEBUG 2025-04-22 14:51:37,958 views 13536 16328 提取到的气象条件: []
DEBUG 2025-04-22 14:51:37,958 views 13536 16328 提取到的生育期: []
DEBUG 2025-04-22 14:51:37,958 views 13536 16328 提取到的地区: ['河北']
DEBUG 2025-04-22 14:51:37,959 views 13536 16328 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 14:51:37,959 views 13536 16328 提取到的气象条件: []
DEBUG 2025-04-22 14:51:37,959 views 13536 16328 提取到的生育期: []
DEBUG 2025-04-22 14:51:37,959 views 13536 16328 提取到的地区: []
DEBUG 2025-04-22 14:51:37,959 views 13536 16328 提取到的发病部位: []
DEBUG 2025-04-22 14:51:37,959 views 13536 16328 提取到的气象条件: []
DEBUG 2025-04-22 14:51:37,959 views 13536 16328 提取到的生育期: []
DEBUG 2025-04-22 14:51:37,959 views 13536 16328 提取到的地区: []
DEBUG 2025-04-22 14:51:37,959 views 13536 16328 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 14:51:37,959 views 13536 16328 提取到的气象条件: []
DEBUG 2025-04-22 14:51:37,959 views 13536 16328 提取到的生育期: []
DEBUG 2025-04-22 14:51:37,959 views 13536 16328 提取到的地区: ['河北']
INFO 2025-04-22 14:51:37,959 views 13536 16328 症状提取结果: {'plant_part': '叶片', 'region': '河北'}
DEBUG 2025-04-22 14:51:37,959 views 13536 16328 检查会话状态: 1
DEBUG 2025-04-22 14:51:37,959 views 13536 16328 当前所有会话: ['1']
DEBUG 2025-04-22 14:51:37,959 views 13536 16328 症状收集状态: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 14:51:37,959 views 13536 16328 更新后的症状信息: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-22 14:51:37,959 views 13536 16328 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片
- 发病地区：河北

还需要补充的信息：
- 气象条件
- 生育期

INFO 2025-04-22 14:51:40,841 services 13536 16328 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-22 14:51:40,841 services 13536 16328 Executing query: 
                MATCH (d:Disease)
                OPTIONAL MATCH (d)-[:AFFECTS_PART]->(p:PlantPart)
                OPTIONAL MATCH (d)-[:OCCURS_IN_WEATHER]->(w:Weather)
                OPTIONAL MATCH (d)-[:OCCURS_IN_STAGE]->(s:GrowthStage)
                OPTIONAL MATCH (d)-[:OCCURS_IN_REGION]->(r:Region)
                 WHERE p.name = $plant_part AND r.name = $region
                WITH d, size([x IN [$plant_part, $weather, $growth_stage, $region] WHERE x IS NOT NULL]) as total_symptoms,
                     size([x IN [$plant_part, $weather, $growth_stage, $region] WHERE x IS NOT NULL AND x IN 
                          CASE 
                            WHEN x = $plant_part AND p IS NOT NULL THEN [p.name]
                            WHEN x = $weather AND w IS NOT NULL THEN [w.name]
                            WHEN x = $growth_stage AND s IS NOT NULL THEN [s.name]
                            WHEN x = $region AND r IS NOT NULL THEN [r.name]
                            ELSE []
                          END
                     ]) as matched_symptoms
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       matched_symptoms,
                       toFloat(matched_symptoms) / toFloat(total_symptoms) as match_ratio
                ORDER BY match_ratio DESC
                LIMIT 5
                
INFO 2025-04-22 14:51:40,850 services 13536 16328 With parameters: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-22 14:51:41,193 services 13536 16328 查询结果: <neo4j._sync.work.result.Result object at 0x000001BBD813F440>
DEBUG 2025-04-22 14:52:11,150 views 13536 16328 添加历史记录 - 会话ID: 1, 角色: user
DEBUG 2025-04-22 14:52:11,150 views 13536 16328 消息内容: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗...
DEBUG 2025-04-22 14:52:11,150 views 13536 16328 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 14:52:11,150 views 13536 16328 添加历史记录 - 会话ID: 1, 角色: assistant
DEBUG 2025-04-22 14:52:11,150 views 13536 16328 消息内容: 根据目前掌握的信息（发病部位：叶片，地区：河北），可能的病害有：

1. 小麦叶锈病
   主要特征: 夏孢子堆圆形至长椭圆形，桔红色，散生，成熟后表皮开裂散出夏孢子；冬孢子堆主要在叶片背面和叶鞘上，...
DEBUG 2025-04-22 14:52:11,150 views 13536 16328 历史记录更新成功，当前长度: 2
INFO 2025-04-22 14:52:11,150 basehttp 13536 16328 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%8E%B0%E5%9C%A8%E5%9C%A8%E6%B2%B3%E5%8C%97%EF%BC%8C%E8%80%8C%E4%B8%94%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E7%9A%84%E9%97%AE%E9%A2%98%E4%B8%BB%E8%A6%81%E5%8F%91%E7%94%9F%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%EF%BC%8C%E8%AF%B7%E9%97%AE%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E6%98%AF%E6%9C%89%E4%BB%80%E4%B9%88%E7%97%87%E7%8A%B6%E5%90%97&session_id=1 HTTP/1.1" 200 6908
INFO 2025-04-22 14:52:13,908 views 13536 3224 Neo4j服务初始化成功
DEBUG 2025-04-22 14:52:15,943 views 13536 3224 ChatAPI实例初始化完成
INFO 2025-04-22 14:52:15,947 basehttp 13536 3224 "GET /api/chat/get_history/ HTTP/1.1" 200 37
WARNING 2025-04-22 14:53:19,103 log 13536 16700 Not Found: /api/knowledge/graph/
WARNING 2025-04-22 14:53:19,106 basehttp 13536 16700 "GET /api/knowledge/graph/ HTTP/1.1" 404 12845
WARNING 2025-04-22 14:53:31,016 log 13536 16700 Not Found: /api/knowledge/graph/
WARNING 2025-04-22 14:53:31,017 basehttp 13536 16700 "GET /api/knowledge/graph/ HTTP/1.1" 404 12845
INFO 2025-04-22 14:55:04,209 autoreload 13536 24124 D:\GraduationProject\wheatdisease\knowledge\views.py changed, reloading.
INFO 2025-04-22 14:55:05,028 autoreload 4228 7028 Watching for file changes with StatReloader
INFO 2025-04-22 14:55:47,020 autoreload 4228 7028 D:\GraduationProject\wheatdisease\knowledge\views.py changed, reloading.
INFO 2025-04-22 14:55:47,814 autoreload 9928 11020 Watching for file changes with StatReloader
WARNING 2025-04-22 14:55:51,372 log 9928 20180 Not Found: /api/knowledge/graph/
WARNING 2025-04-22 14:55:51,372 basehttp 9928 20180 "GET /api/knowledge/graph/ HTTP/1.1" 404 12845
WARNING 2025-04-22 14:55:55,103 log 9928 20180 Not Found: /api/knowledge/graph/
WARNING 2025-04-22 14:55:55,103 basehttp 9928 20180 "GET /api/knowledge/graph/ HTTP/1.1" 404 12845
INFO 2025-04-22 14:56:56,478 autoreload 9928 11020 D:\GraduationProject\wheatdisease\knowledge\urls.py changed, reloading.
INFO 2025-04-22 14:56:57,265 autoreload 21688 14236 Watching for file changes with StatReloader
INFO 2025-04-22 14:58:39,416 basehttp 21688 20200 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
INFO 2025-04-22 14:58:39,735 basehttp 21688 10148 "OPTIONS /api/knowledge/graph/ HTTP/1.1" 200 0
INFO 2025-04-22 14:58:43,933 basehttp 21688 10148 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
INFO 2025-04-22 14:58:59,648 basehttp 21688 10148 "OPTIONS /api/knowledge/get_node_subgraph/?node=%E6%B2%B3%E5%8C%97&type=region HTTP/1.1" 200 0
INFO 2025-04-22 14:59:03,806 basehttp 21688 10148 "GET /api/knowledge/get_node_subgraph/?node=%E6%B2%B3%E5%8C%97&type=region HTTP/1.1" 200 1845
INFO 2025-04-22 15:04:51,658 autoreload 21688 14236 D:\GraduationProject\wheatdisease\knowledge\views.py changed, reloading.
INFO 2025-04-22 15:04:52,459 autoreload 14772 13484 Watching for file changes with StatReloader
INFO 2025-04-22 15:09:23,110 autoreload 14772 13484 D:\GraduationProject\wheatdisease\knowledge\views.py changed, reloading.
INFO 2025-04-22 15:09:24,014 autoreload 5224 22996 Watching for file changes with StatReloader
INFO 2025-04-22 15:09:27,908 autoreload 5224 22996 D:\GraduationProject\wheatdisease\knowledge\views.py changed, reloading.
INFO 2025-04-22 15:09:28,712 autoreload 21276 16364 Watching for file changes with StatReloader
INFO 2025-04-22 15:10:19,269 autoreload 21276 16364 D:\GraduationProject\wheatdisease\knowledge\views.py changed, reloading.
INFO 2025-04-22 15:10:20,056 autoreload 19900 16488 Watching for file changes with StatReloader
INFO 2025-04-22 15:10:43,386 autoreload 19900 16488 D:\GraduationProject\wheatdisease\knowledge\views.py changed, reloading.
INFO 2025-04-22 15:10:44,366 autoreload 16220 15256 Watching for file changes with StatReloader
INFO 2025-04-22 15:10:49,191 autoreload 16220 15256 D:\GraduationProject\wheatdisease\knowledge\views.py changed, reloading.
INFO 2025-04-22 15:10:50,070 autoreload 7644 20652 Watching for file changes with StatReloader
INFO 2025-04-22 15:10:53,805 autoreload 7644 20652 D:\GraduationProject\wheatdisease\knowledge\views.py changed, reloading.
INFO 2025-04-22 15:10:54,575 autoreload 24428 3680 Watching for file changes with StatReloader
INFO 2025-04-22 15:11:04,793 autoreload 24428 3680 D:\GraduationProject\wheatdisease\knowledge\views.py changed, reloading.
INFO 2025-04-22 15:11:05,568 autoreload 13288 19728 Watching for file changes with StatReloader
INFO 2025-04-22 15:12:36,379 autoreload 13288 19728 D:\GraduationProject\wheatdisease\chat\services.py changed, reloading.
INFO 2025-04-22 15:12:37,205 autoreload 11948 24228 Watching for file changes with StatReloader
INFO 2025-04-22 15:13:00,654 autoreload 11948 24228 D:\GraduationProject\wheatdisease\chat\services.py changed, reloading.
INFO 2025-04-22 15:13:01,452 autoreload 21584 13784 Watching for file changes with StatReloader
INFO 2025-04-22 15:13:11,899 views 21584 10816 Neo4j服务初始化成功
DEBUG 2025-04-22 15:13:13,956 views 21584 10816 ChatAPI实例初始化完成
INFO 2025-04-22 15:13:13,956 basehttp 21584 10816 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 15:13:16,297 views 21584 16400 Neo4j服务初始化成功
DEBUG 2025-04-22 15:13:18,345 views 21584 16400 ChatAPI实例初始化完成
INFO 2025-04-22 15:13:18,346 basehttp 21584 16400 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:13:20,655 views 21584 18852 Neo4j服务初始化成功
INFO 2025-04-22 15:13:21,303 views 21584 9432 Neo4j服务初始化成功
DEBUG 2025-04-22 15:13:22,690 views 21584 18852 ChatAPI实例初始化完成
INFO 2025-04-22 15:13:22,694 basehttp 21584 18852 "GET /api/chat/get_history/ HTTP/1.1" 200 37
DEBUG 2025-04-22 15:13:23,351 views 21584 9432 ChatAPI实例初始化完成
DEBUG 2025-04-22 15:13:23,353 views 21584 9432 收到stream_chat请求: {'message': ['我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'], 'session_id': ['1']}
DEBUG 2025-04-22 15:13:23,353 views 21584 9432 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 15:13:23,361 views 21584 9432 处理消息: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗, 会话ID: 1
DEBUG 2025-04-22 15:13:23,363 views 21584 9432 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'}]
DEBUG 2025-04-22 15:13:23,364 views 21584 9432 构建的消息列表长度: 2
DEBUG 2025-04-22 15:13:23,364 views 21584 9432 检查会话状态: 1
DEBUG 2025-04-22 15:13:23,368 views 21584 9432 当前所有会话: []
DEBUG 2025-04-22 15:13:23,369 views 21584 9432 症状收集状态: {}
INFO 2025-04-22 15:13:23,369 views 21584 9432 创建新会话: 1
INFO 2025-04-22 15:13:23,370 views 21584 9432 初始化症状收集状态: 1
DEBUG 2025-04-22 15:13:23,371 views 21584 9432 当前症状信息: {}
DEBUG 2025-04-22 15:13:23,371 views 21584 9432 开始提取症状，输入消息: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗
DEBUG 2025-04-22 15:13:23,372 views 21584 9432 分句结果: ['我现在在河北', '而且我的小麦的问题主要发生在叶片上', '请问我的小麦是有什么症状吗', '我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗']
DEBUG 2025-04-22 15:13:23,373 views 21584 9432 提取到的发病部位: []
DEBUG 2025-04-22 15:13:23,374 views 21584 9432 提取到的气象条件: []
DEBUG 2025-04-22 15:13:23,374 views 21584 9432 提取到的生育期: []
DEBUG 2025-04-22 15:13:23,375 views 21584 9432 提取到的地区: ['河北']
DEBUG 2025-04-22 15:13:23,375 views 21584 9432 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 15:13:23,376 views 21584 9432 提取到的气象条件: []
DEBUG 2025-04-22 15:13:23,376 views 21584 9432 提取到的生育期: []
DEBUG 2025-04-22 15:13:23,376 views 21584 9432 提取到的地区: []
DEBUG 2025-04-22 15:13:23,376 views 21584 9432 提取到的发病部位: []
DEBUG 2025-04-22 15:13:23,377 views 21584 9432 提取到的气象条件: []
DEBUG 2025-04-22 15:13:23,377 views 21584 9432 提取到的生育期: []
DEBUG 2025-04-22 15:13:23,377 views 21584 9432 提取到的地区: []
DEBUG 2025-04-22 15:13:23,378 views 21584 9432 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 15:13:23,378 views 21584 9432 提取到的气象条件: []
DEBUG 2025-04-22 15:13:23,379 views 21584 9432 提取到的生育期: []
DEBUG 2025-04-22 15:13:23,379 views 21584 9432 提取到的地区: ['河北']
INFO 2025-04-22 15:13:23,379 views 21584 9432 症状提取结果: {'plant_part': '叶片', 'region': '河北'}
DEBUG 2025-04-22 15:13:23,379 views 21584 9432 检查会话状态: 1
DEBUG 2025-04-22 15:13:23,379 views 21584 9432 当前所有会话: ['1']
DEBUG 2025-04-22 15:13:23,379 views 21584 9432 症状收集状态: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 15:13:23,379 views 21584 9432 更新后的症状信息: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-22 15:13:23,380 views 21584 9432 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片
- 发病地区：河北

还需要补充的信息：
- 气象条件
- 生育期

INFO 2025-04-22 15:13:26,254 services 21584 9432 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-22 15:13:26,254 services 21584 9432 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) MATCH (d)-[:OCCURS_IN_REGION]->(r:Region {name: $region}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                
INFO 2025-04-22 15:13:26,254 services 21584 9432 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-22 15:13:26,343 services 21584 9432 查询结果: <neo4j._sync.work.result.Result object at 0x00000204C6791C40>
DEBUG 2025-04-22 15:13:40,385 views 21584 9432 添加历史记录 - 会话ID: 1, 角色: user
DEBUG 2025-04-22 15:13:40,385 views 21584 9432 消息内容: 我现在在河北，而且我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗...
DEBUG 2025-04-22 15:13:40,385 views 21584 9432 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 15:13:40,389 views 21584 9432 添加历史记录 - 会话ID: 1, 角色: assistant
DEBUG 2025-04-22 15:13:40,389 views 21584 9432 消息内容: 根据您提供的信息（发病部位：叶片，地区：河北），诊断结果为小麦叶锈病。

病害特征：
夏孢子堆圆形至长椭圆形，桔红色，散生，成熟后表皮开裂散出夏孢子；冬孢子堆主要在叶片背面和叶鞘上，圆形或长椭圆形，黑...
DEBUG 2025-04-22 15:13:40,391 views 21584 9432 历史记录更新成功，当前长度: 2
INFO 2025-04-22 15:13:40,392 basehttp 21584 9432 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%8E%B0%E5%9C%A8%E5%9C%A8%E6%B2%B3%E5%8C%97%EF%BC%8C%E8%80%8C%E4%B8%94%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E7%9A%84%E9%97%AE%E9%A2%98%E4%B8%BB%E8%A6%81%E5%8F%91%E7%94%9F%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%EF%BC%8C%E8%AF%B7%E9%97%AE%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E6%98%AF%E6%9C%89%E4%BB%80%E4%B9%88%E7%97%87%E7%8A%B6%E5%90%97&session_id=1 HTTP/1.1" 200 3538
INFO 2025-04-22 15:13:43,135 views 21584 16640 Neo4j服务初始化成功
DEBUG 2025-04-22 15:13:45,200 views 21584 16640 ChatAPI实例初始化完成
INFO 2025-04-22 15:13:45,203 basehttp 21584 16640 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:14:57,824 autoreload 21584 13784 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 15:14:58,625 autoreload 9492 22188 Watching for file changes with StatReloader
INFO 2025-04-22 15:15:11,548 views 9492 23624 Neo4j服务初始化成功
DEBUG 2025-04-22 15:15:13,589 views 9492 23624 ChatAPI实例初始化完成
INFO 2025-04-22 15:15:13,589 basehttp 9492 23624 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 15:15:15,911 views 9492 9040 Neo4j服务初始化成功
DEBUG 2025-04-22 15:15:17,968 views 9492 9040 ChatAPI实例初始化完成
INFO 2025-04-22 15:15:17,970 basehttp 9492 9040 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:15:20,318 views 9492 17796 Neo4j服务初始化成功
DEBUG 2025-04-22 15:15:22,362 views 9492 17796 ChatAPI实例初始化完成
INFO 2025-04-22 15:15:22,366 basehttp 9492 17796 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:15:25,769 views 9492 17568 Neo4j服务初始化成功
DEBUG 2025-04-22 15:15:27,806 views 9492 17568 ChatAPI实例初始化完成
DEBUG 2025-04-22 15:15:27,806 views 9492 17568 收到stream_chat请求: {'message': ['你好，我的小麦好像生病了'], 'session_id': ['2']}
DEBUG 2025-04-22 15:15:27,810 views 9492 17568 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 15:15:27,810 views 9492 17568 处理消息: 你好，我的小麦好像生病了, 会话ID: 2
DEBUG 2025-04-22 15:15:27,810 views 9492 17568 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好，我的小麦好像生病了'}]
DEBUG 2025-04-22 15:15:27,810 views 9492 17568 构建的消息列表长度: 2
DEBUG 2025-04-22 15:15:27,810 views 9492 17568 检查会话状态: 2
DEBUG 2025-04-22 15:15:27,810 views 9492 17568 当前所有会话: []
DEBUG 2025-04-22 15:15:27,810 views 9492 17568 症状收集状态: {}
INFO 2025-04-22 15:15:27,810 views 9492 17568 创建新会话: 2
INFO 2025-04-22 15:15:27,810 views 9492 17568 初始化症状收集状态: 2
DEBUG 2025-04-22 15:15:27,810 views 9492 17568 当前症状信息: {}
DEBUG 2025-04-22 15:15:27,810 views 9492 17568 开始提取症状，输入消息: 你好，我的小麦好像生病了
DEBUG 2025-04-22 15:15:27,814 views 9492 17568 分句结果: ['你好', '我的小麦好像生病了', '你好，我的小麦好像生病了']
DEBUG 2025-04-22 15:15:27,814 views 9492 17568 提取到的发病部位: []
DEBUG 2025-04-22 15:15:27,814 views 9492 17568 提取到的气象条件: []
DEBUG 2025-04-22 15:15:27,814 views 9492 17568 提取到的生育期: []
DEBUG 2025-04-22 15:15:27,814 views 9492 17568 提取到的地区: []
DEBUG 2025-04-22 15:15:27,815 views 9492 17568 提取到的发病部位: []
DEBUG 2025-04-22 15:15:27,815 views 9492 17568 提取到的气象条件: []
DEBUG 2025-04-22 15:15:27,815 views 9492 17568 提取到的生育期: []
DEBUG 2025-04-22 15:15:27,816 views 9492 17568 提取到的地区: []
DEBUG 2025-04-22 15:15:27,816 views 9492 17568 提取到的发病部位: []
DEBUG 2025-04-22 15:15:27,816 views 9492 17568 提取到的气象条件: []
DEBUG 2025-04-22 15:15:27,816 views 9492 17568 提取到的生育期: []
DEBUG 2025-04-22 15:15:27,816 views 9492 17568 提取到的地区: []
INFO 2025-04-22 15:15:27,817 views 9492 17568 症状提取结果: {}
DEBUG 2025-04-22 15:15:27,817 views 9492 17568 检查会话状态: 2
DEBUG 2025-04-22 15:15:27,818 views 9492 17568 当前所有会话: ['2']
DEBUG 2025-04-22 15:15:27,818 views 9492 17568 症状收集状态: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 15:15:27,818 views 9492 17568 更新后的症状信息: {}
DEBUG 2025-04-22 15:15:30,848 views 9492 17568 添加历史记录 - 会话ID: 2, 角色: user
DEBUG 2025-04-22 15:15:30,848 views 9492 17568 消息内容: 你好，我的小麦好像生病了...
DEBUG 2025-04-22 15:15:30,848 views 9492 17568 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 15:15:30,852 views 9492 17568 添加历史记录 - 会话ID: 2, 角色: assistant
DEBUG 2025-04-22 15:15:30,852 views 9492 17568 消息内容: 请告诉我小麦的发病情况，包括：
1. 从哪个部位开始发病
2. 发病时的气象条件
3. 发病的生育期
4. 发病的地区...
DEBUG 2025-04-22 15:15:30,855 views 9492 17568 历史记录更新成功，当前长度: 2
INFO 2025-04-22 15:15:30,858 basehttp 9492 17568 "GET /api/chat/stream_chat/?message=%E4%BD%A0%E5%A5%BD%EF%BC%8C%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%A5%BD%E5%83%8F%E7%94%9F%E7%97%85%E4%BA%86&session_id=2 HTTP/1.1" 200 666
INFO 2025-04-22 15:15:33,209 views 9492 17744 Neo4j服务初始化成功
DEBUG 2025-04-22 15:15:35,256 views 9492 17744 ChatAPI实例初始化完成
INFO 2025-04-22 15:15:35,256 basehttp 9492 17744 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:15:52,436 views 9492 7644 Neo4j服务初始化成功
DEBUG 2025-04-22 15:15:54,493 views 9492 7644 ChatAPI实例初始化完成
DEBUG 2025-04-22 15:15:54,493 views 9492 7644 收到stream_chat请求: {'message': ['我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'], 'session_id': ['2']}
DEBUG 2025-04-22 15:15:54,493 views 9492 7644 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 15:15:54,493 views 9492 7644 处理消息: 我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗, 会话ID: 2
DEBUG 2025-04-22 15:15:54,493 views 9492 7644 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'}]
DEBUG 2025-04-22 15:15:54,493 views 9492 7644 构建的消息列表长度: 2
DEBUG 2025-04-22 15:15:54,497 views 9492 7644 检查会话状态: 2
DEBUG 2025-04-22 15:15:54,497 views 9492 7644 当前所有会话: []
DEBUG 2025-04-22 15:15:54,497 views 9492 7644 症状收集状态: {}
INFO 2025-04-22 15:15:54,497 views 9492 7644 创建新会话: 2
INFO 2025-04-22 15:15:54,497 views 9492 7644 初始化症状收集状态: 2
DEBUG 2025-04-22 15:15:54,497 views 9492 7644 当前症状信息: {}
DEBUG 2025-04-22 15:15:54,497 views 9492 7644 开始提取症状，输入消息: 我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗
DEBUG 2025-04-22 15:15:54,498 views 9492 7644 分句结果: ['我的小麦的问题主要发生在叶片上', '请问我的小麦是有什么症状吗', '我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗']
DEBUG 2025-04-22 15:15:54,498 views 9492 7644 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 15:15:54,498 views 9492 7644 提取到的气象条件: []
DEBUG 2025-04-22 15:15:54,499 views 9492 7644 提取到的生育期: []
DEBUG 2025-04-22 15:15:54,499 views 9492 7644 提取到的地区: []
DEBUG 2025-04-22 15:15:54,500 views 9492 7644 提取到的发病部位: []
DEBUG 2025-04-22 15:15:54,500 views 9492 7644 提取到的气象条件: []
DEBUG 2025-04-22 15:15:54,500 views 9492 7644 提取到的生育期: []
DEBUG 2025-04-22 15:15:54,500 views 9492 7644 提取到的地区: []
DEBUG 2025-04-22 15:15:54,501 views 9492 7644 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 15:15:54,501 views 9492 7644 提取到的气象条件: []
DEBUG 2025-04-22 15:15:54,501 views 9492 7644 提取到的生育期: []
DEBUG 2025-04-22 15:15:54,501 views 9492 7644 提取到的地区: []
INFO 2025-04-22 15:15:54,501 views 9492 7644 症状提取结果: {'plant_part': '叶片'}
DEBUG 2025-04-22 15:15:54,501 views 9492 7644 检查会话状态: 2
DEBUG 2025-04-22 15:15:54,501 views 9492 7644 当前所有会话: ['2']
DEBUG 2025-04-22 15:15:54,501 views 9492 7644 症状收集状态: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 15:15:54,501 views 9492 7644 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-22 15:15:54,501 views 9492 7644 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 发病地区

INFO 2025-04-22 15:15:57,241 services 9492 7644 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-22 15:15:57,242 services 9492 7644 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                
INFO 2025-04-22 15:15:57,242 services 9492 7644 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-22 15:15:57,280 services 9492 7644 查询结果: <neo4j._sync.work.result.Result object at 0x00000128FA15A840>
DEBUG 2025-04-22 15:19:43,555 views 9492 7644 添加历史记录 - 会话ID: 2, 角色: user
DEBUG 2025-04-22 15:19:43,555 views 9492 7644 消息内容: 我的小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗...
DEBUG 2025-04-22 15:19:43,555 views 9492 7644 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 15:19:43,555 views 9492 7644 添加历史记录 - 会话ID: 2, 角色: assistant
DEBUG 2025-04-22 15:19:43,558 views 9492 7644 消息内容: 根据目前掌握的信息（发病部位：叶片），可能的病害有：

1. 小麦黑颖病
   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或...
DEBUG 2025-04-22 15:19:43,558 views 9492 7644 历史记录更新成功，当前长度: 2
INFO 2025-04-22 15:19:43,560 basehttp 9492 7644 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E7%9A%84%E9%97%AE%E9%A2%98%E4%B8%BB%E8%A6%81%E5%8F%91%E7%94%9F%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%EF%BC%8C%E8%AF%B7%E9%97%AE%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E6%98%AF%E6%9C%89%E4%BB%80%E4%B9%88%E7%97%87%E7%8A%B6%E5%90%97&session_id=2 HTTP/1.1" 200 47812
INFO 2025-04-22 15:19:52,165 views 9492 2916 Neo4j服务初始化成功
DEBUG 2025-04-22 15:19:54,231 views 9492 2916 ChatAPI实例初始化完成
INFO 2025-04-22 15:19:54,231 basehttp 9492 2916 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:20:19,583 autoreload 9492 22188 D:\GraduationProject\wheatdisease\chat\services.py changed, reloading.
INFO 2025-04-22 15:20:20,417 autoreload 5272 17060 Watching for file changes with StatReloader
INFO 2025-04-22 15:20:49,245 autoreload 5272 17060 D:\GraduationProject\wheatdisease\chat\services.py changed, reloading.
INFO 2025-04-22 15:20:50,001 autoreload 21696 19188 Watching for file changes with StatReloader
INFO 2025-04-22 15:21:10,044 autoreload 21696 19188 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 15:21:10,834 autoreload 8144 23184 Watching for file changes with StatReloader
INFO 2025-04-22 15:21:25,058 views 8144 12344 Neo4j服务初始化成功
DEBUG 2025-04-22 15:21:27,086 views 8144 12344 ChatAPI实例初始化完成
INFO 2025-04-22 15:21:27,086 basehttp 8144 12344 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 15:21:28,093 views 8144 22160 Neo4j服务初始化成功
INFO 2025-04-22 15:21:29,396 views 8144 3084 Neo4j服务初始化成功
DEBUG 2025-04-22 15:21:30,159 views 8144 22160 ChatAPI实例初始化完成
INFO 2025-04-22 15:21:30,163 basehttp 8144 22160 "POST /api/chat/create_session/ HTTP/1.1" 200 40
DEBUG 2025-04-22 15:21:31,426 views 8144 3084 ChatAPI实例初始化完成
INFO 2025-04-22 15:21:31,427 basehttp 8144 3084 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:21:33,832 views 8144 16912 Neo4j服务初始化成功
INFO 2025-04-22 15:21:33,836 views 8144 23104 Neo4j服务初始化成功
DEBUG 2025-04-22 15:21:35,876 views 8144 16912 ChatAPI实例初始化完成
DEBUG 2025-04-22 15:21:35,880 views 8144 23104 ChatAPI实例初始化完成
DEBUG 2025-04-22 15:21:35,880 views 8144 16912 收到stream_chat请求: {'message': ['你好，我的小麦好像生病了'], 'session_id': ['3']}
DEBUG 2025-04-22 15:21:35,880 views 8144 16912 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
INFO 2025-04-22 15:21:35,880 basehttp 8144 23104 "GET /api/chat/get_history/ HTTP/1.1" 200 37
DEBUG 2025-04-22 15:21:35,884 views 8144 16912 处理消息: 你好，我的小麦好像生病了, 会话ID: 3
DEBUG 2025-04-22 15:21:35,884 views 8144 16912 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好，我的小麦好像生病了'}]
DEBUG 2025-04-22 15:21:35,887 views 8144 16912 构建的消息列表长度: 2
DEBUG 2025-04-22 15:21:35,888 views 8144 16912 检查会话状态: 3
DEBUG 2025-04-22 15:21:35,889 views 8144 16912 当前所有会话: []
DEBUG 2025-04-22 15:21:35,889 views 8144 16912 症状收集状态: {}
INFO 2025-04-22 15:21:35,890 views 8144 16912 创建新会话: 3
INFO 2025-04-22 15:21:35,890 views 8144 16912 初始化症状收集状态: 3
DEBUG 2025-04-22 15:21:35,891 views 8144 16912 当前症状信息: {}
DEBUG 2025-04-22 15:21:35,891 views 8144 16912 开始提取症状，输入消息: 你好，我的小麦好像生病了
DEBUG 2025-04-22 15:21:35,891 views 8144 16912 分句结果: ['你好', '我的小麦好像生病了', '你好，我的小麦好像生病了']
DEBUG 2025-04-22 15:21:35,892 views 8144 16912 提取到的发病部位: []
DEBUG 2025-04-22 15:21:35,892 views 8144 16912 提取到的气象条件: []
DEBUG 2025-04-22 15:21:35,893 views 8144 16912 提取到的生育期: []
DEBUG 2025-04-22 15:21:35,893 views 8144 16912 提取到的地区: []
DEBUG 2025-04-22 15:21:35,894 views 8144 16912 提取到的发病部位: []
DEBUG 2025-04-22 15:21:35,894 views 8144 16912 提取到的气象条件: []
DEBUG 2025-04-22 15:21:35,895 views 8144 16912 提取到的生育期: []
DEBUG 2025-04-22 15:21:35,895 views 8144 16912 提取到的地区: []
DEBUG 2025-04-22 15:21:35,895 views 8144 16912 提取到的发病部位: []
DEBUG 2025-04-22 15:21:35,896 views 8144 16912 提取到的气象条件: []
DEBUG 2025-04-22 15:21:35,896 views 8144 16912 提取到的生育期: []
DEBUG 2025-04-22 15:21:35,896 views 8144 16912 提取到的地区: []
INFO 2025-04-22 15:21:35,897 views 8144 16912 症状提取结果: {}
DEBUG 2025-04-22 15:21:35,897 views 8144 16912 检查会话状态: 3
DEBUG 2025-04-22 15:21:35,897 views 8144 16912 当前所有会话: ['3']
DEBUG 2025-04-22 15:21:35,897 views 8144 16912 症状收集状态: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 15:21:35,898 views 8144 16912 更新后的症状信息: {}
INFO 2025-04-22 15:21:38,199 views 8144 20288 Neo4j服务初始化成功
DEBUG 2025-04-22 15:21:38,946 views 8144 16912 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 15:21:38,946 views 8144 16912 消息内容: 你好，我的小麦好像生病了...
DEBUG 2025-04-22 15:21:38,946 views 8144 16912 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 15:21:38,946 views 8144 16912 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 15:21:38,946 views 8144 16912 消息内容: 请告诉我小麦的发病情况，包括：
1. 从哪个部位开始发病
2. 发病时的气象条件
3. 发病的生育期
4. 发病的地区...
DEBUG 2025-04-22 15:21:38,946 views 8144 16912 历史记录更新成功，当前长度: 2
INFO 2025-04-22 15:21:38,946 basehttp 8144 16912 "GET /api/chat/stream_chat/?message=%E4%BD%A0%E5%A5%BD%EF%BC%8C%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%A5%BD%E5%83%8F%E7%94%9F%E7%97%85%E4%BA%86&session_id=3 HTTP/1.1" 200 666
DEBUG 2025-04-22 15:21:40,243 views 8144 20288 ChatAPI实例初始化完成
DEBUG 2025-04-22 15:21:40,243 views 8144 20288 收到stream_chat请求: {'message': [''], 'session_id': ['3']}
DEBUG 2025-04-22 15:21:40,243 views 8144 20288 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 15:21:40,243 views 8144 20288 处理消息: , 会话ID: 3
WARNING 2025-04-22 15:21:40,243 views 8144 20288 接收到空消息
INFO 2025-04-22 15:21:40,243 basehttp 8144 20288 "GET /api/chat/stream_chat/?message=&session_id=3 HTTP/1.1" 200 34
INFO 2025-04-22 15:21:42,887 views 8144 9800 Neo4j服务初始化成功
DEBUG 2025-04-22 15:21:44,919 views 8144 9800 ChatAPI实例初始化完成
INFO 2025-04-22 15:21:44,919 basehttp 8144 9800 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:21:54,503 views 8144 7536 Neo4j服务初始化成功
DEBUG 2025-04-22 15:21:56,577 views 8144 7536 ChatAPI实例初始化完成
INFO 2025-04-22 15:21:56,577 basehttp 8144 7536 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 15:21:58,929 views 8144 17172 Neo4j服务初始化成功
DEBUG 2025-04-22 15:22:01,005 views 8144 17172 ChatAPI实例初始化完成
INFO 2025-04-22 15:22:01,008 basehttp 8144 17172 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:22:01,962 views 8144 19916 Neo4j服务初始化成功
INFO 2025-04-22 15:22:03,382 views 8144 18008 Neo4j服务初始化成功
DEBUG 2025-04-22 15:22:04,030 views 8144 19916 ChatAPI实例初始化完成
DEBUG 2025-04-22 15:22:04,034 views 8144 19916 收到stream_chat请求: {'message': ['你好，我的小麦好像生病了'], 'session_id': ['3']}
DEBUG 2025-04-22 15:22:04,034 views 8144 19916 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 15:22:04,034 views 8144 19916 处理消息: 你好，我的小麦好像生病了, 会话ID: 3
DEBUG 2025-04-22 15:22:04,038 views 8144 19916 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好，我的小麦好像生病了'}]
DEBUG 2025-04-22 15:22:04,039 views 8144 19916 构建的消息列表长度: 2
DEBUG 2025-04-22 15:22:04,040 views 8144 19916 检查会话状态: 3
DEBUG 2025-04-22 15:22:04,041 views 8144 19916 当前所有会话: []
DEBUG 2025-04-22 15:22:04,041 views 8144 19916 症状收集状态: {}
INFO 2025-04-22 15:22:04,042 views 8144 19916 创建新会话: 3
INFO 2025-04-22 15:22:04,042 views 8144 19916 初始化症状收集状态: 3
DEBUG 2025-04-22 15:22:04,043 views 8144 19916 当前症状信息: {}
DEBUG 2025-04-22 15:22:04,043 views 8144 19916 开始提取症状，输入消息: 你好，我的小麦好像生病了
DEBUG 2025-04-22 15:22:04,044 views 8144 19916 分句结果: ['你好', '我的小麦好像生病了', '你好，我的小麦好像生病了']
DEBUG 2025-04-22 15:22:04,044 views 8144 19916 提取到的发病部位: []
DEBUG 2025-04-22 15:22:04,045 views 8144 19916 提取到的气象条件: []
DEBUG 2025-04-22 15:22:04,045 views 8144 19916 提取到的生育期: []
DEBUG 2025-04-22 15:22:04,046 views 8144 19916 提取到的地区: []
DEBUG 2025-04-22 15:22:04,046 views 8144 19916 提取到的发病部位: []
DEBUG 2025-04-22 15:22:04,046 views 8144 19916 提取到的气象条件: []
DEBUG 2025-04-22 15:22:04,046 views 8144 19916 提取到的生育期: []
DEBUG 2025-04-22 15:22:04,047 views 8144 19916 提取到的地区: []
DEBUG 2025-04-22 15:22:04,047 views 8144 19916 提取到的发病部位: []
DEBUG 2025-04-22 15:22:04,047 views 8144 19916 提取到的气象条件: []
DEBUG 2025-04-22 15:22:04,048 views 8144 19916 提取到的生育期: []
DEBUG 2025-04-22 15:22:04,048 views 8144 19916 提取到的地区: []
INFO 2025-04-22 15:22:04,048 views 8144 19916 症状提取结果: {}
DEBUG 2025-04-22 15:22:04,048 views 8144 19916 检查会话状态: 3
DEBUG 2025-04-22 15:22:04,049 views 8144 19916 当前所有会话: ['3']
DEBUG 2025-04-22 15:22:04,049 views 8144 19916 症状收集状态: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 15:22:04,049 views 8144 19916 更新后的症状信息: {}
DEBUG 2025-04-22 15:22:05,450 views 8144 18008 ChatAPI实例初始化完成
INFO 2025-04-22 15:22:05,452 basehttp 8144 18008 "GET /api/chat/get_history/ HTTP/1.1" 200 37
DEBUG 2025-04-22 15:22:07,093 views 8144 19916 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 15:22:07,093 views 8144 19916 消息内容: 你好，我的小麦好像生病了...
DEBUG 2025-04-22 15:22:07,093 views 8144 19916 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 15:22:07,093 views 8144 19916 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 15:22:07,093 views 8144 19916 消息内容: 请告诉我小麦的发病情况，包括：
1. 从哪个部位开始发病
2. 发病时的气象条件
3. 发病的生育期
4. 发病的地区...
DEBUG 2025-04-22 15:22:07,093 views 8144 19916 历史记录更新成功，当前长度: 2
INFO 2025-04-22 15:22:07,093 basehttp 8144 19916 "GET /api/chat/stream_chat/?message=%E4%BD%A0%E5%A5%BD%EF%BC%8C%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%A5%BD%E5%83%8F%E7%94%9F%E7%97%85%E4%BA%86&session_id=3 HTTP/1.1" 200 666
INFO 2025-04-22 15:22:09,455 views 8144 7636 Neo4j服务初始化成功
DEBUG 2025-04-22 15:22:11,505 views 8144 7636 ChatAPI实例初始化完成
INFO 2025-04-22 15:22:11,506 basehttp 8144 7636 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:22:24,451 views 8144 24084 Neo4j服务初始化成功
DEBUG 2025-04-22 15:22:26,504 views 8144 24084 ChatAPI实例初始化完成
DEBUG 2025-04-22 15:22:26,508 views 8144 24084 收到stream_chat请求: {'message': ['小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'], 'session_id': ['3']}
DEBUG 2025-04-22 15:22:26,508 views 8144 24084 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 15:22:26,508 views 8144 24084 处理消息: 小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗, 会话ID: 3
DEBUG 2025-04-22 15:22:26,508 views 8144 24084 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'}]
DEBUG 2025-04-22 15:22:26,508 views 8144 24084 构建的消息列表长度: 2
DEBUG 2025-04-22 15:22:26,512 views 8144 24084 检查会话状态: 3
DEBUG 2025-04-22 15:22:26,512 views 8144 24084 当前所有会话: []
DEBUG 2025-04-22 15:22:26,512 views 8144 24084 症状收集状态: {}
INFO 2025-04-22 15:22:26,512 views 8144 24084 创建新会话: 3
INFO 2025-04-22 15:22:26,512 views 8144 24084 初始化症状收集状态: 3
DEBUG 2025-04-22 15:22:26,512 views 8144 24084 当前症状信息: {}
DEBUG 2025-04-22 15:22:26,513 views 8144 24084 开始提取症状，输入消息: 小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗
DEBUG 2025-04-22 15:22:26,513 views 8144 24084 分句结果: ['小麦的问题主要发生在叶片上', '请问我的小麦是有什么症状吗', '小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗']
DEBUG 2025-04-22 15:22:26,513 views 8144 24084 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 15:22:26,514 views 8144 24084 提取到的气象条件: []
DEBUG 2025-04-22 15:22:26,514 views 8144 24084 提取到的生育期: []
DEBUG 2025-04-22 15:22:26,514 views 8144 24084 提取到的地区: []
DEBUG 2025-04-22 15:22:26,514 views 8144 24084 提取到的发病部位: []
DEBUG 2025-04-22 15:22:26,514 views 8144 24084 提取到的气象条件: []
DEBUG 2025-04-22 15:22:26,515 views 8144 24084 提取到的生育期: []
DEBUG 2025-04-22 15:22:26,515 views 8144 24084 提取到的地区: []
DEBUG 2025-04-22 15:22:26,515 views 8144 24084 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 15:22:26,515 views 8144 24084 提取到的气象条件: []
DEBUG 2025-04-22 15:22:26,516 views 8144 24084 提取到的生育期: []
DEBUG 2025-04-22 15:22:26,516 views 8144 24084 提取到的地区: []
INFO 2025-04-22 15:22:26,516 views 8144 24084 症状提取结果: {'plant_part': '叶片'}
DEBUG 2025-04-22 15:22:26,516 views 8144 24084 检查会话状态: 3
DEBUG 2025-04-22 15:22:26,516 views 8144 24084 当前所有会话: ['3']
DEBUG 2025-04-22 15:22:26,516 views 8144 24084 症状收集状态: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 15:22:26,517 views 8144 24084 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-22 15:22:26,517 views 8144 24084 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 发病地区

INFO 2025-04-22 15:22:29,248 services 8144 24084 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-22 15:22:29,248 services 8144 24084 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-22 15:22:29,252 services 8144 24084 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-22 15:22:29,302 services 8144 24084 查询结果: <neo4j._sync.work.result.Result object at 0x000001827CE35D00>
DEBUG 2025-04-22 15:22:51,983 views 8144 24084 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 15:22:51,983 views 8144 24084 消息内容: 小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗...
DEBUG 2025-04-22 15:22:51,983 views 8144 24084 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 15:22:51,983 views 8144 24084 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 15:22:51,983 views 8144 24084 消息内容: 根据目前掌握的信息（发病部位：叶片），可能的病害有：

1. 小麦黑颖病
   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或...
DEBUG 2025-04-22 15:22:51,983 views 8144 24084 历史记录更新成功，当前长度: 2
INFO 2025-04-22 15:22:51,983 basehttp 8144 24084 "GET /api/chat/stream_chat/?message=%E5%B0%8F%E9%BA%A6%E7%9A%84%E9%97%AE%E9%A2%98%E4%B8%BB%E8%A6%81%E5%8F%91%E7%94%9F%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%EF%BC%8C%E8%AF%B7%E9%97%AE%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E6%98%AF%E6%9C%89%E4%BB%80%E4%B9%88%E7%97%87%E7%8A%B6%E5%90%97&session_id=3 HTTP/1.1" 200 5351
INFO 2025-04-22 15:22:54,453 views 8144 21220 Neo4j服务初始化成功
DEBUG 2025-04-22 15:22:56,518 views 8144 21220 ChatAPI实例初始化完成
INFO 2025-04-22 15:22:56,521 basehttp 8144 21220 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:23:16,037 views 8144 20600 Neo4j服务初始化成功
DEBUG 2025-04-22 15:23:18,087 views 8144 20600 ChatAPI实例初始化完成
DEBUG 2025-04-22 15:23:18,087 views 8144 20600 收到stream_chat请求: {'message': ['小麦的发病地区是在河北'], 'session_id': ['3']}
DEBUG 2025-04-22 15:23:18,087 views 8144 20600 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 15:23:18,087 views 8144 20600 处理消息: 小麦的发病地区是在河北, 会话ID: 3
DEBUG 2025-04-22 15:23:18,087 views 8144 20600 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '小麦的发病地区是在河北'}]
DEBUG 2025-04-22 15:23:18,087 views 8144 20600 构建的消息列表长度: 2
DEBUG 2025-04-22 15:23:18,091 views 8144 20600 检查会话状态: 3
DEBUG 2025-04-22 15:23:18,091 views 8144 20600 当前所有会话: []
DEBUG 2025-04-22 15:23:18,091 views 8144 20600 症状收集状态: {}
INFO 2025-04-22 15:23:18,091 views 8144 20600 创建新会话: 3
INFO 2025-04-22 15:23:18,091 views 8144 20600 初始化症状收集状态: 3
DEBUG 2025-04-22 15:23:18,091 views 8144 20600 当前症状信息: {}
DEBUG 2025-04-22 15:23:18,091 views 8144 20600 开始提取症状，输入消息: 小麦的发病地区是在河北
DEBUG 2025-04-22 15:23:18,091 views 8144 20600 分句结果: ['小麦的发病地区是在河北', '小麦的发病地区是在河北']
DEBUG 2025-04-22 15:23:18,091 views 8144 20600 提取到的发病部位: []
DEBUG 2025-04-22 15:23:18,091 views 8144 20600 提取到的气象条件: []
DEBUG 2025-04-22 15:23:18,091 views 8144 20600 提取到的生育期: []
DEBUG 2025-04-22 15:23:18,093 views 8144 20600 提取到的地区: ['河北']
DEBUG 2025-04-22 15:23:18,093 views 8144 20600 提取到的发病部位: []
DEBUG 2025-04-22 15:23:18,093 views 8144 20600 提取到的气象条件: []
DEBUG 2025-04-22 15:23:18,093 views 8144 20600 提取到的生育期: []
DEBUG 2025-04-22 15:23:18,093 views 8144 20600 提取到的地区: ['河北']
INFO 2025-04-22 15:23:18,094 views 8144 20600 症状提取结果: {'region': '河北'}
DEBUG 2025-04-22 15:23:18,094 views 8144 20600 检查会话状态: 3
DEBUG 2025-04-22 15:23:18,094 views 8144 20600 当前所有会话: ['3']
DEBUG 2025-04-22 15:23:18,094 views 8144 20600 症状收集状态: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 15:23:18,094 views 8144 20600 更新后的症状信息: {'region': '河北'}
INFO 2025-04-22 15:23:18,094 views 8144 20600 已收集的信息: 目前已经收集到的信息：
- 发病地区：河北

还需要补充的信息：
- 发病部位
- 气象条件
- 生育期

INFO 2025-04-22 15:23:20,813 services 8144 20600 查询参数: {'plant_part': None, 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-22 15:23:20,813 services 8144 20600 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:OCCURS_IN_REGION]->(r:Region {name: $region}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-22 15:23:20,820 services 8144 20600 查询参数: {'plant_part': None, 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-22 15:23:20,853 services 8144 20600 查询结果: <neo4j._sync.work.result.Result object at 0x000001827CE4A720>
DEBUG 2025-04-22 15:23:32,779 views 8144 20600 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 15:23:32,780 views 8144 20600 消息内容: 小麦的发病地区是在河北...
DEBUG 2025-04-22 15:23:32,780 views 8144 20600 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 15:23:32,780 views 8144 20600 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 15:23:32,780 views 8144 20600 消息内容: 根据目前掌握的信息（地区：河北），可能的病害有：

1. 小麦旺长
   主要特征: 冬季气温低时出现冻害，有的影响穗分化，抗寒力下降，引起死苗，导致下年小麦返青晚，穗数不够，造成严重减产...

2...
DEBUG 2025-04-22 15:23:32,784 views 8144 20600 历史记录更新成功，当前长度: 2
INFO 2025-04-22 15:23:32,787 basehttp 8144 20600 "GET /api/chat/stream_chat/?message=%E5%B0%8F%E9%BA%A6%E7%9A%84%E5%8F%91%E7%97%85%E5%9C%B0%E5%8C%BA%E6%98%AF%E5%9C%A8%E6%B2%B3%E5%8C%97&session_id=3 HTTP/1.1" 200 3098
INFO 2025-04-22 15:23:35,322 views 8144 4048 Neo4j服务初始化成功
DEBUG 2025-04-22 15:23:37,362 views 8144 4048 ChatAPI实例初始化完成
INFO 2025-04-22 15:23:37,366 basehttp 8144 4048 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:27:08,254 autoreload 8144 23184 D:\GraduationProject\wheatdisease\chat\services.py changed, reloading.
INFO 2025-04-22 15:27:09,071 autoreload 12828 11504 Watching for file changes with StatReloader
INFO 2025-04-22 15:27:32,680 autoreload 12828 11504 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 15:27:33,501 autoreload 18988 22320 Watching for file changes with StatReloader
INFO 2025-04-22 15:27:37,271 autoreload 18988 22320 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 15:27:38,086 autoreload 17172 19916 Watching for file changes with StatReloader
INFO 2025-04-22 15:29:56,736 autoreload 17172 19916 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 15:29:57,560 autoreload 15296 19420 Watching for file changes with StatReloader
INFO 2025-04-22 15:30:02,537 autoreload 15296 19420 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 15:30:03,345 autoreload 15976 12308 Watching for file changes with StatReloader
INFO 2025-04-22 15:30:08,240 autoreload 15976 12308 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 15:30:09,075 autoreload 20012 21860 Watching for file changes with StatReloader
INFO 2025-04-22 15:30:36,742 autoreload 20012 21860 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 15:30:37,523 autoreload 5488 13164 Watching for file changes with StatReloader
INFO 2025-04-22 15:30:57,700 autoreload 19324 13536 Watching for file changes with StatReloader
INFO 2025-04-22 15:31:52,588 views 19324 7216 Neo4j服务初始化成功
DEBUG 2025-04-22 15:31:54,627 views 19324 7216 ChatAPI实例初始化完成
INFO 2025-04-22 15:31:54,631 basehttp 19324 7216 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 15:31:56,946 views 19324 7140 Neo4j服务初始化成功
DEBUG 2025-04-22 15:31:58,990 views 19324 7140 ChatAPI实例初始化完成
INFO 2025-04-22 15:31:58,994 basehttp 19324 7140 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:32:01,308 views 19324 2732 Neo4j服务初始化成功
INFO 2025-04-22 15:32:02,506 views 19324 10804 Neo4j服务初始化成功
DEBUG 2025-04-22 15:32:03,347 views 19324 2732 ChatAPI实例初始化完成
INFO 2025-04-22 15:32:03,351 basehttp 19324 2732 "GET /api/chat/get_history/ HTTP/1.1" 200 37
DEBUG 2025-04-22 15:32:04,560 views 19324 10804 ChatAPI实例初始化完成
DEBUG 2025-04-22 15:32:04,564 views 19324 10804 收到stream_chat请求: {'message': ['你好，我的小麦好像生病了'], 'session_id': ['3']}
DEBUG 2025-04-22 15:32:04,564 views 19324 10804 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 15:32:04,573 views 19324 10804 处理消息: 你好，我的小麦好像生病了, 会话ID: 3
DEBUG 2025-04-22 15:32:04,575 views 19324 10804 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好，我的小麦好像生病了'}]
DEBUG 2025-04-22 15:32:04,576 views 19324 10804 构建的消息列表长度: 2
INFO 2025-04-22 15:32:04,580 views 19324 10804 检查会话状态: 3
INFO 2025-04-22 15:32:04,580 views 19324 10804 当前所有会话: []
INFO 2025-04-22 15:32:04,580 views 19324 10804 当前症状收集状态: {}
INFO 2025-04-22 15:32:04,580 views 19324 10804 创建新会话: 3
INFO 2025-04-22 15:32:04,583 views 19324 10804 初始化症状收集状态: 3
DEBUG 2025-04-22 15:32:04,584 views 19324 10804 当前症状信息: {}
DEBUG 2025-04-22 15:32:04,585 views 19324 10804 开始提取症状，输入消息: 你好，我的小麦好像生病了
DEBUG 2025-04-22 15:32:04,585 views 19324 10804 分句结果: ['你好', '我的小麦好像生病了', '你好，我的小麦好像生病了']
DEBUG 2025-04-22 15:32:04,586 views 19324 10804 提取到的发病部位: []
DEBUG 2025-04-22 15:32:04,587 views 19324 10804 提取到的气象条件: []
DEBUG 2025-04-22 15:32:04,588 views 19324 10804 提取到的生育期: []
DEBUG 2025-04-22 15:32:04,588 views 19324 10804 提取到的地区: []
DEBUG 2025-04-22 15:32:04,589 views 19324 10804 提取到的发病部位: []
DEBUG 2025-04-22 15:32:04,589 views 19324 10804 提取到的气象条件: []
DEBUG 2025-04-22 15:32:04,589 views 19324 10804 提取到的生育期: []
DEBUG 2025-04-22 15:32:04,590 views 19324 10804 提取到的地区: []
DEBUG 2025-04-22 15:32:04,590 views 19324 10804 提取到的发病部位: []
DEBUG 2025-04-22 15:32:04,590 views 19324 10804 提取到的气象条件: []
DEBUG 2025-04-22 15:32:04,591 views 19324 10804 提取到的生育期: []
DEBUG 2025-04-22 15:32:04,591 views 19324 10804 提取到的地区: []
INFO 2025-04-22 15:32:04,591 views 19324 10804 症状提取结果: {}
INFO 2025-04-22 15:32:04,591 views 19324 10804 更新会话 3 的症状信息
INFO 2025-04-22 15:32:04,591 views 19324 10804 新的症状信息: {}
INFO 2025-04-22 15:32:04,592 views 19324 10804 检查会话状态: 3
INFO 2025-04-22 15:32:04,592 views 19324 10804 当前所有会话: ['3']
INFO 2025-04-22 15:32:04,592 views 19324 10804 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {}}}
INFO 2025-04-22 15:32:04,592 views 19324 10804 已存在的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 15:32:04,592 views 19324 10804 获取到的当前症状信息: {}
INFO 2025-04-22 15:32:04,593 views 19324 10804 更新后的完整症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 15:32:04,593 views 19324 10804 更新后的症状信息: {}
DEBUG 2025-04-22 15:32:07,638 views 19324 10804 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 15:32:07,638 views 19324 10804 消息内容: 你好，我的小麦好像生病了...
DEBUG 2025-04-22 15:32:07,638 views 19324 10804 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 15:32:07,638 views 19324 10804 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 15:32:07,638 views 19324 10804 消息内容: 请告诉我小麦的发病情况，包括：
1. 从哪个部位开始发病
2. 发病时的气象条件
3. 发病的生育期
4. 发病的地区...
DEBUG 2025-04-22 15:32:07,638 views 19324 10804 历史记录更新成功，当前长度: 2
INFO 2025-04-22 15:32:07,638 basehttp 19324 10804 "GET /api/chat/stream_chat/?message=%E4%BD%A0%E5%A5%BD%EF%BC%8C%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%A5%BD%E5%83%8F%E7%94%9F%E7%97%85%E4%BA%86&session_id=3 HTTP/1.1" 200 666
INFO 2025-04-22 15:32:09,975 views 19324 8508 Neo4j服务初始化成功
DEBUG 2025-04-22 15:32:12,042 views 19324 8508 ChatAPI实例初始化完成
INFO 2025-04-22 15:32:12,046 basehttp 19324 8508 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:32:19,074 views 19324 14752 Neo4j服务初始化成功
DEBUG 2025-04-22 15:32:21,106 views 19324 14752 ChatAPI实例初始化完成
DEBUG 2025-04-22 15:32:21,106 views 19324 14752 收到stream_chat请求: {'message': ['小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'], 'session_id': ['3']}
DEBUG 2025-04-22 15:32:21,110 views 19324 14752 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 15:32:21,110 views 19324 14752 处理消息: 小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗, 会话ID: 3
DEBUG 2025-04-22 15:32:21,110 views 19324 14752 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'}]
DEBUG 2025-04-22 15:32:21,110 views 19324 14752 构建的消息列表长度: 2
INFO 2025-04-22 15:32:21,110 views 19324 14752 检查会话状态: 3
INFO 2025-04-22 15:32:21,110 views 19324 14752 当前所有会话: []
INFO 2025-04-22 15:32:21,113 views 19324 14752 当前症状收集状态: {}
INFO 2025-04-22 15:32:21,113 views 19324 14752 创建新会话: 3
INFO 2025-04-22 15:32:21,113 views 19324 14752 初始化症状收集状态: 3
DEBUG 2025-04-22 15:32:21,113 views 19324 14752 当前症状信息: {}
DEBUG 2025-04-22 15:32:21,113 views 19324 14752 开始提取症状，输入消息: 小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗
DEBUG 2025-04-22 15:32:21,114 views 19324 14752 分句结果: ['小麦的问题主要发生在叶片上', '请问我的小麦是有什么症状吗', '小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗']
DEBUG 2025-04-22 15:32:21,114 views 19324 14752 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 15:32:21,114 views 19324 14752 提取到的气象条件: []
DEBUG 2025-04-22 15:32:21,115 views 19324 14752 提取到的生育期: []
DEBUG 2025-04-22 15:32:21,115 views 19324 14752 提取到的地区: []
DEBUG 2025-04-22 15:32:21,115 views 19324 14752 提取到的发病部位: []
DEBUG 2025-04-22 15:32:21,115 views 19324 14752 提取到的气象条件: []
DEBUG 2025-04-22 15:32:21,116 views 19324 14752 提取到的生育期: []
DEBUG 2025-04-22 15:32:21,116 views 19324 14752 提取到的地区: []
DEBUG 2025-04-22 15:32:21,116 views 19324 14752 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 15:32:21,116 views 19324 14752 提取到的气象条件: []
DEBUG 2025-04-22 15:32:21,116 views 19324 14752 提取到的生育期: []
DEBUG 2025-04-22 15:32:21,117 views 19324 14752 提取到的地区: []
INFO 2025-04-22 15:32:21,117 views 19324 14752 症状提取结果: {'plant_part': '叶片'}
INFO 2025-04-22 15:32:21,117 views 19324 14752 更新会话 3 的症状信息
INFO 2025-04-22 15:32:21,117 views 19324 14752 新的症状信息: {'plant_part': '叶片'}
INFO 2025-04-22 15:32:21,117 views 19324 14752 检查会话状态: 3
INFO 2025-04-22 15:32:21,118 views 19324 14752 当前所有会话: ['3']
INFO 2025-04-22 15:32:21,118 views 19324 14752 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {}}}
INFO 2025-04-22 15:32:21,118 views 19324 14752 已存在的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 15:32:21,118 views 19324 14752 获取到的当前症状信息: {}
INFO 2025-04-22 15:32:21,119 views 19324 14752 更新症状类别 plant_part: 叶片
INFO 2025-04-22 15:32:21,119 views 19324 14752 更新后的完整症状信息: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-22 15:32:21,119 views 19324 14752 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-22 15:32:21,119 views 19324 14752 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 发病地区

INFO 2025-04-22 15:32:23,855 services 19324 14752 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-22 15:32:23,855 services 19324 14752 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-22 15:32:23,863 services 19324 14752 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-22 15:32:23,867 services 19324 14752 查询结果: <neo4j._sync.work.result.Result object at 0x0000027820E66450>
DEBUG 2025-04-22 15:32:46,558 views 19324 14752 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 15:32:46,558 views 19324 14752 消息内容: 小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗...
DEBUG 2025-04-22 15:32:46,558 views 19324 14752 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 15:32:46,558 views 19324 14752 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 15:32:46,558 views 19324 14752 消息内容: 根据目前掌握的信息（发病部位：叶片），可能的病害有：

1. 小麦黑颖病
   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或...
DEBUG 2025-04-22 15:32:46,558 views 19324 14752 历史记录更新成功，当前长度: 2
INFO 2025-04-22 15:32:46,558 basehttp 19324 14752 "GET /api/chat/stream_chat/?message=%E5%B0%8F%E9%BA%A6%E7%9A%84%E9%97%AE%E9%A2%98%E4%B8%BB%E8%A6%81%E5%8F%91%E7%94%9F%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%EF%BC%8C%E8%AF%B7%E9%97%AE%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E6%98%AF%E6%9C%89%E4%BB%80%E4%B9%88%E7%97%87%E7%8A%B6%E5%90%97&session_id=3 HTTP/1.1" 200 5351
INFO 2025-04-22 15:32:49,377 views 19324 16780 Neo4j服务初始化成功
DEBUG 2025-04-22 15:32:51,427 views 19324 16780 ChatAPI实例初始化完成
INFO 2025-04-22 15:32:51,431 basehttp 19324 16780 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:33:03,889 views 19324 21272 Neo4j服务初始化成功
DEBUG 2025-04-22 15:33:05,933 views 19324 21272 ChatAPI实例初始化完成
DEBUG 2025-04-22 15:33:05,937 views 19324 21272 收到stream_chat请求: {'message': ['小麦的发病地区是河北'], 'session_id': ['3']}
DEBUG 2025-04-22 15:33:05,937 views 19324 21272 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 15:33:05,944 views 19324 21272 处理消息: 小麦的发病地区是河北, 会话ID: 3
DEBUG 2025-04-22 15:33:05,945 views 19324 21272 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '小麦的发病地区是河北'}]
DEBUG 2025-04-22 15:33:05,947 views 19324 21272 构建的消息列表长度: 2
INFO 2025-04-22 15:33:05,948 views 19324 21272 检查会话状态: 3
INFO 2025-04-22 15:33:05,949 views 19324 21272 当前所有会话: []
INFO 2025-04-22 15:33:05,949 views 19324 21272 当前症状收集状态: {}
INFO 2025-04-22 15:33:05,950 views 19324 21272 创建新会话: 3
INFO 2025-04-22 15:33:05,951 views 19324 21272 初始化症状收集状态: 3
DEBUG 2025-04-22 15:33:05,951 views 19324 21272 当前症状信息: {}
DEBUG 2025-04-22 15:33:05,952 views 19324 21272 开始提取症状，输入消息: 小麦的发病地区是河北
DEBUG 2025-04-22 15:33:05,952 views 19324 21272 分句结果: ['小麦的发病地区是河北', '小麦的发病地区是河北']
DEBUG 2025-04-22 15:33:05,953 views 19324 21272 提取到的发病部位: []
DEBUG 2025-04-22 15:33:05,954 views 19324 21272 提取到的气象条件: []
DEBUG 2025-04-22 15:33:05,954 views 19324 21272 提取到的生育期: []
DEBUG 2025-04-22 15:33:05,955 views 19324 21272 提取到的地区: ['河北']
DEBUG 2025-04-22 15:33:05,955 views 19324 21272 提取到的发病部位: []
DEBUG 2025-04-22 15:33:05,955 views 19324 21272 提取到的气象条件: []
DEBUG 2025-04-22 15:33:05,956 views 19324 21272 提取到的生育期: []
DEBUG 2025-04-22 15:33:05,956 views 19324 21272 提取到的地区: ['河北']
INFO 2025-04-22 15:33:05,956 views 19324 21272 症状提取结果: {'region': '河北'}
INFO 2025-04-22 15:33:05,956 views 19324 21272 更新会话 3 的症状信息
INFO 2025-04-22 15:33:05,957 views 19324 21272 新的症状信息: {'region': '河北'}
INFO 2025-04-22 15:33:05,957 views 19324 21272 检查会话状态: 3
INFO 2025-04-22 15:33:05,957 views 19324 21272 当前所有会话: ['3']
INFO 2025-04-22 15:33:05,958 views 19324 21272 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {}}}
INFO 2025-04-22 15:33:05,958 views 19324 21272 已存在的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 15:33:05,958 views 19324 21272 获取到的当前症状信息: {}
INFO 2025-04-22 15:33:05,959 views 19324 21272 更新症状类别 region: 河北
INFO 2025-04-22 15:33:05,959 views 19324 21272 更新后的完整症状信息: {'collecting': True, 'symptoms': {'region': '河北'}}
INFO 2025-04-22 15:33:05,959 views 19324 21272 更新后的症状信息: {'region': '河北'}
INFO 2025-04-22 15:33:05,959 views 19324 21272 已收集的信息: 目前已经收集到的信息：
- 发病地区：河北

还需要补充的信息：
- 发病部位
- 气象条件
- 生育期

INFO 2025-04-22 15:33:08,687 services 19324 21272 查询参数: {'plant_part': None, 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-22 15:33:08,687 services 19324 21272 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:OCCURS_IN_REGION]->(r:Region {name: $region}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-22 15:33:08,694 services 19324 21272 查询参数: {'plant_part': None, 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-22 15:33:08,697 services 19324 21272 查询结果: <neo4j._sync.work.result.Result object at 0x0000027820F24A70>
DEBUG 2025-04-22 15:33:20,629 views 19324 21272 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 15:33:20,629 views 19324 21272 消息内容: 小麦的发病地区是河北...
DEBUG 2025-04-22 15:33:20,629 views 19324 21272 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 15:33:20,633 views 19324 21272 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 15:33:20,634 views 19324 21272 消息内容: 根据目前掌握的信息（地区：河北），可能的病害有：

1. 小麦旺长
   主要特征: 冬季气温低时出现冻害，有的影响穗分化，抗寒力下降，引起死苗，导致下年小麦返青晚，穗数不够，造成严重减产...

2...
DEBUG 2025-04-22 15:33:20,639 views 19324 21272 历史记录更新成功，当前长度: 2
INFO 2025-04-22 15:33:20,641 basehttp 19324 21272 "GET /api/chat/stream_chat/?message=%E5%B0%8F%E9%BA%A6%E7%9A%84%E5%8F%91%E7%97%85%E5%9C%B0%E5%8C%BA%E6%98%AF%E6%B2%B3%E5%8C%97&session_id=3 HTTP/1.1" 200 3098
INFO 2025-04-22 15:33:23,421 views 19324 1520 Neo4j服务初始化成功
DEBUG 2025-04-22 15:33:25,467 views 19324 1520 ChatAPI实例初始化完成
INFO 2025-04-22 15:33:25,470 basehttp 19324 1520 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:35:39,389 autoreload 19324 13536 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 15:35:40,316 autoreload 1228 5388 Watching for file changes with StatReloader
INFO 2025-04-22 15:42:09,402 autoreload 1228 5388 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 15:42:10,269 autoreload 15416 21240 Watching for file changes with StatReloader
INFO 2025-04-22 15:42:25,059 views 15416 3484 Neo4j服务初始化成功
DEBUG 2025-04-22 15:42:27,108 views 15416 3484 ChatAPI实例初始化完成
DEBUG 2025-04-22 15:42:27,112 views 15416 3484 收到stream_chat请求: {'message': ['小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'], 'session_id': ['3']}
DEBUG 2025-04-22 15:42:27,112 views 15416 3484 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 15:42:27,112 views 15416 3484 处理消息: 小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗, 会话ID: 3
DEBUG 2025-04-22 15:42:27,112 views 15416 3484 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗'}]
DEBUG 2025-04-22 15:42:27,112 views 15416 3484 构建的消息列表长度: 2
INFO 2025-04-22 15:42:27,116 views 15416 3484 检查会话状态: 3
INFO 2025-04-22 15:42:27,116 views 15416 3484 当前所有会话: []
INFO 2025-04-22 15:42:27,116 views 15416 3484 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 15:42:27,117 views 15416 3484 创建新会话: 3
INFO 2025-04-22 15:42:27,117 views 15416 3484 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {}}}
DEBUG 2025-04-22 15:42:27,117 views 15416 3484 当前症状信息: {}
DEBUG 2025-04-22 15:42:27,117 views 15416 3484 开始提取症状，输入消息: 小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗
DEBUG 2025-04-22 15:42:27,117 views 15416 3484 分句结果: ['小麦的问题主要发生在叶片上', '请问我的小麦是有什么症状吗', '小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗']
DEBUG 2025-04-22 15:42:27,118 views 15416 3484 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 15:42:27,118 views 15416 3484 提取到的气象条件: []
DEBUG 2025-04-22 15:42:27,118 views 15416 3484 提取到的生育期: []
DEBUG 2025-04-22 15:42:27,118 views 15416 3484 提取到的地区: []
DEBUG 2025-04-22 15:42:27,119 views 15416 3484 提取到的发病部位: []
DEBUG 2025-04-22 15:42:27,119 views 15416 3484 提取到的气象条件: []
DEBUG 2025-04-22 15:42:27,119 views 15416 3484 提取到的生育期: []
DEBUG 2025-04-22 15:42:27,119 views 15416 3484 提取到的地区: []
DEBUG 2025-04-22 15:42:27,120 views 15416 3484 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 15:42:27,120 views 15416 3484 提取到的气象条件: []
DEBUG 2025-04-22 15:42:27,121 views 15416 3484 提取到的生育期: []
DEBUG 2025-04-22 15:42:27,121 views 15416 3484 提取到的地区: []
INFO 2025-04-22 15:42:27,121 views 15416 3484 症状提取结果: {'plant_part': '叶片'}
INFO 2025-04-22 15:42:27,121 views 15416 3484 更新会话 3 的症状信息
INFO 2025-04-22 15:42:27,121 views 15416 3484 新的症状信息: {'plant_part': '叶片'}
INFO 2025-04-22 15:42:27,121 views 15416 3484 检查会话状态: 3
INFO 2025-04-22 15:42:27,121 views 15416 3484 当前所有会话: ['3']
INFO 2025-04-22 15:42:27,121 views 15416 3484 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 15:42:27,121 views 15416 3484 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {}}}
INFO 2025-04-22 15:42:27,121 views 15416 3484 获取到的当前症状信息: {}
INFO 2025-04-22 15:42:27,121 views 15416 3484 更新症状类别 plant_part: 叶片
INFO 2025-04-22 15:42:27,121 views 15416 3484 更新后的完整症状信息: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-22 15:42:27,121 views 15416 3484 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-22 15:42:27,121 views 15416 3484 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 发病地区

INFO 2025-04-22 15:42:29,844 services 15416 3484 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-22 15:42:29,844 services 15416 3484 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-22 15:42:29,846 services 15416 3484 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-22 15:42:29,847 services 15416 3484 查询结果: <neo4j._sync.work.result.Result object at 0x000001C6A9B910A0>
DEBUG 2025-04-22 15:42:52,498 views 15416 3484 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 15:42:52,498 views 15416 3484 消息内容: 小麦的问题主要发生在叶片上，请问我的小麦是有什么症状吗...
DEBUG 2025-04-22 15:42:52,498 views 15416 3484 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 15:42:52,498 views 15416 3484 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 15:42:52,498 views 15416 3484 消息内容: 根据目前掌握的信息（发病部位：叶片），可能的病害有：

1. 小麦黑颖病
   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或...
DEBUG 2025-04-22 15:42:52,498 views 15416 3484 历史记录更新成功，当前长度: 2
INFO 2025-04-22 15:42:52,498 basehttp 15416 3484 "GET /api/chat/stream_chat/?message=%E5%B0%8F%E9%BA%A6%E7%9A%84%E9%97%AE%E9%A2%98%E4%B8%BB%E8%A6%81%E5%8F%91%E7%94%9F%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%EF%BC%8C%E8%AF%B7%E9%97%AE%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E6%98%AF%E6%9C%89%E4%BB%80%E4%B9%88%E7%97%87%E7%8A%B6%E5%90%97&session_id=3 HTTP/1.1" 200 5351
INFO 2025-04-22 15:42:55,156 views 15416 436 Neo4j服务初始化成功
DEBUG 2025-04-22 15:42:57,206 views 15416 436 ChatAPI实例初始化完成
INFO 2025-04-22 15:42:57,210 basehttp 15416 436 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:43:05,661 views 15416 6860 Neo4j服务初始化成功
DEBUG 2025-04-22 15:43:07,709 views 15416 6860 ChatAPI实例初始化完成
DEBUG 2025-04-22 15:43:07,709 views 15416 6860 收到stream_chat请求: {'message': ['小麦的发病地区是河北'], 'session_id': ['3']}
DEBUG 2025-04-22 15:43:07,709 views 15416 6860 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 15:43:07,713 views 15416 6860 处理消息: 小麦的发病地区是河北, 会话ID: 3
DEBUG 2025-04-22 15:43:07,713 views 15416 6860 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '小麦的发病地区是河北'}]
DEBUG 2025-04-22 15:43:07,713 views 15416 6860 构建的消息列表长度: 2
INFO 2025-04-22 15:43:07,713 views 15416 6860 检查会话状态: 3
INFO 2025-04-22 15:43:07,713 views 15416 6860 当前所有会话: []
INFO 2025-04-22 15:43:07,713 views 15416 6860 从缓存获取的症状信息: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-22 15:43:07,713 views 15416 6860 创建新会话: 3
INFO 2025-04-22 15:43:07,713 views 15416 6860 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {'plant_part': '叶片'}}}
DEBUG 2025-04-22 15:43:07,713 views 15416 6860 当前症状信息: {'plant_part': '叶片'}
DEBUG 2025-04-22 15:43:07,713 views 15416 6860 开始提取症状，输入消息: 小麦的发病地区是河北
DEBUG 2025-04-22 15:43:07,713 views 15416 6860 分句结果: ['小麦的发病地区是河北', '小麦的发病地区是河北']
DEBUG 2025-04-22 15:43:07,716 views 15416 6860 提取到的发病部位: []
DEBUG 2025-04-22 15:43:07,717 views 15416 6860 提取到的气象条件: []
DEBUG 2025-04-22 15:43:07,717 views 15416 6860 提取到的生育期: []
DEBUG 2025-04-22 15:43:07,717 views 15416 6860 提取到的地区: ['河北']
DEBUG 2025-04-22 15:43:07,717 views 15416 6860 提取到的发病部位: []
DEBUG 2025-04-22 15:43:07,717 views 15416 6860 提取到的气象条件: []
DEBUG 2025-04-22 15:43:07,718 views 15416 6860 提取到的生育期: []
DEBUG 2025-04-22 15:43:07,718 views 15416 6860 提取到的地区: ['河北']
INFO 2025-04-22 15:43:07,718 views 15416 6860 症状提取结果: {'region': '河北'}
INFO 2025-04-22 15:43:07,718 views 15416 6860 更新会话 3 的症状信息
INFO 2025-04-22 15:43:07,718 views 15416 6860 新的症状信息: {'region': '河北'}
INFO 2025-04-22 15:43:07,719 views 15416 6860 检查会话状态: 3
INFO 2025-04-22 15:43:07,719 views 15416 6860 当前所有会话: ['3']
INFO 2025-04-22 15:43:07,719 views 15416 6860 从缓存获取的症状信息: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-22 15:43:07,719 views 15416 6860 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {'plant_part': '叶片'}}}
INFO 2025-04-22 15:43:07,720 views 15416 6860 获取到的当前症状信息: {'plant_part': '叶片'}
INFO 2025-04-22 15:43:07,720 views 15416 6860 更新症状类别 region: 河北
INFO 2025-04-22 15:43:07,720 views 15416 6860 更新后的完整症状信息: {'collecting': True, 'symptoms': {'plant_part': '叶片', 'region': '河北'}}
INFO 2025-04-22 15:43:07,720 views 15416 6860 更新后的症状信息: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-22 15:43:07,720 views 15416 6860 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片
- 发病地区：河北

还需要补充的信息：
- 气象条件
- 生育期

INFO 2025-04-22 15:43:10,605 services 15416 6860 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-22 15:43:10,605 services 15416 6860 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) MATCH (d)-[:OCCURS_IN_REGION]->(r:Region {name: $region}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-22 15:43:10,605 services 15416 6860 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-22 15:43:10,655 services 15416 6860 查询结果: <neo4j._sync.work.result.Result object at 0x000001C6A9DD72C0>
DEBUG 2025-04-22 15:43:24,663 views 15416 6860 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 15:43:24,664 views 15416 6860 消息内容: 小麦的发病地区是河北...
DEBUG 2025-04-22 15:43:24,664 views 15416 6860 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 15:43:24,664 views 15416 6860 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 15:43:24,664 views 15416 6860 消息内容: 根据您提供的信息（发病部位：叶片，地区：河北），诊断结果为小麦叶锈病。

病害特征：
夏孢子堆圆形至长椭圆形，桔红色，散生，成熟后表皮开裂散出夏孢子；冬孢子堆主要在叶片背面和叶鞘上，圆形或长椭圆形，黑...
DEBUG 2025-04-22 15:43:24,668 views 15416 6860 历史记录更新成功，当前长度: 2
INFO 2025-04-22 15:43:24,668 basehttp 15416 6860 "GET /api/chat/stream_chat/?message=%E5%B0%8F%E9%BA%A6%E7%9A%84%E5%8F%91%E7%97%85%E5%9C%B0%E5%8C%BA%E6%98%AF%E6%B2%B3%E5%8C%97&session_id=3 HTTP/1.1" 200 3538
INFO 2025-04-22 15:43:27,208 views 15416 22052 Neo4j服务初始化成功
DEBUG 2025-04-22 15:43:29,259 views 15416 22052 ChatAPI实例初始化完成
INFO 2025-04-22 15:43:29,264 basehttp 15416 22052 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:44:09,782 autoreload 15416 21240 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 15:44:10,632 autoreload 12920 1404 Watching for file changes with StatReloader
INFO 2025-04-22 15:44:34,278 views 12920 16432 Neo4j服务初始化成功
DEBUG 2025-04-22 15:44:36,324 views 12920 16432 ChatAPI实例初始化完成
INFO 2025-04-22 15:44:36,328 basehttp 12920 16432 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 15:44:38,649 views 12920 10936 Neo4j服务初始化成功
DEBUG 2025-04-22 15:44:40,701 views 12920 10936 ChatAPI实例初始化完成
INFO 2025-04-22 15:44:40,705 basehttp 12920 10936 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:44:43,050 views 12920 4772 Neo4j服务初始化成功
DEBUG 2025-04-22 15:44:45,124 views 12920 4772 ChatAPI实例初始化完成
INFO 2025-04-22 15:44:45,124 basehttp 12920 4772 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:45:59,927 views 12920 24184 Neo4j服务初始化成功
INFO 2025-04-22 15:46:00,047 views 12920 2084 Neo4j服务初始化成功
INFO 2025-04-22 15:46:00,266 views 12920 14720 Neo4j服务初始化成功
INFO 2025-04-22 15:46:00,277 views 12920 14332 Neo4j服务初始化成功
DEBUG 2025-04-22 15:46:01,984 views 12920 24184 ChatAPI实例初始化完成
INFO 2025-04-22 15:46:01,984 basehttp 12920 24184 "POST /api/chat/create_session/ HTTP/1.1" 200 40
DEBUG 2025-04-22 15:46:02,067 views 12920 2084 ChatAPI实例初始化完成
INFO 2025-04-22 15:46:02,071 basehttp 12920 2084 "POST /api/chat/create_session/ HTTP/1.1" 200 40
DEBUG 2025-04-22 15:46:02,312 views 12920 14332 ChatAPI实例初始化完成
INFO 2025-04-22 15:46:02,312 basehttp 12920 14332 "POST /api/chat/create_session/ HTTP/1.1" 200 40
DEBUG 2025-04-22 15:46:02,329 views 12920 14720 ChatAPI实例初始化完成
INFO 2025-04-22 15:46:02,332 basehttp 12920 14720 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 15:46:04,311 views 12920 20916 Neo4j服务初始化成功
DEBUG 2025-04-22 15:46:06,375 views 12920 20916 ChatAPI实例初始化完成
INFO 2025-04-22 15:46:06,375 basehttp 12920 20916 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:46:08,712 views 12920 21640 Neo4j服务初始化成功
DEBUG 2025-04-22 15:46:10,756 views 12920 21640 ChatAPI实例初始化完成
INFO 2025-04-22 15:46:10,760 basehttp 12920 21640 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:46:13,115 views 12920 13536 Neo4j服务初始化成功
DEBUG 2025-04-22 15:46:15,169 views 12920 13536 ChatAPI实例初始化完成
INFO 2025-04-22 15:46:15,170 basehttp 12920 13536 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:46:17,502 views 12920 3700 Neo4j服务初始化成功
DEBUG 2025-04-22 15:46:19,526 views 12920 3700 ChatAPI实例初始化完成
INFO 2025-04-22 15:46:19,526 basehttp 12920 3700 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:46:21,874 views 12920 22448 Neo4j服务初始化成功
INFO 2025-04-22 15:46:22,165 views 12920 12388 Neo4j服务初始化成功
DEBUG 2025-04-22 15:46:23,909 views 12920 22448 ChatAPI实例初始化完成
INFO 2025-04-22 15:46:23,910 basehttp 12920 22448 "GET /api/chat/get_history/ HTTP/1.1" 200 37
DEBUG 2025-04-22 15:46:24,201 views 12920 12388 ChatAPI实例初始化完成
INFO 2025-04-22 15:46:24,202 basehttp 12920 12388 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 15:46:26,210 views 12920 19336 Neo4j服务初始化成功
DEBUG 2025-04-22 15:46:28,272 views 12920 19336 ChatAPI实例初始化完成
INFO 2025-04-22 15:46:28,272 basehttp 12920 19336 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:46:28,514 views 12920 21420 Neo4j服务初始化成功
DEBUG 2025-04-22 15:46:30,554 views 12920 21420 ChatAPI实例初始化完成
DEBUG 2025-04-22 15:46:30,554 views 12920 21420 收到stream_chat请求: {'message': ['你好'], 'session_id': ['3']}
DEBUG 2025-04-22 15:46:30,554 views 12920 21420 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 15:46:30,558 views 12920 21420 处理消息: 你好, 会话ID: 3
DEBUG 2025-04-22 15:46:30,558 views 12920 21420 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好'}]
DEBUG 2025-04-22 15:46:30,558 views 12920 21420 构建的消息列表长度: 2
INFO 2025-04-22 15:46:30,584 views 12920 13440 Neo4j服务初始化成功
DEBUG 2025-04-22 15:46:32,614 views 12920 13440 ChatAPI实例初始化完成
INFO 2025-04-22 15:46:32,618 basehttp 12920 13440 "GET /api/chat/get_history/ HTTP/1.1" 200 37
DEBUG 2025-04-22 15:46:33,891 views 12920 21420 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 15:46:33,891 views 12920 21420 消息内容: 你好...
DEBUG 2025-04-22 15:46:33,891 views 12920 21420 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 15:46:33,895 views 12920 21420 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 15:46:33,895 views 12920 21420 消息内容: 你好呀！为了能准确诊断小麦病害，请详细描述一下小麦出现的症状，比如叶片、茎秆、麦穗等部位有没有异常，是从哪个部位开始发病的，发病时的气象条件如何，小麦处于什么生育期，发病地区在哪等，这样我就能为你诊断...
DEBUG 2025-04-22 15:46:33,895 views 12920 21420 历史记录更新成功，当前长度: 2
INFO 2025-04-22 15:46:33,895 basehttp 12920 21420 "GET /api/chat/stream_chat/?message=%E4%BD%A0%E5%A5%BD&session_id=3 HTTP/1.1" 200 945
INFO 2025-04-22 15:46:34,943 views 12920 17984 Neo4j服务初始化成功
DEBUG 2025-04-22 15:46:37,007 views 12920 17984 ChatAPI实例初始化完成
INFO 2025-04-22 15:46:37,008 basehttp 12920 17984 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:46:39,362 views 12920 19544 Neo4j服务初始化成功
DEBUG 2025-04-22 15:46:41,419 views 12920 19544 ChatAPI实例初始化完成
INFO 2025-04-22 15:46:41,419 basehttp 12920 19544 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:46:43,746 views 12920 16444 Neo4j服务初始化成功
DEBUG 2025-04-22 15:46:45,780 views 12920 16444 ChatAPI实例初始化完成
INFO 2025-04-22 15:46:45,780 basehttp 12920 16444 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:46:48,118 views 12920 12404 Neo4j服务初始化成功
DEBUG 2025-04-22 15:46:50,136 views 12920 12404 ChatAPI实例初始化完成
INFO 2025-04-22 15:46:50,140 basehttp 12920 12404 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:47:01,663 views 12920 17316 Neo4j服务初始化成功
DEBUG 2025-04-22 15:47:03,724 views 12920 17316 ChatAPI实例初始化完成
DEBUG 2025-04-22 15:47:03,724 views 12920 17316 收到stream_chat请求: {'message': ['我的小麦的问题主要发生在叶片上，请问我的小麦是有什么病害吗'], 'session_id': ['3']}
DEBUG 2025-04-22 15:47:03,728 views 12920 17316 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 15:47:03,728 views 12920 17316 处理消息: 我的小麦的问题主要发生在叶片上，请问我的小麦是有什么病害吗, 会话ID: 3
DEBUG 2025-04-22 15:47:03,728 views 12920 17316 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦的问题主要发生在叶片上，请问我的小麦是有什么病害吗'}]
DEBUG 2025-04-22 15:47:03,728 views 12920 17316 构建的消息列表长度: 2
INFO 2025-04-22 15:47:03,728 views 12920 17316 检查会话状态: 3
INFO 2025-04-22 15:47:03,728 views 12920 17316 当前所有会话: []
INFO 2025-04-22 15:47:03,728 views 12920 17316 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 15:47:03,728 views 12920 17316 创建新会话: 3
INFO 2025-04-22 15:47:03,728 views 12920 17316 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {}}}
DEBUG 2025-04-22 15:47:03,728 views 12920 17316 当前症状信息: {}
DEBUG 2025-04-22 15:47:03,732 views 12920 17316 开始提取症状，输入消息: 我的小麦的问题主要发生在叶片上，请问我的小麦是有什么病害吗
DEBUG 2025-04-22 15:47:03,732 views 12920 17316 分句结果: ['我的小麦的问题主要发生在叶片上', '请问我的小麦是有什么病害吗', '我的小麦的问题主要发生在叶片上，请问我的小麦是有什么病害吗']
DEBUG 2025-04-22 15:47:03,732 views 12920 17316 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 15:47:03,732 views 12920 17316 提取到的气象条件: []
DEBUG 2025-04-22 15:47:03,732 views 12920 17316 提取到的生育期: []
DEBUG 2025-04-22 15:47:03,733 views 12920 17316 提取到的地区: []
DEBUG 2025-04-22 15:47:03,733 views 12920 17316 提取到的发病部位: []
DEBUG 2025-04-22 15:47:03,733 views 12920 17316 提取到的气象条件: []
DEBUG 2025-04-22 15:47:03,733 views 12920 17316 提取到的生育期: []
DEBUG 2025-04-22 15:47:03,734 views 12920 17316 提取到的地区: []
DEBUG 2025-04-22 15:47:03,734 views 12920 17316 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 15:47:03,734 views 12920 17316 提取到的气象条件: []
DEBUG 2025-04-22 15:47:03,734 views 12920 17316 提取到的生育期: []
DEBUG 2025-04-22 15:47:03,734 views 12920 17316 提取到的地区: []
INFO 2025-04-22 15:47:03,735 views 12920 17316 症状提取结果: {'plant_part': '叶片'}
INFO 2025-04-22 15:47:03,735 views 12920 17316 更新会话 3 的症状信息
INFO 2025-04-22 15:47:03,735 views 12920 17316 新的症状信息: {'plant_part': '叶片'}
INFO 2025-04-22 15:47:03,735 views 12920 17316 检查会话状态: 3
INFO 2025-04-22 15:47:03,736 views 12920 17316 当前所有会话: ['3']
INFO 2025-04-22 15:47:03,736 views 12920 17316 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 15:47:03,736 views 12920 17316 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {}}}
INFO 2025-04-22 15:47:03,736 views 12920 17316 获取到的当前症状信息: {}
INFO 2025-04-22 15:47:03,737 views 12920 17316 更新症状类别 plant_part: 叶片
INFO 2025-04-22 15:47:03,738 views 12920 17316 更新后的完整症状信息: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-22 15:47:03,738 views 12920 17316 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-22 15:47:03,738 views 12920 17316 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 发病地区

INFO 2025-04-22 15:47:06,462 services 12920 17316 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-22 15:47:06,462 services 12920 17316 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-22 15:47:06,462 services 12920 17316 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-22 15:47:06,466 services 12920 17316 查询结果: <neo4j._sync.work.result.Result object at 0x0000023FB67490A0>
DEBUG 2025-04-22 15:47:29,144 views 12920 17316 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 15:47:29,144 views 12920 17316 消息内容: 我的小麦的问题主要发生在叶片上，请问我的小麦是有什么病害吗...
DEBUG 2025-04-22 15:47:29,144 views 12920 17316 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 15:47:29,144 views 12920 17316 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 15:47:29,148 views 12920 17316 消息内容: 根据目前掌握的信息（发病部位：叶片），可能的病害有：

1. 小麦黑颖病
   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或...
DEBUG 2025-04-22 15:47:29,148 views 12920 17316 历史记录更新成功，当前长度: 2
INFO 2025-04-22 15:47:29,148 basehttp 12920 17316 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E7%9A%84%E9%97%AE%E9%A2%98%E4%B8%BB%E8%A6%81%E5%8F%91%E7%94%9F%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%EF%BC%8C%E8%AF%B7%E9%97%AE%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E6%98%AF%E6%9C%89%E4%BB%80%E4%B9%88%E7%97%85%E5%AE%B3%E5%90%97&session_id=3 HTTP/1.1" 200 5351
INFO 2025-04-22 15:47:31,651 views 12920 20180 Neo4j服务初始化成功
DEBUG 2025-04-22 15:47:33,692 views 12920 20180 ChatAPI实例初始化完成
INFO 2025-04-22 15:47:33,695 basehttp 12920 20180 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:47:50,600 views 12920 16272 Neo4j服务初始化成功
DEBUG 2025-04-22 15:47:52,667 views 12920 16272 ChatAPI实例初始化完成
DEBUG 2025-04-22 15:47:52,667 views 12920 16272 收到stream_chat请求: {'message': ['小麦的发病地区是在河北'], 'session_id': ['3']}
DEBUG 2025-04-22 15:47:52,667 views 12920 16272 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 15:47:52,671 views 12920 16272 处理消息: 小麦的发病地区是在河北, 会话ID: 3
DEBUG 2025-04-22 15:47:52,675 views 12920 16272 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '小麦的发病地区是在河北'}]
DEBUG 2025-04-22 15:47:52,677 views 12920 16272 构建的消息列表长度: 2
INFO 2025-04-22 15:47:52,686 views 12920 16272 检查会话状态: 3
INFO 2025-04-22 15:47:52,686 views 12920 16272 当前所有会话: []
INFO 2025-04-22 15:47:52,687 views 12920 16272 从缓存获取的症状信息: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-22 15:47:52,687 views 12920 16272 创建新会话: 3
INFO 2025-04-22 15:47:52,687 views 12920 16272 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {'plant_part': '叶片'}}}
DEBUG 2025-04-22 15:47:52,688 views 12920 16272 当前症状信息: {'plant_part': '叶片'}
DEBUG 2025-04-22 15:47:52,688 views 12920 16272 开始提取症状，输入消息: 小麦的发病地区是在河北
DEBUG 2025-04-22 15:47:52,688 views 12920 16272 分句结果: ['小麦的发病地区是在河北', '小麦的发病地区是在河北']
DEBUG 2025-04-22 15:47:52,688 views 12920 16272 提取到的发病部位: []
DEBUG 2025-04-22 15:47:52,689 views 12920 16272 提取到的气象条件: []
DEBUG 2025-04-22 15:47:52,689 views 12920 16272 提取到的生育期: []
DEBUG 2025-04-22 15:47:52,689 views 12920 16272 提取到的地区: ['河北']
DEBUG 2025-04-22 15:47:52,689 views 12920 16272 提取到的发病部位: []
DEBUG 2025-04-22 15:47:52,690 views 12920 16272 提取到的气象条件: []
DEBUG 2025-04-22 15:47:52,690 views 12920 16272 提取到的生育期: []
DEBUG 2025-04-22 15:47:52,690 views 12920 16272 提取到的地区: ['河北']
INFO 2025-04-22 15:47:52,690 views 12920 16272 症状提取结果: {'region': '河北'}
INFO 2025-04-22 15:47:52,690 views 12920 16272 更新会话 3 的症状信息
INFO 2025-04-22 15:47:52,691 views 12920 16272 新的症状信息: {'region': '河北'}
INFO 2025-04-22 15:47:52,691 views 12920 16272 检查会话状态: 3
INFO 2025-04-22 15:47:52,691 views 12920 16272 当前所有会话: ['3']
INFO 2025-04-22 15:47:52,691 views 12920 16272 从缓存获取的症状信息: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-22 15:47:52,692 views 12920 16272 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {'plant_part': '叶片'}}}
INFO 2025-04-22 15:47:52,692 views 12920 16272 获取到的当前症状信息: {'plant_part': '叶片'}
INFO 2025-04-22 15:47:52,692 views 12920 16272 更新症状类别 region: 河北
INFO 2025-04-22 15:47:52,692 views 12920 16272 更新后的完整症状信息: {'collecting': True, 'symptoms': {'plant_part': '叶片', 'region': '河北'}}
INFO 2025-04-22 15:47:52,693 views 12920 16272 更新后的症状信息: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-22 15:47:52,693 views 12920 16272 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片
- 发病地区：河北

还需要补充的信息：
- 气象条件
- 生育期

INFO 2025-04-22 15:47:55,579 services 12920 16272 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-22 15:47:55,579 services 12920 16272 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) MATCH (d)-[:OCCURS_IN_REGION]->(r:Region {name: $region}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-22 15:47:55,587 services 12920 16272 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-22 15:47:55,594 services 12920 16272 查询结果: <neo4j._sync.work.result.Result object at 0x0000023FB6748FB0>
DEBUG 2025-04-22 15:48:09,645 views 12920 16272 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 15:48:09,645 views 12920 16272 消息内容: 小麦的发病地区是在河北...
DEBUG 2025-04-22 15:48:09,645 views 12920 16272 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 15:48:09,645 views 12920 16272 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 15:48:09,649 views 12920 16272 消息内容: 根据您提供的信息（发病部位：叶片，地区：河北），诊断结果为小麦叶锈病。

病害特征：
夏孢子堆圆形至长椭圆形，桔红色，散生，成熟后表皮开裂散出夏孢子；冬孢子堆主要在叶片背面和叶鞘上，圆形或长椭圆形，黑...
DEBUG 2025-04-22 15:48:09,649 views 12920 16272 历史记录更新成功，当前长度: 2
INFO 2025-04-22 15:48:09,653 basehttp 12920 16272 "GET /api/chat/stream_chat/?message=%E5%B0%8F%E9%BA%A6%E7%9A%84%E5%8F%91%E7%97%85%E5%9C%B0%E5%8C%BA%E6%98%AF%E5%9C%A8%E6%B2%B3%E5%8C%97&session_id=3 HTTP/1.1" 200 3538
INFO 2025-04-22 15:48:12,154 views 12920 15444 Neo4j服务初始化成功
DEBUG 2025-04-22 15:48:14,194 views 12920 15444 ChatAPI实例初始化完成
INFO 2025-04-22 15:48:14,194 basehttp 12920 15444 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:59:09,693 views 12920 19236 Neo4j服务初始化成功
DEBUG 2025-04-22 15:59:11,728 views 12920 19236 ChatAPI实例初始化完成
INFO 2025-04-22 15:59:11,729 basehttp 12920 19236 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 15:59:14,096 views 12920 14280 Neo4j服务初始化成功
DEBUG 2025-04-22 15:59:16,111 views 12920 14280 ChatAPI实例初始化完成
INFO 2025-04-22 15:59:16,112 basehttp 12920 14280 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:59:18,425 views 12920 3140 Neo4j服务初始化成功
DEBUG 2025-04-22 15:59:20,480 views 12920 3140 ChatAPI实例初始化完成
INFO 2025-04-22 15:59:20,484 basehttp 12920 3140 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:59:27,063 views 12920 4048 Neo4j服务初始化成功
DEBUG 2025-04-22 15:59:29,090 views 12920 4048 ChatAPI实例初始化完成
INFO 2025-04-22 15:59:29,094 basehttp 12920 4048 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 15:59:31,503 views 12920 4092 Neo4j服务初始化成功
DEBUG 2025-04-22 15:59:33,529 views 12920 4092 ChatAPI实例初始化完成
INFO 2025-04-22 15:59:33,530 basehttp 12920 4092 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 15:59:35,835 views 12920 11056 Neo4j服务初始化成功
DEBUG 2025-04-22 15:59:37,889 views 12920 11056 ChatAPI实例初始化完成
INFO 2025-04-22 15:59:37,890 basehttp 12920 11056 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:00:13,563 views 12920 20512 Neo4j服务初始化成功
DEBUG 2025-04-22 16:00:15,594 views 12920 20512 ChatAPI实例初始化完成
DEBUG 2025-04-22 16:00:15,594 views 12920 20512 收到stream_chat请求: {'message': ['你好，我的小麦好像生病了'], 'session_id': ['3']}
DEBUG 2025-04-22 16:00:15,594 views 12920 20512 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 16:00:15,594 views 12920 20512 处理消息: 你好，我的小麦好像生病了, 会话ID: 3
DEBUG 2025-04-22 16:00:15,594 views 12920 20512 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好，我的小麦好像生病了'}]
DEBUG 2025-04-22 16:00:15,598 views 12920 20512 构建的消息列表长度: 2
INFO 2025-04-22 16:00:15,598 views 12920 20512 检查会话状态: 3
INFO 2025-04-22 16:00:15,598 views 12920 20512 当前所有会话: []
INFO 2025-04-22 16:00:15,598 views 12920 20512 从缓存获取的症状信息: {'collecting': True, 'symptoms': {'plant_part': '叶片', 'region': '河北'}}
INFO 2025-04-22 16:00:15,598 views 12920 20512 创建新会话: 3
INFO 2025-04-22 16:00:15,598 views 12920 20512 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {'plant_part': '叶片', 'region': '河北'}}}
DEBUG 2025-04-22 16:00:15,598 views 12920 20512 当前症状信息: {'plant_part': '叶片', 'region': '河北'}
DEBUG 2025-04-22 16:00:15,598 views 12920 20512 开始提取症状，输入消息: 你好，我的小麦好像生病了
DEBUG 2025-04-22 16:00:15,598 views 12920 20512 分句结果: ['你好', '我的小麦好像生病了', '你好，我的小麦好像生病了']
DEBUG 2025-04-22 16:00:15,598 views 12920 20512 提取到的发病部位: []
DEBUG 2025-04-22 16:00:15,598 views 12920 20512 提取到的气象条件: []
DEBUG 2025-04-22 16:00:15,598 views 12920 20512 提取到的生育期: []
DEBUG 2025-04-22 16:00:15,598 views 12920 20512 提取到的地区: []
DEBUG 2025-04-22 16:00:15,598 views 12920 20512 提取到的发病部位: []
DEBUG 2025-04-22 16:00:15,598 views 12920 20512 提取到的气象条件: []
DEBUG 2025-04-22 16:00:15,602 views 12920 20512 提取到的生育期: []
DEBUG 2025-04-22 16:00:15,602 views 12920 20512 提取到的地区: []
DEBUG 2025-04-22 16:00:15,602 views 12920 20512 提取到的发病部位: []
DEBUG 2025-04-22 16:00:15,602 views 12920 20512 提取到的气象条件: []
DEBUG 2025-04-22 16:00:15,602 views 12920 20512 提取到的生育期: []
DEBUG 2025-04-22 16:00:15,602 views 12920 20512 提取到的地区: []
INFO 2025-04-22 16:00:15,602 views 12920 20512 症状提取结果: {}
INFO 2025-04-22 16:00:15,602 views 12920 20512 更新会话 3 的症状信息
INFO 2025-04-22 16:00:15,602 views 12920 20512 新的症状信息: {}
INFO 2025-04-22 16:00:15,602 views 12920 20512 检查会话状态: 3
INFO 2025-04-22 16:00:15,602 views 12920 20512 当前所有会话: ['3']
INFO 2025-04-22 16:00:15,602 views 12920 20512 从缓存获取的症状信息: {'collecting': True, 'symptoms': {'plant_part': '叶片', 'region': '河北'}}
INFO 2025-04-22 16:00:15,602 views 12920 20512 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {'plant_part': '叶片', 'region': '河北'}}}
INFO 2025-04-22 16:00:15,602 views 12920 20512 获取到的当前症状信息: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-22 16:00:15,602 views 12920 20512 更新后的完整症状信息: {'collecting': True, 'symptoms': {'plant_part': '叶片', 'region': '河北'}}
INFO 2025-04-22 16:00:15,602 views 12920 20512 更新后的症状信息: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-22 16:00:15,602 views 12920 20512 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片
- 发病地区：河北

还需要补充的信息：
- 气象条件
- 生育期

INFO 2025-04-22 16:00:18,488 services 12920 20512 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-22 16:00:18,488 services 12920 20512 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) MATCH (d)-[:OCCURS_IN_REGION]->(r:Region {name: $region}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-22 16:00:18,488 services 12920 20512 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-22 16:00:18,492 services 12920 20512 查询结果: <neo4j._sync.work.result.Result object at 0x0000023FB6881250>
DEBUG 2025-04-22 16:00:32,539 views 12920 20512 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 16:00:32,539 views 12920 20512 消息内容: 你好，我的小麦好像生病了...
DEBUG 2025-04-22 16:00:32,539 views 12920 20512 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 16:00:32,543 views 12920 20512 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 16:00:32,543 views 12920 20512 消息内容: 根据您提供的信息（发病部位：叶片，地区：河北），诊断结果为小麦叶锈病。

病害特征：
夏孢子堆圆形至长椭圆形，桔红色，散生，成熟后表皮开裂散出夏孢子；冬孢子堆主要在叶片背面和叶鞘上，圆形或长椭圆形，黑...
DEBUG 2025-04-22 16:00:32,543 views 12920 20512 历史记录更新成功，当前长度: 2
INFO 2025-04-22 16:00:32,547 basehttp 12920 20512 "GET /api/chat/stream_chat/?message=%E4%BD%A0%E5%A5%BD%EF%BC%8C%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%A5%BD%E5%83%8F%E7%94%9F%E7%97%85%E4%BA%86&session_id=3 HTTP/1.1" 200 3538
INFO 2025-04-22 16:00:34,975 views 12920 1520 Neo4j服务初始化成功
DEBUG 2025-04-22 16:00:37,002 views 12920 1520 ChatAPI实例初始化完成
INFO 2025-04-22 16:00:37,006 basehttp 12920 1520 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:04:05,924 views 12920 11252 Neo4j服务初始化成功
INFO 2025-04-22 16:04:06,066 views 12920 2368 Neo4j服务初始化成功
DEBUG 2025-04-22 16:04:07,978 views 12920 11252 ChatAPI实例初始化完成
INFO 2025-04-22 16:04:07,982 basehttp 12920 11252 "POST /api/chat/create_session/ HTTP/1.1" 200 40
DEBUG 2025-04-22 16:04:08,101 views 12920 2368 ChatAPI实例初始化完成
INFO 2025-04-22 16:04:08,101 basehttp 12920 2368 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 16:04:10,301 views 12920 6124 Neo4j服务初始化成功
DEBUG 2025-04-22 16:04:12,372 views 12920 6124 ChatAPI实例初始化完成
INFO 2025-04-22 16:04:12,375 basehttp 12920 6124 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:04:14,681 views 12920 15240 Neo4j服务初始化成功
DEBUG 2025-04-22 16:04:16,757 views 12920 15240 ChatAPI实例初始化完成
INFO 2025-04-22 16:04:16,757 basehttp 12920 15240 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:04:19,058 views 12920 3564 Neo4j服务初始化成功
DEBUG 2025-04-22 16:04:21,135 views 12920 3564 ChatAPI实例初始化完成
INFO 2025-04-22 16:04:21,136 basehttp 12920 3564 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:04:23,471 views 12920 8816 Neo4j服务初始化成功
DEBUG 2025-04-22 16:04:25,514 views 12920 8816 ChatAPI实例初始化完成
INFO 2025-04-22 16:04:25,518 basehttp 12920 8816 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:06:30,419 views 12920 20276 Neo4j服务初始化成功
DEBUG 2025-04-22 16:06:32,479 views 12920 20276 ChatAPI实例初始化完成
INFO 2025-04-22 16:06:32,480 basehttp 12920 20276 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 16:06:33,257 views 12920 8844 Neo4j服务初始化成功
INFO 2025-04-22 16:06:34,818 views 12920 19972 Neo4j服务初始化成功
DEBUG 2025-04-22 16:06:35,299 views 12920 8844 ChatAPI实例初始化完成
INFO 2025-04-22 16:06:35,299 basehttp 12920 8844 "POST /api/chat/create_session/ HTTP/1.1" 200 40
DEBUG 2025-04-22 16:06:36,869 views 12920 19972 ChatAPI实例初始化完成
INFO 2025-04-22 16:06:36,872 basehttp 12920 19972 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:06:39,181 views 12920 16548 Neo4j服务初始化成功
DEBUG 2025-04-22 16:06:41,253 views 12920 16548 ChatAPI实例初始化完成
INFO 2025-04-22 16:06:41,253 basehttp 12920 16548 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:06:43,566 views 12920 9916 Neo4j服务初始化成功
DEBUG 2025-04-22 16:06:45,595 views 12920 9916 ChatAPI实例初始化完成
INFO 2025-04-22 16:06:45,595 basehttp 12920 9916 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:07:43,164 views 12920 8292 Neo4j服务初始化成功
INFO 2025-04-22 16:07:43,517 views 12920 16464 Neo4j服务初始化成功
INFO 2025-04-22 16:07:43,571 views 12920 11012 Neo4j服务初始化成功
INFO 2025-04-22 16:07:43,617 views 12920 14992 Neo4j服务初始化成功
DEBUG 2025-04-22 16:07:45,251 views 12920 8292 ChatAPI实例初始化完成
INFO 2025-04-22 16:07:45,252 basehttp 12920 8292 "POST /api/chat/create_session/ HTTP/1.1" 200 40
DEBUG 2025-04-22 16:07:45,548 views 12920 16464 ChatAPI实例初始化完成
INFO 2025-04-22 16:07:45,549 basehttp 12920 16464 "POST /api/chat/create_session/ HTTP/1.1" 200 40
DEBUG 2025-04-22 16:07:45,628 views 12920 11012 ChatAPI实例初始化完成
INFO 2025-04-22 16:07:45,629 basehttp 12920 11012 "POST /api/chat/create_session/ HTTP/1.1" 200 40
DEBUG 2025-04-22 16:07:45,656 views 12920 14992 ChatAPI实例初始化完成
INFO 2025-04-22 16:07:45,657 basehttp 12920 14992 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 16:07:47,548 views 12920 2524 Neo4j服务初始化成功
DEBUG 2025-04-22 16:07:49,586 views 12920 2524 ChatAPI实例初始化完成
INFO 2025-04-22 16:07:49,587 basehttp 12920 2524 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:07:51,896 views 12920 15600 Neo4j服务初始化成功
DEBUG 2025-04-22 16:07:53,961 views 12920 15600 ChatAPI实例初始化完成
INFO 2025-04-22 16:07:53,962 basehttp 12920 15600 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:07:56,300 views 12920 18208 Neo4j服务初始化成功
DEBUG 2025-04-22 16:07:58,366 views 12920 18208 ChatAPI实例初始化完成
INFO 2025-04-22 16:07:58,370 basehttp 12920 18208 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:08:00,705 views 12920 3984 Neo4j服务初始化成功
DEBUG 2025-04-22 16:08:02,752 views 12920 3984 ChatAPI实例初始化完成
INFO 2025-04-22 16:08:02,758 basehttp 12920 3984 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:08:05,094 views 12920 17768 Neo4j服务初始化成功
DEBUG 2025-04-22 16:08:07,166 views 12920 17768 ChatAPI实例初始化完成
INFO 2025-04-22 16:08:07,166 basehttp 12920 17768 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:08:09,472 views 12920 2960 Neo4j服务初始化成功
DEBUG 2025-04-22 16:08:11,519 views 12920 2960 ChatAPI实例初始化完成
INFO 2025-04-22 16:08:11,522 basehttp 12920 2960 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:08:13,853 views 12920 15040 Neo4j服务初始化成功
DEBUG 2025-04-22 16:08:15,914 views 12920 15040 ChatAPI实例初始化完成
INFO 2025-04-22 16:08:15,918 basehttp 12920 15040 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:08:18,243 views 12920 19420 Neo4j服务初始化成功
DEBUG 2025-04-22 16:08:20,266 views 12920 19420 ChatAPI实例初始化完成
INFO 2025-04-22 16:08:20,266 basehttp 12920 19420 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:08:21,232 views 12920 17176 Neo4j服务初始化成功
DEBUG 2025-04-22 16:08:23,267 views 12920 17176 ChatAPI实例初始化完成
INFO 2025-04-22 16:08:23,267 basehttp 12920 17176 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 16:08:25,601 views 12920 19728 Neo4j服务初始化成功
DEBUG 2025-04-22 16:08:27,633 views 12920 19728 ChatAPI实例初始化完成
INFO 2025-04-22 16:08:27,633 basehttp 12920 19728 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:08:29,961 views 12920 23380 Neo4j服务初始化成功
DEBUG 2025-04-22 16:08:32,007 views 12920 23380 ChatAPI实例初始化完成
INFO 2025-04-22 16:08:32,007 basehttp 12920 23380 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:08:38,038 views 12920 23656 Neo4j服务初始化成功
DEBUG 2025-04-22 16:08:40,104 views 12920 23656 ChatAPI实例初始化完成
INFO 2025-04-22 16:08:40,108 basehttp 12920 23656 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 16:08:42,431 views 12920 2968 Neo4j服务初始化成功
DEBUG 2025-04-22 16:08:44,471 views 12920 2968 ChatAPI实例初始化完成
INFO 2025-04-22 16:08:44,471 basehttp 12920 2968 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:08:46,816 views 12920 1972 Neo4j服务初始化成功
DEBUG 2025-04-22 16:08:48,892 views 12920 1972 ChatAPI实例初始化完成
INFO 2025-04-22 16:08:48,898 basehttp 12920 1972 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:10:15,167 views 12920 3164 Neo4j服务初始化成功
INFO 2025-04-22 16:10:15,613 views 12920 16444 Neo4j服务初始化成功
INFO 2025-04-22 16:10:15,677 views 12920 18388 Neo4j服务初始化成功
INFO 2025-04-22 16:10:15,677 views 12920 4796 Neo4j服务初始化成功
INFO 2025-04-22 16:10:15,677 views 12920 11472 Neo4j服务初始化成功
INFO 2025-04-22 16:10:15,711 views 12920 11380 Neo4j服务初始化成功
DEBUG 2025-04-22 16:10:17,204 views 12920 3164 ChatAPI实例初始化完成
INFO 2025-04-22 16:10:17,204 basehttp 12920 3164 "POST /api/chat/create_session/ HTTP/1.1" 200 40
DEBUG 2025-04-22 16:10:17,658 views 12920 16444 ChatAPI实例初始化完成
INFO 2025-04-22 16:10:17,658 basehttp 12920 16444 "POST /api/chat/create_session/ HTTP/1.1" 200 40
DEBUG 2025-04-22 16:10:17,711 views 12920 11472 ChatAPI实例初始化完成
DEBUG 2025-04-22 16:10:17,715 views 12920 4796 ChatAPI实例初始化完成
DEBUG 2025-04-22 16:10:17,715 views 12920 18388 ChatAPI实例初始化完成
INFO 2025-04-22 16:10:17,715 basehttp 12920 11472 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 16:10:17,715 basehttp 12920 4796 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 16:10:17,715 basehttp 12920 18388 "POST /api/chat/create_session/ HTTP/1.1" 200 40
DEBUG 2025-04-22 16:10:17,761 views 12920 11380 ChatAPI实例初始化完成
INFO 2025-04-22 16:10:17,761 basehttp 12920 11380 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 16:10:19,523 views 12920 2444 Neo4j服务初始化成功
DEBUG 2025-04-22 16:10:21,585 views 12920 2444 ChatAPI实例初始化完成
INFO 2025-04-22 16:10:21,589 basehttp 12920 2444 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:10:23,909 views 12920 7912 Neo4j服务初始化成功
DEBUG 2025-04-22 16:10:25,934 views 12920 7912 ChatAPI实例初始化完成
INFO 2025-04-22 16:10:25,934 basehttp 12920 7912 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:10:28,251 views 12920 8520 Neo4j服务初始化成功
DEBUG 2025-04-22 16:10:30,299 views 12920 8520 ChatAPI实例初始化完成
INFO 2025-04-22 16:10:30,299 basehttp 12920 8520 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:10:32,645 views 12920 21048 Neo4j服务初始化成功
DEBUG 2025-04-22 16:10:34,697 views 12920 21048 ChatAPI实例初始化完成
INFO 2025-04-22 16:10:34,701 basehttp 12920 21048 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:10:36,990 views 12920 4556 Neo4j服务初始化成功
DEBUG 2025-04-22 16:10:39,035 views 12920 4556 ChatAPI实例初始化完成
INFO 2025-04-22 16:10:39,035 basehttp 12920 4556 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:10:40,121 views 12920 16988 Neo4j服务初始化成功
INFO 2025-04-22 16:10:41,366 views 12920 13568 Neo4j服务初始化成功
DEBUG 2025-04-22 16:10:42,184 views 12920 16988 ChatAPI实例初始化完成
INFO 2025-04-22 16:10:42,184 basehttp 12920 16988 "GET /api/chat/get_history/ HTTP/1.1" 200 37
DEBUG 2025-04-22 16:10:43,412 views 12920 13568 ChatAPI实例初始化完成
INFO 2025-04-22 16:10:43,412 basehttp 12920 13568 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:10:45,729 views 12920 17240 Neo4j服务初始化成功
DEBUG 2025-04-22 16:10:47,768 views 12920 17240 ChatAPI实例初始化完成
INFO 2025-04-22 16:10:47,772 basehttp 12920 17240 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:10:50,069 views 12920 15572 Neo4j服务初始化成功
DEBUG 2025-04-22 16:10:52,113 views 12920 15572 ChatAPI实例初始化完成
INFO 2025-04-22 16:10:52,117 basehttp 12920 15572 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:10:54,448 views 12920 23216 Neo4j服务初始化成功
DEBUG 2025-04-22 16:10:56,470 views 12920 23216 ChatAPI实例初始化完成
INFO 2025-04-22 16:10:56,474 basehttp 12920 23216 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:10:58,223 views 12920 15964 Neo4j服务初始化成功
INFO 2025-04-22 16:10:58,774 views 12920 4920 Neo4j服务初始化成功
DEBUG 2025-04-22 16:11:00,273 views 12920 15964 ChatAPI实例初始化完成
INFO 2025-04-22 16:11:00,273 basehttp 12920 15964 "POST /api/chat/create_session/ HTTP/1.1" 200 40
DEBUG 2025-04-22 16:11:00,829 views 12920 4920 ChatAPI实例初始化完成
INFO 2025-04-22 16:11:00,830 basehttp 12920 4920 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:11:02,872 views 12920 19368 Neo4j服务初始化成功
INFO 2025-04-22 16:11:03,221 views 12920 5916 Neo4j服务初始化成功
DEBUG 2025-04-22 16:11:04,914 views 12920 19368 ChatAPI实例初始化完成
INFO 2025-04-22 16:11:04,915 basehttp 12920 19368 "GET /api/chat/get_history/ HTTP/1.1" 200 37
DEBUG 2025-04-22 16:11:05,270 views 12920 5916 ChatAPI实例初始化完成
INFO 2025-04-22 16:11:05,272 basehttp 12920 5916 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:11:07,598 views 12920 15740 Neo4j服务初始化成功
DEBUG 2025-04-22 16:11:09,641 views 12920 15740 ChatAPI实例初始化完成
INFO 2025-04-22 16:11:09,641 basehttp 12920 15740 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:11:22,484 views 12920 3188 Neo4j服务初始化成功
DEBUG 2025-04-22 16:11:24,566 views 12920 3188 ChatAPI实例初始化完成
DEBUG 2025-04-22 16:11:24,566 views 12920 3188 收到stream_chat请求: {'message': ['你好，我的小麦到底有什么病'], 'session_id': ['3']}
DEBUG 2025-04-22 16:11:24,569 views 12920 3188 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 16:11:24,569 views 12920 3188 处理消息: 你好，我的小麦到底有什么病, 会话ID: 3
DEBUG 2025-04-22 16:11:24,569 views 12920 3188 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好，我的小麦到底有什么病'}]
DEBUG 2025-04-22 16:11:24,569 views 12920 3188 构建的消息列表长度: 2
INFO 2025-04-22 16:11:24,569 views 12920 3188 检查会话状态: 3
INFO 2025-04-22 16:11:24,569 views 12920 3188 当前所有会话: []
INFO 2025-04-22 16:11:24,569 views 12920 3188 从缓存获取的症状信息: {'collecting': True, 'symptoms': {'plant_part': '叶片', 'region': '河北'}}
INFO 2025-04-22 16:11:24,569 views 12920 3188 创建新会话: 3
INFO 2025-04-22 16:11:24,569 views 12920 3188 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {'plant_part': '叶片', 'region': '河北'}}}
DEBUG 2025-04-22 16:11:24,569 views 12920 3188 当前症状信息: {'plant_part': '叶片', 'region': '河北'}
DEBUG 2025-04-22 16:11:24,569 views 12920 3188 开始提取症状，输入消息: 你好，我的小麦到底有什么病
DEBUG 2025-04-22 16:11:24,573 views 12920 3188 分句结果: ['你好', '我的小麦到底有什么病', '你好，我的小麦到底有什么病']
DEBUG 2025-04-22 16:11:24,573 views 12920 3188 提取到的发病部位: []
DEBUG 2025-04-22 16:11:24,573 views 12920 3188 提取到的气象条件: []
DEBUG 2025-04-22 16:11:24,573 views 12920 3188 提取到的生育期: []
DEBUG 2025-04-22 16:11:24,574 views 12920 3188 提取到的地区: []
DEBUG 2025-04-22 16:11:24,574 views 12920 3188 提取到的发病部位: []
DEBUG 2025-04-22 16:11:24,574 views 12920 3188 提取到的气象条件: []
DEBUG 2025-04-22 16:11:24,575 views 12920 3188 提取到的生育期: []
DEBUG 2025-04-22 16:11:24,576 views 12920 3188 提取到的地区: []
DEBUG 2025-04-22 16:11:24,576 views 12920 3188 提取到的发病部位: []
DEBUG 2025-04-22 16:11:24,576 views 12920 3188 提取到的气象条件: []
DEBUG 2025-04-22 16:11:24,577 views 12920 3188 提取到的生育期: []
DEBUG 2025-04-22 16:11:24,577 views 12920 3188 提取到的地区: []
INFO 2025-04-22 16:11:24,577 views 12920 3188 症状提取结果: {}
INFO 2025-04-22 16:11:24,577 views 12920 3188 更新会话 3 的症状信息
INFO 2025-04-22 16:11:24,577 views 12920 3188 新的症状信息: {}
INFO 2025-04-22 16:11:24,578 views 12920 3188 检查会话状态: 3
INFO 2025-04-22 16:11:24,578 views 12920 3188 当前所有会话: ['3']
INFO 2025-04-22 16:11:24,578 views 12920 3188 从缓存获取的症状信息: {'collecting': True, 'symptoms': {'plant_part': '叶片', 'region': '河北'}}
INFO 2025-04-22 16:11:24,578 views 12920 3188 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {'plant_part': '叶片', 'region': '河北'}}}
INFO 2025-04-22 16:11:24,579 views 12920 3188 获取到的当前症状信息: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-22 16:11:24,579 views 12920 3188 更新后的完整症状信息: {'collecting': True, 'symptoms': {'plant_part': '叶片', 'region': '河北'}}
INFO 2025-04-22 16:11:24,579 views 12920 3188 更新后的症状信息: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-22 16:11:24,579 views 12920 3188 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片
- 发病地区：河北

还需要补充的信息：
- 气象条件
- 生育期

INFO 2025-04-22 16:11:27,460 services 12920 3188 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-22 16:11:27,460 services 12920 3188 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) MATCH (d)-[:OCCURS_IN_REGION]->(r:Region {name: $region}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-22 16:11:27,469 services 12920 3188 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-22 16:11:27,471 services 12920 3188 查询结果: <neo4j._sync.work.result.Result object at 0x0000023FB67490A0>
DEBUG 2025-04-22 16:11:41,502 views 12920 3188 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 16:11:41,502 views 12920 3188 消息内容: 你好，我的小麦到底有什么病...
DEBUG 2025-04-22 16:11:41,502 views 12920 3188 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 16:11:41,506 views 12920 3188 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 16:11:41,506 views 12920 3188 消息内容: 根据您提供的信息（发病部位：叶片，地区：河北），诊断结果为小麦叶锈病。

病害特征：
夏孢子堆圆形至长椭圆形，桔红色，散生，成熟后表皮开裂散出夏孢子；冬孢子堆主要在叶片背面和叶鞘上，圆形或长椭圆形，黑...
DEBUG 2025-04-22 16:11:41,506 views 12920 3188 历史记录更新成功，当前长度: 2
INFO 2025-04-22 16:11:41,510 basehttp 12920 3188 "GET /api/chat/stream_chat/?message=%E4%BD%A0%E5%A5%BD%EF%BC%8C%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%88%B0%E5%BA%95%E6%9C%89%E4%BB%80%E4%B9%88%E7%97%85&session_id=3 HTTP/1.1" 200 3538
INFO 2025-04-22 16:11:43,935 views 12920 7100 Neo4j服务初始化成功
DEBUG 2025-04-22 16:11:45,989 views 12920 7100 ChatAPI实例初始化完成
INFO 2025-04-22 16:11:45,993 basehttp 12920 7100 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:14:26,100 views 12920 10316 Neo4j服务初始化成功
INFO 2025-04-22 16:14:26,338 views 12920 16840 Neo4j服务初始化成功
DEBUG 2025-04-22 16:14:28,160 views 12920 10316 ChatAPI实例初始化完成
INFO 2025-04-22 16:14:28,161 basehttp 12920 10316 "POST /api/chat/create_session/ HTTP/1.1" 200 40
DEBUG 2025-04-22 16:14:28,377 views 12920 16840 ChatAPI实例初始化完成
INFO 2025-04-22 16:14:28,377 basehttp 12920 16840 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 16:14:30,559 views 12920 22220 Neo4j服务初始化成功
DEBUG 2025-04-22 16:14:32,614 views 12920 22220 ChatAPI实例初始化完成
INFO 2025-04-22 16:14:32,618 basehttp 12920 22220 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:14:34,962 views 12920 5424 Neo4j服务初始化成功
DEBUG 2025-04-22 16:14:37,023 views 12920 5424 ChatAPI实例初始化完成
INFO 2025-04-22 16:14:37,024 basehttp 12920 5424 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:14:39,336 views 12920 17976 Neo4j服务初始化成功
DEBUG 2025-04-22 16:14:41,379 views 12920 17976 ChatAPI实例初始化完成
INFO 2025-04-22 16:14:41,380 basehttp 12920 17976 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:14:43,680 views 12920 18660 Neo4j服务初始化成功
DEBUG 2025-04-22 16:14:45,726 views 12920 18660 ChatAPI实例初始化完成
INFO 2025-04-22 16:14:45,730 basehttp 12920 18660 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:15:18,807 views 12920 4152 Neo4j服务初始化成功
DEBUG 2025-04-22 16:15:20,839 views 12920 4152 ChatAPI实例初始化完成
INFO 2025-04-22 16:15:20,840 basehttp 12920 4152 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 16:15:23,204 views 12920 18236 Neo4j服务初始化成功
DEBUG 2025-04-22 16:15:25,248 views 12920 18236 ChatAPI实例初始化完成
INFO 2025-04-22 16:15:25,248 basehttp 12920 18236 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:15:27,563 views 12920 3824 Neo4j服务初始化成功
DEBUG 2025-04-22 16:15:29,612 views 12920 3824 ChatAPI实例初始化完成
INFO 2025-04-22 16:15:29,612 basehttp 12920 3824 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:15:51,330 views 12920 20108 Neo4j服务初始化成功
DEBUG 2025-04-22 16:15:53,380 views 12920 20108 ChatAPI实例初始化完成
INFO 2025-04-22 16:15:53,381 basehttp 12920 20108 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 16:15:55,677 views 12920 14932 Neo4j服务初始化成功
INFO 2025-04-22 16:15:57,300 basehttp 12920 20688 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
DEBUG 2025-04-22 16:15:57,721 views 12920 14932 ChatAPI实例初始化完成
INFO 2025-04-22 16:15:57,723 basehttp 12920 14932 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:16:00,030 views 12920 3092 Neo4j服务初始化成功
INFO 2025-04-22 16:16:01,808 basehttp 12920 21600 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
DEBUG 2025-04-22 16:16:02,088 views 12920 3092 ChatAPI实例初始化完成
INFO 2025-04-22 16:16:02,088 basehttp 12920 3092 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:16:21,789 basehttp 12920 21600 "OPTIONS /api/users/ HTTP/1.1" 200 0
INFO 2025-04-22 16:16:21,812 basehttp 12920 21600 "GET /api/users/ HTTP/1.1" 200 226
INFO 2025-04-22 16:16:26,980 views 12920 8352 Neo4j服务初始化成功
INFO 2025-04-22 16:16:27,543 basehttp 12920 20688 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
DEBUG 2025-04-22 16:16:29,023 views 12920 8352 ChatAPI实例初始化完成
INFO 2025-04-22 16:16:29,025 basehttp 12920 8352 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 16:16:31,351 views 12920 12056 Neo4j服务初始化成功
INFO 2025-04-22 16:16:31,732 basehttp 12920 21600 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
DEBUG 2025-04-22 16:16:33,401 views 12920 12056 ChatAPI实例初始化完成
INFO 2025-04-22 16:16:33,401 basehttp 12920 12056 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:16:35,737 views 12920 21552 Neo4j服务初始化成功
DEBUG 2025-04-22 16:16:37,798 views 12920 21552 ChatAPI实例初始化完成
INFO 2025-04-22 16:16:37,798 basehttp 12920 21552 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:18:28,010 autoreload 20688 21600 Watching for file changes with StatReloader
INFO 2025-04-22 16:19:16,592 views 20688 15640 Neo4j服务初始化成功
DEBUG 2025-04-22 16:19:18,618 views 20688 15640 ChatAPI实例初始化完成
INFO 2025-04-22 16:19:18,622 basehttp 20688 15640 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 16:19:21,238 views 20688 22232 Neo4j服务初始化成功
DEBUG 2025-04-22 16:19:23,281 views 20688 22232 ChatAPI实例初始化完成
INFO 2025-04-22 16:19:23,285 basehttp 20688 22232 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:19:25,606 views 20688 24448 Neo4j服务初始化成功
DEBUG 2025-04-22 16:19:27,667 views 20688 24448 ChatAPI实例初始化完成
INFO 2025-04-22 16:19:27,667 basehttp 20688 24448 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:20:37,576 views 20688 18900 Neo4j服务初始化成功
DEBUG 2025-04-22 16:20:39,602 views 20688 18900 ChatAPI实例初始化完成
DEBUG 2025-04-22 16:20:39,602 views 20688 18900 收到stream_chat请求: {'message': ['你好，我的小麦好像出现了一些问题，叶片部位很严重，能告诉我出现了什么问题吗'], 'session_id': ['3']}
DEBUG 2025-04-22 16:20:39,606 views 20688 18900 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 16:20:39,607 views 20688 18900 处理消息: 你好，我的小麦好像出现了一些问题，叶片部位很严重，能告诉我出现了什么问题吗, 会话ID: 3
DEBUG 2025-04-22 16:20:39,607 views 20688 18900 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好，我的小麦好像出现了一些问题，叶片部位很严重，能告诉我出现了什么问题吗'}]
DEBUG 2025-04-22 16:20:39,607 views 20688 18900 构建的消息列表长度: 2
DEBUG 2025-04-22 16:20:43,093 views 20688 18900 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 16:20:43,093 views 20688 18900 消息内容: 你好，我的小麦好像出现了一些问题，叶片部位很严重，能告诉我出现了什么问题吗...
DEBUG 2025-04-22 16:20:43,093 views 20688 18900 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 16:20:43,093 views 20688 18900 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 16:20:43,093 views 20688 18900 消息内容: 为了更准确地诊断小麦病害，还需要您补充一些信息，比如：从叶片的哪个部位开始发病（叶尖、叶缘还是叶片中部等），发病时的气象条件（比如温度、湿度、降雨情况等），小麦处于哪个生育期（苗期、拔节期、抽穗期等）...
DEBUG 2025-04-22 16:20:43,093 views 20688 18900 历史记录更新成功，当前长度: 2
INFO 2025-04-22 16:20:43,093 basehttp 20688 18900 "GET /api/chat/stream_chat/?message=%E4%BD%A0%E5%A5%BD%EF%BC%8C%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%A5%BD%E5%83%8F%E5%87%BA%E7%8E%B0%E4%BA%86%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%EF%BC%8C%E5%8F%B6%E7%89%87%E9%83%A8%E4%BD%8D%E5%BE%88%E4%B8%A5%E9%87%8D%EF%BC%8C%E8%83%BD%E5%91%8A%E8%AF%89%E6%88%91%E5%87%BA%E7%8E%B0%E4%BA%86%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98%E5%90%97&session_id=3 HTTP/1.1" 200 1128
INFO 2025-04-22 16:20:45,442 views 20688 22960 Neo4j服务初始化成功
DEBUG 2025-04-22 16:20:47,509 views 20688 22960 ChatAPI实例初始化完成
INFO 2025-04-22 16:20:47,509 basehttp 20688 22960 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:22:35,000 autoreload 20688 21600 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 16:22:35,802 autoreload 14892 22648 Watching for file changes with StatReloader
INFO 2025-04-22 16:24:07,666 autoreload 14892 22648 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 16:24:08,575 autoreload 7892 7380 Watching for file changes with StatReloader
INFO 2025-04-22 16:24:13,833 autoreload 7892 7380 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 16:24:14,689 autoreload 3780 22492 Watching for file changes with StatReloader
INFO 2025-04-22 16:24:24,054 views 3780 23140 Neo4j服务初始化成功
DEBUG 2025-04-22 16:24:26,103 views 3780 23140 ChatAPI实例初始化完成
DEBUG 2025-04-22 16:24:26,107 views 3780 23140 收到stream_chat请求: {'message': ['你好，我的小麦好像出现了一些问题，叶片部位很严重，能告诉我出现了什么问题吗'], 'session_id': ['3']}
DEBUG 2025-04-22 16:24:26,107 views 3780 23140 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 16:24:26,111 views 3780 23140 处理消息: 你好，我的小麦好像出现了一些问题，叶片部位很严重，能告诉我出现了什么问题吗, 会话ID: 3
DEBUG 2025-04-22 16:24:26,115 views 3780 23140 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好，我的小麦好像出现了一些问题，叶片部位很严重，能告诉我出现了什么问题吗'}]
DEBUG 2025-04-22 16:24:26,119 views 3780 23140 构建的消息列表长度: 2
INFO 2025-04-22 16:24:26,122 views 3780 23140 检查会话状态: 3
INFO 2025-04-22 16:24:26,123 views 3780 23140 当前所有会话: []
INFO 2025-04-22 16:24:26,124 views 3780 23140 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 16:24:26,125 views 3780 23140 创建新会话: 3
INFO 2025-04-22 16:24:26,126 views 3780 23140 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {}}}
DEBUG 2025-04-22 16:24:26,127 views 3780 23140 当前症状信息: {}
DEBUG 2025-04-22 16:24:26,127 views 3780 23140 开始提取症状，输入消息: 你好，我的小麦好像出现了一些问题，叶片部位很严重，能告诉我出现了什么问题吗
DEBUG 2025-04-22 16:24:26,127 views 3780 23140 分句结果: ['你好', '我的小麦好像出现了一些问题', '叶片部位很严重', '能告诉我出现了什么问题吗', '你好，我的小麦好像出现了一些问题，叶片部位很严重，能告诉我出现了什么问题吗']
DEBUG 2025-04-22 16:24:26,127 views 3780 23140 提取到的发病部位: []
DEBUG 2025-04-22 16:24:26,127 views 3780 23140 提取到的气象条件: []
DEBUG 2025-04-22 16:24:26,131 views 3780 23140 提取到的生育期: []
DEBUG 2025-04-22 16:24:26,131 views 3780 23140 提取到的地区: []
DEBUG 2025-04-22 16:24:26,131 views 3780 23140 提取到的发病部位: []
DEBUG 2025-04-22 16:24:26,131 views 3780 23140 提取到的气象条件: []
DEBUG 2025-04-22 16:24:26,131 views 3780 23140 提取到的生育期: []
DEBUG 2025-04-22 16:24:26,131 views 3780 23140 提取到的地区: []
DEBUG 2025-04-22 16:24:26,131 views 3780 23140 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 16:24:26,131 views 3780 23140 提取到的气象条件: []
DEBUG 2025-04-22 16:24:26,135 views 3780 23140 提取到的生育期: []
DEBUG 2025-04-22 16:24:26,135 views 3780 23140 提取到的地区: []
DEBUG 2025-04-22 16:24:26,135 views 3780 23140 提取到的发病部位: []
DEBUG 2025-04-22 16:24:26,135 views 3780 23140 提取到的气象条件: []
DEBUG 2025-04-22 16:24:26,135 views 3780 23140 提取到的生育期: []
DEBUG 2025-04-22 16:24:26,135 views 3780 23140 提取到的地区: []
DEBUG 2025-04-22 16:24:26,135 views 3780 23140 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 16:24:26,135 views 3780 23140 提取到的气象条件: []
DEBUG 2025-04-22 16:24:26,135 views 3780 23140 提取到的生育期: []
DEBUG 2025-04-22 16:24:26,139 views 3780 23140 提取到的地区: []
INFO 2025-04-22 16:24:26,139 views 3780 23140 症状提取结果: {'plant_part': '叶片'}
INFO 2025-04-22 16:24:26,139 views 3780 23140 更新会话 3 的症状信息
INFO 2025-04-22 16:24:26,139 views 3780 23140 新的症状信息: {'plant_part': '叶片'}
INFO 2025-04-22 16:24:26,139 views 3780 23140 检查会话状态: 3
INFO 2025-04-22 16:24:26,139 views 3780 23140 当前所有会话: ['3']
INFO 2025-04-22 16:24:26,139 views 3780 23140 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 16:24:26,139 views 3780 23140 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {}}}
INFO 2025-04-22 16:24:26,139 views 3780 23140 获取到的当前症状信息: {}
INFO 2025-04-22 16:24:26,143 views 3780 23140 更新症状类别 plant_part: 叶片
INFO 2025-04-22 16:24:26,143 views 3780 23140 更新后的完整症状信息: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-22 16:24:26,143 views 3780 23140 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-22 16:24:26,144 views 3780 23140 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 发病地区

INFO 2025-04-22 16:24:28,851 services 3780 23140 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-22 16:24:28,851 services 3780 23140 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-22 16:24:28,855 services 3780 23140 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-22 16:24:28,860 services 3780 23140 查询结果: <neo4j._sync.work.result.Result object at 0x0000021EA606AC30>
DEBUG 2025-04-22 16:24:51,518 views 3780 23140 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 16:24:51,518 views 3780 23140 消息内容: 你好，我的小麦好像出现了一些问题，叶片部位很严重，能告诉我出现了什么问题吗...
DEBUG 2025-04-22 16:24:51,518 views 3780 23140 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 16:24:51,518 views 3780 23140 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 16:24:51,518 views 3780 23140 消息内容: 根据目前掌握的信息（发病部位：叶片），可能的病害有：

1. 小麦黑颖病
   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或...
DEBUG 2025-04-22 16:24:51,518 views 3780 23140 历史记录更新成功，当前长度: 2
INFO 2025-04-22 16:24:51,518 basehttp 3780 23140 "GET /api/chat/stream_chat/?message=%E4%BD%A0%E5%A5%BD%EF%BC%8C%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%A5%BD%E5%83%8F%E5%87%BA%E7%8E%B0%E4%BA%86%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%EF%BC%8C%E5%8F%B6%E7%89%87%E9%83%A8%E4%BD%8D%E5%BE%88%E4%B8%A5%E9%87%8D%EF%BC%8C%E8%83%BD%E5%91%8A%E8%AF%89%E6%88%91%E5%87%BA%E7%8E%B0%E4%BA%86%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98%E5%90%97&session_id=3 HTTP/1.1" 200 5351
INFO 2025-04-22 16:24:54,079 views 3780 11008 Neo4j服务初始化成功
DEBUG 2025-04-22 16:24:56,132 views 3780 11008 ChatAPI实例初始化完成
INFO 2025-04-22 16:24:56,132 basehttp 3780 11008 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:25:33,648 views 3780 9360 Neo4j服务初始化成功
DEBUG 2025-04-22 16:25:35,701 views 3780 9360 ChatAPI实例初始化完成
DEBUG 2025-04-22 16:25:35,705 views 3780 9360 收到stream_chat请求: {'message': ['我目前的所在地是河北'], 'session_id': ['3']}
DEBUG 2025-04-22 16:25:35,705 views 3780 9360 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 16:25:35,709 views 3780 9360 处理消息: 我目前的所在地是河北, 会话ID: 3
DEBUG 2025-04-22 16:25:35,712 views 3780 9360 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我目前的所在地是河北'}]
DEBUG 2025-04-22 16:25:35,714 views 3780 9360 构建的消息列表长度: 2
DEBUG 2025-04-22 16:25:38,953 views 3780 9360 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 16:25:38,956 views 3780 9360 消息内容: 我目前的所在地是河北...
DEBUG 2025-04-22 16:25:38,956 views 3780 9360 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 16:25:38,956 views 3780 9360 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 16:25:38,957 views 3780 9360 消息内容: 仅知道您在河北信息还不够哦。麻烦您详细描述一下小麦出现的症状，比如小麦哪个部位开始发病，发病时的气象条件，小麦处于什么生育期等，这样我才能准确地为您诊断小麦可能患的病害。 ...
DEBUG 2025-04-22 16:25:38,957 views 3780 9360 历史记录更新成功，当前长度: 2
INFO 2025-04-22 16:25:38,957 basehttp 3780 9360 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9B%AE%E5%89%8D%E7%9A%84%E6%89%80%E5%9C%A8%E5%9C%B0%E6%98%AF%E6%B2%B3%E5%8C%97&session_id=3 HTTP/1.1" 200 745
INFO 2025-04-22 16:25:41,315 views 3780 16840 Neo4j服务初始化成功
DEBUG 2025-04-22 16:25:43,369 views 3780 16840 ChatAPI实例初始化完成
INFO 2025-04-22 16:25:43,373 basehttp 3780 16840 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:25:51,001 views 3780 18292 Neo4j服务初始化成功
DEBUG 2025-04-22 16:25:53,049 views 3780 18292 ChatAPI实例初始化完成
INFO 2025-04-22 16:25:53,049 basehttp 3780 18292 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 16:25:55,362 views 3780 16032 Neo4j服务初始化成功
DEBUG 2025-04-22 16:25:57,396 views 3780 16032 ChatAPI实例初始化完成
INFO 2025-04-22 16:25:57,398 basehttp 3780 16032 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:25:59,725 views 3780 24192 Neo4j服务初始化成功
DEBUG 2025-04-22 16:26:01,786 views 3780 24192 ChatAPI实例初始化完成
INFO 2025-04-22 16:26:01,790 basehttp 3780 24192 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:26:49,915 autoreload 8464 8488 Watching for file changes with StatReloader
INFO 2025-04-22 16:27:59,170 views 8464 15660 Neo4j服务初始化成功
DEBUG 2025-04-22 16:28:01,222 views 8464 15660 ChatAPI实例初始化完成
INFO 2025-04-22 16:28:01,225 basehttp 8464 15660 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 16:28:03,864 views 8464 15476 Neo4j服务初始化成功
DEBUG 2025-04-22 16:28:05,915 views 8464 15476 ChatAPI实例初始化完成
INFO 2025-04-22 16:28:05,915 basehttp 8464 15476 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:28:08,220 views 8464 12516 Neo4j服务初始化成功
DEBUG 2025-04-22 16:28:10,249 views 8464 12516 ChatAPI实例初始化完成
INFO 2025-04-22 16:28:10,253 basehttp 8464 12516 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:28:46,117 views 8464 14060 Neo4j服务初始化成功
DEBUG 2025-04-22 16:28:48,196 views 8464 14060 ChatAPI实例初始化完成
DEBUG 2025-04-22 16:28:48,196 views 8464 14060 收到stream_chat请求: {'message': ['你好我的小麦好像出现了一些问题，主要是在叶片上'], 'session_id': ['3']}
DEBUG 2025-04-22 16:28:48,200 views 8464 14060 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 16:28:48,207 views 8464 14060 处理消息: 你好我的小麦好像出现了一些问题，主要是在叶片上, 会话ID: 3
DEBUG 2025-04-22 16:28:48,208 views 8464 14060 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好我的小麦好像出现了一些问题，主要是在叶片上'}]
DEBUG 2025-04-22 16:28:48,210 views 8464 14060 构建的消息列表长度: 2
INFO 2025-04-22 16:28:48,212 views 8464 14060 检查会话状态: 3
INFO 2025-04-22 16:28:48,213 views 8464 14060 当前所有会话: []
INFO 2025-04-22 16:28:48,214 views 8464 14060 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 16:28:48,215 views 8464 14060 创建新会话: 3
INFO 2025-04-22 16:28:48,215 views 8464 14060 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {}}}
DEBUG 2025-04-22 16:28:48,216 views 8464 14060 当前症状信息: {}
DEBUG 2025-04-22 16:28:48,217 views 8464 14060 开始提取症状，输入消息: 你好我的小麦好像出现了一些问题，主要是在叶片上
DEBUG 2025-04-22 16:28:48,218 views 8464 14060 分句结果: ['你好我的小麦好像出现了一些问题', '主要是在叶片上', '你好我的小麦好像出现了一些问题，主要是在叶片上']
DEBUG 2025-04-22 16:28:48,218 views 8464 14060 提取到的发病部位: []
DEBUG 2025-04-22 16:28:48,219 views 8464 14060 提取到的气象条件: []
DEBUG 2025-04-22 16:28:48,219 views 8464 14060 提取到的生育期: []
DEBUG 2025-04-22 16:28:48,219 views 8464 14060 提取到的地区: []
DEBUG 2025-04-22 16:28:48,219 views 8464 14060 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 16:28:48,220 views 8464 14060 提取到的气象条件: []
DEBUG 2025-04-22 16:28:48,220 views 8464 14060 提取到的生育期: []
DEBUG 2025-04-22 16:28:48,220 views 8464 14060 提取到的地区: []
DEBUG 2025-04-22 16:28:48,220 views 8464 14060 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 16:28:48,221 views 8464 14060 提取到的气象条件: []
DEBUG 2025-04-22 16:28:48,221 views 8464 14060 提取到的生育期: []
DEBUG 2025-04-22 16:28:48,221 views 8464 14060 提取到的地区: []
INFO 2025-04-22 16:28:48,221 views 8464 14060 症状提取结果: {'plant_part': '叶片'}
INFO 2025-04-22 16:28:48,221 views 8464 14060 更新会话 3 的症状信息
INFO 2025-04-22 16:28:48,222 views 8464 14060 新的症状信息: {'plant_part': '叶片'}
INFO 2025-04-22 16:28:48,222 views 8464 14060 检查会话状态: 3
INFO 2025-04-22 16:28:48,222 views 8464 14060 当前所有会话: ['3']
INFO 2025-04-22 16:28:48,222 views 8464 14060 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 16:28:48,222 views 8464 14060 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {}}}
INFO 2025-04-22 16:28:48,223 views 8464 14060 获取到的当前症状信息: {}
INFO 2025-04-22 16:28:48,223 views 8464 14060 更新症状类别 plant_part: 叶片
INFO 2025-04-22 16:28:48,223 views 8464 14060 更新后的完整症状信息: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-22 16:28:48,223 views 8464 14060 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-22 16:28:48,223 views 8464 14060 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 发病地区

INFO 2025-04-22 16:28:50,942 services 8464 14060 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-22 16:28:50,942 services 8464 14060 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-22 16:28:50,943 services 8464 14060 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-22 16:28:50,947 services 8464 14060 查询结果: <neo4j._sync.work.result.Result object at 0x00000214F1C6B800>
DEBUG 2025-04-22 16:29:13,638 views 8464 14060 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 16:29:13,638 views 8464 14060 消息内容: 你好我的小麦好像出现了一些问题，主要是在叶片上...
DEBUG 2025-04-22 16:29:13,638 views 8464 14060 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 16:29:13,638 views 8464 14060 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 16:29:13,639 views 8464 14060 消息内容: 根据目前掌握的信息（发病部位：叶片），可能的病害有：

1. 小麦黑颖病
   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或...
DEBUG 2025-04-22 16:29:13,639 views 8464 14060 历史记录更新成功，当前长度: 2
INFO 2025-04-22 16:29:13,639 basehttp 8464 14060 "GET /api/chat/stream_chat/?message=%E4%BD%A0%E5%A5%BD%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%A5%BD%E5%83%8F%E5%87%BA%E7%8E%B0%E4%BA%86%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%EF%BC%8C%E4%B8%BB%E8%A6%81%E6%98%AF%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A&session_id=3 HTTP/1.1" 200 5351
INFO 2025-04-22 16:29:16,498 views 8464 18068 Neo4j服务初始化成功
DEBUG 2025-04-22 16:29:18,546 views 8464 18068 ChatAPI实例初始化完成
INFO 2025-04-22 16:29:18,546 basehttp 8464 18068 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:29:34,540 views 8464 1348 Neo4j服务初始化成功
DEBUG 2025-04-22 16:29:36,584 views 8464 1348 ChatAPI实例初始化完成
DEBUG 2025-04-22 16:29:36,584 views 8464 1348 收到stream_chat请求: {'message': ['我目前所在位置是在河北'], 'session_id': ['3']}
DEBUG 2025-04-22 16:29:36,589 views 8464 1348 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 16:29:36,593 views 8464 1348 处理消息: 我目前所在位置是在河北, 会话ID: 3
DEBUG 2025-04-22 16:29:36,594 views 8464 1348 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我目前所在位置是在河北'}]
DEBUG 2025-04-22 16:29:36,596 views 8464 1348 构建的消息列表长度: 2
DEBUG 2025-04-22 16:29:40,103 views 8464 1348 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 16:29:40,103 views 8464 1348 消息内容: 我目前所在位置是在河北...
DEBUG 2025-04-22 16:29:40,103 views 8464 1348 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 16:29:40,107 views 8464 1348 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 16:29:40,107 views 8464 1348 消息内容: 仅知道您在河北，关于小麦病害的症状信息还不够呢。请您详细描述一下小麦出现的症状，比如小麦从哪个部位开始发病，发病时的气象条件，处于什么生育期等，这样我才能准确为您诊断病害并给出防治建议。 ...
DEBUG 2025-04-22 16:29:40,107 views 8464 1348 历史记录更新成功，当前长度: 2
INFO 2025-04-22 16:29:40,111 basehttp 8464 1348 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9B%AE%E5%89%8D%E6%89%80%E5%9C%A8%E4%BD%8D%E7%BD%AE%E6%98%AF%E5%9C%A8%E6%B2%B3%E5%8C%97&session_id=3 HTTP/1.1" 200 809
INFO 2025-04-22 16:29:42,807 views 8464 24464 Neo4j服务初始化成功
DEBUG 2025-04-22 16:29:44,844 views 8464 24464 ChatAPI实例初始化完成
INFO 2025-04-22 16:29:44,848 basehttp 8464 24464 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:32:18,216 autoreload 8464 8488 D:\GraduationProject\wheatdisease\backend\settings.py changed, reloading.
INFO 2025-04-22 16:32:19,016 autoreload 16052 23892 Watching for file changes with StatReloader
INFO 2025-04-22 16:33:31,407 autoreload 16052 23892 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 16:33:32,348 autoreload 1820 3496 Watching for file changes with StatReloader
INFO 2025-04-22 16:34:28,477 autoreload 20732 21136 Watching for file changes with StatReloader
INFO 2025-04-22 16:35:01,524 views 20732 17960 Neo4j服务初始化成功
DEBUG 2025-04-22 16:35:03,565 views 20732 17960 ChatAPI实例初始化完成
INFO 2025-04-22 16:35:03,565 basehttp 20732 17960 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 16:35:05,896 views 20732 10304 Neo4j服务初始化成功
DEBUG 2025-04-22 16:35:07,932 views 20732 10304 ChatAPI实例初始化完成
INFO 2025-04-22 16:35:07,932 basehttp 20732 10304 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:35:10,273 views 20732 15352 Neo4j服务初始化成功
DEBUG 2025-04-22 16:35:12,315 views 20732 15352 ChatAPI实例初始化完成
INFO 2025-04-22 16:35:12,315 basehttp 20732 15352 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:36:37,627 views 20732 11096 Neo4j服务初始化成功
DEBUG 2025-04-22 16:36:39,667 views 20732 11096 ChatAPI实例初始化完成
DEBUG 2025-04-22 16:36:39,670 views 20732 11096 收到stream_chat请求: {'message': ['我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗'], 'session_id': ['3']}
DEBUG 2025-04-22 16:36:39,670 views 20732 11096 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 16:36:39,670 views 20732 11096 处理消息: 我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗, 会话ID: 3
DEBUG 2025-04-22 16:36:39,670 views 20732 11096 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗'}]
DEBUG 2025-04-22 16:36:39,670 views 20732 11096 构建的消息列表长度: 2
INFO 2025-04-22 16:36:39,670 views 20732 11096 检查会话状态: 3
INFO 2025-04-22 16:36:39,670 views 20732 11096 当前所有会话: []
INFO 2025-04-22 16:36:39,674 views 20732 11096 从缓存获取症状信息 - 会话ID: 3, 数据: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 16:36:39,674 views 20732 11096 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 16:36:39,675 views 20732 11096 创建新会话: 3
INFO 2025-04-22 16:36:39,675 views 20732 11096 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {}}}
DEBUG 2025-04-22 16:36:39,676 views 20732 11096 当前症状信息: {}
DEBUG 2025-04-22 16:36:39,676 views 20732 11096 开始提取症状，输入消息: 我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗
DEBUG 2025-04-22 16:36:39,676 views 20732 11096 分句结果: ['我的小麦好像出现了一些问题', '主要发生在叶片上', '请问我的小麦是有什么病害吗', '我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗']
DEBUG 2025-04-22 16:36:39,677 views 20732 11096 提取到的发病部位: []
DEBUG 2025-04-22 16:36:39,677 views 20732 11096 提取到的气象条件: []
DEBUG 2025-04-22 16:36:39,677 views 20732 11096 提取到的生育期: []
DEBUG 2025-04-22 16:36:39,677 views 20732 11096 提取到的地区: []
DEBUG 2025-04-22 16:36:39,678 views 20732 11096 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 16:36:39,678 views 20732 11096 提取到的气象条件: []
DEBUG 2025-04-22 16:36:39,678 views 20732 11096 提取到的生育期: []
DEBUG 2025-04-22 16:36:39,678 views 20732 11096 提取到的地区: []
DEBUG 2025-04-22 16:36:39,678 views 20732 11096 提取到的发病部位: []
DEBUG 2025-04-22 16:36:39,679 views 20732 11096 提取到的气象条件: []
DEBUG 2025-04-22 16:36:39,679 views 20732 11096 提取到的生育期: []
DEBUG 2025-04-22 16:36:39,679 views 20732 11096 提取到的地区: []
DEBUG 2025-04-22 16:36:39,679 views 20732 11096 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 16:36:39,680 views 20732 11096 提取到的气象条件: []
DEBUG 2025-04-22 16:36:39,680 views 20732 11096 提取到的生育期: []
DEBUG 2025-04-22 16:36:39,680 views 20732 11096 提取到的地区: []
INFO 2025-04-22 16:36:39,681 views 20732 11096 症状提取结果: {'plant_part': '叶片'}
INFO 2025-04-22 16:36:39,681 views 20732 11096 开始更新症状信息 - 会话ID: 3, 新症状: {'plant_part': '叶片'}
INFO 2025-04-22 16:36:39,681 views 20732 11096 检查会话状态: 3
INFO 2025-04-22 16:36:39,681 views 20732 11096 当前所有会话: ['3']
INFO 2025-04-22 16:36:39,682 views 20732 11096 从缓存获取症状信息 - 会话ID: 3, 数据: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 16:36:39,682 views 20732 11096 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 16:36:39,682 views 20732 11096 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {}}}
INFO 2025-04-22 16:36:39,683 views 20732 11096 当前症状信息 - 会话ID: 3, 症状: {}
INFO 2025-04-22 16:36:39,683 views 20732 11096 更新症状类别 - 会话ID: 3, 类别: plant_part, 值: 叶片
INFO 2025-04-22 16:36:39,683 views 20732 11096 保存症状信息到缓存 - 会话ID: 3, 数据: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-22 16:36:39,684 views 20732 11096 症状信息成功保存到缓存 - 会话ID: 3
INFO 2025-04-22 16:36:39,684 views 20732 11096 症状信息更新完成 - 会话ID: 3, 最终症状: {'plant_part': '叶片'}
INFO 2025-04-22 16:36:39,684 views 20732 11096 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-22 16:36:39,684 views 20732 11096 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 发病地区

INFO 2025-04-22 16:36:42,432 services 20732 11096 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-22 16:36:42,432 services 20732 11096 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-22 16:36:42,432 services 20732 11096 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-22 16:36:42,436 services 20732 11096 查询结果: <neo4j._sync.work.result.Result object at 0x0000029EBF7EF110>
DEBUG 2025-04-22 16:37:05,121 views 20732 11096 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 16:37:05,121 views 20732 11096 消息内容: 我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗...
DEBUG 2025-04-22 16:37:05,121 views 20732 11096 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 16:37:05,125 views 20732 11096 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 16:37:05,126 views 20732 11096 消息内容: 根据目前掌握的信息（发病部位：叶片），可能的病害有：

1. 小麦黑颖病
   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或...
DEBUG 2025-04-22 16:37:05,130 views 20732 11096 历史记录更新成功，当前长度: 2
INFO 2025-04-22 16:37:05,131 basehttp 20732 11096 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%A5%BD%E5%83%8F%E5%87%BA%E7%8E%B0%E4%BA%86%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%EF%BC%8C%E4%B8%BB%E8%A6%81%E5%8F%91%E7%94%9F%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%EF%BC%8C%E8%AF%B7%E9%97%AE%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E6%98%AF%E6%9C%89%E4%BB%80%E4%B9%88%E7%97%85%E5%AE%B3%E5%90%97&session_id=3 HTTP/1.1" 200 5351
INFO 2025-04-22 16:37:07,646 views 20732 20328 Neo4j服务初始化成功
DEBUG 2025-04-22 16:37:09,700 views 20732 20328 ChatAPI实例初始化完成
INFO 2025-04-22 16:37:09,700 basehttp 20732 20328 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:37:22,770 views 20732 7644 Neo4j服务初始化成功
DEBUG 2025-04-22 16:37:24,836 views 20732 7644 ChatAPI实例初始化完成
DEBUG 2025-04-22 16:37:24,836 views 20732 7644 收到stream_chat请求: {'message': ['我的小麦种在河北'], 'session_id': ['3']}
DEBUG 2025-04-22 16:37:24,836 views 20732 7644 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 16:37:24,836 views 20732 7644 处理消息: 我的小麦种在河北, 会话ID: 3
DEBUG 2025-04-22 16:37:24,840 views 20732 7644 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦种在河北'}]
DEBUG 2025-04-22 16:37:24,840 views 20732 7644 构建的消息列表长度: 2
DEBUG 2025-04-22 16:37:29,245 views 20732 7644 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 16:37:29,245 views 20732 7644 消息内容: 我的小麦种在河北...
DEBUG 2025-04-22 16:37:29,245 views 20732 7644 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 16:37:29,245 views 20732 7644 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 16:37:29,245 views 20732 7644 消息内容: 仅知道小麦种植在河北，关于小麦是否发病以及发病症状等关键信息不足。为了准确诊断小麦可能患有的病害，请您补充一下信息，比如小麦是否出现异常，从哪个部位开始发病，发病时的气象条件，发病处于小麦的哪个生育期...
DEBUG 2025-04-22 16:37:29,249 views 20732 7644 历史记录更新成功，当前长度: 2
INFO 2025-04-22 16:37:29,250 basehttp 20732 7644 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E7%A7%8D%E5%9C%A8%E6%B2%B3%E5%8C%97&session_id=3 HTTP/1.1" 200 852
INFO 2025-04-22 16:37:31,607 views 20732 13900 Neo4j服务初始化成功
DEBUG 2025-04-22 16:37:33,678 views 20732 13900 ChatAPI实例初始化完成
INFO 2025-04-22 16:37:33,678 basehttp 20732 13900 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:40:16,087 autoreload 20732 21136 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 16:40:16,920 autoreload 16932 13448 Watching for file changes with StatReloader
INFO 2025-04-22 16:40:41,432 autoreload 16932 13448 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 16:40:42,253 autoreload 11152 11520 Watching for file changes with StatReloader
INFO 2025-04-22 16:40:47,055 views 11152 13492 Neo4j服务初始化成功
DEBUG 2025-04-22 16:40:49,126 views 11152 13492 ChatAPI实例初始化完成
INFO 2025-04-22 16:40:49,130 basehttp 11152 13492 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 16:40:51,467 views 11152 19888 Neo4j服务初始化成功
DEBUG 2025-04-22 16:40:53,510 views 11152 19888 ChatAPI实例初始化完成
INFO 2025-04-22 16:40:53,510 basehttp 11152 19888 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:40:55,819 views 11152 14576 Neo4j服务初始化成功
DEBUG 2025-04-22 16:40:57,887 views 11152 14576 ChatAPI实例初始化完成
INFO 2025-04-22 16:40:57,891 basehttp 11152 14576 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:41:25,207 views 11152 10156 Neo4j服务初始化成功
DEBUG 2025-04-22 16:41:27,273 views 11152 10156 ChatAPI实例初始化完成
DEBUG 2025-04-22 16:41:27,277 views 11152 10156 收到stream_chat请求: {'message': ['我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗'], 'session_id': ['3']}
DEBUG 2025-04-22 16:41:27,280 views 11152 10156 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 16:41:27,284 views 11152 10156 处理消息: 我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗, 会话ID: 3
DEBUG 2025-04-22 16:41:27,286 views 11152 10156 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗'}]
DEBUG 2025-04-22 16:41:27,288 views 11152 10156 构建的消息列表长度: 2
INFO 2025-04-22 16:41:27,290 views 11152 10156 检查会话状态: 3
INFO 2025-04-22 16:41:27,290 views 11152 10156 当前所有会话: []
INFO 2025-04-22 16:41:27,291 views 11152 10156 从缓存获取症状信息 - 会话ID: 3, 数据: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 16:41:27,292 views 11152 10156 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 16:41:27,292 views 11152 10156 创建新会话: 3
INFO 2025-04-22 16:41:27,293 views 11152 10156 初始化新的症状收集状态
INFO 2025-04-22 16:41:27,294 views 11152 10156 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {}}}
DEBUG 2025-04-22 16:41:27,295 views 11152 10156 当前症状信息: {}
DEBUG 2025-04-22 16:41:27,295 views 11152 10156 开始提取症状，输入消息: 我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗
DEBUG 2025-04-22 16:41:27,296 views 11152 10156 分句结果: ['我的小麦好像出现了一些问题', '主要发生在叶片上', '请问我的小麦是有什么病害吗', '我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗']
DEBUG 2025-04-22 16:41:27,296 views 11152 10156 提取到的发病部位: []
DEBUG 2025-04-22 16:41:27,297 views 11152 10156 提取到的气象条件: []
DEBUG 2025-04-22 16:41:27,297 views 11152 10156 提取到的生育期: []
DEBUG 2025-04-22 16:41:27,297 views 11152 10156 提取到的地区: []
DEBUG 2025-04-22 16:41:27,298 views 11152 10156 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 16:41:27,298 views 11152 10156 提取到的气象条件: []
DEBUG 2025-04-22 16:41:27,298 views 11152 10156 提取到的生育期: []
DEBUG 2025-04-22 16:41:27,298 views 11152 10156 提取到的地区: []
DEBUG 2025-04-22 16:41:27,299 views 11152 10156 提取到的发病部位: []
DEBUG 2025-04-22 16:41:27,299 views 11152 10156 提取到的气象条件: []
DEBUG 2025-04-22 16:41:27,299 views 11152 10156 提取到的生育期: []
DEBUG 2025-04-22 16:41:27,299 views 11152 10156 提取到的地区: []
DEBUG 2025-04-22 16:41:27,300 views 11152 10156 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 16:41:27,300 views 11152 10156 提取到的气象条件: []
DEBUG 2025-04-22 16:41:27,300 views 11152 10156 提取到的生育期: []
DEBUG 2025-04-22 16:41:27,300 views 11152 10156 提取到的地区: []
INFO 2025-04-22 16:41:27,301 views 11152 10156 症状提取结果: {'plant_part': '叶片'}
INFO 2025-04-22 16:41:27,301 views 11152 10156 开始更新症状信息 - 会话ID: 3, 新症状: {'plant_part': '叶片'}
INFO 2025-04-22 16:41:27,301 views 11152 10156 检查会话状态: 3
INFO 2025-04-22 16:41:27,301 views 11152 10156 当前所有会话: ['3']
INFO 2025-04-22 16:41:27,301 views 11152 10156 从缓存获取症状信息 - 会话ID: 3, 数据: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 16:41:27,302 views 11152 10156 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 16:41:27,303 views 11152 10156 使用现有的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 16:41:27,303 views 11152 10156 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {}}}
INFO 2025-04-22 16:41:27,303 views 11152 10156 当前症状信息 - 会话ID: 3, 症状: {}
INFO 2025-04-22 16:41:27,303 views 11152 10156 更新症状类别 - 会话ID: 3, 类别: plant_part, 值: 叶片
INFO 2025-04-22 16:41:27,303 views 11152 10156 保存症状信息到缓存 - 会话ID: 3, 数据: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-22 16:41:27,303 views 11152 10156 症状信息成功保存到缓存 - 会话ID: 3
INFO 2025-04-22 16:41:27,303 views 11152 10156 症状信息更新完成 - 会话ID: 3, 最终症状: {'plant_part': '叶片'}
INFO 2025-04-22 16:41:27,303 views 11152 10156 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-22 16:41:27,303 views 11152 10156 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 发病地区

INFO 2025-04-22 16:41:30,038 services 11152 10156 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-22 16:41:30,038 services 11152 10156 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-22 16:41:30,045 services 11152 10156 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-22 16:41:30,055 services 11152 10156 查询结果: <neo4j._sync.work.result.Result object at 0x00000234BE946300>
DEBUG 2025-04-22 16:41:52,785 views 11152 10156 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 16:41:52,785 views 11152 10156 消息内容: 我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗...
DEBUG 2025-04-22 16:41:52,785 views 11152 10156 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 16:41:52,785 views 11152 10156 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 16:41:52,785 views 11152 10156 消息内容: 根据目前掌握的信息（发病部位：叶片），可能的病害有：

1. 小麦黑颖病
   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或...
DEBUG 2025-04-22 16:41:52,785 views 11152 10156 历史记录更新成功，当前长度: 2
INFO 2025-04-22 16:41:52,785 basehttp 11152 10156 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%A5%BD%E5%83%8F%E5%87%BA%E7%8E%B0%E4%BA%86%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%EF%BC%8C%E4%B8%BB%E8%A6%81%E5%8F%91%E7%94%9F%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%EF%BC%8C%E8%AF%B7%E9%97%AE%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E6%98%AF%E6%9C%89%E4%BB%80%E4%B9%88%E7%97%85%E5%AE%B3%E5%90%97&session_id=3 HTTP/1.1" 200 5351
INFO 2025-04-22 16:41:55,303 views 11152 22156 Neo4j服务初始化成功
DEBUG 2025-04-22 16:41:57,346 views 11152 22156 ChatAPI实例初始化完成
INFO 2025-04-22 16:41:57,350 basehttp 11152 22156 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:42:31,532 views 11152 17084 Neo4j服务初始化成功
DEBUG 2025-04-22 16:42:33,572 views 11152 17084 ChatAPI实例初始化完成
DEBUG 2025-04-22 16:42:33,576 views 11152 17084 收到stream_chat请求: {'message': ['我小麦种植区在河北'], 'session_id': ['3']}
DEBUG 2025-04-22 16:42:33,576 views 11152 17084 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 16:42:33,576 views 11152 17084 处理消息: 我小麦种植区在河北, 会话ID: 3
DEBUG 2025-04-22 16:42:33,576 views 11152 17084 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我小麦种植区在河北'}]
DEBUG 2025-04-22 16:42:33,580 views 11152 17084 构建的消息列表长度: 2
DEBUG 2025-04-22 16:42:37,808 views 11152 17084 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 16:42:37,808 views 11152 17084 消息内容: 我小麦种植区在河北...
DEBUG 2025-04-22 16:42:37,808 views 11152 17084 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 16:42:37,808 views 11152 17084 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 16:42:37,808 views 11152 17084 消息内容: 仅知道种植区在河北，信息还不太够诊断小麦病害呢。麻烦您详细描述下小麦出现的症状，比如小麦哪个部位开始发病，发病时的气象条件如何，处于什么生育期，以及具体有怎样的外观表现，例如叶片是否变色、出现斑点，茎...
DEBUG 2025-04-22 16:42:37,808 views 11152 17084 历史记录更新成功，当前长度: 2
INFO 2025-04-22 16:42:37,811 basehttp 11152 17084 "GET /api/chat/stream_chat/?message=%E6%88%91%E5%B0%8F%E9%BA%A6%E7%A7%8D%E6%A4%8D%E5%8C%BA%E5%9C%A8%E6%B2%B3%E5%8C%97&session_id=3 HTTP/1.1" 200 926
INFO 2025-04-22 16:42:40,162 views 11152 17344 Neo4j服务初始化成功
DEBUG 2025-04-22 16:42:42,230 views 11152 17344 ChatAPI实例初始化完成
INFO 2025-04-22 16:42:42,233 basehttp 11152 17344 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:48:16,437 autoreload 11152 11520 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 16:48:17,436 autoreload 11672 8292 Watching for file changes with StatReloader
INFO 2025-04-22 16:48:45,671 autoreload 11672 8292 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 16:48:46,471 autoreload 18800 9004 Watching for file changes with StatReloader
INFO 2025-04-22 16:49:06,151 autoreload 14124 24460 Watching for file changes with StatReloader
INFO 2025-04-22 16:49:33,079 views 14124 6444 Neo4j服务初始化成功
DEBUG 2025-04-22 16:49:35,133 views 14124 6444 ChatAPI实例初始化完成
INFO 2025-04-22 16:49:35,137 basehttp 14124 6444 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 16:49:37,773 views 14124 24420 Neo4j服务初始化成功
DEBUG 2025-04-22 16:49:39,793 views 14124 24420 ChatAPI实例初始化完成
INFO 2025-04-22 16:49:39,793 basehttp 14124 24420 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:49:42,105 views 14124 15612 Neo4j服务初始化成功
DEBUG 2025-04-22 16:49:44,138 views 14124 15612 ChatAPI实例初始化完成
INFO 2025-04-22 16:49:44,138 basehttp 14124 15612 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:49:49,233 views 14124 7184 Neo4j服务初始化成功
DEBUG 2025-04-22 16:49:51,266 views 14124 7184 ChatAPI实例初始化完成
DEBUG 2025-04-22 16:49:51,270 views 14124 7184 收到stream_chat请求: {'message': ['我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗'], 'session_id': ['3']}
DEBUG 2025-04-22 16:49:51,274 views 14124 7184 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 16:49:51,279 views 14124 7184 处理消息: 我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗, 会话ID: 3
DEBUG 2025-04-22 16:49:51,281 views 14124 7184 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗'}]
DEBUG 2025-04-22 16:49:51,285 views 14124 7184 构建的消息列表长度: 2
INFO 2025-04-22 16:49:51,287 views 14124 7184 检查会话状态: 3
INFO 2025-04-22 16:49:51,288 views 14124 7184 从缓存获取症状信息 - 会话ID: 3, 数据: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 16:49:51,290 views 14124 7184 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 16:49:51,290 views 14124 7184 创建新会话: 3
INFO 2025-04-22 16:49:51,291 views 14124 7184 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {}}}
DEBUG 2025-04-22 16:49:51,292 views 14124 7184 当前症状信息: {}
DEBUG 2025-04-22 16:49:51,292 views 14124 7184 开始提取症状，输入消息: 我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗
DEBUG 2025-04-22 16:49:51,294 views 14124 7184 分句结果: ['我的小麦好像出现了一些问题', '主要发生在叶片上', '请问我的小麦是有什么病害吗', '我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗']
DEBUG 2025-04-22 16:49:51,295 views 14124 7184 提取到的发病部位: []
DEBUG 2025-04-22 16:49:51,296 views 14124 7184 提取到的气象条件: []
DEBUG 2025-04-22 16:49:51,296 views 14124 7184 提取到的生育期: []
DEBUG 2025-04-22 16:49:51,296 views 14124 7184 提取到的地区: []
DEBUG 2025-04-22 16:49:51,297 views 14124 7184 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 16:49:51,297 views 14124 7184 提取到的气象条件: []
DEBUG 2025-04-22 16:49:51,297 views 14124 7184 提取到的生育期: []
DEBUG 2025-04-22 16:49:51,298 views 14124 7184 提取到的地区: []
DEBUG 2025-04-22 16:49:51,298 views 14124 7184 提取到的发病部位: []
DEBUG 2025-04-22 16:49:51,298 views 14124 7184 提取到的气象条件: []
DEBUG 2025-04-22 16:49:51,299 views 14124 7184 提取到的生育期: []
DEBUG 2025-04-22 16:49:51,299 views 14124 7184 提取到的地区: []
DEBUG 2025-04-22 16:49:51,299 views 14124 7184 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 16:49:51,299 views 14124 7184 提取到的气象条件: []
DEBUG 2025-04-22 16:49:51,300 views 14124 7184 提取到的生育期: []
DEBUG 2025-04-22 16:49:51,300 views 14124 7184 提取到的地区: []
INFO 2025-04-22 16:49:51,300 views 14124 7184 症状提取结果: {'plant_part': '叶片'}
INFO 2025-04-22 16:49:51,300 views 14124 7184 开始更新症状信息 - 会话ID: 3, 新症状: {'plant_part': '叶片'}
INFO 2025-04-22 16:49:51,300 views 14124 7184 从缓存获取症状信息 - 会话ID: 3, 数据: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 16:49:51,301 views 14124 7184 当前症状信息 - 会话ID: 3, 症状: {}
INFO 2025-04-22 16:49:51,301 views 14124 7184 更新症状类别 - 会话ID: 3, 类别: plant_part, 值: 叶片
INFO 2025-04-22 16:49:51,301 views 14124 7184 保存症状信息到缓存 - 会话ID: 3, 数据: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-22 16:49:51,301 views 14124 7184 症状信息成功保存到缓存 - 会话ID: 3, 保存的数据: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-22 16:49:51,301 views 14124 7184 症状信息更新完成 - 会话ID: 3, 最终症状: {'plant_part': '叶片'}
INFO 2025-04-22 16:49:51,302 views 14124 7184 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-22 16:49:51,302 views 14124 7184 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 发病地区

INFO 2025-04-22 16:49:54,029 services 14124 7184 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-22 16:49:54,029 services 14124 7184 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-22 16:49:54,029 services 14124 7184 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-22 16:49:54,033 services 14124 7184 查询结果: <neo4j._sync.work.result.Result object at 0x0000026F697B27E0>
DEBUG 2025-04-22 16:50:16,762 views 14124 7184 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 16:50:16,764 views 14124 7184 消息内容: 我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗...
DEBUG 2025-04-22 16:50:16,765 views 14124 7184 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 16:50:16,765 views 14124 7184 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 16:50:16,765 views 14124 7184 消息内容: 根据目前掌握的信息（发病部位：叶片），可能的病害有：

1. 小麦黑颖病
   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或...
DEBUG 2025-04-22 16:50:16,769 views 14124 7184 历史记录更新成功，当前长度: 2
INFO 2025-04-22 16:50:16,772 basehttp 14124 7184 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%A5%BD%E5%83%8F%E5%87%BA%E7%8E%B0%E4%BA%86%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%EF%BC%8C%E4%B8%BB%E8%A6%81%E5%8F%91%E7%94%9F%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%EF%BC%8C%E8%AF%B7%E9%97%AE%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E6%98%AF%E6%9C%89%E4%BB%80%E4%B9%88%E7%97%85%E5%AE%B3%E5%90%97&session_id=3 HTTP/1.1" 200 5351
INFO 2025-04-22 16:50:19,295 views 14124 19048 Neo4j服务初始化成功
DEBUG 2025-04-22 16:50:21,355 views 14124 19048 ChatAPI实例初始化完成
INFO 2025-04-22 16:50:21,359 basehttp 14124 19048 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:50:52,713 views 14124 12796 Neo4j服务初始化成功
DEBUG 2025-04-22 16:50:54,751 views 14124 12796 ChatAPI实例初始化完成
DEBUG 2025-04-22 16:50:54,751 views 14124 12796 收到stream_chat请求: {'message': ['小麦的种植区在河北'], 'session_id': ['3']}
DEBUG 2025-04-22 16:50:54,751 views 14124 12796 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 16:50:54,751 views 14124 12796 处理消息: 小麦的种植区在河北, 会话ID: 3
DEBUG 2025-04-22 16:50:54,751 views 14124 12796 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '小麦的种植区在河北'}]
DEBUG 2025-04-22 16:50:54,751 views 14124 12796 构建的消息列表长度: 2
DEBUG 2025-04-22 16:50:57,787 views 14124 12796 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 16:50:57,787 views 14124 12796 消息内容: 小麦的种植区在河北...
DEBUG 2025-04-22 16:50:57,787 views 14124 12796 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 16:50:57,788 views 14124 12796 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 16:50:57,788 views 14124 12796 消息内容: 仅知道小麦种植区在河北，信息不足，无法准确诊断病害。请补充更多细节，比如小麦从哪个部位开始发病，发病时呈现出什么样的症状，发病时的气象条件，发病处于小麦的哪个生育期等，以便我能准确诊断可能的小麦病害。...
DEBUG 2025-04-22 16:50:57,788 views 14124 12796 历史记录更新成功，当前长度: 2
INFO 2025-04-22 16:50:57,788 basehttp 14124 12796 "GET /api/chat/stream_chat/?message=%E5%B0%8F%E9%BA%A6%E7%9A%84%E7%A7%8D%E6%A4%8D%E5%8C%BA%E5%9C%A8%E6%B2%B3%E5%8C%97&session_id=3 HTTP/1.1" 200 854
INFO 2025-04-22 16:51:00,217 views 14124 5248 Neo4j服务初始化成功
DEBUG 2025-04-22 16:51:02,263 views 14124 5248 ChatAPI实例初始化完成
INFO 2025-04-22 16:51:02,263 basehttp 14124 5248 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:51:39,611 views 14124 19988 Neo4j服务初始化成功
DEBUG 2025-04-22 16:51:41,651 views 14124 19988 ChatAPI实例初始化完成
INFO 2025-04-22 16:51:41,651 basehttp 14124 19988 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 16:51:42,921 views 14124 17768 Neo4j服务初始化成功
INFO 2025-04-22 16:51:43,985 views 14124 13292 Neo4j服务初始化成功
DEBUG 2025-04-22 16:51:44,957 views 14124 17768 ChatAPI实例初始化完成
INFO 2025-04-22 16:51:44,957 basehttp 14124 17768 "POST /api/chat/create_session/ HTTP/1.1" 200 40
DEBUG 2025-04-22 16:51:46,043 views 14124 13292 ChatAPI实例初始化完成
INFO 2025-04-22 16:51:46,047 basehttp 14124 13292 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:51:48,399 views 14124 24128 Neo4j服务初始化成功
DEBUG 2025-04-22 16:51:50,470 views 14124 24128 ChatAPI实例初始化完成
INFO 2025-04-22 16:51:50,474 basehttp 14124 24128 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:51:52,772 views 14124 1436 Neo4j服务初始化成功
DEBUG 2025-04-22 16:51:54,799 views 14124 1436 ChatAPI实例初始化完成
INFO 2025-04-22 16:51:54,803 basehttp 14124 1436 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:51:57,132 views 14124 19560 Neo4j服务初始化成功
DEBUG 2025-04-22 16:51:59,192 views 14124 19560 ChatAPI实例初始化完成
INFO 2025-04-22 16:51:59,193 basehttp 14124 19560 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:52:48,239 views 14124 14808 Neo4j服务初始化成功
DEBUG 2025-04-22 16:52:50,297 views 14124 14808 ChatAPI实例初始化完成
DEBUG 2025-04-22 16:52:50,300 views 14124 14808 收到stream_chat请求: {'message': ['我的小麦好像出现了一些问题，主要发生在叶片上，且小麦的种植区是在河北，请问我的小麦是有什么病害吗'], 'session_id': ['3']}
DEBUG 2025-04-22 16:52:50,300 views 14124 14808 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 16:52:50,303 views 14124 14808 处理消息: 我的小麦好像出现了一些问题，主要发生在叶片上，且小麦的种植区是在河北，请问我的小麦是有什么病害吗, 会话ID: 3
DEBUG 2025-04-22 16:52:50,303 views 14124 14808 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的地区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦好像出现了一些问题，主要发生在叶片上，且小麦的种植区是在河北，请问我的小麦是有什么病害吗'}]
DEBUG 2025-04-22 16:52:50,303 views 14124 14808 构建的消息列表长度: 2
INFO 2025-04-22 16:52:50,303 views 14124 14808 检查会话状态: 3
INFO 2025-04-22 16:52:50,303 views 14124 14808 从缓存获取症状信息 - 会话ID: 3, 数据: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-22 16:52:50,303 views 14124 14808 从缓存获取的症状信息: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-22 16:52:50,303 views 14124 14808 创建新会话: 3
INFO 2025-04-22 16:52:50,306 views 14124 14808 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {'plant_part': '叶片'}}}
DEBUG 2025-04-22 16:52:50,306 views 14124 14808 当前症状信息: {'plant_part': '叶片'}
DEBUG 2025-04-22 16:52:50,306 views 14124 14808 开始提取症状，输入消息: 我的小麦好像出现了一些问题，主要发生在叶片上，且小麦的种植区是在河北，请问我的小麦是有什么病害吗
DEBUG 2025-04-22 16:52:50,306 views 14124 14808 分句结果: ['我的小麦好像出现了一些问题', '主要发生在叶片上', '且小麦的种植区是在河北', '请问我的小麦是有什么病害吗', '我的小麦好像出现了一些问题，主要发生在叶片上，且小麦的种植区是在河北，请问我的小麦是有什么病害吗']
DEBUG 2025-04-22 16:52:50,307 views 14124 14808 提取到的发病部位: []
DEBUG 2025-04-22 16:52:50,307 views 14124 14808 提取到的气象条件: []
DEBUG 2025-04-22 16:52:50,307 views 14124 14808 提取到的生育期: []
DEBUG 2025-04-22 16:52:50,307 views 14124 14808 提取到的地区: []
DEBUG 2025-04-22 16:52:50,308 views 14124 14808 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 16:52:50,308 views 14124 14808 提取到的气象条件: []
DEBUG 2025-04-22 16:52:50,308 views 14124 14808 提取到的生育期: []
DEBUG 2025-04-22 16:52:50,308 views 14124 14808 提取到的地区: []
DEBUG 2025-04-22 16:52:50,308 views 14124 14808 提取到的发病部位: []
DEBUG 2025-04-22 16:52:50,308 views 14124 14808 提取到的气象条件: []
DEBUG 2025-04-22 16:52:50,308 views 14124 14808 提取到的生育期: []
DEBUG 2025-04-22 16:52:50,309 views 14124 14808 提取到的地区: ['河北']
DEBUG 2025-04-22 16:52:50,309 views 14124 14808 提取到的发病部位: []
DEBUG 2025-04-22 16:52:50,309 views 14124 14808 提取到的气象条件: []
DEBUG 2025-04-22 16:52:50,310 views 14124 14808 提取到的生育期: []
DEBUG 2025-04-22 16:52:50,310 views 14124 14808 提取到的地区: []
DEBUG 2025-04-22 16:52:50,310 views 14124 14808 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 16:52:50,310 views 14124 14808 提取到的气象条件: []
DEBUG 2025-04-22 16:52:50,311 views 14124 14808 提取到的生育期: []
DEBUG 2025-04-22 16:52:50,311 views 14124 14808 提取到的地区: ['河北']
INFO 2025-04-22 16:52:50,311 views 14124 14808 症状提取结果: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-22 16:52:50,311 views 14124 14808 开始更新症状信息 - 会话ID: 3, 新症状: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-22 16:52:50,311 views 14124 14808 从缓存获取症状信息 - 会话ID: 3, 数据: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-22 16:52:50,312 views 14124 14808 当前症状信息 - 会话ID: 3, 症状: {'plant_part': '叶片'}
INFO 2025-04-22 16:52:50,312 views 14124 14808 更新症状类别 - 会话ID: 3, 类别: plant_part, 值: 叶片
INFO 2025-04-22 16:52:50,312 views 14124 14808 更新症状类别 - 会话ID: 3, 类别: region, 值: 河北
INFO 2025-04-22 16:52:50,312 views 14124 14808 保存症状信息到缓存 - 会话ID: 3, 数据: {'collecting': True, 'symptoms': {'plant_part': '叶片', 'region': '河北'}}
INFO 2025-04-22 16:52:50,313 views 14124 14808 症状信息成功保存到缓存 - 会话ID: 3, 保存的数据: {'collecting': True, 'symptoms': {'plant_part': '叶片', 'region': '河北'}}
INFO 2025-04-22 16:52:50,313 views 14124 14808 症状信息更新完成 - 会话ID: 3, 最终症状: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-22 16:52:50,313 views 14124 14808 更新后的症状信息: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-22 16:52:50,313 views 14124 14808 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片
- 发病地区：河北

还需要补充的信息：
- 气象条件
- 生育期

INFO 2025-04-22 16:52:53,187 services 14124 14808 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-22 16:52:53,187 services 14124 14808 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) MATCH (d)-[:OCCURS_IN_REGION]->(r:Region {name: $region}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-22 16:52:53,191 services 14124 14808 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-22 16:52:53,201 services 14124 14808 查询结果: <neo4j._sync.work.result.Result object at 0x0000026F698D7020>
DEBUG 2025-04-22 16:53:07,213 views 14124 14808 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 16:53:07,213 views 14124 14808 消息内容: 我的小麦好像出现了一些问题，主要发生在叶片上，且小麦的种植区是在河北，请问我的小麦是有什么病害吗...
DEBUG 2025-04-22 16:53:07,213 views 14124 14808 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 16:53:07,213 views 14124 14808 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 16:53:07,213 views 14124 14808 消息内容: 根据您提供的信息（发病部位：叶片，地区：河北），诊断结果为小麦叶锈病。

病害特征：
夏孢子堆圆形至长椭圆形，桔红色，散生，成熟后表皮开裂散出夏孢子；冬孢子堆主要在叶片背面和叶鞘上，圆形或长椭圆形，黑...
DEBUG 2025-04-22 16:53:07,213 views 14124 14808 历史记录更新成功，当前长度: 2
INFO 2025-04-22 16:53:07,213 basehttp 14124 14808 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%A5%BD%E5%83%8F%E5%87%BA%E7%8E%B0%E4%BA%86%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%EF%BC%8C%E4%B8%BB%E8%A6%81%E5%8F%91%E7%94%9F%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%EF%BC%8C%E4%B8%94%E5%B0%8F%E9%BA%A6%E7%9A%84%E7%A7%8D%E6%A4%8D%E5%8C%BA%E6%98%AF%E5%9C%A8%E6%B2%B3%E5%8C%97%EF%BC%8C%E8%AF%B7%E9%97%AE%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E6%98%AF%E6%9C%89%E4%BB%80%E4%B9%88%E7%97%85%E5%AE%B3%E5%90%97&session_id=3 HTTP/1.1" 200 3538
INFO 2025-04-22 16:53:09,693 views 14124 20836 Neo4j服务初始化成功
DEBUG 2025-04-22 16:53:11,751 views 14124 20836 ChatAPI实例初始化完成
INFO 2025-04-22 16:53:11,752 basehttp 14124 20836 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 16:59:32,402 autoreload 14124 24460 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 16:59:33,289 autoreload 12316 7868 Watching for file changes with StatReloader
INFO 2025-04-22 16:59:39,863 autoreload 12316 7868 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 16:59:40,825 autoreload 4260 15936 Watching for file changes with StatReloader
INFO 2025-04-22 17:00:02,235 autoreload 4260 15936 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 17:00:03,059 autoreload 18348 9796 Watching for file changes with StatReloader
INFO 2025-04-22 17:00:13,742 autoreload 18348 9796 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 17:00:14,571 autoreload 10796 16068 Watching for file changes with StatReloader
INFO 2025-04-22 17:00:25,120 autoreload 10796 16068 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 17:00:25,964 autoreload 23980 16468 Watching for file changes with StatReloader
INFO 2025-04-22 17:00:30,120 autoreload 23980 16468 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 17:00:30,968 autoreload 22880 17688 Watching for file changes with StatReloader
INFO 2025-04-22 17:00:36,146 autoreload 22880 17688 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 17:00:37,029 autoreload 10264 15680 Watching for file changes with StatReloader
INFO 2025-04-22 17:00:43,359 autoreload 10264 15680 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 17:00:44,195 autoreload 8616 14580 Watching for file changes with StatReloader
INFO 2025-04-22 17:00:51,490 autoreload 8616 14580 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 17:00:52,299 autoreload 11172 12872 Watching for file changes with StatReloader
INFO 2025-04-22 17:00:59,562 autoreload 11172 12872 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 17:01:00,540 autoreload 22984 21500 Watching for file changes with StatReloader
INFO 2025-04-22 17:01:08,955 autoreload 22984 21500 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-22 17:01:09,849 autoreload 6904 24108 Watching for file changes with StatReloader
INFO 2025-04-22 17:01:30,049 basehttp 6904 21408 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
INFO 2025-04-22 17:01:30,399 basehttp 6904 15108 "OPTIONS /api/knowledge/graph/ HTTP/1.1" 200 0
INFO 2025-04-22 17:01:34,559 basehttp 6904 15108 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
INFO 2025-04-22 17:01:39,344 basehttp 6904 15108 "OPTIONS /api/knowledge/get_node_subgraph/?node=%E6%B2%B3%E5%8C%97&type=region HTTP/1.1" 200 0
INFO 2025-04-22 17:01:43,444 basehttp 6904 15108 "GET /api/knowledge/get_node_subgraph/?node=%E6%B2%B3%E5%8C%97&type=region HTTP/1.1" 200 1845
INFO 2025-04-22 17:04:01,111 views 6904 4988 Neo4j服务初始化成功
DEBUG 2025-04-22 17:04:03,154 views 6904 4988 ChatAPI实例初始化完成
INFO 2025-04-22 17:04:03,155 basehttp 6904 4988 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 17:04:05,478 views 6904 20084 Neo4j服务初始化成功
DEBUG 2025-04-22 17:04:07,525 views 6904 20084 ChatAPI实例初始化完成
INFO 2025-04-22 17:04:07,526 basehttp 6904 20084 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 17:04:09,887 views 6904 14352 Neo4j服务初始化成功
DEBUG 2025-04-22 17:04:11,931 views 6904 14352 ChatAPI实例初始化完成
INFO 2025-04-22 17:04:11,932 basehttp 6904 14352 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 17:06:57,590 views 6904 7520 Neo4j服务初始化成功
DEBUG 2025-04-22 17:06:59,643 views 6904 7520 ChatAPI实例初始化完成
INFO 2025-04-22 17:06:59,644 basehttp 6904 7520 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 17:29:55,782 views 6904 11532 Neo4j服务初始化成功
DEBUG 2025-04-22 17:29:57,841 views 6904 11532 ChatAPI实例初始化完成
INFO 2025-04-22 17:29:57,842 basehttp 6904 11532 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 17:30:00,182 views 6904 4508 Neo4j服务初始化成功
DEBUG 2025-04-22 17:30:02,214 views 6904 4508 ChatAPI实例初始化完成
INFO 2025-04-22 17:30:02,215 basehttp 6904 4508 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 17:30:04,533 views 6904 9472 Neo4j服务初始化成功
DEBUG 2025-04-22 17:30:06,575 views 6904 9472 ChatAPI实例初始化完成
INFO 2025-04-22 17:30:06,576 basehttp 6904 9472 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 17:30:07,429 views 6904 18260 Neo4j服务初始化成功
DEBUG 2025-04-22 17:30:09,481 views 6904 18260 ChatAPI实例初始化完成
DEBUG 2025-04-22 17:30:09,481 views 6904 18260 收到stream_chat请求: {'message': ['我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗'], 'session_id': ['3']}
DEBUG 2025-04-22 17:30:09,481 views 6904 18260 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 17:30:09,485 views 6904 18260 处理消息: 我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗, 会话ID: 3
DEBUG 2025-04-22 17:30:09,485 views 6904 18260 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗'}]
DEBUG 2025-04-22 17:30:09,485 views 6904 18260 构建的消息列表长度: 2
INFO 2025-04-22 17:30:09,485 views 6904 18260 检查会话状态: 3
INFO 2025-04-22 17:30:09,485 views 6904 18260 从缓存获取症状信息 - 会话ID: 3, 数据: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 17:30:09,485 views 6904 18260 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 17:30:09,485 views 6904 18260 创建新会话: 3
INFO 2025-04-22 17:30:09,489 views 6904 18260 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {}}}
DEBUG 2025-04-22 17:30:09,489 views 6904 18260 当前症状信息: {}
DEBUG 2025-04-22 17:30:09,490 views 6904 18260 开始提取症状，输入消息: 我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗
DEBUG 2025-04-22 17:30:09,490 views 6904 18260 分句结果: ['我的小麦好像出现了一些问题', '主要发生在叶片上', '请问我的小麦是有什么病害吗', '我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗']
DEBUG 2025-04-22 17:30:09,490 views 6904 18260 提取到的发病部位: []
DEBUG 2025-04-22 17:30:09,490 views 6904 18260 提取到的气象条件: []
DEBUG 2025-04-22 17:30:09,491 views 6904 18260 提取到的生育期: []
DEBUG 2025-04-22 17:30:09,491 views 6904 18260 提取到的种植区: []
DEBUG 2025-04-22 17:30:09,491 views 6904 18260 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 17:30:09,492 views 6904 18260 提取到的气象条件: []
DEBUG 2025-04-22 17:30:09,492 views 6904 18260 提取到的生育期: []
DEBUG 2025-04-22 17:30:09,492 views 6904 18260 提取到的种植区: []
DEBUG 2025-04-22 17:30:09,492 views 6904 18260 提取到的发病部位: []
DEBUG 2025-04-22 17:30:09,492 views 6904 18260 提取到的气象条件: []
DEBUG 2025-04-22 17:30:09,493 views 6904 18260 提取到的生育期: []
DEBUG 2025-04-22 17:30:09,493 views 6904 18260 提取到的种植区: []
DEBUG 2025-04-22 17:30:09,493 views 6904 18260 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 17:30:09,493 views 6904 18260 提取到的气象条件: []
DEBUG 2025-04-22 17:30:09,493 views 6904 18260 提取到的生育期: []
DEBUG 2025-04-22 17:30:09,493 views 6904 18260 提取到的种植区: []
INFO 2025-04-22 17:30:09,494 views 6904 18260 症状提取结果: {'plant_part': '叶片'}
INFO 2025-04-22 17:30:09,494 views 6904 18260 开始更新症状信息 - 会话ID: 3, 新症状: {'plant_part': '叶片'}
INFO 2025-04-22 17:30:09,494 views 6904 18260 从缓存获取症状信息 - 会话ID: 3, 数据: {'collecting': True, 'symptoms': {}}
INFO 2025-04-22 17:30:09,494 views 6904 18260 当前症状信息 - 会话ID: 3, 症状: {}
INFO 2025-04-22 17:30:09,495 views 6904 18260 更新症状类别 - 会话ID: 3, 类别: plant_part, 值: 叶片
INFO 2025-04-22 17:30:09,495 views 6904 18260 保存症状信息到缓存 - 会话ID: 3, 数据: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-22 17:30:09,495 views 6904 18260 症状信息成功保存到缓存 - 会话ID: 3, 保存的数据: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-22 17:30:09,495 views 6904 18260 症状信息更新完成 - 会话ID: 3, 最终症状: {'plant_part': '叶片'}
INFO 2025-04-22 17:30:09,495 views 6904 18260 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-22 17:30:09,496 views 6904 18260 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 种植区

INFO 2025-04-22 17:30:12,168 services 6904 18260 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-22 17:30:12,168 services 6904 18260 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-22 17:30:12,168 services 6904 18260 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-22 17:30:12,168 services 6904 18260 查询结果: <neo4j._sync.work.result.Result object at 0x0000022F65C3CE30>
INFO 2025-04-22 17:30:16,769 views 6904 7228 Neo4j服务初始化成功
DEBUG 2025-04-22 17:30:18,819 views 6904 7228 ChatAPI实例初始化完成
INFO 2025-04-22 17:30:18,820 basehttp 6904 7228 "POST /api/chat/create_session/ HTTP/1.1" 200 40
INFO 2025-04-22 17:30:21,140 views 6904 9024 Neo4j服务初始化成功
DEBUG 2025-04-22 17:30:23,189 views 6904 9024 ChatAPI实例初始化完成
INFO 2025-04-22 17:30:23,193 basehttp 6904 9024 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 17:30:25,530 views 6904 10020 Neo4j服务初始化成功
DEBUG 2025-04-22 17:30:27,571 views 6904 10020 ChatAPI实例初始化完成
INFO 2025-04-22 17:30:27,571 basehttp 6904 10020 "GET /api/chat/get_history/ HTTP/1.1" 200 37
DEBUG 2025-04-22 17:30:34,880 views 6904 18260 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 17:30:34,880 views 6904 18260 消息内容: 我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗...
DEBUG 2025-04-22 17:30:34,880 views 6904 18260 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 17:30:34,880 views 6904 18260 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 17:30:34,884 views 6904 18260 消息内容: 根据目前掌握的信息（发病部位：叶片），可能的病害有：

1. 小麦黑颖病
   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或...
DEBUG 2025-04-22 17:30:34,884 views 6904 18260 历史记录更新成功，当前长度: 2
INFO 2025-04-22 17:30:34,888 basehttp 6904 18260 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%A5%BD%E5%83%8F%E5%87%BA%E7%8E%B0%E4%BA%86%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%EF%BC%8C%E4%B8%BB%E8%A6%81%E5%8F%91%E7%94%9F%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%EF%BC%8C%E8%AF%B7%E9%97%AE%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E6%98%AF%E6%9C%89%E4%BB%80%E4%B9%88%E7%97%85%E5%AE%B3%E5%90%97&session_id=3 HTTP/1.1" 200 5340
INFO 2025-04-22 17:30:38,143 views 6904 22324 Neo4j服务初始化成功
DEBUG 2025-04-22 17:30:40,179 views 6904 22324 ChatAPI实例初始化完成
DEBUG 2025-04-22 17:30:40,179 views 6904 22324 收到stream_chat请求: {'message': ['我的小麦好像出现了一些问题，主要发生在叶片上，且小麦的种植区是在河北，请问我的小麦是有什么病害吗'], 'session_id': ['3']}
DEBUG 2025-04-22 17:30:40,179 views 6904 22324 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 17:30:40,183 views 6904 22324 处理消息: 我的小麦好像出现了一些问题，主要发生在叶片上，且小麦的种植区是在河北，请问我的小麦是有什么病害吗, 会话ID: 3
DEBUG 2025-04-22 17:30:40,183 views 6904 22324 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦好像出现了一些问题，主要发生在叶片上，且小麦的种植区是在河北，请问我的小麦是有什么病害吗'}]
DEBUG 2025-04-22 17:30:40,183 views 6904 22324 构建的消息列表长度: 2
INFO 2025-04-22 17:30:40,183 views 6904 22324 检查会话状态: 3
INFO 2025-04-22 17:30:40,183 views 6904 22324 从缓存获取症状信息 - 会话ID: 3, 数据: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-22 17:30:40,183 views 6904 22324 从缓存获取的症状信息: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-22 17:30:40,186 views 6904 22324 创建新会话: 3
INFO 2025-04-22 17:30:40,186 views 6904 22324 当前症状收集状态: {'3': {'collecting': True, 'symptoms': {'plant_part': '叶片'}}}
DEBUG 2025-04-22 17:30:40,186 views 6904 22324 当前症状信息: {'plant_part': '叶片'}
DEBUG 2025-04-22 17:30:40,186 views 6904 22324 开始提取症状，输入消息: 我的小麦好像出现了一些问题，主要发生在叶片上，且小麦的种植区是在河北，请问我的小麦是有什么病害吗
DEBUG 2025-04-22 17:30:40,186 views 6904 22324 分句结果: ['我的小麦好像出现了一些问题', '主要发生在叶片上', '且小麦的种植区是在河北', '请问我的小麦是有什么病害吗', '我的小麦好像出现了一些问题，主要发生在叶片上，且小麦的种植区是在河北，请问我的小麦是有什么病害吗']
DEBUG 2025-04-22 17:30:40,187 views 6904 22324 提取到的发病部位: []
DEBUG 2025-04-22 17:30:40,187 views 6904 22324 提取到的气象条件: []
DEBUG 2025-04-22 17:30:40,187 views 6904 22324 提取到的生育期: []
DEBUG 2025-04-22 17:30:40,188 views 6904 22324 提取到的种植区: []
DEBUG 2025-04-22 17:30:40,188 views 6904 22324 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 17:30:40,188 views 6904 22324 提取到的气象条件: []
DEBUG 2025-04-22 17:30:40,189 views 6904 22324 提取到的生育期: []
DEBUG 2025-04-22 17:30:40,189 views 6904 22324 提取到的种植区: []
DEBUG 2025-04-22 17:30:40,189 views 6904 22324 提取到的发病部位: []
DEBUG 2025-04-22 17:30:40,189 views 6904 22324 提取到的气象条件: []
DEBUG 2025-04-22 17:30:40,189 views 6904 22324 提取到的生育期: []
DEBUG 2025-04-22 17:30:40,189 views 6904 22324 提取到的种植区: ['河北']
DEBUG 2025-04-22 17:30:40,190 views 6904 22324 提取到的发病部位: []
DEBUG 2025-04-22 17:30:40,190 views 6904 22324 提取到的气象条件: []
DEBUG 2025-04-22 17:30:40,190 views 6904 22324 提取到的生育期: []
DEBUG 2025-04-22 17:30:40,190 views 6904 22324 提取到的种植区: []
DEBUG 2025-04-22 17:30:40,190 views 6904 22324 提取到的发病部位: ['叶片']
DEBUG 2025-04-22 17:30:40,191 views 6904 22324 提取到的气象条件: []
DEBUG 2025-04-22 17:30:40,191 views 6904 22324 提取到的生育期: []
DEBUG 2025-04-22 17:30:40,191 views 6904 22324 提取到的种植区: ['河北']
INFO 2025-04-22 17:30:40,191 views 6904 22324 症状提取结果: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-22 17:30:40,191 views 6904 22324 开始更新症状信息 - 会话ID: 3, 新症状: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-22 17:30:40,192 views 6904 22324 从缓存获取症状信息 - 会话ID: 3, 数据: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-22 17:30:40,192 views 6904 22324 当前症状信息 - 会话ID: 3, 症状: {'plant_part': '叶片'}
INFO 2025-04-22 17:30:40,192 views 6904 22324 更新症状类别 - 会话ID: 3, 类别: plant_part, 值: 叶片
INFO 2025-04-22 17:30:40,192 views 6904 22324 更新症状类别 - 会话ID: 3, 类别: region, 值: 河北
INFO 2025-04-22 17:30:40,192 views 6904 22324 保存症状信息到缓存 - 会话ID: 3, 数据: {'collecting': True, 'symptoms': {'plant_part': '叶片', 'region': '河北'}}
INFO 2025-04-22 17:30:40,193 views 6904 22324 症状信息成功保存到缓存 - 会话ID: 3, 保存的数据: {'collecting': True, 'symptoms': {'plant_part': '叶片', 'region': '河北'}}
INFO 2025-04-22 17:30:40,193 views 6904 22324 症状信息更新完成 - 会话ID: 3, 最终症状: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-22 17:30:40,193 views 6904 22324 更新后的症状信息: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-22 17:30:40,194 views 6904 22324 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片
- 种植区：河北

还需要补充的信息：
- 气象条件
- 生育期

INFO 2025-04-22 17:30:43,019 services 6904 22324 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-22 17:30:43,019 services 6904 22324 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) MATCH (d)-[:OCCURS_IN_REGION]->(r:Region {name: $region}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-22 17:30:43,023 services 6904 22324 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-22 17:30:43,028 services 6904 22324 查询结果: <neo4j._sync.work.result.Result object at 0x0000022F65E46DB0>
DEBUG 2025-04-22 17:30:57,097 views 6904 22324 添加历史记录 - 会话ID: 3, 角色: user
DEBUG 2025-04-22 17:30:57,097 views 6904 22324 消息内容: 我的小麦好像出现了一些问题，主要发生在叶片上，且小麦的种植区是在河北，请问我的小麦是有什么病害吗...
DEBUG 2025-04-22 17:30:57,097 views 6904 22324 历史记录更新成功，当前长度: 1
DEBUG 2025-04-22 17:30:57,097 views 6904 22324 添加历史记录 - 会话ID: 3, 角色: assistant
DEBUG 2025-04-22 17:30:57,097 views 6904 22324 消息内容: 根据您提供的信息（发病部位：叶片，种植区：河北），诊断结果为小麦叶锈病。

病害特征：
夏孢子堆圆形至长椭圆形，桔红色，散生，成熟后表皮开裂散出夏孢子；冬孢子堆主要在叶片背面和叶鞘上，圆形或长椭圆形，...
DEBUG 2025-04-22 17:30:57,097 views 6904 22324 历史记录更新成功，当前长度: 2
INFO 2025-04-22 17:30:57,097 basehttp 6904 22324 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%A5%BD%E5%83%8F%E5%87%BA%E7%8E%B0%E4%BA%86%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%EF%BC%8C%E4%B8%BB%E8%A6%81%E5%8F%91%E7%94%9F%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%EF%BC%8C%E4%B8%94%E5%B0%8F%E9%BA%A6%E7%9A%84%E7%A7%8D%E6%A4%8D%E5%8C%BA%E6%98%AF%E5%9C%A8%E6%B2%B3%E5%8C%97%EF%BC%8C%E8%AF%B7%E9%97%AE%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E6%98%AF%E6%9C%89%E4%BB%80%E4%B9%88%E7%97%85%E5%AE%B3%E5%90%97&session_id=3 HTTP/1.1" 200 3538
INFO 2025-04-22 17:30:59,852 views 6904 10396 Neo4j服务初始化成功
DEBUG 2025-04-22 17:31:01,914 views 6904 10396 ChatAPI实例初始化完成
INFO 2025-04-22 17:31:01,918 basehttp 6904 10396 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-22 20:13:26,783 autoreload 18532 7924 Watching for file changes with StatReloader
INFO 2025-04-22 20:18:58,905 views 18532 20416 Neo4j服务初始化成功
INFO 2025-04-22 20:18:58,905 views 18532 2480 Neo4j服务初始化成功
DEBUG 2025-04-22 20:19:01,085 views 18532 2480 ChatAPI实例初始化完成
DEBUG 2025-04-22 20:19:01,085 views 18532 20416 ChatAPI实例初始化完成
ERROR 2025-04-22 20:19:01,089 views 18532 2480 创建会话失败: Module "redis.connection" does not define a "HiredisParser" attribute/class
ERROR 2025-04-22 20:19:01,089 views 18532 20416 创建会话失败: Module "redis.connection" does not define a "HiredisParser" attribute/class
ERROR 2025-04-22 20:19:01,094 log 18532 2480 Internal Server Error: /api/chat/create_session/
ERROR 2025-04-22 20:19:01,094 log 18532 20416 Internal Server Error: /api/chat/create_session/
ERROR 2025-04-22 20:19:01,095 basehttp 18532 2480 "POST /api/chat/create_session/ HTTP/1.1" 500 113
ERROR 2025-04-22 20:19:01,095 basehttp 18532 20416 "POST /api/chat/create_session/ HTTP/1.1" 500 113
INFO 2025-04-22 20:19:03,444 views 18532 19524 Neo4j服务初始化成功
DEBUG 2025-04-22 20:19:05,501 views 18532 19524 ChatAPI实例初始化完成
ERROR 2025-04-22 20:19:05,505 views 18532 19524 获取历史记录失败: Module "redis.connection" does not define a "HiredisParser" attribute/class
ERROR 2025-04-22 20:19:05,505 log 18532 19524 Internal Server Error: /api/chat/get_history/
ERROR 2025-04-22 20:19:05,505 basehttp 18532 19524 "GET /api/chat/get_history/ HTTP/1.1" 500 113
INFO 2025-04-22 20:19:40,163 views 18532 19468 Neo4j服务初始化成功
DEBUG 2025-04-22 20:19:42,195 views 18532 19468 ChatAPI实例初始化完成
ERROR 2025-04-22 20:19:42,199 views 18532 19468 创建会话失败: Module "redis.connection" does not define a "HiredisParser" attribute/class
ERROR 2025-04-22 20:19:42,199 log 18532 19468 Internal Server Error: /api/chat/create_session/
ERROR 2025-04-22 20:19:42,201 basehttp 18532 19468 "POST /api/chat/create_session/ HTTP/1.1" 500 113
INFO 2025-04-22 20:19:44,547 views 18532 2340 Neo4j服务初始化成功
DEBUG 2025-04-22 20:19:46,590 views 18532 2340 ChatAPI实例初始化完成
ERROR 2025-04-22 20:19:46,590 views 18532 2340 获取历史记录失败: Module "redis.connection" does not define a "HiredisParser" attribute/class
ERROR 2025-04-22 20:19:46,590 log 18532 2340 Internal Server Error: /api/chat/get_history/
ERROR 2025-04-22 20:19:46,590 basehttp 18532 2340 "GET /api/chat/get_history/ HTTP/1.1" 500 113
INFO 2025-04-22 20:19:54,279 views 18532 16732 Neo4j服务初始化成功
INFO 2025-04-22 20:19:56,229 views 18532 5756 Neo4j服务初始化成功
DEBUG 2025-04-22 20:19:56,320 views 18532 16732 ChatAPI实例初始化完成
ERROR 2025-04-22 20:19:56,320 views 18532 16732 创建会话失败: Module "redis.connection" does not define a "HiredisParser" attribute/class
ERROR 2025-04-22 20:19:56,320 log 18532 16732 Internal Server Error: /api/chat/create_session/
ERROR 2025-04-22 20:19:56,320 basehttp 18532 16732 "POST /api/chat/create_session/ HTTP/1.1" 500 113
DEBUG 2025-04-22 20:19:58,271 views 18532 5756 ChatAPI实例初始化完成
ERROR 2025-04-22 20:19:58,272 views 18532 5756 创建会话失败: Module "redis.connection" does not define a "HiredisParser" attribute/class
ERROR 2025-04-22 20:19:58,272 log 18532 5756 Internal Server Error: /api/chat/create_session/
ERROR 2025-04-22 20:19:58,273 basehttp 18532 5756 "POST /api/chat/create_session/ HTTP/1.1" 500 113
INFO 2025-04-22 20:19:58,689 views 18532 3652 Neo4j服务初始化成功
INFO 2025-04-22 20:20:00,632 views 18532 5408 Neo4j服务初始化成功
DEBUG 2025-04-22 20:20:00,742 views 18532 3652 ChatAPI实例初始化完成
DEBUG 2025-04-22 20:20:00,743 views 18532 3652 收到stream_chat请求: {'message': ['我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗'], 'session_id': ['default']}
DEBUG 2025-04-22 20:20:00,743 views 18532 3652 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 20:20:00,744 views 18532 3652 处理消息: 我的小麦好像出现了一些问题，主要发生在叶片上，请问我的小麦是有什么病害吗, 会话ID: default
ERROR 2025-04-22 20:20:00,744 views 18532 3652 stream_chat处理异常: Module "redis.connection" does not define a "HiredisParser" attribute/class
Traceback (most recent call last):
  File "D:\Python\Python312\Lib\site-packages\django\utils\module_loading.py", line 30, in import_string
    return cached_import(module_path, class_name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\django\utils\module_loading.py", line 16, in cached_import
    return getattr(module, class_name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: module 'redis.connection' has no attribute 'HiredisParser'. Did you mean: '_HiredisParser'?

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "D:\GraduationProject\wheatdisease\chat\views.py", line 123, in stream_chat
    history = self.get_conversation_history(session_id)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\GraduationProject\wheatdisease\chat\views.py", line 662, in get_conversation_history
    session = self._get_or_create_session(session_id)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\GraduationProject\wheatdisease\chat\views.py", line 680, in _get_or_create_session
    session = cache.get(session_key)
              ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\django_redis\cache.py", line 92, in get
    value = self._get(key, default, version, client)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\django_redis\cache.py", line 29, in _decorator
    return method(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\django_redis\cache.py", line 99, in _get
    return self.client.get(key, default=default, version=version, client=client)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\django_redis\client\default.py", line 253, in get
    client = self.get_client(write=False)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\django_redis\client\default.py", line 105, in get_client
    self._clients[index] = self.connect(index)
                           ^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\django_redis\client\default.py", line 118, in connect
    return self.connection_factory.connect(self._server[index])
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\django_redis\pool.py", line 70, in connect
    params = self.make_connection_params(url)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\django_redis\pool.py", line 42, in make_connection_params
    "parser_class": self.get_parser_cls(),
                    ^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\django_redis\pool.py", line 99, in get_parser_cls
    return import_string(cls)
           ^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\django\utils\module_loading.py", line 32, in import_string
    raise ImportError(
ImportError: Module "redis.connection" does not define a "HiredisParser" attribute/class
INFO 2025-04-22 20:20:00,773 basehttp 18532 3652 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%A5%BD%E5%83%8F%E5%87%BA%E7%8E%B0%E4%BA%86%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%EF%BC%8C%E4%B8%BB%E8%A6%81%E5%8F%91%E7%94%9F%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%EF%BC%8C%E8%AF%B7%E9%97%AE%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E6%98%AF%E6%9C%89%E4%BB%80%E4%B9%88%E7%97%85%E5%AE%B3%E5%90%97&session_id=default HTTP/1.1" 200 90
DEBUG 2025-04-22 20:20:02,679 views 18532 5408 ChatAPI实例初始化完成
DEBUG 2025-04-22 20:20:02,679 views 18532 5408 收到stream_chat请求: {'message': [''], 'session_id': ['default']}
DEBUG 2025-04-22 20:20:02,679 views 18532 5408 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-22 20:20:02,679 views 18532 5408 处理消息: , 会话ID: default
WARNING 2025-04-22 20:20:02,679 views 18532 5408 接收到空消息
INFO 2025-04-22 20:20:02,683 basehttp 18532 5408 "GET /api/chat/stream_chat/?message=&session_id=default HTTP/1.1" 200 34
INFO 2025-04-22 20:20:05,334 views 18532 5368 Neo4j服务初始化成功
DEBUG 2025-04-22 20:20:07,379 views 18532 5368 ChatAPI实例初始化完成
ERROR 2025-04-22 20:20:07,379 views 18532 5368 获取历史记录失败: Module "redis.connection" does not define a "HiredisParser" attribute/class
ERROR 2025-04-22 20:20:07,379 log 18532 5368 Internal Server Error: /api/chat/get_history/
ERROR 2025-04-22 20:20:07,382 basehttp 18532 5368 "GET /api/chat/get_history/ HTTP/1.1" 500 113
INFO 2025-04-22 20:21:37,239 autoreload 18532 7924 D:\GraduationProject\wheatdisease\backend\settings.py changed, reloading.
INFO 2025-04-22 20:21:38,089 autoreload 10700 21516 Watching for file changes with StatReloader
INFO 2025-04-22 20:22:36,460 autoreload 10700 21516 D:\GraduationProject\wheatdisease\backend\settings.py changed, reloading.
INFO 2025-04-22 20:22:37,397 autoreload 9560 17012 Watching for file changes with StatReloader
INFO 2025-04-22 20:24:15,721 views 9560 16732 Neo4j服务初始化成功
DEBUG 2025-04-22 20:24:17,762 views 9560 16732 ChatAPI实例初始化完成
ERROR 2025-04-22 20:24:17,767 views 9560 16732 创建会话失败: Authentication required.
ERROR 2025-04-22 20:24:17,767 log 9560 16732 Internal Server Error: /api/chat/create_session/
ERROR 2025-04-22 20:24:17,768 basehttp 9560 16732 "POST /api/chat/create_session/ HTTP/1.1" 500 58
INFO 2025-04-22 20:24:20,117 views 9560 22208 Neo4j服务初始化成功
DEBUG 2025-04-22 20:24:22,181 views 9560 22208 ChatAPI实例初始化完成
ERROR 2025-04-22 20:24:22,183 views 9560 22208 获取历史记录失败: Authentication required.
ERROR 2025-04-22 20:24:22,184 log 9560 22208 Internal Server Error: /api/chat/get_history/
ERROR 2025-04-22 20:24:22,184 basehttp 9560 22208 "GET /api/chat/get_history/ HTTP/1.1" 500 58
INFO 2025-04-22 20:43:22,298 basehttp 9560 13960 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
INFO 2025-04-22 20:43:22,615 basehttp 9560 18572 "OPTIONS /api/knowledge/graph/ HTTP/1.1" 200 0
WARNING 2025-04-22 20:43:26,735 log 9560 18572 Unauthorized: /api/knowledge/graph/
WARNING 2025-04-22 20:43:26,738 basehttp 9560 18572 "GET /api/knowledge/graph/ HTTP/1.1" 401 171
INFO 2025-04-29 22:20:34,786 autoreload 21984 14792 Watching for file changes with StatReloader
INFO 2025-04-29 22:24:09,676 basehttp 21984 2108 "OPTIONS /api/users/login/ HTTP/1.1" 200 0
INFO 2025-04-29 22:24:10,550 basehttp 21984 2108 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-04-29 22:24:10,567 basehttp 21984 2108 "OPTIONS /api/knowledge/init/ HTTP/1.1" 200 0
ERROR 2025-04-29 22:24:18,752 log 21984 2108 Internal Server Error: /api/knowledge/init/
INFO 2025-04-29 22:24:18,752 basehttp 21984 2108 - Broken pipe from ('127.0.0.1', 63465)
INFO 2025-04-29 22:24:19,209 basehttp 21984 16816 "POST /api/users/login/ HTTP/1.1" 200 526
ERROR 2025-04-29 22:24:27,412 log 21984 16816 Internal Server Error: /api/knowledge/init/
INFO 2025-04-29 22:24:27,413 basehttp 21984 16816 - Broken pipe from ('127.0.0.1', 63467)
INFO 2025-04-29 22:24:41,607 views 21984 18336 Neo4j服务初始化成功
INFO 2025-04-29 22:24:42,746 basehttp 21984 5328 "OPTIONS /api/users/ HTTP/1.1" 200 0
INFO 2025-04-29 22:24:42,771 basehttp 21984 5328 "GET /api/users/ HTTP/1.1" 200 226
ERROR 2025-04-29 22:24:43,870 log 21984 17488 Internal Server Error: /api/knowledge/graph/
ERROR 2025-04-29 22:24:43,871 basehttp 21984 17488 "GET /api/knowledge/graph/ HTTP/1.1" 500 56
DEBUG 2025-04-29 22:24:45,700 views 21984 18336 ChatAPI实例初始化完成
INFO 2025-04-29 22:24:45,702 views 21984 18336 创建新会话成功 - 会话ID: 1745936685701_6920
INFO 2025-04-29 22:24:45,703 basehttp 21984 18336 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-29 22:24:46,089 views 21984 21124 Neo4j服务初始化成功
INFO 2025-04-29 22:24:50,105 views 21984 2128 Neo4j服务初始化成功
DEBUG 2025-04-29 22:24:50,167 views 21984 21124 ChatAPI实例初始化完成
INFO 2025-04-29 22:24:50,168 views 21984 21124 创建新会话成功 - 会话ID: 1745936690167_7410
INFO 2025-04-29 22:24:50,169 basehttp 21984 21124 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-29 22:24:51,995 views 21984 23132 Neo4j服务初始化成功
ERROR 2025-04-29 22:24:52,010 log 21984 14372 Internal Server Error: /api/knowledge/graph/
ERROR 2025-04-29 22:24:52,011 basehttp 21984 14372 "GET /api/knowledge/graph/ HTTP/1.1" 500 56
DEBUG 2025-04-29 22:24:54,195 views 21984 2128 ChatAPI实例初始化完成
INFO 2025-04-29 22:24:54,196 views 21984 2128 获取所有历史会话 - 会话数: 0
INFO 2025-04-29 22:24:54,197 basehttp 21984 2128 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-29 22:24:55,189 views 21984 9588 Neo4j服务初始化成功
DEBUG 2025-04-29 22:24:56,079 views 21984 23132 ChatAPI实例初始化完成
INFO 2025-04-29 22:24:56,080 views 21984 23132 创建新会话成功 - 会话ID: 1745936696079_7512
INFO 2025-04-29 22:24:56,080 basehttp 21984 23132 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-29 22:24:58,618 views 21984 21364 Neo4j服务初始化成功
DEBUG 2025-04-29 22:24:59,287 views 21984 9588 ChatAPI实例初始化完成
INFO 2025-04-29 22:24:59,288 views 21984 9588 创建新会话成功 - 会话ID: 1745936699287_3392
INFO 2025-04-29 22:24:59,288 basehttp 21984 9588 "POST /api/chat/create_session/ HTTP/1.1" 200 57
ERROR 2025-04-29 22:25:00,208 log 21984 17488 Internal Server Error: /api/knowledge/graph/
ERROR 2025-04-29 22:25:00,208 basehttp 21984 17488 "GET /api/knowledge/graph/ HTTP/1.1" 500 56
DEBUG 2025-04-29 22:25:02,716 views 21984 21364 ChatAPI实例初始化完成
INFO 2025-04-29 22:25:02,718 views 21984 21364 获取所有历史会话 - 会话数: 0
INFO 2025-04-29 22:25:02,719 basehttp 21984 21364 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-29 22:25:07,109 views 21984 4756 Neo4j服务初始化成功
ERROR 2025-04-29 22:25:08,343 log 21984 14372 Internal Server Error: /api/knowledge/graph/
ERROR 2025-04-29 22:25:08,344 basehttp 21984 14372 "GET /api/knowledge/graph/ HTTP/1.1" 500 56
DEBUG 2025-04-29 22:25:11,195 views 21984 4756 ChatAPI实例初始化完成
INFO 2025-04-29 22:25:11,197 views 21984 4756 获取所有历史会话 - 会话数: 0
INFO 2025-04-29 22:25:11,197 basehttp 21984 4756 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-29 22:25:15,591 views 21984 23532 Neo4j服务初始化成功
DEBUG 2025-04-29 22:25:19,679 views 21984 23532 ChatAPI实例初始化完成
INFO 2025-04-29 22:25:19,681 views 21984 23532 获取所有历史会话 - 会话数: 0
INFO 2025-04-29 22:25:19,682 basehttp 21984 23532 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-29 22:25:24,082 views 21984 12768 Neo4j服务初始化成功
INFO 2025-04-29 22:25:24,160 views 21984 9272 Neo4j服务初始化成功
DEBUG 2025-04-29 22:25:28,162 views 21984 12768 ChatAPI实例初始化完成
INFO 2025-04-29 22:25:28,163 views 21984 12768 获取所有历史会话 - 会话数: 0
INFO 2025-04-29 22:25:28,164 basehttp 21984 12768 "GET /api/chat/get_history/ HTTP/1.1" 200 37
DEBUG 2025-04-29 22:25:28,255 views 21984 9272 ChatAPI实例初始化完成
INFO 2025-04-29 22:25:28,256 views 21984 9272 获取所有历史会话 - 会话数: 0
INFO 2025-04-29 22:25:28,257 basehttp 21984 9272 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-29 22:25:32,685 views 21984 4180 Neo4j服务初始化成功
DEBUG 2025-04-29 22:25:36,759 views 21984 4180 ChatAPI实例初始化完成
INFO 2025-04-29 22:25:36,760 views 21984 4180 获取所有历史会话 - 会话数: 0
INFO 2025-04-29 22:25:36,761 basehttp 21984 4180 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-29 22:26:36,836 basehttp 21984 14372 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
INFO 2025-04-29 22:26:36,850 basehttp 21984 5328 "OPTIONS /api/knowledge/graph/ HTTP/1.1" 200 0
INFO 2025-04-29 22:26:40,992 basehttp 21984 5328 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
INFO 2025-04-29 23:08:15,938 views 21984 19156 Neo4j服务初始化成功
DEBUG 2025-04-29 23:08:17,975 views 21984 19156 ChatAPI实例初始化完成
INFO 2025-04-29 23:08:17,975 views 21984 19156 创建新会话成功 - 会话ID: 1745939297975_5572
INFO 2025-04-29 23:08:17,976 basehttp 21984 19156 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-29 23:08:20,286 views 21984 6768 Neo4j服务初始化成功
DEBUG 2025-04-29 23:08:22,364 views 21984 6768 ChatAPI实例初始化完成
INFO 2025-04-29 23:08:22,365 views 21984 6768 获取所有历史会话 - 会话数: 0
INFO 2025-04-29 23:08:22,366 basehttp 21984 6768 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-29 23:08:24,745 views 21984 18112 Neo4j服务初始化成功
DEBUG 2025-04-29 23:08:26,775 views 21984 18112 ChatAPI实例初始化完成
INFO 2025-04-29 23:08:26,777 views 21984 18112 获取所有历史会话 - 会话数: 0
INFO 2025-04-29 23:08:26,778 basehttp 21984 18112 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-29 23:08:52,957 views 21984 23488 Neo4j服务初始化成功
DEBUG 2025-04-29 23:08:55,010 views 21984 23488 ChatAPI实例初始化完成
DEBUG 2025-04-29 23:08:55,010 views 21984 23488 收到stream_chat请求: {'message': ['你好，我的小麦的叶片好像有一点问题，你能帮我看看吗'], 'session_id': ['1745939297975_5572']}
DEBUG 2025-04-29 23:08:55,014 views 21984 23488 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-29 23:08:55,014 views 21984 23488 处理消息: 你好，我的小麦的叶片好像有一点问题，你能帮我看看吗, 会话ID: 1745939297975_5572
INFO 2025-04-29 23:08:55,014 views 21984 23488 获取现有会话: 1745939297975_5572
INFO 2025-04-29 23:08:55,017 views 21984 23488 会话已更新: 1745939297975_5572
INFO 2025-04-29 23:08:55,017 views 21984 23488 获取会话历史 - 会话ID: 1745939297975_5572, 历史记录数: 0
DEBUG 2025-04-29 23:08:55,017 views 21984 23488 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好，我的小麦的叶片好像有一点问题，你能帮我看看吗'}]
DEBUG 2025-04-29 23:08:55,019 views 21984 23488 构建的消息列表长度: 2
INFO 2025-04-29 23:08:55,019 views 21984 23488 检查会话状态: 1745939297975_5572
INFO 2025-04-29 23:08:55,020 views 21984 23488 获取现有会话: 1745939297975_5572
INFO 2025-04-29 23:08:55,021 views 21984 23488 会话已更新: 1745939297975_5572
INFO 2025-04-29 23:08:55,021 views 21984 23488 从会话获取症状信息 - 会话ID: 1745939297975_5572, 症状: {}
INFO 2025-04-29 23:08:55,021 views 21984 23488 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-29 23:08:55,022 views 21984 23488 创建新会话: 1745939297975_5572
INFO 2025-04-29 23:08:55,023 views 21984 23488 当前症状收集状态: {'1745939297975_5572': {'collecting': True, 'symptoms': {}}}
DEBUG 2025-04-29 23:08:55,023 views 21984 23488 当前症状信息: {}
DEBUG 2025-04-29 23:08:55,023 views 21984 23488 开始提取症状，输入消息: 你好，我的小麦的叶片好像有一点问题，你能帮我看看吗
DEBUG 2025-04-29 23:08:55,024 views 21984 23488 分句结果: ['你好', '我的小麦的叶片好像有一点问题', '你能帮我看看吗', '你好，我的小麦的叶片好像有一点问题，你能帮我看看吗']
DEBUG 2025-04-29 23:08:55,024 views 21984 23488 提取到的发病部位: []
DEBUG 2025-04-29 23:08:55,024 views 21984 23488 提取到的气象条件: []
DEBUG 2025-04-29 23:08:55,025 views 21984 23488 提取到的生育期: []
DEBUG 2025-04-29 23:08:55,025 views 21984 23488 提取到的种植区: []
DEBUG 2025-04-29 23:08:55,025 views 21984 23488 提取到的发病部位: ['叶片']
DEBUG 2025-04-29 23:08:55,026 views 21984 23488 提取到的气象条件: []
DEBUG 2025-04-29 23:08:55,026 views 21984 23488 提取到的生育期: []
DEBUG 2025-04-29 23:08:55,026 views 21984 23488 提取到的种植区: []
DEBUG 2025-04-29 23:08:55,027 views 21984 23488 提取到的发病部位: []
DEBUG 2025-04-29 23:08:55,027 views 21984 23488 提取到的气象条件: []
DEBUG 2025-04-29 23:08:55,027 views 21984 23488 提取到的生育期: []
DEBUG 2025-04-29 23:08:55,028 views 21984 23488 提取到的种植区: []
DEBUG 2025-04-29 23:08:55,028 views 21984 23488 提取到的发病部位: ['叶片']
DEBUG 2025-04-29 23:08:55,028 views 21984 23488 提取到的气象条件: []
DEBUG 2025-04-29 23:08:55,029 views 21984 23488 提取到的生育期: []
DEBUG 2025-04-29 23:08:55,029 views 21984 23488 提取到的种植区: []
INFO 2025-04-29 23:08:55,029 views 21984 23488 症状提取结果: {'plant_part': '叶片'}
INFO 2025-04-29 23:08:55,030 views 21984 23488 开始更新症状信息 - 会话ID: 1745939297975_5572, 新症状: {'plant_part': '叶片'}
INFO 2025-04-29 23:08:55,030 views 21984 23488 获取现有会话: 1745939297975_5572
INFO 2025-04-29 23:08:55,031 views 21984 23488 会话已更新: 1745939297975_5572
INFO 2025-04-29 23:08:55,031 views 21984 23488 从会话获取症状信息 - 会话ID: 1745939297975_5572, 症状: {}
INFO 2025-04-29 23:08:55,031 views 21984 23488 当前症状信息 - 会话ID: 1745939297975_5572, 症状: {}
INFO 2025-04-29 23:08:55,031 views 21984 23488 更新症状类别 - 会话ID: 1745939297975_5572, 类别: plant_part, 值: 叶片
INFO 2025-04-29 23:08:55,032 views 21984 23488 获取现有会话: 1745939297975_5572
INFO 2025-04-29 23:08:55,032 views 21984 23488 会话已更新: 1745939297975_5572
INFO 2025-04-29 23:08:55,033 views 21984 23488 会话已保存到 Redis: 1745939297975_5572
INFO 2025-04-29 23:08:55,033 views 21984 23488 症状信息已保存到会话 - 会话ID: 1745939297975_5572, 症状: {'plant_part': '叶片'}
INFO 2025-04-29 23:08:55,033 views 21984 23488 症状信息更新完成 - 会话ID: 1745939297975_5572, 最终症状: {'plant_part': '叶片'}
INFO 2025-04-29 23:08:55,034 views 21984 23488 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-29 23:08:55,034 views 21984 23488 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 种植区

INFO 2025-04-29 23:08:57,686 services 21984 23488 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-29 23:08:57,686 services 21984 23488 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-29 23:08:57,689 services 21984 23488 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-29 23:08:57,917 services 21984 23488 查询结果: <neo4j._sync.work.result.Result object at 0x000002728B1CBB30>
INFO 2025-04-29 23:09:20,456 views 21984 23488 获取现有会话: 1745939297975_5572
INFO 2025-04-29 23:09:20,456 views 21984 23488 会话已更新: 1745939297975_5572
INFO 2025-04-29 23:09:20,456 views 21984 23488 会话已保存到 Redis: 1745939297975_5572
DEBUG 2025-04-29 23:09:20,456 views 21984 23488 添加历史记录 - 会话ID: 1745939297975_5572, 角色: user
INFO 2025-04-29 23:09:20,456 views 21984 23488 获取现有会话: 1745939297975_5572
INFO 2025-04-29 23:09:20,456 views 21984 23488 会话已更新: 1745939297975_5572
INFO 2025-04-29 23:09:20,456 views 21984 23488 会话已保存到 Redis: 1745939297975_5572
DEBUG 2025-04-29 23:09:20,456 views 21984 23488 添加历史记录 - 会话ID: 1745939297975_5572, 角色: assistant
INFO 2025-04-29 23:09:20,456 basehttp 21984 23488 "GET /api/chat/stream_chat/?message=%E4%BD%A0%E5%A5%BD%EF%BC%8C%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E7%9A%84%E5%8F%B6%E7%89%87%E5%A5%BD%E5%83%8F%E6%9C%89%E4%B8%80%E7%82%B9%E9%97%AE%E9%A2%98%EF%BC%8C%E4%BD%A0%E8%83%BD%E5%B8%AE%E6%88%91%E7%9C%8B%E7%9C%8B%E5%90%97&session_id=1745939297975_5572 HTTP/1.1" 200 5340
INFO 2025-04-29 23:09:23,388 views 21984 23084 Neo4j服务初始化成功
DEBUG 2025-04-29 23:09:25,452 views 21984 23084 ChatAPI实例初始化完成
INFO 2025-04-29 23:09:25,452 views 21984 23084 获取所有历史会话 - 会话数: 1
INFO 2025-04-29 23:09:25,452 basehttp 21984 23084 "GET /api/chat/get_history/ HTTP/1.1" 200 429
INFO 2025-04-29 23:09:53,555 views 21984 14668 Neo4j服务初始化成功
DEBUG 2025-04-29 23:09:55,611 views 21984 14668 ChatAPI实例初始化完成
DEBUG 2025-04-29 23:09:55,611 views 21984 14668 收到stream_chat请求: {'message': ['目前在河北'], 'session_id': ['1745939297975_5572']}
DEBUG 2025-04-29 23:09:55,611 views 21984 14668 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-29 23:09:55,611 views 21984 14668 处理消息: 目前在河北, 会话ID: 1745939297975_5572
INFO 2025-04-29 23:09:55,615 views 21984 14668 获取现有会话: 1745939297975_5572
INFO 2025-04-29 23:09:55,615 views 21984 14668 会话已更新: 1745939297975_5572
INFO 2025-04-29 23:09:55,615 views 21984 14668 获取会话历史 - 会话ID: 1745939297975_5572, 历史记录数: 2
DEBUG 2025-04-29 23:09:55,615 views 21984 14668 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好，我的小麦的叶片好像有一点问题，你能帮我看看吗'}, {'role': 'assistant', 'content': '根据目前掌握的信息（发病部位：叶片），可能的病害有：\n\n1. 小麦黑颖病\n   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或不饱满，发病轻的种子颜色变深；叶片染病初呈水渍状小点，渐沿叶脉向上、下扩展为黄褐色条状斑；穗...\n\n2. 小麦黑节病\n   主要特征: 叶片染病初生水渍状条斑，后变为黄褐色，最后呈浓褐色，病斑长椭圆形，也有中间色浅些的；叶鞘染病沿叶脉形成黑褐色长形条斑，多与叶上病斑相连，后叶鞘全部变为浅褐色；茎秆染病主要为害节部，病部呈浓褐色，内部也...\n\n3. 小麦黄矮病毒病\n   主要特征: 叶片典型症状是新叶发病从叶尖渐向叶基扩展变黄，黄化部分占全叶的1/3 - 1/2，叶基仍为绿色，且保持较长时间，有时出现与叶脉平行但不受叶脉限制的黄绿相间条纹，病叶较光滑，发病早植株矮化严重，但因品种...\n\n请补充更多信息，以便我更准确地判断。您也可以点击[深入]按钮了解某个病害的详细信息。'}, {'role': 'user', 'content': '目前在河北'}]
DEBUG 2025-04-29 23:09:55,615 views 21984 14668 构建的消息列表长度: 4
INFO 2025-04-29 23:09:59,325 views 21984 14668 获取现有会话: 1745939297975_5572
INFO 2025-04-29 23:09:59,325 views 21984 14668 会话已更新: 1745939297975_5572
INFO 2025-04-29 23:09:59,329 views 21984 14668 会话已保存到 Redis: 1745939297975_5572
DEBUG 2025-04-29 23:09:59,329 views 21984 14668 添加历史记录 - 会话ID: 1745939297975_5572, 角色: user
INFO 2025-04-29 23:09:59,329 views 21984 14668 获取现有会话: 1745939297975_5572
INFO 2025-04-29 23:09:59,329 views 21984 14668 会话已更新: 1745939297975_5572
INFO 2025-04-29 23:09:59,329 views 21984 14668 会话已保存到 Redis: 1745939297975_5572
DEBUG 2025-04-29 23:09:59,333 views 21984 14668 添加历史记录 - 会话ID: 1745939297975_5572, 角色: assistant
INFO 2025-04-29 23:09:59,333 basehttp 21984 14668 "GET /api/chat/stream_chat/?message=%E7%9B%AE%E5%89%8D%E5%9C%A8%E6%B2%B3%E5%8C%97&session_id=1745939297975_5572 HTTP/1.1" 200 1027
INFO 2025-04-29 23:10:02,012 views 21984 7296 Neo4j服务初始化成功
DEBUG 2025-04-29 23:10:04,081 views 21984 7296 ChatAPI实例初始化完成
INFO 2025-04-29 23:10:04,085 views 21984 7296 获取所有历史会话 - 会话数: 1
INFO 2025-04-29 23:10:04,085 basehttp 21984 7296 "GET /api/chat/get_history/ HTTP/1.1" 200 476
INFO 2025-04-29 23:10:28,411 views 21984 4724 Neo4j服务初始化成功
DEBUG 2025-04-29 23:10:30,476 views 21984 4724 ChatAPI实例初始化完成
INFO 2025-04-29 23:10:30,479 basehttp 21984 4724 "GET /api/chat/get_session_history/?session_id=1745939297975_5572 HTTP/1.1" 200 37
INFO 2025-04-29 23:10:32,301 views 21984 16036 Neo4j服务初始化成功
DEBUG 2025-04-29 23:10:34,316 views 21984 16036 ChatAPI实例初始化完成
INFO 2025-04-29 23:10:34,316 views 21984 16036 创建新会话成功 - 会话ID: 1745939434316_3952
INFO 2025-04-29 23:10:34,320 basehttp 21984 16036 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-29 23:10:36,663 views 21984 16172 Neo4j服务初始化成功
DEBUG 2025-04-29 23:10:38,692 views 21984 16172 ChatAPI实例初始化完成
INFO 2025-04-29 23:10:38,692 views 21984 16172 获取所有历史会话 - 会话数: 1
INFO 2025-04-29 23:10:38,696 basehttp 21984 16172 "GET /api/chat/get_history/ HTTP/1.1" 200 476
INFO 2025-04-29 23:11:46,506 views 21984 16892 Neo4j服务初始化成功
DEBUG 2025-04-29 23:11:48,556 views 21984 16892 ChatAPI实例初始化完成
INFO 2025-04-29 23:11:48,556 views 21984 16892 创建新会话成功 - 会话ID: 1745939508556_4370
INFO 2025-04-29 23:11:48,560 basehttp 21984 16892 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-29 23:11:50,894 views 21984 8044 Neo4j服务初始化成功
DEBUG 2025-04-29 23:11:52,944 views 21984 8044 ChatAPI实例初始化完成
INFO 2025-04-29 23:11:52,949 views 21984 8044 获取所有历史会话 - 会话数: 1
INFO 2025-04-29 23:11:52,949 basehttp 21984 8044 "GET /api/chat/get_history/ HTTP/1.1" 200 476
INFO 2025-04-29 23:11:55,285 views 21984 3844 Neo4j服务初始化成功
DEBUG 2025-04-29 23:11:57,361 views 21984 3844 ChatAPI实例初始化完成
INFO 2025-04-29 23:11:57,365 views 21984 3844 获取所有历史会话 - 会话数: 1
INFO 2025-04-29 23:11:57,365 basehttp 21984 3844 "GET /api/chat/get_history/ HTTP/1.1" 200 476
INFO 2025-04-29 23:37:51,347 views 21984 10108 Neo4j服务初始化成功
DEBUG 2025-04-29 23:37:53,411 views 21984 10108 ChatAPI实例初始化完成
INFO 2025-04-29 23:37:53,411 basehttp 21984 10108 "GET /api/chat/get_session_history/?session_id=1745939297975_5572 HTTP/1.1" 200 37
INFO 2025-04-29 23:37:55,355 views 21984 5624 Neo4j服务初始化成功
INFO 2025-04-29 23:37:55,726 views 21984 14448 Neo4j服务初始化成功
DEBUG 2025-04-29 23:37:57,416 views 21984 5624 ChatAPI实例初始化完成
INFO 2025-04-29 23:37:57,416 views 21984 5624 已清除会话 1745939297975_5572 的所有信息
INFO 2025-04-29 23:37:57,416 basehttp 21984 5624 "POST /api/chat/clear_history/ HTTP/1.1" 200 13
DEBUG 2025-04-29 23:37:57,784 views 21984 14448 ChatAPI实例初始化完成
INFO 2025-04-29 23:37:57,784 basehttp 21984 14448 "GET /api/chat/get_session_history/?session_id=1745939297975_5572 HTTP/1.1" 200 37
INFO 2025-04-29 23:37:57,913 views 21984 20844 Neo4j服务初始化成功
DEBUG 2025-04-29 23:37:59,972 views 21984 20844 ChatAPI实例初始化完成
INFO 2025-04-29 23:37:59,976 views 21984 20844 已清除会话 1745939297975_5572 的所有信息
INFO 2025-04-29 23:37:59,976 basehttp 21984 20844 "POST /api/chat/clear_history/ HTTP/1.1" 200 13
INFO 2025-04-30 00:13:30,104 views 21984 12228 Neo4j服务初始化成功
DEBUG 2025-04-30 00:13:32,170 views 21984 12228 ChatAPI实例初始化完成
INFO 2025-04-30 00:13:32,181 views 21984 12228 创建新会话成功 - 会话ID: 1745943212170_7853
INFO 2025-04-30 00:13:32,182 basehttp 21984 12228 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 00:13:34,567 views 21984 18256 Neo4j服务初始化成功
DEBUG 2025-04-30 00:13:36,630 views 21984 18256 ChatAPI实例初始化完成
INFO 2025-04-30 00:13:36,632 views 21984 18256 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 00:13:36,633 basehttp 21984 18256 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-30 00:13:38,997 views 21984 12956 Neo4j服务初始化成功
DEBUG 2025-04-30 00:13:41,075 views 21984 12956 ChatAPI实例初始化完成
INFO 2025-04-30 00:13:41,077 views 21984 12956 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 00:13:41,078 basehttp 21984 12956 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-30 00:24:19,327 autoreload 21984 14792 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 00:24:21,072 autoreload 16116 10992 Watching for file changes with StatReloader
INFO 2025-04-30 00:26:35,361 autoreload 16116 10992 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 00:26:36,177 autoreload 1528 17428 Watching for file changes with StatReloader
INFO 2025-04-30 00:26:44,334 views 1528 6364 Neo4j服务初始化成功
DEBUG 2025-04-30 00:26:46,388 views 1528 6364 ChatAPI实例初始化完成
INFO 2025-04-30 00:26:46,397 views 1528 6364 创建新会话成功 - 会话ID: 1745944006392_9571
INFO 2025-04-30 00:26:46,399 basehttp 1528 6364 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 00:26:48,736 views 1528 3672 Neo4j服务初始化成功
DEBUG 2025-04-30 00:26:50,767 views 1528 3672 ChatAPI实例初始化完成
INFO 2025-04-30 00:26:50,767 views 1528 3672 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 00:26:50,771 basehttp 1528 3672 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-30 00:26:53,103 views 1528 3708 Neo4j服务初始化成功
DEBUG 2025-04-30 00:26:55,166 views 1528 3708 ChatAPI实例初始化完成
INFO 2025-04-30 00:26:55,171 views 1528 3708 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 00:26:55,175 basehttp 1528 3708 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-30 00:27:10,293 views 1528 15728 Neo4j服务初始化成功
DEBUG 2025-04-30 00:27:12,346 views 1528 15728 ChatAPI实例初始化完成
INFO 2025-04-30 00:27:12,346 views 1528 15728 创建新会话成功 - 会话ID: 1745944032346_7176
INFO 2025-04-30 00:27:12,346 basehttp 1528 15728 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 00:27:12,454 views 1528 10904 Neo4j服务初始化成功
DEBUG 2025-04-30 00:27:14,526 views 1528 10904 ChatAPI实例初始化完成
INFO 2025-04-30 00:27:14,531 views 1528 10904 创建新会话成功 - 会话ID: 1745944034531_7037
INFO 2025-04-30 00:27:14,531 basehttp 1528 10904 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 00:27:14,662 views 1528 23656 Neo4j服务初始化成功
DEBUG 2025-04-30 00:27:16,733 views 1528 23656 ChatAPI实例初始化完成
INFO 2025-04-30 00:27:16,737 views 1528 23656 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 00:27:16,741 basehttp 1528 23656 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-30 00:27:19,060 views 1528 11524 Neo4j服务初始化成功
DEBUG 2025-04-30 00:27:21,114 views 1528 11524 ChatAPI实例初始化完成
INFO 2025-04-30 00:27:21,124 views 1528 11524 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 00:27:21,126 basehttp 1528 11524 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-30 00:27:23,040 views 1528 20900 Neo4j服务初始化成功
DEBUG 2025-04-30 00:27:25,069 views 1528 20900 ChatAPI实例初始化完成
DEBUG 2025-04-30 00:27:25,070 views 1528 20900 收到stream_chat请求: {'message': ['你好我的小麦好像生病了'], 'session_id': ['1745944034531_7037']}
DEBUG 2025-04-30 00:27:25,070 views 1528 20900 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 00:27:25,070 views 1528 20900 处理消息: 你好我的小麦好像生病了, 会话ID: 1745944034531_7037
INFO 2025-04-30 00:27:25,071 views 1528 20900 获取现有会话: 1745944034531_7037
INFO 2025-04-30 00:27:25,071 views 1528 20900 获取会话历史 - 会话ID: 1745944034531_7037, 历史记录数: 0
DEBUG 2025-04-30 00:27:25,072 views 1528 20900 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好我的小麦好像生病了'}]
DEBUG 2025-04-30 00:27:25,072 views 1528 20900 构建的消息列表长度: 2
INFO 2025-04-30 00:27:25,073 views 1528 20900 检查会话状态: 1745944034531_7037
INFO 2025-04-30 00:27:25,073 views 1528 20900 获取现有会话: 1745944034531_7037
INFO 2025-04-30 00:27:25,074 views 1528 20900 从会话获取症状信息 - 会话ID: 1745944034531_7037, 症状: {}
INFO 2025-04-30 00:27:25,074 views 1528 20900 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-30 00:27:25,074 views 1528 20900 创建新会话: 1745944034531_7037
INFO 2025-04-30 00:27:25,074 views 1528 20900 当前症状收集状态: {'1745944034531_7037': {'collecting': True, 'symptoms': {}}}
DEBUG 2025-04-30 00:27:25,074 views 1528 20900 当前症状信息: {}
DEBUG 2025-04-30 00:27:25,075 views 1528 20900 开始提取症状，输入消息: 你好我的小麦好像生病了
DEBUG 2025-04-30 00:27:25,075 views 1528 20900 分句结果: ['你好我的小麦好像生病了', '你好我的小麦好像生病了']
DEBUG 2025-04-30 00:27:25,075 views 1528 20900 提取到的发病部位: []
DEBUG 2025-04-30 00:27:25,075 views 1528 20900 提取到的气象条件: []
DEBUG 2025-04-30 00:27:25,076 views 1528 20900 提取到的生育期: []
DEBUG 2025-04-30 00:27:25,076 views 1528 20900 提取到的种植区: []
DEBUG 2025-04-30 00:27:25,076 views 1528 20900 提取到的发病部位: []
DEBUG 2025-04-30 00:27:25,076 views 1528 20900 提取到的气象条件: []
DEBUG 2025-04-30 00:27:25,077 views 1528 20900 提取到的生育期: []
DEBUG 2025-04-30 00:27:25,077 views 1528 20900 提取到的种植区: []
INFO 2025-04-30 00:27:25,077 views 1528 20900 症状提取结果: {}
INFO 2025-04-30 00:27:25,077 views 1528 20900 开始更新症状信息 - 会话ID: 1745944034531_7037, 新症状: {}
INFO 2025-04-30 00:27:25,078 views 1528 20900 获取现有会话: 1745944034531_7037
INFO 2025-04-30 00:27:25,078 views 1528 20900 从会话获取症状信息 - 会话ID: 1745944034531_7037, 症状: {}
INFO 2025-04-30 00:27:25,078 views 1528 20900 当前症状信息 - 会话ID: 1745944034531_7037, 症状: {}
INFO 2025-04-30 00:27:25,079 views 1528 20900 获取现有会话: 1745944034531_7037
INFO 2025-04-30 00:27:25,079 views 1528 20900 会话已保存到 Redis: 1745944034531_7037
INFO 2025-04-30 00:27:25,079 views 1528 20900 症状信息已保存到会话 - 会话ID: 1745944034531_7037, 症状: {}
INFO 2025-04-30 00:27:25,080 views 1528 20900 症状信息更新完成 - 会话ID: 1745944034531_7037, 最终症状: {}
INFO 2025-04-30 00:27:25,080 views 1528 20900 更新后的症状信息: {}
DEBUG 2025-04-30 00:27:28,131 views 1528 20900 添加历史记录成功 - 会话ID: 1745944034531_7037, 角色: user
DEBUG 2025-04-30 00:27:28,132 views 1528 20900 添加历史记录成功 - 会话ID: 1745944034531_7037, 角色: assistant
INFO 2025-04-30 00:27:28,132 basehttp 1528 20900 "GET /api/chat/stream_chat/?message=%E4%BD%A0%E5%A5%BD%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%A5%BD%E5%83%8F%E7%94%9F%E7%97%85%E4%BA%86&session_id=1745944034531_7037 HTTP/1.1" 200 677
INFO 2025-04-30 00:27:30,781 views 1528 10052 Neo4j服务初始化成功
DEBUG 2025-04-30 00:27:32,850 views 1528 10052 ChatAPI实例初始化完成
INFO 2025-04-30 00:27:32,852 views 1528 10052 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 00:27:32,853 basehttp 1528 10052 "GET /api/chat/get_history/ HTTP/1.1" 200 444
INFO 2025-04-30 00:27:37,780 views 1528 22040 Neo4j服务初始化成功
DEBUG 2025-04-30 00:27:39,851 views 1528 22040 ChatAPI实例初始化完成
INFO 2025-04-30 00:27:39,856 basehttp 1528 22040 "GET /api/chat/get_session_history/?session_id=1745944034531_7037 HTTP/1.1" 200 536
INFO 2025-04-30 00:27:42,191 views 1528 16936 Neo4j服务初始化成功
DEBUG 2025-04-30 00:27:44,245 views 1528 16936 ChatAPI实例初始化完成
INFO 2025-04-30 00:27:44,249 basehttp 1528 16936 "GET /api/chat/get_session_history/?session_id=1745944034531_7037 HTTP/1.1" 200 536
INFO 2025-04-30 00:28:03,078 views 1528 20844 Neo4j服务初始化成功
DEBUG 2025-04-30 00:28:05,135 views 1528 20844 ChatAPI实例初始化完成
INFO 2025-04-30 00:28:05,135 views 1528 20844 创建新会话成功 - 会话ID: 1745944085135_3919
INFO 2025-04-30 00:28:05,139 basehttp 1528 20844 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 00:28:07,477 views 1528 23420 Neo4j服务初始化成功
DEBUG 2025-04-30 00:28:09,520 views 1528 23420 ChatAPI实例初始化完成
INFO 2025-04-30 00:28:09,524 views 1528 23420 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 00:28:09,524 basehttp 1528 23420 "GET /api/chat/get_history/ HTTP/1.1" 200 445
INFO 2025-04-30 00:28:11,858 views 1528 13760 Neo4j服务初始化成功
DEBUG 2025-04-30 00:28:13,919 views 1528 13760 ChatAPI实例初始化完成
INFO 2025-04-30 00:28:13,919 views 1528 13760 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 00:28:13,923 basehttp 1528 13760 "GET /api/chat/get_history/ HTTP/1.1" 200 445
INFO 2025-04-30 00:28:30,453 views 1528 18536 Neo4j服务初始化成功
DEBUG 2025-04-30 00:28:32,520 views 1528 18536 ChatAPI实例初始化完成
INFO 2025-04-30 00:28:32,521 basehttp 1528 18536 "GET /api/chat/get_session_history/?session_id=1745944034531_7037 HTTP/1.1" 200 536
INFO 2025-04-30 00:29:06,755 views 1528 22972 Neo4j服务初始化成功
DEBUG 2025-04-30 00:29:08,798 views 1528 22972 ChatAPI实例初始化完成
DEBUG 2025-04-30 00:29:08,798 views 1528 22972 收到stream_chat请求: {'message': ['他的叶片好像有很多很多问题'], 'session_id': ['1745944034531_7037']}
DEBUG 2025-04-30 00:29:08,798 views 1528 22972 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 00:29:08,802 views 1528 22972 处理消息: 他的叶片好像有很多很多问题, 会话ID: 1745944034531_7037
INFO 2025-04-30 00:29:08,803 views 1528 22972 获取现有会话: 1745944034531_7037
INFO 2025-04-30 00:29:08,803 views 1528 22972 获取会话历史 - 会话ID: 1745944034531_7037, 历史记录数: 2
DEBUG 2025-04-30 00:29:08,803 views 1528 22972 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好我的小麦好像生病了', 'timestamp': 1745944048.131186}, {'role': 'assistant', 'content': '请告诉我小麦的发病情况，包括：\n1. 从哪个部位开始发病\n2. 发病时的气象条件\n3. 发病的生育期\n4. 发病的种植区', 'timestamp': 1745944048.131186}, {'role': 'user', 'content': '他的叶片好像有很多很多问题'}]
DEBUG 2025-04-30 00:29:08,803 views 1528 22972 构建的消息列表长度: 4
INFO 2025-04-30 00:29:08,803 views 1528 22972 检查会话状态: 1745944034531_7037
INFO 2025-04-30 00:29:08,803 views 1528 22972 获取现有会话: 1745944034531_7037
INFO 2025-04-30 00:29:08,803 views 1528 22972 从会话获取症状信息 - 会话ID: 1745944034531_7037, 症状: {}
INFO 2025-04-30 00:29:08,803 views 1528 22972 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-30 00:29:08,803 views 1528 22972 创建新会话: 1745944034531_7037
INFO 2025-04-30 00:29:08,806 views 1528 22972 当前症状收集状态: {'1745944034531_7037': {'collecting': True, 'symptoms': {}}}
DEBUG 2025-04-30 00:29:08,806 views 1528 22972 当前症状信息: {}
DEBUG 2025-04-30 00:29:08,806 views 1528 22972 开始提取症状，输入消息: 他的叶片好像有很多很多问题
DEBUG 2025-04-30 00:29:08,806 views 1528 22972 分句结果: ['他的叶片好像有很多很多问题', '他的叶片好像有很多很多问题']
DEBUG 2025-04-30 00:29:08,807 views 1528 22972 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 00:29:08,807 views 1528 22972 提取到的气象条件: []
DEBUG 2025-04-30 00:29:08,808 views 1528 22972 提取到的生育期: []
DEBUG 2025-04-30 00:29:08,808 views 1528 22972 提取到的种植区: []
DEBUG 2025-04-30 00:29:08,808 views 1528 22972 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 00:29:08,808 views 1528 22972 提取到的气象条件: []
DEBUG 2025-04-30 00:29:08,808 views 1528 22972 提取到的生育期: []
DEBUG 2025-04-30 00:29:08,809 views 1528 22972 提取到的种植区: []
INFO 2025-04-30 00:29:08,809 views 1528 22972 症状提取结果: {'plant_part': '叶片'}
INFO 2025-04-30 00:29:08,809 views 1528 22972 开始更新症状信息 - 会话ID: 1745944034531_7037, 新症状: {'plant_part': '叶片'}
INFO 2025-04-30 00:29:08,809 views 1528 22972 获取现有会话: 1745944034531_7037
INFO 2025-04-30 00:29:08,810 views 1528 22972 从会话获取症状信息 - 会话ID: 1745944034531_7037, 症状: {}
INFO 2025-04-30 00:29:08,810 views 1528 22972 当前症状信息 - 会话ID: 1745944034531_7037, 症状: {}
INFO 2025-04-30 00:29:08,810 views 1528 22972 更新症状类别 - 会话ID: 1745944034531_7037, 类别: plant_part, 值: 叶片
INFO 2025-04-30 00:29:08,811 views 1528 22972 获取现有会话: 1745944034531_7037
INFO 2025-04-30 00:29:08,811 views 1528 22972 会话已保存到 Redis: 1745944034531_7037
INFO 2025-04-30 00:29:08,811 views 1528 22972 症状信息已保存到会话 - 会话ID: 1745944034531_7037, 症状: {'plant_part': '叶片'}
INFO 2025-04-30 00:29:08,812 views 1528 22972 症状信息更新完成 - 会话ID: 1745944034531_7037, 最终症状: {'plant_part': '叶片'}
INFO 2025-04-30 00:29:08,812 views 1528 22972 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-30 00:29:08,812 views 1528 22972 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 种植区

INFO 2025-04-30 00:29:11,467 services 1528 22972 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 00:29:11,467 services 1528 22972 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 00:29:11,467 services 1528 22972 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 00:29:11,474 services 1528 22972 查询结果: <neo4j._sync.work.result.Result object at 0x0000024F5B331700>
DEBUG 2025-04-30 00:29:34,018 views 1528 22972 添加历史记录成功 - 会话ID: 1745944034531_7037, 角色: user
DEBUG 2025-04-30 00:29:34,022 views 1528 22972 添加历史记录成功 - 会话ID: 1745944034531_7037, 角色: assistant
INFO 2025-04-30 00:29:34,022 basehttp 1528 22972 "GET /api/chat/stream_chat/?message=%E4%BB%96%E7%9A%84%E5%8F%B6%E7%89%87%E5%A5%BD%E5%83%8F%E6%9C%89%E5%BE%88%E5%A4%9A%E5%BE%88%E5%A4%9A%E9%97%AE%E9%A2%98&session_id=1745944034531_7037 HTTP/1.1" 200 5340
INFO 2025-04-30 00:29:36,560 views 1528 21308 Neo4j服务初始化成功
DEBUG 2025-04-30 00:29:38,610 views 1528 21308 ChatAPI实例初始化完成
INFO 2025-04-30 00:29:38,610 views 1528 21308 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 00:29:38,614 basehttp 1528 21308 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 00:33:33,232 autoreload 1528 17428 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 00:33:34,192 autoreload 17360 7744 Watching for file changes with StatReloader
INFO 2025-04-30 00:33:40,381 autoreload 17360 7744 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 00:33:41,526 autoreload 20260 20964 Watching for file changes with StatReloader
INFO 2025-04-30 00:33:51,353 views 20260 15980 Neo4j服务初始化成功
DEBUG 2025-04-30 00:33:53,400 views 20260 15980 ChatAPI实例初始化完成
INFO 2025-04-30 00:33:53,405 views 20260 15980 创建新会话成功 - 会话ID: 1745944433400_2267
INFO 2025-04-30 00:33:53,406 basehttp 20260 15980 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 00:33:53,951 views 20260 13380 Neo4j服务初始化成功
INFO 2025-04-30 00:33:55,764 views 20260 11168 Neo4j服务初始化成功
DEBUG 2025-04-30 00:33:55,979 views 20260 13380 ChatAPI实例初始化完成
INFO 2025-04-30 00:33:55,979 views 20260 13380 创建新会话成功 - 会话ID: 1745944435979_5334
INFO 2025-04-30 00:33:55,979 basehttp 20260 13380 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 00:33:57,809 views 20260 11168 ChatAPI实例初始化完成
INFO 2025-04-30 00:33:57,814 views 20260 11168 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 00:33:57,814 basehttp 20260 11168 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 00:34:00,165 views 20260 20484 Neo4j服务初始化成功
DEBUG 2025-04-30 00:34:02,216 views 20260 20484 ChatAPI实例初始化完成
INFO 2025-04-30 00:34:02,221 views 20260 20484 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 00:34:02,221 basehttp 20260 20484 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 00:34:04,543 views 20260 14624 Neo4j服务初始化成功
DEBUG 2025-04-30 00:34:06,588 views 20260 14624 ChatAPI实例初始化完成
INFO 2025-04-30 00:34:06,593 views 20260 14624 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 00:34:06,593 basehttp 20260 14624 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 00:34:08,913 views 20260 3608 Neo4j服务初始化成功
DEBUG 2025-04-30 00:34:10,983 views 20260 3608 ChatAPI实例初始化完成
INFO 2025-04-30 00:34:10,983 views 20260 3608 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 00:34:10,987 basehttp 20260 3608 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 00:40:37,849 autoreload 20260 20964 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 00:40:38,689 autoreload 11592 16636 Watching for file changes with StatReloader
INFO 2025-04-30 00:40:56,661 views 11592 22616 Neo4j服务初始化成功
DEBUG 2025-04-30 00:40:58,709 views 11592 22616 ChatAPI实例初始化完成
INFO 2025-04-30 00:40:58,715 views 11592 22616 创建新会话成功 - 会话ID: 1745944858710_5828
INFO 2025-04-30 00:40:58,716 basehttp 11592 22616 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 00:41:01,036 views 11592 22920 Neo4j服务初始化成功
DEBUG 2025-04-30 00:41:03,076 views 11592 22920 ChatAPI实例初始化完成
INFO 2025-04-30 00:41:03,080 views 11592 22920 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 00:41:03,080 basehttp 11592 22920 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 00:41:05,401 views 11592 10232 Neo4j服务初始化成功
DEBUG 2025-04-30 00:41:07,457 views 11592 10232 ChatAPI实例初始化完成
INFO 2025-04-30 00:41:07,457 views 11592 10232 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 00:41:07,457 basehttp 11592 10232 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:13:28,325 autoreload 11592 16636 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 10:13:29,231 autoreload 22120 18388 Watching for file changes with StatReloader
INFO 2025-04-30 10:17:22,530 views 22120 20324 Neo4j服务初始化成功
DEBUG 2025-04-30 10:17:24,568 views 22120 20324 ChatAPI实例初始化完成
INFO 2025-04-30 10:17:24,573 views 22120 20324 创建新会话成功 - 会话ID: 1745979444568_9543
INFO 2025-04-30 10:17:24,574 basehttp 22120 20324 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 10:17:26,928 views 22120 15228 Neo4j服务初始化成功
DEBUG 2025-04-30 10:17:28,960 views 22120 15228 ChatAPI实例初始化完成
INFO 2025-04-30 10:17:28,964 views 22120 15228 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:17:28,964 basehttp 22120 15228 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:17:31,307 views 22120 7748 Neo4j服务初始化成功
DEBUG 2025-04-30 10:17:33,361 views 22120 7748 ChatAPI实例初始化完成
INFO 2025-04-30 10:17:33,365 views 22120 7748 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:17:33,365 basehttp 22120 7748 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:17:34,269 views 22120 708 Neo4j服务初始化成功
DEBUG 2025-04-30 10:17:36,330 views 22120 708 ChatAPI实例初始化完成
INFO 2025-04-30 10:17:36,330 basehttp 22120 708 "GET /api/chat/get_session_history/?session_id=1745944034531_7037 HTTP/1.1" 200 3161
INFO 2025-04-30 10:17:40,616 views 22120 12852 Neo4j服务初始化成功
INFO 2025-04-30 10:17:42,044 views 22120 22648 Neo4j服务初始化成功
DEBUG 2025-04-30 10:17:42,657 views 22120 12852 ChatAPI实例初始化完成
INFO 2025-04-30 10:17:42,660 basehttp 22120 12852 "GET /api/chat/get_session_history/?session_id=1745944034531_7037 HTTP/1.1" 200 3161
DEBUG 2025-04-30 10:17:44,081 views 22120 22648 ChatAPI实例初始化完成
INFO 2025-04-30 10:17:44,082 views 22120 22648 创建新会话成功 - 会话ID: 1745979464081_4482
INFO 2025-04-30 10:17:44,082 basehttp 22120 22648 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 10:17:46,425 views 22120 11448 Neo4j服务初始化成功
DEBUG 2025-04-30 10:17:48,474 views 22120 11448 ChatAPI实例初始化完成
INFO 2025-04-30 10:17:48,478 views 22120 11448 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:17:48,478 basehttp 22120 11448 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:17:50,818 views 22120 19440 Neo4j服务初始化成功
DEBUG 2025-04-30 10:17:52,872 views 22120 19440 ChatAPI实例初始化完成
INFO 2025-04-30 10:17:52,876 views 22120 19440 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:17:52,876 basehttp 22120 19440 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:18:35,820 autoreload 22120 18388 D:\GraduationProject\wheatdisease\backend\settings.py changed, reloading.
INFO 2025-04-30 10:18:36,686 autoreload 23020 2132 Watching for file changes with StatReloader
INFO 2025-04-30 10:18:43,713 autoreload 23020 2132 D:\GraduationProject\wheatdisease\backend\settings.py changed, reloading.
INFO 2025-04-30 10:18:44,529 autoreload 19236 12340 Watching for file changes with StatReloader
INFO 2025-04-30 10:19:04,735 autoreload 19236 12340 D:\GraduationProject\wheatdisease\backend\settings.py changed, reloading.
INFO 2025-04-30 10:19:05,531 autoreload 17764 17220 Watching for file changes with StatReloader
INFO 2025-04-30 10:21:44,838 autoreload 21496 13580 Watching for file changes with StatReloader
INFO 2025-04-30 10:22:45,687 views 21496 17860 Neo4j服务初始化成功
DEBUG 2025-04-30 10:22:49,768 views 21496 17860 ChatAPI实例初始化完成
INFO 2025-04-30 10:22:49,776 views 21496 17860 创建新会话成功 - 会话ID: 1745979769768_5070
INFO 2025-04-30 10:22:49,779 basehttp 21496 17860 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 10:22:54,118 views 21496 21600 Neo4j服务初始化成功
DEBUG 2025-04-30 10:22:58,214 views 21496 21600 ChatAPI实例初始化完成
INFO 2025-04-30 10:22:58,218 views 21496 21600 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:22:58,219 basehttp 21496 21600 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:23:02,574 views 21496 10816 Neo4j服务初始化成功
DEBUG 2025-04-30 10:23:06,663 views 21496 10816 ChatAPI实例初始化完成
INFO 2025-04-30 10:23:06,678 views 21496 10816 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:23:06,678 basehttp 21496 10816 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:24:03,304 views 21496 21580 Neo4j服务初始化成功
DEBUG 2025-04-30 10:24:05,463 views 21496 21580 ChatAPI实例初始化完成
INFO 2025-04-30 10:24:05,463 views 21496 21580 创建新会话成功 - 会话ID: 1745979845463_6940
INFO 2025-04-30 10:24:05,467 basehttp 21496 21580 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 10:24:07,808 views 21496 23064 Neo4j服务初始化成功
DEBUG 2025-04-30 10:24:09,860 views 21496 23064 ChatAPI实例初始化完成
INFO 2025-04-30 10:24:09,864 views 21496 23064 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:24:09,864 basehttp 21496 23064 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:24:12,213 views 21496 22540 Neo4j服务初始化成功
DEBUG 2025-04-30 10:24:14,248 views 21496 22540 ChatAPI实例初始化完成
INFO 2025-04-30 10:24:14,252 views 21496 22540 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:24:14,252 basehttp 21496 22540 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:25:53,827 views 21496 12332 Neo4j服务初始化成功
INFO 2025-04-30 10:25:54,190 views 21496 11080 Neo4j服务初始化成功
INFO 2025-04-30 10:25:54,252 views 21496 16936 Neo4j服务初始化成功
INFO 2025-04-30 10:25:54,283 views 21496 23744 Neo4j服务初始化成功
DEBUG 2025-04-30 10:25:55,871 views 21496 12332 ChatAPI实例初始化完成
INFO 2025-04-30 10:25:55,872 views 21496 12332 创建新会话成功 - 会话ID: 1745979955871_8265
INFO 2025-04-30 10:25:55,873 basehttp 21496 12332 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 10:25:56,250 views 21496 11080 ChatAPI实例初始化完成
INFO 2025-04-30 10:25:56,251 views 21496 11080 创建新会话成功 - 会话ID: 1745979956250_9360
INFO 2025-04-30 10:25:56,251 basehttp 21496 11080 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 10:25:56,294 views 21496 16936 ChatAPI实例初始化完成
INFO 2025-04-30 10:25:56,295 views 21496 16936 创建新会话成功 - 会话ID: 1745979956295_1228
INFO 2025-04-30 10:25:56,296 basehttp 21496 16936 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 10:25:56,340 views 21496 23744 ChatAPI实例初始化完成
INFO 2025-04-30 10:25:56,340 views 21496 23744 创建新会话成功 - 会话ID: 1745979956340_1199
INFO 2025-04-30 10:25:56,340 basehttp 21496 23744 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 10:25:58,188 views 21496 10868 Neo4j服务初始化成功
DEBUG 2025-04-30 10:26:00,239 views 21496 10868 ChatAPI实例初始化完成
INFO 2025-04-30 10:26:00,243 views 21496 10868 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:26:00,244 basehttp 21496 10868 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:26:02,572 views 21496 22888 Neo4j服务初始化成功
DEBUG 2025-04-30 10:26:04,603 views 21496 22888 ChatAPI实例初始化完成
INFO 2025-04-30 10:26:04,611 views 21496 22888 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:26:04,611 basehttp 21496 22888 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:26:06,962 views 21496 3920 Neo4j服务初始化成功
DEBUG 2025-04-30 10:26:09,006 views 21496 3920 ChatAPI实例初始化完成
INFO 2025-04-30 10:26:09,006 views 21496 3920 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:26:09,010 basehttp 21496 3920 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:26:11,376 views 21496 14600 Neo4j服务初始化成功
DEBUG 2025-04-30 10:26:13,438 views 21496 14600 ChatAPI实例初始化完成
INFO 2025-04-30 10:26:13,439 views 21496 14600 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:26:13,439 basehttp 21496 14600 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:26:15,751 views 21496 17072 Neo4j服务初始化成功
DEBUG 2025-04-30 10:26:17,801 views 21496 17072 ChatAPI实例初始化完成
INFO 2025-04-30 10:26:17,805 views 21496 17072 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:26:17,809 basehttp 21496 17072 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:26:20,145 views 21496 22108 Neo4j服务初始化成功
DEBUG 2025-04-30 10:26:22,212 views 21496 22108 ChatAPI实例初始化完成
INFO 2025-04-30 10:26:22,224 views 21496 22108 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:26:22,224 basehttp 21496 22108 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:26:24,547 views 21496 16980 Neo4j服务初始化成功
DEBUG 2025-04-30 10:26:26,580 views 21496 16980 ChatAPI实例初始化完成
INFO 2025-04-30 10:26:26,584 views 21496 16980 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:26:26,585 basehttp 21496 16980 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:26:28,917 views 21496 6152 Neo4j服务初始化成功
DEBUG 2025-04-30 10:26:30,961 views 21496 6152 ChatAPI实例初始化完成
INFO 2025-04-30 10:26:30,965 views 21496 6152 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:26:30,965 basehttp 21496 6152 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:27:24,117 views 21496 20292 Neo4j服务初始化成功
DEBUG 2025-04-30 10:27:26,177 views 21496 20292 ChatAPI实例初始化完成
INFO 2025-04-30 10:27:26,193 views 21496 20292 创建新会话成功 - 会话ID: 1745980046177_2499
INFO 2025-04-30 10:27:26,194 basehttp 21496 20292 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 10:27:28,576 views 21496 14060 Neo4j服务初始化成功
DEBUG 2025-04-30 10:27:30,618 views 21496 14060 ChatAPI实例初始化完成
INFO 2025-04-30 10:27:30,622 views 21496 14060 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:27:30,622 basehttp 21496 14060 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:27:32,958 views 21496 24260 Neo4j服务初始化成功
DEBUG 2025-04-30 10:27:35,023 views 21496 24260 ChatAPI实例初始化完成
INFO 2025-04-30 10:27:35,026 views 21496 24260 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:27:35,026 basehttp 21496 24260 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:28:14,577 autoreload 21496 13580 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 10:28:15,441 autoreload 22508 9964 Watching for file changes with StatReloader
INFO 2025-04-30 10:28:27,447 views 22508 24012 Neo4j服务初始化成功
DEBUG 2025-04-30 10:28:29,478 views 22508 24012 ChatAPI实例初始化完成
INFO 2025-04-30 10:28:29,485 views 22508 24012 创建新会话成功 - 会话ID: 1745980109479_6234
INFO 2025-04-30 10:28:29,486 basehttp 22508 24012 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 10:28:30,697 views 22508 11880 Neo4j服务初始化成功
DEBUG 2025-04-30 10:28:32,740 views 22508 11880 ChatAPI实例初始化完成
INFO 2025-04-30 10:28:32,740 views 22508 11880 创建新会话成功 - 会话ID: 1745980112740_5612
INFO 2025-04-30 10:28:32,744 basehttp 22508 11880 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 10:28:35,071 views 22508 22444 Neo4j服务初始化成功
DEBUG 2025-04-30 10:28:37,115 views 22508 22444 ChatAPI实例初始化完成
INFO 2025-04-30 10:28:37,123 views 22508 22444 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:28:37,123 basehttp 22508 22444 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:28:39,466 views 22508 19184 Neo4j服务初始化成功
DEBUG 2025-04-30 10:28:41,529 views 22508 19184 ChatAPI实例初始化完成
INFO 2025-04-30 10:28:41,533 views 22508 19184 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:28:41,533 basehttp 22508 19184 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:30:18,930 views 22508 22316 Neo4j服务初始化成功
DEBUG 2025-04-30 10:30:20,962 views 22508 22316 ChatAPI实例初始化完成
INFO 2025-04-30 10:30:20,963 views 22508 22316 创建新会话成功 - 会话ID: 1745980220963_5199
INFO 2025-04-30 10:30:20,964 basehttp 22508 22316 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 10:30:23,312 views 22508 15640 Neo4j服务初始化成功
DEBUG 2025-04-30 10:30:25,358 views 22508 15640 ChatAPI实例初始化完成
INFO 2025-04-30 10:30:25,362 views 22508 15640 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:30:25,362 basehttp 22508 15640 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:30:27,761 views 22508 12040 Neo4j服务初始化成功
DEBUG 2025-04-30 10:30:29,807 views 22508 12040 ChatAPI实例初始化完成
INFO 2025-04-30 10:30:29,814 views 22508 12040 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:30:29,815 basehttp 22508 12040 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:31:43,953 autoreload 22508 9964 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 10:31:44,721 autoreload 23192 10976 Watching for file changes with StatReloader
INFO 2025-04-30 10:31:48,493 autoreload 23192 10976 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 10:31:49,303 autoreload 9224 17456 Watching for file changes with StatReloader
INFO 2025-04-30 10:32:55,158 autoreload 9224 17456 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 10:32:56,329 autoreload 13088 19020 Watching for file changes with StatReloader
INFO 2025-04-30 10:33:07,303 views 13088 9228 Neo4j服务初始化成功
DEBUG 2025-04-30 10:33:09,334 views 13088 9228 ChatAPI实例初始化完成
INFO 2025-04-30 10:33:09,338 views 13088 9228 创建新会话成功 - 会话ID: 1745980389334_4702
INFO 2025-04-30 10:33:09,338 basehttp 13088 9228 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 10:33:11,651 views 13088 7828 Neo4j服务初始化成功
DEBUG 2025-04-30 10:33:13,689 views 13088 7828 ChatAPI实例初始化完成
INFO 2025-04-30 10:33:13,693 views 13088 7828 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:33:13,693 basehttp 13088 7828 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 10:33:16,029 views 13088 23072 Neo4j服务初始化成功
DEBUG 2025-04-30 10:33:18,073 views 13088 23072 ChatAPI实例初始化完成
INFO 2025-04-30 10:33:18,077 views 13088 23072 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 10:33:18,081 basehttp 13088 23072 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 15:14:08,112 autoreload 9996 6104 Watching for file changes with StatReloader
INFO 2025-04-30 15:32:24,130 views 9996 23424 Neo4j服务初始化成功
DEBUG 2025-04-30 15:32:26,270 views 9996 23424 ChatAPI实例初始化完成
INFO 2025-04-30 15:32:26,276 views 9996 23424 创建新会话成功 - 会话ID: 1745998346270_6054
INFO 2025-04-30 15:32:26,276 basehttp 9996 23424 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 15:32:28,647 views 9996 20768 Neo4j服务初始化成功
DEBUG 2025-04-30 15:32:30,682 views 9996 20768 ChatAPI实例初始化完成
INFO 2025-04-30 15:32:30,685 views 9996 20768 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 15:32:30,689 basehttp 9996 20768 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 15:32:33,041 views 9996 13588 Neo4j服务初始化成功
DEBUG 2025-04-30 15:32:35,083 views 9996 13588 ChatAPI实例初始化完成
INFO 2025-04-30 15:32:35,087 views 9996 13588 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 15:32:35,087 basehttp 9996 13588 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 15:33:23,074 views 9996 20968 Neo4j服务初始化成功
DEBUG 2025-04-30 15:33:25,121 views 9996 20968 ChatAPI实例初始化完成
DEBUG 2025-04-30 15:33:25,123 views 9996 20968 收到stream_chat请求: {'message': ['小麦的叶片有问题'], 'session_id': ['1745998346270_6054']}
DEBUG 2025-04-30 15:33:25,123 views 9996 20968 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 15:33:25,125 views 9996 20968 处理消息: 小麦的叶片有问题, 会话ID: 1745998346270_6054
INFO 2025-04-30 15:33:25,126 views 9996 20968 获取现有会话: 1745998346270_6054
INFO 2025-04-30 15:33:25,126 views 9996 20968 获取会话历史 - 会话ID: 1745998346270_6054, 历史记录数: 0
DEBUG 2025-04-30 15:33:25,127 views 9996 20968 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '小麦的叶片有问题'}]
DEBUG 2025-04-30 15:33:25,128 views 9996 20968 构建的消息列表长度: 2
INFO 2025-04-30 15:33:25,129 views 9996 20968 检查会话状态: 1745998346270_6054
INFO 2025-04-30 15:33:25,129 views 9996 20968 获取现有会话: 1745998346270_6054
INFO 2025-04-30 15:33:25,130 views 9996 20968 从会话获取症状信息 - 会话ID: 1745998346270_6054, 症状: {}
INFO 2025-04-30 15:33:25,130 views 9996 20968 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-30 15:33:25,130 views 9996 20968 创建新会话: 1745998346270_6054
INFO 2025-04-30 15:33:25,131 views 9996 20968 当前症状收集状态: {'1745998346270_6054': {'collecting': True, 'symptoms': {}}}
DEBUG 2025-04-30 15:33:25,131 views 9996 20968 当前症状信息: {}
DEBUG 2025-04-30 15:33:25,131 views 9996 20968 开始提取症状，输入消息: 小麦的叶片有问题
DEBUG 2025-04-30 15:33:25,132 views 9996 20968 分句结果: ['小麦的叶片有问题', '小麦的叶片有问题']
DEBUG 2025-04-30 15:33:25,132 views 9996 20968 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 15:33:25,132 views 9996 20968 提取到的气象条件: []
DEBUG 2025-04-30 15:33:25,132 views 9996 20968 提取到的生育期: []
DEBUG 2025-04-30 15:33:25,133 views 9996 20968 提取到的种植区: []
DEBUG 2025-04-30 15:33:25,133 views 9996 20968 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 15:33:25,133 views 9996 20968 提取到的气象条件: []
DEBUG 2025-04-30 15:33:25,133 views 9996 20968 提取到的生育期: []
DEBUG 2025-04-30 15:33:25,133 views 9996 20968 提取到的种植区: []
INFO 2025-04-30 15:33:25,134 views 9996 20968 症状提取结果: {'plant_part': '叶片'}
INFO 2025-04-30 15:33:25,134 views 9996 20968 开始更新症状信息 - 会话ID: 1745998346270_6054, 新症状: {'plant_part': '叶片'}
INFO 2025-04-30 15:33:25,134 views 9996 20968 获取现有会话: 1745998346270_6054
INFO 2025-04-30 15:33:25,135 views 9996 20968 从会话获取症状信息 - 会话ID: 1745998346270_6054, 症状: {}
INFO 2025-04-30 15:33:25,135 views 9996 20968 当前症状信息 - 会话ID: 1745998346270_6054, 症状: {}
INFO 2025-04-30 15:33:25,135 views 9996 20968 更新症状类别 - 会话ID: 1745998346270_6054, 类别: plant_part, 值: 叶片
INFO 2025-04-30 15:33:25,135 views 9996 20968 获取现有会话: 1745998346270_6054
INFO 2025-04-30 15:33:25,136 views 9996 20968 会话已保存到 Redis: 1745998346270_6054
INFO 2025-04-30 15:33:25,136 views 9996 20968 症状信息已保存到会话 - 会话ID: 1745998346270_6054, 症状: {'plant_part': '叶片'}
INFO 2025-04-30 15:33:25,136 views 9996 20968 症状信息更新完成 - 会话ID: 1745998346270_6054, 最终症状: {'plant_part': '叶片'}
INFO 2025-04-30 15:33:25,136 views 9996 20968 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-30 15:33:25,137 views 9996 20968 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 种植区

INFO 2025-04-30 15:33:27,782 services 9996 20968 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 15:33:27,782 services 9996 20968 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 15:33:27,783 services 9996 20968 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 15:33:28,146 services 9996 20968 查询结果: <neo4j._sync.work.result.Result object at 0x00000219D0F739E0>
DEBUG 2025-04-30 15:33:49,970 views 9996 20968 添加历史记录成功 - 会话ID: 1745998346270_6054, 角色: user
DEBUG 2025-04-30 15:33:49,971 views 9996 20968 添加历史记录成功 - 会话ID: 1745998346270_6054, 角色: assistant
INFO 2025-04-30 15:33:49,971 basehttp 9996 20968 "GET /api/chat/stream_chat/?message=%E5%B0%8F%E9%BA%A6%E7%9A%84%E5%8F%B6%E7%89%87%E6%9C%89%E9%97%AE%E9%A2%98&session_id=1745998346270_6054 HTTP/1.1" 200 5179
INFO 2025-04-30 15:33:52,489 views 9996 23908 Neo4j服务初始化成功
DEBUG 2025-04-30 15:33:54,536 views 9996 23908 ChatAPI实例初始化完成
INFO 2025-04-30 15:33:54,545 views 9996 23908 获取所有历史会话 - 会话数: 2
INFO 2025-04-30 15:33:54,546 basehttp 9996 23908 "GET /api/chat/get_history/ HTTP/1.1" 200 841
INFO 2025-04-30 15:34:31,086 views 9996 17292 Neo4j服务初始化成功
DEBUG 2025-04-30 15:34:33,139 views 9996 17292 ChatAPI实例初始化完成
INFO 2025-04-30 15:34:33,139 views 9996 17292 创建新会话成功 - 会话ID: 1745998473139_6022
INFO 2025-04-30 15:34:33,139 basehttp 9996 17292 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 15:34:35,466 views 9996 20528 Neo4j服务初始化成功
DEBUG 2025-04-30 15:34:37,519 views 9996 20528 ChatAPI实例初始化完成
INFO 2025-04-30 15:34:37,523 views 9996 20528 获取所有历史会话 - 会话数: 2
INFO 2025-04-30 15:34:37,524 basehttp 9996 20528 "GET /api/chat/get_history/ HTTP/1.1" 200 841
INFO 2025-04-30 15:34:39,847 views 9996 4128 Neo4j服务初始化成功
DEBUG 2025-04-30 15:34:41,876 views 9996 4128 ChatAPI实例初始化完成
INFO 2025-04-30 15:34:41,880 views 9996 4128 获取所有历史会话 - 会话数: 2
INFO 2025-04-30 15:34:41,880 basehttp 9996 4128 "GET /api/chat/get_history/ HTTP/1.1" 200 841
INFO 2025-04-30 15:35:04,616 views 9996 7556 Neo4j服务初始化成功
INFO 2025-04-30 15:35:05,529 views 9996 12192 Neo4j服务初始化成功
DEBUG 2025-04-30 15:35:06,642 views 9996 7556 ChatAPI实例初始化完成
INFO 2025-04-30 15:35:06,643 basehttp 9996 7556 "GET /api/chat/get_session_history/?session_id=1745998346270_6054 HTTP/1.1" 200 2517
DEBUG 2025-04-30 15:35:07,593 views 9996 12192 ChatAPI实例初始化完成
INFO 2025-04-30 15:35:07,594 basehttp 9996 12192 "GET /api/chat/get_session_history/?session_id=1745944034531_7037 HTTP/1.1" 200 3161
INFO 2025-04-30 15:35:08,994 views 9996 15216 Neo4j服务初始化成功
INFO 2025-04-30 15:35:09,934 views 9996 22920 Neo4j服务初始化成功
DEBUG 2025-04-30 15:35:11,020 views 9996 15216 ChatAPI实例初始化完成
INFO 2025-04-30 15:35:11,022 basehttp 9996 15216 "GET /api/chat/get_session_history/?session_id=1745998346270_6054 HTTP/1.1" 200 2517
DEBUG 2025-04-30 15:35:11,986 views 9996 22920 ChatAPI实例初始化完成
INFO 2025-04-30 15:35:11,988 basehttp 9996 22920 "GET /api/chat/get_session_history/?session_id=1745944034531_7037 HTTP/1.1" 200 3161
INFO 2025-04-30 15:35:13,355 views 9996 17224 Neo4j服务初始化成功
DEBUG 2025-04-30 15:35:15,409 views 9996 17224 ChatAPI实例初始化完成
INFO 2025-04-30 15:35:15,410 basehttp 9996 17224 "GET /api/chat/get_session_history/?session_id=1745998346270_6054 HTTP/1.1" 200 2517
INFO 2025-04-30 15:35:19,824 views 9996 19412 Neo4j服务初始化成功
DEBUG 2025-04-30 15:35:21,865 views 9996 19412 ChatAPI实例初始化完成
INFO 2025-04-30 15:35:21,869 basehttp 9996 19412 "GET /api/chat/get_session_history/?session_id=1745944034531_7037 HTTP/1.1" 200 3161
INFO 2025-04-30 15:35:32,078 views 9996 10884 Neo4j服务初始化成功
DEBUG 2025-04-30 15:35:34,140 views 9996 10884 ChatAPI实例初始化完成
INFO 2025-04-30 15:35:34,141 views 9996 10884 已清除会话 1745998346270_6054 的所有信息
INFO 2025-04-30 15:35:34,142 basehttp 9996 10884 "POST /api/chat/clear_history/ HTTP/1.1" 200 13
INFO 2025-04-30 15:36:54,727 views 9996 23036 Neo4j服务初始化成功
DEBUG 2025-04-30 15:36:56,769 views 9996 23036 ChatAPI实例初始化完成
INFO 2025-04-30 15:36:56,770 views 9996 23036 创建新会话成功 - 会话ID: 1745998616770_3662
INFO 2025-04-30 15:36:56,771 basehttp 9996 23036 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 15:36:59,097 views 9996 23376 Neo4j服务初始化成功
DEBUG 2025-04-30 15:37:01,120 views 9996 23376 ChatAPI实例初始化完成
INFO 2025-04-30 15:37:01,124 views 9996 23376 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 15:37:01,125 basehttp 9996 23376 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 15:37:03,446 views 9996 2620 Neo4j服务初始化成功
DEBUG 2025-04-30 15:37:05,500 views 9996 2620 ChatAPI实例初始化完成
INFO 2025-04-30 15:37:05,504 views 9996 2620 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 15:37:05,504 basehttp 9996 2620 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 15:37:25,162 autoreload 9996 6104 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 15:37:26,006 autoreload 11168 5596 Watching for file changes with StatReloader
INFO 2025-04-30 15:38:23,182 autoreload 11168 5596 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 15:38:24,069 autoreload 5588 6200 Watching for file changes with StatReloader
INFO 2025-04-30 15:39:39,646 views 5588 5504 Neo4j服务初始化成功
DEBUG 2025-04-30 15:39:41,706 views 5588 5504 ChatAPI实例初始化完成
INFO 2025-04-30 15:39:41,712 views 5588 5504 创建新会话成功 - 会话ID: 1745998781707_6428
INFO 2025-04-30 15:39:41,713 basehttp 5588 5504 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 15:39:44,040 views 5588 5504 Neo4j服务初始化成功
DEBUG 2025-04-30 15:39:46,066 views 5588 5504 ChatAPI实例初始化完成
INFO 2025-04-30 15:39:46,072 views 5588 5504 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 15:39:46,072 basehttp 5588 5504 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 15:39:48,389 views 5588 5504 Neo4j服务初始化成功
DEBUG 2025-04-30 15:39:50,421 views 5588 5504 ChatAPI实例初始化完成
INFO 2025-04-30 15:39:50,435 views 5588 5504 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 15:39:50,435 basehttp 5588 5504 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 15:40:59,299 views 5588 5504 Neo4j服务初始化成功
DEBUG 2025-04-30 15:41:01,337 views 5588 5504 ChatAPI实例初始化完成
INFO 2025-04-30 15:41:01,338 views 5588 5504 创建新会话成功 - 会话ID: 1745998861338_7974
INFO 2025-04-30 15:41:01,338 basehttp 5588 5504 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 15:41:03,762 views 5588 5504 Neo4j服务初始化成功
INFO 2025-04-30 15:41:03,812 views 5588 9140 Neo4j服务初始化成功
DEBUG 2025-04-30 15:41:05,806 views 5588 5504 ChatAPI实例初始化完成
INFO 2025-04-30 15:41:05,810 views 5588 5504 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 15:41:05,810 basehttp 5588 5504 "GET /api/chat/get_history/ HTTP/1.1" 200 450
DEBUG 2025-04-30 15:41:05,836 views 5588 9140 ChatAPI实例初始化完成
INFO 2025-04-30 15:41:05,837 views 5588 9140 创建新会话成功 - 会话ID: 1745998865837_7231
INFO 2025-04-30 15:41:05,837 basehttp 5588 9140 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 15:41:08,145 views 5588 5504 Neo4j服务初始化成功
DEBUG 2025-04-30 15:41:10,193 views 5588 5504 ChatAPI实例初始化完成
INFO 2025-04-30 15:41:10,198 views 5588 5504 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 15:41:10,198 basehttp 5588 5504 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 15:41:12,533 views 5588 9140 Neo4j服务初始化成功
DEBUG 2025-04-30 15:41:14,585 views 5588 9140 ChatAPI实例初始化完成
INFO 2025-04-30 15:41:14,589 views 5588 9140 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 15:41:14,589 basehttp 5588 9140 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 15:41:16,932 views 5588 9140 Neo4j服务初始化成功
DEBUG 2025-04-30 15:41:18,977 views 5588 9140 ChatAPI实例初始化完成
INFO 2025-04-30 15:41:18,981 views 5588 9140 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 15:41:18,985 basehttp 5588 9140 "GET /api/chat/get_history/ HTTP/1.1" 200 450
INFO 2025-04-30 15:41:20,293 views 5588 5504 Neo4j服务初始化成功
DEBUG 2025-04-30 15:41:22,364 views 5588 5504 ChatAPI实例初始化完成
INFO 2025-04-30 15:41:22,364 basehttp 5588 5504 "GET /api/chat/get_session_history/?session_id=1745944034531_7037 HTTP/1.1" 200 3161
INFO 2025-04-30 15:41:52,176 basehttp 5588 5504 "OPTIONS /api/chat/clear_history/ HTTP/1.1" 200 0
INFO 2025-04-30 15:41:54,489 views 5588 5504 Neo4j服务初始化成功
DEBUG 2025-04-30 15:41:56,516 views 5588 5504 ChatAPI实例初始化完成
INFO 2025-04-30 15:41:56,517 views 5588 5504 已清除会话 1745944034531_7037 的所有信息
INFO 2025-04-30 15:41:56,518 basehttp 5588 5504 "POST /api/chat/clear_history/ HTTP/1.1" 200 108
INFO 2025-04-30 15:41:58,836 views 5588 5504 Neo4j服务初始化成功
DEBUG 2025-04-30 15:42:00,871 views 5588 5504 ChatAPI实例初始化完成
INFO 2025-04-30 15:42:00,876 views 5588 5504 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 15:42:00,876 basehttp 5588 5504 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-30 15:42:01,149 views 5588 9140 Neo4j服务初始化成功
DEBUG 2025-04-30 15:42:03,193 views 5588 9140 ChatAPI实例初始化完成
INFO 2025-04-30 15:42:03,194 basehttp 5588 9140 "GET /api/chat/get_session_history/?session_id=1745944034531_7037 HTTP/1.1" 200 53
INFO 2025-04-30 15:43:26,570 views 5588 9140 Neo4j服务初始化成功
INFO 2025-04-30 15:43:26,570 views 5588 5504 Neo4j服务初始化成功
DEBUG 2025-04-30 15:43:28,636 views 5588 9140 ChatAPI实例初始化完成
INFO 2025-04-30 15:43:28,640 views 5588 9140 创建新会话成功 - 会话ID: 1745999008636_9640
INFO 2025-04-30 15:43:28,641 basehttp 5588 9140 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 15:43:28,648 views 5588 5504 ChatAPI实例初始化完成
INFO 2025-04-30 15:43:28,650 views 5588 5504 创建新会话成功 - 会话ID: 1745999008649_6035
INFO 2025-04-30 15:43:28,652 basehttp 5588 5504 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 15:43:30,957 views 5588 5504 Neo4j服务初始化成功
DEBUG 2025-04-30 15:43:33,001 views 5588 5504 ChatAPI实例初始化完成
INFO 2025-04-30 15:43:33,005 views 5588 5504 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 15:43:33,005 basehttp 5588 5504 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-30 15:43:35,332 views 5588 9140 Neo4j服务初始化成功
DEBUG 2025-04-30 15:43:37,390 views 5588 9140 ChatAPI实例初始化完成
INFO 2025-04-30 15:43:37,398 views 5588 9140 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 15:43:37,399 basehttp 5588 9140 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-30 15:43:39,731 views 5588 5504 Neo4j服务初始化成功
DEBUG 2025-04-30 15:43:41,795 views 5588 5504 ChatAPI实例初始化完成
INFO 2025-04-30 15:43:41,808 views 5588 5504 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 15:43:41,808 basehttp 5588 5504 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-30 15:43:44,138 views 5588 9140 Neo4j服务初始化成功
DEBUG 2025-04-30 15:43:46,188 views 5588 9140 ChatAPI实例初始化完成
INFO 2025-04-30 15:43:46,195 views 5588 9140 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 15:43:46,196 basehttp 5588 9140 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-30 15:44:53,304 views 5588 9140 Neo4j服务初始化成功
DEBUG 2025-04-30 15:44:55,360 views 5588 9140 ChatAPI实例初始化完成
INFO 2025-04-30 15:44:55,365 views 5588 9140 创建新会话成功 - 会话ID: 1745999095365_9394
INFO 2025-04-30 15:44:55,369 basehttp 5588 9140 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 15:44:57,729 views 5588 9140 Neo4j服务初始化成功
DEBUG 2025-04-30 15:44:59,755 views 5588 9140 ChatAPI实例初始化完成
INFO 2025-04-30 15:44:59,761 views 5588 9140 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 15:44:59,762 basehttp 5588 9140 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-30 15:45:02,096 views 5588 9140 Neo4j服务初始化成功
DEBUG 2025-04-30 15:45:04,119 views 5588 9140 ChatAPI实例初始化完成
INFO 2025-04-30 15:45:04,122 views 5588 9140 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 15:45:04,122 basehttp 5588 9140 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-30 15:45:24,411 views 5588 9140 Neo4j服务初始化成功
DEBUG 2025-04-30 15:45:26,440 views 5588 9140 ChatAPI实例初始化完成
INFO 2025-04-30 15:45:26,441 views 5588 9140 创建新会话成功 - 会话ID: 1745999126441_1066
INFO 2025-04-30 15:45:26,441 basehttp 5588 9140 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 15:45:26,596 views 5588 5504 Neo4j服务初始化成功
DEBUG 2025-04-30 15:45:28,643 views 5588 5504 ChatAPI实例初始化完成
INFO 2025-04-30 15:45:28,643 views 5588 5504 创建新会话成功 - 会话ID: 1745999128643_2088
INFO 2025-04-30 15:45:28,644 basehttp 5588 5504 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 15:45:28,793 views 5588 9140 Neo4j服务初始化成功
INFO 2025-04-30 15:45:29,341 views 5588 17220 Neo4j服务初始化成功
DEBUG 2025-04-30 15:45:30,834 views 5588 9140 ChatAPI实例初始化完成
INFO 2025-04-30 15:45:30,839 views 5588 9140 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 15:45:30,840 basehttp 5588 9140 "GET /api/chat/get_history/ HTTP/1.1" 200 37
DEBUG 2025-04-30 15:45:31,399 views 5588 17220 ChatAPI实例初始化完成
INFO 2025-04-30 15:45:31,400 views 5588 17220 创建新会话成功 - 会话ID: 1745999131399_9950
INFO 2025-04-30 15:45:31,400 basehttp 5588 17220 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 15:45:33,218 views 5588 5504 Neo4j服务初始化成功
DEBUG 2025-04-30 15:45:35,276 views 5588 5504 ChatAPI实例初始化完成
INFO 2025-04-30 15:45:35,281 views 5588 5504 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 15:45:35,283 basehttp 5588 5504 - Broken pipe from ('127.0.0.1', 53041)
INFO 2025-04-30 15:45:36,121 views 5588 19952 Neo4j服务初始化成功
DEBUG 2025-04-30 15:45:38,182 views 5588 19952 ChatAPI实例初始化完成
INFO 2025-04-30 15:45:38,183 views 5588 19952 创建新会话成功 - 会话ID: 1745999138182_5170
INFO 2025-04-30 15:45:38,183 basehttp 5588 19952 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 15:45:40,510 views 5588 19952 Neo4j服务初始化成功
DEBUG 2025-04-30 15:45:42,565 views 5588 19952 ChatAPI实例初始化完成
INFO 2025-04-30 15:45:42,569 views 5588 19952 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 15:45:42,571 basehttp 5588 19952 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-30 15:45:44,870 views 5588 19952 Neo4j服务初始化成功
DEBUG 2025-04-30 15:45:46,925 views 5588 19952 ChatAPI实例初始化完成
INFO 2025-04-30 15:45:46,929 views 5588 19952 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 15:45:46,933 basehttp 5588 19952 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-30 15:46:09,920 views 5588 11528 Neo4j服务初始化成功
DEBUG 2025-04-30 15:46:11,960 views 5588 11528 ChatAPI实例初始化完成
DEBUG 2025-04-30 15:46:11,960 views 5588 11528 收到stream_chat请求: {'message': ['我的小麦的叶片上出现了很多问题'], 'session_id': ['1745999138182_5170']}
DEBUG 2025-04-30 15:46:11,960 views 5588 11528 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 15:46:11,960 views 5588 11528 处理消息: 我的小麦的叶片上出现了很多问题, 会话ID: 1745999138182_5170
INFO 2025-04-30 15:46:11,960 views 5588 11528 获取现有会话: 1745999138182_5170
INFO 2025-04-30 15:46:11,960 views 5588 11528 获取会话历史 - 会话ID: 1745999138182_5170, 历史记录数: 0
DEBUG 2025-04-30 15:46:11,960 views 5588 11528 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦的叶片上出现了很多问题'}]
DEBUG 2025-04-30 15:46:11,960 views 5588 11528 构建的消息列表长度: 2
INFO 2025-04-30 15:46:11,964 views 5588 11528 检查会话状态: 1745999138182_5170
INFO 2025-04-30 15:46:11,964 views 5588 11528 获取现有会话: 1745999138182_5170
INFO 2025-04-30 15:46:11,964 views 5588 11528 从会话获取症状信息 - 会话ID: 1745999138182_5170, 症状: {}
INFO 2025-04-30 15:46:11,964 views 5588 11528 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-30 15:46:11,965 views 5588 11528 创建新会话: 1745999138182_5170
INFO 2025-04-30 15:46:11,965 views 5588 11528 当前症状收集状态: {'1745999138182_5170': {'collecting': True, 'symptoms': {}}}
DEBUG 2025-04-30 15:46:11,965 views 5588 11528 当前症状信息: {}
DEBUG 2025-04-30 15:46:11,965 views 5588 11528 开始提取症状，输入消息: 我的小麦的叶片上出现了很多问题
DEBUG 2025-04-30 15:46:11,965 views 5588 11528 分句结果: ['我的小麦的叶片上出现了很多问题', '我的小麦的叶片上出现了很多问题']
DEBUG 2025-04-30 15:46:11,966 views 5588 11528 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 15:46:11,966 views 5588 11528 提取到的气象条件: []
DEBUG 2025-04-30 15:46:11,966 views 5588 11528 提取到的生育期: []
DEBUG 2025-04-30 15:46:11,967 views 5588 11528 提取到的种植区: []
DEBUG 2025-04-30 15:46:11,967 views 5588 11528 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 15:46:11,967 views 5588 11528 提取到的气象条件: []
DEBUG 2025-04-30 15:46:11,967 views 5588 11528 提取到的生育期: []
DEBUG 2025-04-30 15:46:11,968 views 5588 11528 提取到的种植区: []
INFO 2025-04-30 15:46:11,968 views 5588 11528 症状提取结果: {'plant_part': '叶片'}
INFO 2025-04-30 15:46:11,968 views 5588 11528 开始更新症状信息 - 会话ID: 1745999138182_5170, 新症状: {'plant_part': '叶片'}
INFO 2025-04-30 15:46:11,968 views 5588 11528 获取现有会话: 1745999138182_5170
INFO 2025-04-30 15:46:11,970 views 5588 11528 从会话获取症状信息 - 会话ID: 1745999138182_5170, 症状: {}
INFO 2025-04-30 15:46:11,970 views 5588 11528 当前症状信息 - 会话ID: 1745999138182_5170, 症状: {}
INFO 2025-04-30 15:46:11,970 views 5588 11528 更新症状类别 - 会话ID: 1745999138182_5170, 类别: plant_part, 值: 叶片
INFO 2025-04-30 15:46:11,971 views 5588 11528 获取现有会话: 1745999138182_5170
INFO 2025-04-30 15:46:11,971 views 5588 11528 会话已保存到 Redis: 1745999138182_5170
INFO 2025-04-30 15:46:11,971 views 5588 11528 症状信息已保存到会话 - 会话ID: 1745999138182_5170, 症状: {'plant_part': '叶片'}
INFO 2025-04-30 15:46:11,972 views 5588 11528 症状信息更新完成 - 会话ID: 1745999138182_5170, 最终症状: {'plant_part': '叶片'}
INFO 2025-04-30 15:46:11,972 views 5588 11528 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-30 15:46:11,972 views 5588 11528 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 种植区

INFO 2025-04-30 15:46:14,620 services 5588 11528 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 15:46:14,621 services 5588 11528 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 15:46:14,621 services 5588 11528 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 15:46:14,633 services 5588 11528 查询结果: <neo4j._sync.work.result.Result object at 0x000001D7E01BC6E0>
DEBUG 2025-04-30 15:46:36,490 views 5588 11528 添加历史记录成功 - 会话ID: 1745999138182_5170, 角色: user
DEBUG 2025-04-30 15:46:36,491 views 5588 11528 添加历史记录成功 - 会话ID: 1745999138182_5170, 角色: assistant
INFO 2025-04-30 15:46:36,491 basehttp 5588 11528 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E7%9A%84%E5%8F%B6%E7%89%87%E4%B8%8A%E5%87%BA%E7%8E%B0%E4%BA%86%E5%BE%88%E5%A4%9A%E9%97%AE%E9%A2%98&session_id=1745999138182_5170 HTTP/1.1" 200 5179
INFO 2025-04-30 15:46:39,019 views 5588 19952 Neo4j服务初始化成功
DEBUG 2025-04-30 15:46:41,063 views 5588 19952 ChatAPI实例初始化完成
INFO 2025-04-30 15:46:41,071 views 5588 19952 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 15:46:41,071 basehttp 5588 19952 "GET /api/chat/get_history/ HTTP/1.1" 200 426
INFO 2025-04-30 15:49:28,827 views 5588 17472 Neo4j服务初始化成功
DEBUG 2025-04-30 15:49:30,899 views 5588 17472 ChatAPI实例初始化完成
INFO 2025-04-30 15:49:30,900 views 5588 17472 创建新会话成功 - 会话ID: 1745999370900_7251
INFO 2025-04-30 15:49:30,900 basehttp 5588 17472 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 15:49:33,204 views 5588 17472 Neo4j服务初始化成功
DEBUG 2025-04-30 15:49:35,271 views 5588 17472 ChatAPI实例初始化完成
INFO 2025-04-30 15:49:35,283 views 5588 17472 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 15:49:35,284 basehttp 5588 17472 "GET /api/chat/get_history/ HTTP/1.1" 200 426
INFO 2025-04-30 15:49:37,597 views 5588 17472 Neo4j服务初始化成功
DEBUG 2025-04-30 15:49:39,635 views 5588 17472 ChatAPI实例初始化完成
INFO 2025-04-30 15:49:39,640 views 5588 17472 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 15:49:39,641 basehttp 5588 17472 "GET /api/chat/get_history/ HTTP/1.1" 200 426
INFO 2025-04-30 15:50:31,408 views 5588 17472 Neo4j服务初始化成功
DEBUG 2025-04-30 15:50:33,431 views 5588 17472 ChatAPI实例初始化完成
INFO 2025-04-30 15:50:33,432 views 5588 17472 创建新会话成功 - 会话ID: 1745999433431_4820
INFO 2025-04-30 15:50:33,432 basehttp 5588 17472 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 15:50:35,748 views 5588 17472 Neo4j服务初始化成功
DEBUG 2025-04-30 15:50:37,782 views 5588 17472 ChatAPI实例初始化完成
INFO 2025-04-30 15:50:37,786 views 5588 17472 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 15:50:37,786 basehttp 5588 17472 "GET /api/chat/get_history/ HTTP/1.1" 200 426
INFO 2025-04-30 15:50:40,090 views 5588 17472 Neo4j服务初始化成功
DEBUG 2025-04-30 15:50:42,124 views 5588 17472 ChatAPI实例初始化完成
INFO 2025-04-30 15:50:42,129 views 5588 17472 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 15:50:42,130 basehttp 5588 17472 "GET /api/chat/get_history/ HTTP/1.1" 200 426
INFO 2025-04-30 15:50:46,144 views 5588 17472 Neo4j服务初始化成功
DEBUG 2025-04-30 15:50:48,189 views 5588 17472 ChatAPI实例初始化完成
INFO 2025-04-30 15:50:48,190 views 5588 17472 创建新会话成功 - 会话ID: 1745999448190_8537
INFO 2025-04-30 15:50:48,190 basehttp 5588 17472 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 15:50:50,527 views 5588 17472 Neo4j服务初始化成功
DEBUG 2025-04-30 15:50:52,560 views 5588 17472 ChatAPI实例初始化完成
INFO 2025-04-30 15:50:52,569 views 5588 17472 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 15:50:52,569 basehttp 5588 17472 "GET /api/chat/get_history/ HTTP/1.1" 200 426
INFO 2025-04-30 15:50:54,914 views 5588 17472 Neo4j服务初始化成功
INFO 2025-04-30 15:50:56,592 views 5588 17516 Neo4j服务初始化成功
DEBUG 2025-04-30 15:50:56,955 views 5588 17472 ChatAPI实例初始化完成
INFO 2025-04-30 15:50:56,962 views 5588 17472 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 15:50:56,963 basehttp 5588 17472 "GET /api/chat/get_history/ HTTP/1.1" 200 426
DEBUG 2025-04-30 15:50:58,625 views 5588 17516 ChatAPI实例初始化完成
INFO 2025-04-30 15:50:58,625 basehttp 5588 17516 "GET /api/chat/get_session_history/?session_id=1745999138182_5170 HTTP/1.1" 200 2559
INFO 2025-04-30 15:51:51,513 autoreload 5588 6200 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 15:51:52,559 autoreload 16912 7256 Watching for file changes with StatReloader
INFO 2025-04-30 15:51:57,841 autoreload 16912 7256 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 15:51:58,721 autoreload 19416 13088 Watching for file changes with StatReloader
INFO 2025-04-30 15:52:09,016 autoreload 19416 13088 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 15:52:09,858 autoreload 20564 17580 Watching for file changes with StatReloader
INFO 2025-04-30 15:52:20,727 autoreload 20564 17580 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 15:52:21,570 autoreload 20216 12768 Watching for file changes with StatReloader
INFO 2025-04-30 15:52:25,715 autoreload 20216 12768 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 15:52:26,545 autoreload 16176 13160 Watching for file changes with StatReloader
INFO 2025-04-30 15:52:30,506 autoreload 16176 13160 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 15:52:31,316 autoreload 13056 18540 Watching for file changes with StatReloader
INFO 2025-04-30 15:52:41,714 views 13056 23472 Neo4j服务初始化成功
DEBUG 2025-04-30 15:52:43,770 views 13056 23472 ChatAPI实例初始化完成
INFO 2025-04-30 15:52:43,773 views 13056 23472 创建新会话成功 - 会话ID: 1745999563770_8892
INFO 2025-04-30 15:52:43,776 basehttp 13056 23472 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 15:52:46,084 views 13056 23472 Neo4j服务初始化成功
DEBUG 2025-04-30 15:52:48,144 views 13056 23472 ChatAPI实例初始化完成
INFO 2025-04-30 15:52:48,149 views 13056 23472 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 15:52:48,150 basehttp 13056 23472 "GET /api/chat/get_history/ HTTP/1.1" 200 427
INFO 2025-04-30 15:52:50,485 views 13056 23472 Neo4j服务初始化成功
DEBUG 2025-04-30 15:52:52,529 views 13056 23472 ChatAPI实例初始化完成
INFO 2025-04-30 15:52:52,535 views 13056 23472 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 15:52:52,536 basehttp 13056 23472 "GET /api/chat/get_history/ HTTP/1.1" 200 427
INFO 2025-04-30 15:52:55,276 views 13056 23472 Neo4j服务初始化成功
DEBUG 2025-04-30 15:52:57,308 views 13056 23472 ChatAPI实例初始化完成
INFO 2025-04-30 15:52:57,308 basehttp 13056 23472 "GET /api/chat/get_session_history/?session_id=1745999138182_5170 HTTP/1.1" 200 2559
INFO 2025-04-30 15:53:12,812 views 13056 23472 Neo4j服务初始化成功
DEBUG 2025-04-30 15:53:14,853 views 13056 23472 ChatAPI实例初始化完成
INFO 2025-04-30 15:53:14,853 views 13056 23472 已清除会话 1745999138182_5170 的所有信息
INFO 2025-04-30 15:53:14,853 basehttp 13056 23472 "POST /api/chat/clear_history/ HTTP/1.1" 200 108
INFO 2025-04-30 15:53:17,171 views 13056 23472 Neo4j服务初始化成功
DEBUG 2025-04-30 15:53:19,230 views 13056 23472 ChatAPI实例初始化完成
INFO 2025-04-30 15:53:19,242 views 13056 23472 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 15:53:19,242 basehttp 13056 23472 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-30 15:53:22,601 views 13056 23472 Neo4j服务初始化成功
INFO 2025-04-30 15:53:24,486 views 13056 10256 Neo4j服务初始化成功
DEBUG 2025-04-30 15:53:24,652 views 13056 23472 ChatAPI实例初始化完成
INFO 2025-04-30 15:53:24,653 views 13056 23472 创建新会话成功 - 会话ID: 1745999604653_3903
INFO 2025-04-30 15:53:24,653 basehttp 13056 23472 - Broken pipe from ('127.0.0.1', 53849)
DEBUG 2025-04-30 15:53:26,549 views 13056 10256 ChatAPI实例初始化完成
INFO 2025-04-30 15:53:26,550 views 13056 10256 创建新会话成功 - 会话ID: 1745999606549_6123
INFO 2025-04-30 15:53:26,550 basehttp 13056 10256 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 15:53:28,880 views 13056 10256 Neo4j服务初始化成功
DEBUG 2025-04-30 15:53:30,945 views 13056 10256 ChatAPI实例初始化完成
INFO 2025-04-30 15:53:30,952 views 13056 10256 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 15:53:30,952 basehttp 13056 10256 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-30 15:53:33,263 views 13056 10256 Neo4j服务初始化成功
DEBUG 2025-04-30 15:53:35,326 views 13056 10256 ChatAPI实例初始化完成
INFO 2025-04-30 15:53:35,330 views 13056 10256 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 15:53:35,330 basehttp 13056 10256 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-30 15:53:55,976 views 13056 8696 Neo4j服务初始化成功
DEBUG 2025-04-30 15:53:58,046 views 13056 8696 ChatAPI实例初始化完成
DEBUG 2025-04-30 15:53:58,046 views 13056 8696 收到stream_chat请求: {'message': ['你好，我的小麦叶片出现了问题'], 'session_id': ['1745999606549_6123']}
DEBUG 2025-04-30 15:53:58,046 views 13056 8696 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 15:53:58,046 views 13056 8696 处理消息: 你好，我的小麦叶片出现了问题, 会话ID: 1745999606549_6123
INFO 2025-04-30 15:53:58,050 views 13056 8696 获取现有会话: 1745999606549_6123
INFO 2025-04-30 15:53:58,050 views 13056 8696 获取会话历史 - 会话ID: 1745999606549_6123, 历史记录数: 0
DEBUG 2025-04-30 15:53:58,050 views 13056 8696 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好，我的小麦叶片出现了问题'}]
DEBUG 2025-04-30 15:53:58,051 views 13056 8696 构建的消息列表长度: 2
INFO 2025-04-30 15:53:58,051 views 13056 8696 检查会话状态: 1745999606549_6123
INFO 2025-04-30 15:53:58,051 views 13056 8696 获取现有会话: 1745999606549_6123
INFO 2025-04-30 15:53:58,053 views 13056 8696 从会话获取症状信息 - 会话ID: 1745999606549_6123, 症状: {}
INFO 2025-04-30 15:53:58,053 views 13056 8696 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-30 15:53:58,053 views 13056 8696 创建新会话: 1745999606549_6123
INFO 2025-04-30 15:53:58,053 views 13056 8696 当前症状收集状态: {'1745999606549_6123': {'collecting': True, 'symptoms': {}}}
DEBUG 2025-04-30 15:53:58,053 views 13056 8696 当前症状信息: {}
DEBUG 2025-04-30 15:53:58,054 views 13056 8696 开始提取症状，输入消息: 你好，我的小麦叶片出现了问题
DEBUG 2025-04-30 15:53:58,054 views 13056 8696 分句结果: ['你好', '我的小麦叶片出现了问题', '你好，我的小麦叶片出现了问题']
DEBUG 2025-04-30 15:53:58,054 views 13056 8696 提取到的发病部位: []
DEBUG 2025-04-30 15:53:58,055 views 13056 8696 提取到的气象条件: []
DEBUG 2025-04-30 15:53:58,055 views 13056 8696 提取到的生育期: []
DEBUG 2025-04-30 15:53:58,055 views 13056 8696 提取到的种植区: []
DEBUG 2025-04-30 15:53:58,055 views 13056 8696 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 15:53:58,056 views 13056 8696 提取到的气象条件: []
DEBUG 2025-04-30 15:53:58,056 views 13056 8696 提取到的生育期: []
DEBUG 2025-04-30 15:53:58,056 views 13056 8696 提取到的种植区: []
DEBUG 2025-04-30 15:53:58,056 views 13056 8696 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 15:53:58,056 views 13056 8696 提取到的气象条件: []
DEBUG 2025-04-30 15:53:58,057 views 13056 8696 提取到的生育期: []
DEBUG 2025-04-30 15:53:58,057 views 13056 8696 提取到的种植区: []
INFO 2025-04-30 15:53:58,057 views 13056 8696 症状提取结果: {'plant_part': '叶片'}
INFO 2025-04-30 15:53:58,057 views 13056 8696 开始更新症状信息 - 会话ID: 1745999606549_6123, 新症状: {'plant_part': '叶片'}
INFO 2025-04-30 15:53:58,058 views 13056 8696 获取现有会话: 1745999606549_6123
INFO 2025-04-30 15:53:58,058 views 13056 8696 从会话获取症状信息 - 会话ID: 1745999606549_6123, 症状: {}
INFO 2025-04-30 15:53:58,058 views 13056 8696 当前症状信息 - 会话ID: 1745999606549_6123, 症状: {}
INFO 2025-04-30 15:53:58,059 views 13056 8696 更新症状类别 - 会话ID: 1745999606549_6123, 类别: plant_part, 值: 叶片
INFO 2025-04-30 15:53:58,059 views 13056 8696 获取现有会话: 1745999606549_6123
INFO 2025-04-30 15:53:58,059 views 13056 8696 会话已保存到 Redis: 1745999606549_6123
INFO 2025-04-30 15:53:58,060 views 13056 8696 症状信息已保存到会话 - 会话ID: 1745999606549_6123, 症状: {'plant_part': '叶片'}
INFO 2025-04-30 15:53:58,060 views 13056 8696 症状信息更新完成 - 会话ID: 1745999606549_6123, 最终症状: {'plant_part': '叶片'}
INFO 2025-04-30 15:53:58,060 views 13056 8696 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-30 15:53:58,060 views 13056 8696 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 种植区

INFO 2025-04-30 15:54:00,702 services 13056 8696 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 15:54:00,702 services 13056 8696 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 15:54:00,704 services 13056 8696 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 15:54:00,713 services 13056 8696 查询结果: <neo4j._sync.work.result.Result object at 0x000001A2DE9B1280>
DEBUG 2025-04-30 15:54:21,877 views 13056 8696 添加历史记录成功 - 会话ID: 1745999606549_6123, 角色: user
DEBUG 2025-04-30 15:54:21,880 views 13056 8696 添加历史记录成功 - 会话ID: 1745999606549_6123, 角色: assistant
INFO 2025-04-30 15:54:21,882 basehttp 13056 8696 "GET /api/chat/stream_chat/?message=%E4%BD%A0%E5%A5%BD%EF%BC%8C%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%8F%B6%E7%89%87%E5%87%BA%E7%8E%B0%E4%BA%86%E9%97%AE%E9%A2%98&session_id=1745999606549_6123 HTTP/1.1" 200 5071
INFO 2025-04-30 15:54:24,371 views 13056 10256 Neo4j服务初始化成功
DEBUG 2025-04-30 15:54:26,411 views 13056 10256 ChatAPI实例初始化完成
INFO 2025-04-30 15:54:26,424 views 13056 10256 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 15:54:26,425 basehttp 13056 10256 "GET /api/chat/get_history/ HTTP/1.1" 200 454
INFO 2025-04-30 15:54:46,325 views 13056 19760 Neo4j服务初始化成功
DEBUG 2025-04-30 15:54:48,374 views 13056 19760 ChatAPI实例初始化完成
DEBUG 2025-04-30 15:54:48,374 views 13056 19760 收到stream_chat请求: {'message': ['我目前所在地在河北'], 'session_id': ['1745999606549_6123']}
DEBUG 2025-04-30 15:54:48,374 views 13056 19760 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 15:54:48,374 views 13056 19760 处理消息: 我目前所在地在河北, 会话ID: 1745999606549_6123
INFO 2025-04-30 15:54:48,374 views 13056 19760 获取现有会话: 1745999606549_6123
INFO 2025-04-30 15:54:48,374 views 13056 19760 获取会话历史 - 会话ID: 1745999606549_6123, 历史记录数: 2
DEBUG 2025-04-30 15:54:48,374 views 13056 19760 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好，我的小麦叶片出现了问题', 'timestamp': 1745999661.8770463}, {'role': 'assistant', 'content': '根据目前掌握的信息（发病部位：叶片），可能的病害有：\n1. 小麦黑颖病\n   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或不饱满，发病轻的种子颜色变深；叶片染病初呈水渍状小点，渐沿叶脉向上、下扩展为黄褐色条状斑；穗...\n\n2. 小麦黑节病\n   主要特征: 叶片染病初生水渍状条斑，后变为黄褐色，最后呈浓褐色，病斑长椭圆形，也有中间色浅些的；叶鞘染病沿叶脉形成黑褐色长形条斑，多与叶上病斑相连，后叶鞘全部变为浅褐色；茎秆染病主要为害节部，病部呈浓褐色，内部也...\n\n3. 小麦黄矮病毒病\n   主要特征: 叶片典型症状是新叶发病从叶尖渐向叶基扩展变黄，黄化部分占全叶的1/3 - 1/2，叶基仍为绿色，且保持较长时间，有时出现与叶脉平行但不受叶脉限制的黄绿相间条纹，病叶较光滑，发病早植株矮化严重，但因品种...\n\n请补充更多信息，以便我更准确地判断。', 'timestamp': 1745999661.8800855}, {'role': 'user', 'content': '我目前所在地在河北'}]
DEBUG 2025-04-30 15:54:48,379 views 13056 19760 构建的消息列表长度: 4
DEBUG 2025-04-30 15:54:51,197 views 13056 19760 添加历史记录成功 - 会话ID: 1745999606549_6123, 角色: user
DEBUG 2025-04-30 15:54:51,197 views 13056 19760 添加历史记录成功 - 会话ID: 1745999606549_6123, 角色: assistant
INFO 2025-04-30 15:54:51,198 basehttp 13056 19760 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9B%AE%E5%89%8D%E6%89%80%E5%9C%A8%E5%9C%B0%E5%9C%A8%E6%B2%B3%E5%8C%97&session_id=1745999606549_6123 HTTP/1.1" 200 964
INFO 2025-04-30 15:54:53,547 views 13056 10256 Neo4j服务初始化成功
DEBUG 2025-04-30 15:54:55,579 views 13056 10256 ChatAPI实例初始化完成
INFO 2025-04-30 15:54:55,584 views 13056 10256 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 15:54:55,585 basehttp 13056 10256 "GET /api/chat/get_history/ HTTP/1.1" 200 502
INFO 2025-04-30 15:55:27,759 views 13056 3396 Neo4j服务初始化成功
DEBUG 2025-04-30 15:55:29,813 views 13056 3396 ChatAPI实例初始化完成
DEBUG 2025-04-30 15:55:29,813 views 13056 3396 收到stream_chat请求: {'message': ['问题出现在叶片上而且我目前在河北'], 'session_id': ['1745999606549_6123']}
DEBUG 2025-04-30 15:55:29,813 views 13056 3396 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 15:55:29,813 views 13056 3396 处理消息: 问题出现在叶片上而且我目前在河北, 会话ID: 1745999606549_6123
INFO 2025-04-30 15:55:29,813 views 13056 3396 获取现有会话: 1745999606549_6123
INFO 2025-04-30 15:55:29,813 views 13056 3396 获取会话历史 - 会话ID: 1745999606549_6123, 历史记录数: 4
DEBUG 2025-04-30 15:55:29,817 views 13056 3396 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好，我的小麦叶片出现了问题', 'timestamp': 1745999661.8770463}, {'role': 'assistant', 'content': '根据目前掌握的信息（发病部位：叶片），可能的病害有：\n1. 小麦黑颖病\n   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或不饱满，发病轻的种子颜色变深；叶片染病初呈水渍状小点，渐沿叶脉向上、下扩展为黄褐色条状斑；穗...\n\n2. 小麦黑节病\n   主要特征: 叶片染病初生水渍状条斑，后变为黄褐色，最后呈浓褐色，病斑长椭圆形，也有中间色浅些的；叶鞘染病沿叶脉形成黑褐色长形条斑，多与叶上病斑相连，后叶鞘全部变为浅褐色；茎秆染病主要为害节部，病部呈浓褐色，内部也...\n\n3. 小麦黄矮病毒病\n   主要特征: 叶片典型症状是新叶发病从叶尖渐向叶基扩展变黄，黄化部分占全叶的1/3 - 1/2，叶基仍为绿色，且保持较长时间，有时出现与叶脉平行但不受叶脉限制的黄绿相间条纹，病叶较光滑，发病早植株矮化严重，但因品种...\n\n请补充更多信息，以便我更准确地判断。', 'timestamp': 1745999661.8800855}, {'role': 'user', 'content': '我目前所在地在河北', 'timestamp': 1745999691.194956}, {'role': 'assistant', 'content': '仅知道发病地区为河北，信息还是不太充足。请您进一步告诉我，小麦是从叶片哪个部位开始发病的，发病时的气象条件（比如温度、湿度、降雨情况等），小麦处于哪个生育期（如苗期、拔节期、抽穗期等 ），这样能让我更精准地诊断病害。 ', 'timestamp': 1745999691.1979985}, {'role': 'user', 'content': '问题出现在叶片上而且我目前在河北'}]
DEBUG 2025-04-30 15:55:29,818 views 13056 3396 构建的消息列表长度: 6
INFO 2025-04-30 15:55:29,819 views 13056 3396 检查会话状态: 1745999606549_6123
INFO 2025-04-30 15:55:29,819 views 13056 3396 获取现有会话: 1745999606549_6123
INFO 2025-04-30 15:55:29,820 views 13056 3396 从会话获取症状信息 - 会话ID: 1745999606549_6123, 症状: {'plant_part': '叶片'}
INFO 2025-04-30 15:55:29,820 views 13056 3396 从缓存获取的症状信息: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-30 15:55:29,820 views 13056 3396 创建新会话: 1745999606549_6123
INFO 2025-04-30 15:55:29,820 views 13056 3396 当前症状收集状态: {'1745999606549_6123': {'collecting': True, 'symptoms': {'plant_part': '叶片'}}}
DEBUG 2025-04-30 15:55:29,821 views 13056 3396 当前症状信息: {'plant_part': '叶片'}
DEBUG 2025-04-30 15:55:29,821 views 13056 3396 开始提取症状，输入消息: 问题出现在叶片上而且我目前在河北
DEBUG 2025-04-30 15:55:29,821 views 13056 3396 分句结果: ['问题出现在叶片上而且我目前在河北', '问题出现在叶片上而且我目前在河北']
DEBUG 2025-04-30 15:55:29,821 views 13056 3396 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 15:55:29,821 views 13056 3396 提取到的气象条件: []
DEBUG 2025-04-30 15:55:29,822 views 13056 3396 提取到的生育期: []
DEBUG 2025-04-30 15:55:29,822 views 13056 3396 提取到的种植区: ['河北']
DEBUG 2025-04-30 15:55:29,822 views 13056 3396 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 15:55:29,822 views 13056 3396 提取到的气象条件: []
DEBUG 2025-04-30 15:55:29,823 views 13056 3396 提取到的生育期: []
DEBUG 2025-04-30 15:55:29,823 views 13056 3396 提取到的种植区: ['河北']
INFO 2025-04-30 15:55:29,823 views 13056 3396 症状提取结果: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-30 15:55:29,823 views 13056 3396 开始更新症状信息 - 会话ID: 1745999606549_6123, 新症状: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-30 15:55:29,824 views 13056 3396 获取现有会话: 1745999606549_6123
INFO 2025-04-30 15:55:29,824 views 13056 3396 从会话获取症状信息 - 会话ID: 1745999606549_6123, 症状: {'plant_part': '叶片'}
INFO 2025-04-30 15:55:29,825 views 13056 3396 当前症状信息 - 会话ID: 1745999606549_6123, 症状: {'plant_part': '叶片'}
INFO 2025-04-30 15:55:29,825 views 13056 3396 更新症状类别 - 会话ID: 1745999606549_6123, 类别: plant_part, 值: 叶片
INFO 2025-04-30 15:55:29,826 views 13056 3396 更新症状类别 - 会话ID: 1745999606549_6123, 类别: region, 值: 河北
INFO 2025-04-30 15:55:29,826 views 13056 3396 获取现有会话: 1745999606549_6123
INFO 2025-04-30 15:55:29,826 views 13056 3396 会话已保存到 Redis: 1745999606549_6123
INFO 2025-04-30 15:55:29,827 views 13056 3396 症状信息已保存到会话 - 会话ID: 1745999606549_6123, 症状: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-30 15:55:29,827 views 13056 3396 症状信息更新完成 - 会话ID: 1745999606549_6123, 最终症状: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-30 15:55:29,827 views 13056 3396 更新后的症状信息: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-30 15:55:29,827 views 13056 3396 已收集的信息: 目前已经收集到的信息：
- 发病部位：叶片
- 种植区：河北

还需要补充的信息：
- 气象条件
- 生育期

INFO 2025-04-30 15:55:32,631 services 13056 3396 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-30 15:55:32,631 services 13056 3396 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) MATCH (d)-[:OCCURS_IN_REGION]->(r:Region {name: $region}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 15:55:32,635 services 13056 3396 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-30 15:55:32,818 services 13056 3396 查询结果: <neo4j._sync.work.result.Result object at 0x000001A2DE9B05C0>
DEBUG 2025-04-30 15:55:46,586 views 13056 3396 添加历史记录成功 - 会话ID: 1745999606549_6123, 角色: user
DEBUG 2025-04-30 15:55:46,588 views 13056 3396 添加历史记录成功 - 会话ID: 1745999606549_6123, 角色: assistant
INFO 2025-04-30 15:55:46,588 basehttp 13056 3396 "GET /api/chat/stream_chat/?message=%E9%97%AE%E9%A2%98%E5%87%BA%E7%8E%B0%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%E8%80%8C%E4%B8%94%E6%88%91%E7%9B%AE%E5%89%8D%E5%9C%A8%E6%B2%B3%E5%8C%97&session_id=1745999606549_6123 HTTP/1.1" 200 3493
INFO 2025-04-30 15:55:49,118 views 13056 10256 Neo4j服务初始化成功
DEBUG 2025-04-30 15:55:51,161 views 13056 10256 ChatAPI实例初始化完成
INFO 2025-04-30 15:55:51,167 views 13056 10256 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 15:55:51,169 basehttp 13056 10256 "GET /api/chat/get_history/ HTTP/1.1" 200 498
INFO 2025-04-30 15:58:37,200 autoreload 13056 18540 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 15:58:38,034 autoreload 10496 20760 Watching for file changes with StatReloader
INFO 2025-04-30 16:00:58,942 autoreload 10496 20760 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 16:00:59,855 autoreload 1584 16804 Watching for file changes with StatReloader
INFO 2025-04-30 16:01:04,942 views 1584 13368 Neo4j服务初始化成功
DEBUG 2025-04-30 16:01:07,002 views 1584 13368 ChatAPI实例初始化完成
INFO 2025-04-30 16:01:07,008 views 1584 13368 创建新会话成功 - 会话ID: 1746000067003_2030
INFO 2025-04-30 16:01:07,009 basehttp 1584 13368 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 16:01:09,322 views 1584 13368 Neo4j服务初始化成功
DEBUG 2025-04-30 16:01:11,381 views 1584 13368 ChatAPI实例初始化完成
INFO 2025-04-30 16:01:11,388 views 1584 13368 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 16:01:11,388 basehttp 1584 13368 "GET /api/chat/get_history/ HTTP/1.1" 200 498
INFO 2025-04-30 16:01:13,694 views 1584 13368 Neo4j服务初始化成功
DEBUG 2025-04-30 16:01:15,758 views 1584 13368 ChatAPI实例初始化完成
INFO 2025-04-30 16:01:15,768 views 1584 13368 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 16:01:15,769 basehttp 1584 13368 "GET /api/chat/get_history/ HTTP/1.1" 200 498
INFO 2025-04-30 16:01:18,486 views 1584 13368 Neo4j服务初始化成功
DEBUG 2025-04-30 16:01:20,537 views 1584 13368 ChatAPI实例初始化完成
INFO 2025-04-30 16:01:20,541 basehttp 1584 13368 "GET /api/chat/get_session_history/?session_id=1745999606549_6123 HTTP/1.1" 200 5011
INFO 2025-04-30 16:01:41,388 views 1584 18232 Neo4j服务初始化成功
DEBUG 2025-04-30 16:01:43,454 views 1584 18232 ChatAPI实例初始化完成
DEBUG 2025-04-30 16:01:43,454 views 1584 18232 收到stream_chat请求: {'message': ['想知道目前已知的信息'], 'session_id': ['1745999606549_6123']}
DEBUG 2025-04-30 16:01:43,457 views 1584 18232 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 16:01:43,457 views 1584 18232 处理消息: 想知道目前已知的信息, 会话ID: 1745999606549_6123
INFO 2025-04-30 16:01:43,458 views 1584 18232 获取现有会话: 1745999606549_6123
INFO 2025-04-30 16:01:43,458 views 1584 18232 获取会话历史 - 会话ID: 1745999606549_6123, 历史记录数: 6
DEBUG 2025-04-30 16:01:43,458 views 1584 18232 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好，我的小麦叶片出现了问题', 'timestamp': 1745999661.8770463}, {'role': 'assistant', 'content': '根据目前掌握的信息（发病部位：叶片），可能的病害有：\n1. 小麦黑颖病\n   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或不饱满，发病轻的种子颜色变深；叶片染病初呈水渍状小点，渐沿叶脉向上、下扩展为黄褐色条状斑；穗...\n\n2. 小麦黑节病\n   主要特征: 叶片染病初生水渍状条斑，后变为黄褐色，最后呈浓褐色，病斑长椭圆形，也有中间色浅些的；叶鞘染病沿叶脉形成黑褐色长形条斑，多与叶上病斑相连，后叶鞘全部变为浅褐色；茎秆染病主要为害节部，病部呈浓褐色，内部也...\n\n3. 小麦黄矮病毒病\n   主要特征: 叶片典型症状是新叶发病从叶尖渐向叶基扩展变黄，黄化部分占全叶的1/3 - 1/2，叶基仍为绿色，且保持较长时间，有时出现与叶脉平行但不受叶脉限制的黄绿相间条纹，病叶较光滑，发病早植株矮化严重，但因品种...\n\n请补充更多信息，以便我更准确地判断。', 'timestamp': 1745999661.8800855}, {'role': 'user', 'content': '我目前所在地在河北', 'timestamp': 1745999691.194956}, {'role': 'assistant', 'content': '仅知道发病地区为河北，信息还是不太充足。请您进一步告诉我，小麦是从叶片哪个部位开始发病的，发病时的气象条件（比如温度、湿度、降雨情况等），小麦处于哪个生育期（如苗期、拔节期、抽穗期等 ），这样能让我更精准地诊断病害。 ', 'timestamp': 1745999691.1979985}, {'role': 'user', 'content': '问题出现在叶片上而且我目前在河北', 'timestamp': 1745999746.5867405}, {'role': 'assistant', 'content': '根据您提供的信息（发病部位：叶片，种植区：河北），诊断结果为小麦叶锈病。\n病害特征：夏孢子堆圆形至长椭圆形，桔红色，散生，成熟后表皮开裂散出夏孢子；冬孢子堆主要在叶片背面和叶鞘上，圆形或长椭圆形，黑色，扁平，成熟时不破裂\n防治建议：药剂防治：药剂拌种用种子重量的0.03% - 0.04%(有效成分)叶锈特或用种子重量0.2%的20%三唑酮乳油拌种；使用15%保丰1号种衣剂包衣种子；于发病初期喷洒20%三唑酮乳油1000倍液，隔10 - 20天1次，防治1 - 2次。农业防治：适期播种，消灭杂草和自生麦苗，雨季及时排水，防止湿气滞留\n', 'timestamp': 1745999746.5877662}, {'role': 'user', 'content': '想知道目前已知的信息'}]
DEBUG 2025-04-30 16:01:43,458 views 1584 18232 构建的消息列表长度: 8
DEBUG 2025-04-30 16:02:00,402 views 1584 18232 添加历史记录成功 - 会话ID: 1745999606549_6123, 角色: user
DEBUG 2025-04-30 16:02:00,406 views 1584 18232 添加历史记录成功 - 会话ID: 1745999606549_6123, 角色: assistant
INFO 2025-04-30 16:02:00,406 basehttp 1584 18232 "GET /api/chat/stream_chat/?message=%E6%83%B3%E7%9F%A5%E9%81%93%E7%9B%AE%E5%89%8D%E5%B7%B2%E7%9F%A5%E7%9A%84%E4%BF%A1%E6%81%AF&session_id=1745999606549_6123 HTTP/1.1" 200 1860
INFO 2025-04-30 16:02:02,853 views 1584 13368 Neo4j服务初始化成功
DEBUG 2025-04-30 16:02:04,904 views 1584 13368 ChatAPI实例初始化完成
INFO 2025-04-30 16:02:04,911 views 1584 13368 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 16:02:04,912 basehttp 1584 13368 "GET /api/chat/get_history/ HTTP/1.1" 200 496
INFO 2025-04-30 16:05:34,008 views 1584 23908 Neo4j服务初始化成功
INFO 2025-04-30 16:05:34,009 views 1584 13368 Neo4j服务初始化成功
DEBUG 2025-04-30 16:05:36,062 views 1584 13368 ChatAPI实例初始化完成
DEBUG 2025-04-30 16:05:36,062 views 1584 23908 ChatAPI实例初始化完成
INFO 2025-04-30 16:05:36,062 views 1584 13368 创建新会话成功 - 会话ID: 1746000336062_8748
INFO 2025-04-30 16:05:36,066 basehttp 1584 13368 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 16:05:36,066 views 1584 23908 创建新会话成功 - 会话ID: 1746000336062_3678
INFO 2025-04-30 16:05:36,071 basehttp 1584 23908 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 16:05:38,389 views 1584 23908 Neo4j服务初始化成功
DEBUG 2025-04-30 16:05:40,423 views 1584 23908 ChatAPI实例初始化完成
INFO 2025-04-30 16:05:40,434 views 1584 23908 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 16:05:40,435 basehttp 1584 23908 "GET /api/chat/get_history/ HTTP/1.1" 200 496
INFO 2025-04-30 16:05:42,791 views 1584 13368 Neo4j服务初始化成功
DEBUG 2025-04-30 16:05:44,859 views 1584 13368 ChatAPI实例初始化完成
INFO 2025-04-30 16:05:44,867 views 1584 13368 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 16:05:44,867 basehttp 1584 13368 "GET /api/chat/get_history/ HTTP/1.1" 200 496
INFO 2025-04-30 16:05:47,186 views 1584 23908 Neo4j服务初始化成功
DEBUG 2025-04-30 16:05:49,223 views 1584 23908 ChatAPI实例初始化完成
INFO 2025-04-30 16:05:49,234 views 1584 23908 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 16:05:49,234 basehttp 1584 23908 "GET /api/chat/get_history/ HTTP/1.1" 200 496
INFO 2025-04-30 16:05:51,560 views 1584 13368 Neo4j服务初始化成功
DEBUG 2025-04-30 16:05:53,588 views 1584 13368 ChatAPI实例初始化完成
INFO 2025-04-30 16:05:53,601 views 1584 13368 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 16:05:53,602 basehttp 1584 13368 "GET /api/chat/get_history/ HTTP/1.1" 200 496
INFO 2025-04-30 16:06:21,228 autoreload 1584 16804 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 16:06:22,365 autoreload 13448 12296 Watching for file changes with StatReloader
INFO 2025-04-30 16:54:00,054 autoreload 13448 12296 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 16:54:00,875 autoreload 10072 13764 Watching for file changes with StatReloader
INFO 2025-04-30 16:54:09,202 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 16:54:11,260 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 16:54:11,264 views 10072 17768 创建新会话成功 - 会话ID: 1746003251260_7283
INFO 2025-04-30 16:54:11,268 basehttp 10072 17768 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 16:54:13,596 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 16:54:15,681 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 16:54:15,689 views 10072 17768 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 16:54:15,689 basehttp 10072 17768 "GET /api/chat/get_history/ HTTP/1.1" 200 496
INFO 2025-04-30 16:54:18,026 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 16:54:20,087 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 16:54:20,111 views 10072 17768 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 16:54:20,113 basehttp 10072 17768 "GET /api/chat/get_history/ HTTP/1.1" 200 496
INFO 2025-04-30 16:54:33,246 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 16:54:35,311 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 16:54:35,315 basehttp 10072 17768 "GET /api/chat/get_session_history/?session_id=1745999606549_6123 HTTP/1.1" 200 6486
INFO 2025-04-30 16:55:59,500 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 16:56:01,582 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 16:56:01,582 views 10072 17768 创建新会话成功 - 会话ID: 1746003361582_5857
INFO 2025-04-30 16:56:01,586 basehttp 10072 17768 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 16:56:03,928 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 16:56:06,004 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 16:56:06,013 views 10072 17768 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 16:56:06,014 basehttp 10072 17768 "GET /api/chat/get_history/ HTTP/1.1" 200 497
INFO 2025-04-30 16:56:21,361 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 16:56:23,417 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 16:56:23,417 views 10072 17768 创建新会话成功 - 会话ID: 1746003383417_8941
INFO 2025-04-30 16:56:23,417 basehttp 10072 17768 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 16:56:25,740 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 16:56:27,762 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 16:56:27,771 views 10072 17768 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 16:56:27,772 basehttp 10072 17768 "GET /api/chat/get_history/ HTTP/1.1" 200 497
INFO 2025-04-30 16:56:30,104 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 16:56:32,136 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 16:56:32,144 views 10072 17768 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 16:56:32,145 basehttp 10072 17768 "GET /api/chat/get_history/ HTTP/1.1" 200 497
INFO 2025-04-30 16:56:45,687 views 10072 12752 Neo4j服务初始化成功
DEBUG 2025-04-30 16:56:47,762 views 10072 12752 ChatAPI实例初始化完成
DEBUG 2025-04-30 16:56:47,762 views 10072 12752 收到stream_chat请求: {'message': ['你好，我的小麦出现问题了'], 'session_id': ['1746003383417_8941']}
DEBUG 2025-04-30 16:56:47,766 views 10072 12752 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 16:56:47,767 views 10072 12752 处理消息: 你好，我的小麦出现问题了, 会话ID: 1746003383417_8941
INFO 2025-04-30 16:56:47,767 views 10072 12752 获取现有会话: 1746003383417_8941
INFO 2025-04-30 16:56:47,767 views 10072 12752 获取会话历史 - 会话ID: 1746003383417_8941, 历史记录数: 0
DEBUG 2025-04-30 16:56:47,767 views 10072 12752 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好，我的小麦出现问题了'}]
DEBUG 2025-04-30 16:56:47,767 views 10072 12752 构建的消息列表长度: 2
INFO 2025-04-30 16:56:47,767 views 10072 12752 检查会话状态: 1746003383417_8941
INFO 2025-04-30 16:56:47,767 views 10072 12752 从Redis获取症状信息 - 会话ID: 1746003383417_8941, 症状: {}
INFO 2025-04-30 16:56:47,767 views 10072 12752 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-30 16:56:47,770 views 10072 12752 创建新会话: 1746003383417_8941
INFO 2025-04-30 16:56:47,770 views 10072 12752 当前症状收集状态: {'1746003383417_8941': {'collecting': True, 'symptoms': {}}}
DEBUG 2025-04-30 16:56:47,770 views 10072 12752 当前症状信息: {}
DEBUG 2025-04-30 16:56:47,770 views 10072 12752 开始提取症状，输入消息: 你好，我的小麦出现问题了
DEBUG 2025-04-30 16:56:47,771 views 10072 12752 分句结果: ['你好', '我的小麦出现问题了', '你好，我的小麦出现问题了']
DEBUG 2025-04-30 16:56:47,771 views 10072 12752 提取到的发病部位: []
DEBUG 2025-04-30 16:56:47,771 views 10072 12752 提取到的气象条件: []
DEBUG 2025-04-30 16:56:47,771 views 10072 12752 提取到的生育期: []
DEBUG 2025-04-30 16:56:47,771 views 10072 12752 提取到的种植区: []
DEBUG 2025-04-30 16:56:47,772 views 10072 12752 提取到的发病部位: []
DEBUG 2025-04-30 16:56:47,772 views 10072 12752 提取到的气象条件: []
DEBUG 2025-04-30 16:56:47,772 views 10072 12752 提取到的生育期: []
DEBUG 2025-04-30 16:56:47,772 views 10072 12752 提取到的种植区: []
DEBUG 2025-04-30 16:56:47,772 views 10072 12752 提取到的发病部位: []
DEBUG 2025-04-30 16:56:47,773 views 10072 12752 提取到的气象条件: []
DEBUG 2025-04-30 16:56:47,773 views 10072 12752 提取到的生育期: []
DEBUG 2025-04-30 16:56:47,773 views 10072 12752 提取到的种植区: []
INFO 2025-04-30 16:56:47,773 views 10072 12752 症状提取结果: {}
INFO 2025-04-30 16:56:47,773 views 10072 12752 开始更新症状信息 - 会话ID: 1746003383417_8941, 新症状: {}
INFO 2025-04-30 16:56:47,774 views 10072 12752 获取现有会话: 1746003383417_8941
INFO 2025-04-30 16:56:47,775 views 10072 12752 会话已保存到 Redis: 1746003383417_8941
INFO 2025-04-30 16:56:47,775 views 10072 12752 症状信息更新完成 - 会话ID: 1746003383417_8941, 最终症状: {}
INFO 2025-04-30 16:56:47,776 views 10072 12752 更新后的症状信息: {}
DEBUG 2025-04-30 16:56:50,871 views 10072 12752 添加历史记录成功 - 会话ID: 1746003383417_8941, 角色: user
DEBUG 2025-04-30 16:56:50,875 views 10072 12752 添加历史记录成功 - 会话ID: 1746003383417_8941, 角色: assistant
INFO 2025-04-30 16:56:50,878 basehttp 10072 12752 "GET /api/chat/stream_chat/?message=%E4%BD%A0%E5%A5%BD%EF%BC%8C%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%87%BA%E7%8E%B0%E9%97%AE%E9%A2%98%E4%BA%86&session_id=1746003383417_8941 HTTP/1.1" 200 677
INFO 2025-04-30 16:56:53,240 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 16:56:55,297 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 16:56:55,329 views 10072 17768 获取所有历史会话 - 会话数: 2
INFO 2025-04-30 16:56:55,330 basehttp 10072 17768 "GET /api/chat/get_history/ HTTP/1.1" 200 907
INFO 2025-04-30 16:57:11,999 views 10072 15844 Neo4j服务初始化成功
DEBUG 2025-04-30 16:57:14,061 views 10072 15844 ChatAPI实例初始化完成
DEBUG 2025-04-30 16:57:14,061 views 10072 15844 收到stream_chat请求: {'message': ['小麦似乎是在叶片出发生问题的'], 'session_id': ['1746003383417_8941']}
DEBUG 2025-04-30 16:57:14,064 views 10072 15844 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 16:57:14,064 views 10072 15844 处理消息: 小麦似乎是在叶片出发生问题的, 会话ID: 1746003383417_8941
INFO 2025-04-30 16:57:14,064 views 10072 15844 获取现有会话: 1746003383417_8941
INFO 2025-04-30 16:57:14,064 views 10072 15844 获取会话历史 - 会话ID: 1746003383417_8941, 历史记录数: 2
DEBUG 2025-04-30 16:57:14,064 views 10072 15844 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好，我的小麦出现问题了', 'timestamp': 1746003410.8717084}, {'role': 'assistant', 'content': '请告诉我小麦的发病情况，包括：\n1. 从哪个部位开始发病\n2. 发病时的气象条件\n3. 发病的生育期\n4. 发病的种植区', 'timestamp': 1746003410.8755505}, {'role': 'user', 'content': '小麦似乎是在叶片出发生问题的'}]
DEBUG 2025-04-30 16:57:14,064 views 10072 15844 构建的消息列表长度: 4
INFO 2025-04-30 16:57:14,068 views 10072 15844 检查会话状态: 1746003383417_8941
INFO 2025-04-30 16:57:14,068 views 10072 15844 从Redis获取症状信息 - 会话ID: 1746003383417_8941, 症状: {}
INFO 2025-04-30 16:57:14,068 views 10072 15844 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-30 16:57:14,068 views 10072 15844 创建新会话: 1746003383417_8941
INFO 2025-04-30 16:57:14,069 views 10072 15844 当前症状收集状态: {'1746003383417_8941': {'collecting': True, 'symptoms': {}}}
DEBUG 2025-04-30 16:57:14,069 views 10072 15844 当前症状信息: {}
DEBUG 2025-04-30 16:57:14,069 views 10072 15844 开始提取症状，输入消息: 小麦似乎是在叶片出发生问题的
DEBUG 2025-04-30 16:57:14,069 views 10072 15844 分句结果: ['小麦似乎是在叶片出发生问题的', '小麦似乎是在叶片出发生问题的']
DEBUG 2025-04-30 16:57:14,069 views 10072 15844 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 16:57:14,070 views 10072 15844 提取到的气象条件: []
DEBUG 2025-04-30 16:57:14,070 views 10072 15844 提取到的生育期: []
DEBUG 2025-04-30 16:57:14,070 views 10072 15844 提取到的种植区: []
DEBUG 2025-04-30 16:57:14,070 views 10072 15844 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 16:57:14,071 views 10072 15844 提取到的气象条件: []
DEBUG 2025-04-30 16:57:14,071 views 10072 15844 提取到的生育期: []
DEBUG 2025-04-30 16:57:14,071 views 10072 15844 提取到的种植区: []
INFO 2025-04-30 16:57:14,071 views 10072 15844 症状提取结果: {'plant_part': '叶片'}
INFO 2025-04-30 16:57:14,072 views 10072 15844 开始更新症状信息 - 会话ID: 1746003383417_8941, 新症状: {'plant_part': '叶片'}
INFO 2025-04-30 16:57:14,073 views 10072 15844 更新症状类别 - 会话ID: 1746003383417_8941, 类别: plant_part, 值: 叶片
INFO 2025-04-30 16:57:14,073 views 10072 15844 获取现有会话: 1746003383417_8941
INFO 2025-04-30 16:57:14,074 views 10072 15844 会话已保存到 Redis: 1746003383417_8941
INFO 2025-04-30 16:57:14,074 views 10072 15844 症状信息更新完成 - 会话ID: 1746003383417_8941, 最终症状: {'plant_part': '叶片'}
INFO 2025-04-30 16:57:14,074 views 10072 15844 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-30 16:57:14,075 views 10072 15844 已收集的信息: 目前已经收集到的信息：

- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 种植区
INFO 2025-04-30 16:57:16,734 services 10072 15844 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 16:57:16,734 services 10072 15844 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 16:57:16,742 services 10072 15844 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 16:57:16,770 services 10072 15844 查询结果: <neo4j._sync.work.result.Result object at 0x000001DE47603980>
DEBUG 2025-04-30 16:57:38,256 views 10072 15844 添加历史记录成功 - 会话ID: 1746003383417_8941, 角色: user
DEBUG 2025-04-30 16:57:38,256 views 10072 15844 添加历史记录成功 - 会话ID: 1746003383417_8941, 角色: assistant
INFO 2025-04-30 16:57:38,256 basehttp 10072 15844 "GET /api/chat/stream_chat/?message=%E5%B0%8F%E9%BA%A6%E4%BC%BC%E4%B9%8E%E6%98%AF%E5%9C%A8%E5%8F%B6%E7%89%87%E5%87%BA%E5%8F%91%E7%94%9F%E9%97%AE%E9%A2%98%E7%9A%84&session_id=1746003383417_8941 HTTP/1.1" 200 5085
INFO 2025-04-30 16:57:40,821 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 16:57:42,845 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 16:57:42,854 views 10072 17768 获取所有历史会话 - 会话数: 2
INFO 2025-04-30 16:57:42,854 basehttp 10072 17768 "GET /api/chat/get_history/ HTTP/1.1" 200 899
INFO 2025-04-30 16:58:27,394 views 10072 8828 Neo4j服务初始化成功
DEBUG 2025-04-30 16:58:29,452 views 10072 8828 ChatAPI实例初始化完成
DEBUG 2025-04-30 16:58:29,452 views 10072 8828 收到stream_chat请求: {'message': ['我的种植地是在河北'], 'session_id': ['1746003383417_8941']}
DEBUG 2025-04-30 16:58:29,452 views 10072 8828 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 16:58:29,460 views 10072 8828 处理消息: 我的种植地是在河北, 会话ID: 1746003383417_8941
INFO 2025-04-30 16:58:29,462 views 10072 8828 获取现有会话: 1746003383417_8941
INFO 2025-04-30 16:58:29,464 views 10072 8828 获取会话历史 - 会话ID: 1746003383417_8941, 历史记录数: 4
DEBUG 2025-04-30 16:58:29,464 views 10072 8828 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好，我的小麦出现问题了', 'timestamp': 1746003410.8717084}, {'role': 'assistant', 'content': '请告诉我小麦的发病情况，包括：\n1. 从哪个部位开始发病\n2. 发病时的气象条件\n3. 发病的生育期\n4. 发病的种植区', 'timestamp': 1746003410.8755505}, {'role': 'user', 'content': '小麦似乎是在叶片出发生问题的', 'timestamp': 1746003458.256034}, {'role': 'assistant', 'content': '根据目前掌握的信息：\n发病部位：叶片\n\n可能的病害有：\n\n1. 小麦黑颖病\n   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或不饱满，发病轻的种子颜色变深；叶片染病初呈水渍状小点，渐沿叶脉向上、下扩展为黄褐色条状斑；穗...\n\n2. 小麦黑节病\n   主要特征: 叶片染病初生水渍状条斑，后变为黄褐色，最后呈浓褐色，病斑长椭圆形，也有中间色浅些的；叶鞘染病沿叶脉形成黑褐色长形条斑，多与叶上病斑相连，后叶鞘全部变为浅褐色；茎秆染病主要为害节部，病部呈浓褐色，内部也...\n\n3. 小麦黄矮病毒病\n   主要特征: 叶片典型症状是新叶发病从叶尖渐向叶基扩展变黄，黄化部分占全叶的1/3 - 1/2，叶基仍为绿色，且保持较长时间，有时出现与叶脉平行但不受叶脉限制的黄绿相间条纹，病叶较光滑，发病早植株矮化严重，但因品种...\n\n请补充更多信息，以便我更准确地判断。', 'timestamp': 1746003458.256034}, {'role': 'user', 'content': '我的种植地是在河北'}]
DEBUG 2025-04-30 16:58:29,468 views 10072 8828 构建的消息列表长度: 6
DEBUG 2025-04-30 16:58:47,925 views 10072 8828 添加历史记录成功 - 会话ID: 1746003383417_8941, 角色: user
DEBUG 2025-04-30 16:58:47,925 views 10072 8828 添加历史记录成功 - 会话ID: 1746003383417_8941, 角色: assistant
INFO 2025-04-30 16:58:47,925 basehttp 10072 8828 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9A%84%E7%A7%8D%E6%A4%8D%E5%9C%B0%E6%98%AF%E5%9C%A8%E6%B2%B3%E5%8C%97&session_id=1746003383417_8941 HTTP/1.1" 200 5084
INFO 2025-04-30 16:58:50,498 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 16:58:52,572 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 16:58:52,584 views 10072 17768 获取所有历史会话 - 会话数: 2
INFO 2025-04-30 16:58:52,584 basehttp 10072 17768 "GET /api/chat/get_history/ HTTP/1.1" 200 916
INFO 2025-04-30 17:01:06,449 views 10072 17768 Neo4j服务初始化成功
INFO 2025-04-30 17:01:08,023 views 10072 22548 Neo4j服务初始化成功
DEBUG 2025-04-30 17:01:08,492 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 17:01:08,492 views 10072 17768 创建新会话成功 - 会话ID: 1746003668492_6999
INFO 2025-04-30 17:01:08,492 basehttp 10072 17768 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:01:10,050 views 10072 22548 ChatAPI实例初始化完成
INFO 2025-04-30 17:01:10,051 views 10072 22548 创建新会话成功 - 会话ID: 1746003670050_1672
INFO 2025-04-30 17:01:10,051 basehttp 10072 22548 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:01:10,787 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 17:01:12,830 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 17:01:12,838 views 10072 17768 获取所有历史会话 - 会话数: 2
INFO 2025-04-30 17:01:12,839 basehttp 10072 17768 "GET /api/chat/get_history/ HTTP/1.1" 200 916
INFO 2025-04-30 17:01:15,164 views 10072 22548 Neo4j服务初始化成功
DEBUG 2025-04-30 17:01:17,218 views 10072 22548 ChatAPI实例初始化完成
INFO 2025-04-30 17:01:17,230 views 10072 22548 获取所有历史会话 - 会话数: 2
INFO 2025-04-30 17:01:17,232 basehttp 10072 22548 "GET /api/chat/get_history/ HTTP/1.1" 200 916
INFO 2025-04-30 17:01:19,584 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 17:01:21,616 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 17:01:21,624 views 10072 17768 获取所有历史会话 - 会话数: 2
INFO 2025-04-30 17:01:21,624 basehttp 10072 17768 "GET /api/chat/get_history/ HTTP/1.1" 200 916
INFO 2025-04-30 17:01:23,931 views 10072 22548 Neo4j服务初始化成功
DEBUG 2025-04-30 17:01:25,982 views 10072 22548 ChatAPI实例初始化完成
INFO 2025-04-30 17:01:25,988 views 10072 22548 获取所有历史会话 - 会话数: 2
INFO 2025-04-30 17:01:25,989 basehttp 10072 22548 "GET /api/chat/get_history/ HTTP/1.1" 200 916
INFO 2025-04-30 17:02:25,515 views 10072 22548 Neo4j服务初始化成功
DEBUG 2025-04-30 17:02:27,567 views 10072 22548 ChatAPI实例初始化完成
INFO 2025-04-30 17:02:27,568 views 10072 22548 创建新会话成功 - 会话ID: 1746003747568_5877
INFO 2025-04-30 17:02:27,569 basehttp 10072 22548 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:02:29,960 views 10072 22548 Neo4j服务初始化成功
INFO 2025-04-30 17:02:30,722 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 17:02:31,990 views 10072 22548 ChatAPI实例初始化完成
INFO 2025-04-30 17:02:31,994 views 10072 22548 获取所有历史会话 - 会话数: 2
INFO 2025-04-30 17:02:31,994 basehttp 10072 22548 - Broken pipe from ('127.0.0.1', 56752)
DEBUG 2025-04-30 17:02:32,749 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 17:02:32,749 views 10072 17768 创建新会话成功 - 会话ID: 1746003752749_5365
INFO 2025-04-30 17:02:32,753 basehttp 10072 17768 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:02:35,062 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 17:02:37,135 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 17:02:37,147 views 10072 17768 获取所有历史会话 - 会话数: 2
INFO 2025-04-30 17:02:37,147 basehttp 10072 17768 "GET /api/chat/get_history/ HTTP/1.1" 200 916
INFO 2025-04-30 17:02:39,483 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 17:02:41,519 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 17:02:41,523 views 10072 17768 获取所有历史会话 - 会话数: 2
INFO 2025-04-30 17:02:41,523 basehttp 10072 17768 "GET /api/chat/get_history/ HTTP/1.1" 200 916
INFO 2025-04-30 17:02:43,827 views 10072 19720 Neo4j服务初始化成功
DEBUG 2025-04-30 17:02:45,878 views 10072 19720 ChatAPI实例初始化完成
INFO 2025-04-30 17:02:45,878 basehttp 10072 19720 "GET /api/chat/get_session_history/?session_id=1746003383417_8941 HTTP/1.1" 200 6497
INFO 2025-04-30 17:03:21,031 views 10072 19720 Neo4j服务初始化成功
DEBUG 2025-04-30 17:03:23,103 views 10072 19720 ChatAPI实例初始化完成
INFO 2025-04-30 17:03:23,107 basehttp 10072 19720 "GET /api/chat/get_session_history/?session_id=1745999606549_6123 HTTP/1.1" 200 6486
INFO 2025-04-30 17:03:25,421 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 17:03:27,467 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 17:03:27,468 basehttp 10072 17768 "GET /api/chat/get_session_history/?session_id=1745999606549_6123 HTTP/1.1" 200 6486
INFO 2025-04-30 17:03:43,562 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 17:03:45,612 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 17:03:45,612 basehttp 10072 17768 "GET /api/chat/get_session_history/?session_id=1746003383417_8941 HTTP/1.1" 200 6497
INFO 2025-04-30 17:04:02,435 views 10072 22264 Neo4j服务初始化成功
DEBUG 2025-04-30 17:04:04,513 views 10072 22264 ChatAPI实例初始化完成
DEBUG 2025-04-30 17:04:04,517 views 10072 22264 收到stream_chat请求: {'message': ['小麦具体是得了什么病呢'], 'session_id': ['1746003383417_8941']}
DEBUG 2025-04-30 17:04:04,517 views 10072 22264 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 17:04:04,523 views 10072 22264 处理消息: 小麦具体是得了什么病呢, 会话ID: 1746003383417_8941
INFO 2025-04-30 17:04:04,526 views 10072 22264 获取现有会话: 1746003383417_8941
INFO 2025-04-30 17:04:04,527 views 10072 22264 获取会话历史 - 会话ID: 1746003383417_8941, 历史记录数: 6
DEBUG 2025-04-30 17:04:04,528 views 10072 22264 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好，我的小麦出现问题了', 'timestamp': 1746003410.8717084}, {'role': 'assistant', 'content': '请告诉我小麦的发病情况，包括：\n1. 从哪个部位开始发病\n2. 发病时的气象条件\n3. 发病的生育期\n4. 发病的种植区', 'timestamp': 1746003410.8755505}, {'role': 'user', 'content': '小麦似乎是在叶片出发生问题的', 'timestamp': 1746003458.256034}, {'role': 'assistant', 'content': '根据目前掌握的信息：\n发病部位：叶片\n\n可能的病害有：\n\n1. 小麦黑颖病\n   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或不饱满，发病轻的种子颜色变深；叶片染病初呈水渍状小点，渐沿叶脉向上、下扩展为黄褐色条状斑；穗...\n\n2. 小麦黑节病\n   主要特征: 叶片染病初生水渍状条斑，后变为黄褐色，最后呈浓褐色，病斑长椭圆形，也有中间色浅些的；叶鞘染病沿叶脉形成黑褐色长形条斑，多与叶上病斑相连，后叶鞘全部变为浅褐色；茎秆染病主要为害节部，病部呈浓褐色，内部也...\n\n3. 小麦黄矮病毒病\n   主要特征: 叶片典型症状是新叶发病从叶尖渐向叶基扩展变黄，黄化部分占全叶的1/3 - 1/2，叶基仍为绿色，且保持较长时间，有时出现与叶脉平行但不受叶脉限制的黄绿相间条纹，病叶较光滑，发病早植株矮化严重，但因品种...\n\n请补充更多信息，以便我更准确地判断。', 'timestamp': 1746003458.256034}, {'role': 'user', 'content': '我的种植地是在河北', 'timestamp': 1746003527.9256523}, {'role': 'assistant', 'content': '仅依据目前已知的发病部位在叶片以及种植地为河北，可能的病害及特征如下：\n - **小麦锈病**：\n    - **条锈病**：主要危害叶片，初期叶片上出现褪绿黄斑，后形成鲜黄色夏孢子堆，呈整齐的虚线状排列，孢子堆小。后期还会产生黑色冬孢子堆。\n    - **叶锈病**：叶片上夏孢子堆橙黄色，近圆形，排列不规则，比条锈病的孢子堆大且颜色更鲜艳。冬孢子堆黑色，扁平状。\n    - **秆锈病**：夏孢子堆大，长椭圆形，红褐色，常沿叶脉扩展，成熟后表皮大片开裂且向外翻卷。冬孢子堆黑色，长椭圆形。\n - **小麦白粉病**：叶片上会出现白色粉状霉斑，起初为小黄点，后扩大为圆形或椭圆形病斑，表面覆盖一层白粉状霉层，后期霉层变灰白色至浅褐色，病斑上散生黑色小粒点（闭囊壳）。\n\n诊断结果可信度评估：由于信息有限，目前诊断可信度较低，大概30% 。\n\n防治建议：\n - **农业防治**：\n    - 合理密植，保证田间通风透光良好，降低湿度。\n    - 施足基肥，增施磷、钾肥，增强小麦的抗病能力。\n    - 及时清除病残体，带出田外深埋或烧毁，减少病原菌残留。\n - **化学防治**：\n    - 对于锈病，在发病初期，可选用三唑酮、戊唑醇、烯唑醇等药剂喷雾防治，按照说明书剂量使用。\n    - 对于白粉病，可选用粉锈宁、多菌灵等药剂，按照规定浓度和用量喷雾，注意药剂交替使用，避免产生抗药性。\n\n为更准确诊断，请补充发病时的气象条件、小麦发病的生育期等信息。 ', 'timestamp': 1746003527.9256523}, {'role': 'user', 'content': '小麦具体是得了什么病呢'}]
DEBUG 2025-04-30 17:04:04,533 views 10072 22264 构建的消息列表长度: 8
INFO 2025-04-30 17:04:04,533 views 10072 22264 检查会话状态: 1746003383417_8941
INFO 2025-04-30 17:04:04,533 views 10072 22264 从Redis获取症状信息 - 会话ID: 1746003383417_8941, 症状: {'plant_part': '叶片'}
INFO 2025-04-30 17:04:04,534 views 10072 22264 从缓存获取的症状信息: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-30 17:04:04,534 views 10072 22264 创建新会话: 1746003383417_8941
INFO 2025-04-30 17:04:04,534 views 10072 22264 当前症状收集状态: {'1746003383417_8941': {'collecting': True, 'symptoms': {'plant_part': '叶片'}}}
DEBUG 2025-04-30 17:04:04,534 views 10072 22264 当前症状信息: {'plant_part': '叶片'}
DEBUG 2025-04-30 17:04:04,535 views 10072 22264 开始提取症状，输入消息: 小麦具体是得了什么病呢
DEBUG 2025-04-30 17:04:04,535 views 10072 22264 分句结果: ['小麦具体是得了什么病呢', '小麦具体是得了什么病呢']
DEBUG 2025-04-30 17:04:04,535 views 10072 22264 提取到的发病部位: []
DEBUG 2025-04-30 17:04:04,535 views 10072 22264 提取到的气象条件: []
DEBUG 2025-04-30 17:04:04,535 views 10072 22264 提取到的生育期: []
DEBUG 2025-04-30 17:04:04,536 views 10072 22264 提取到的种植区: []
DEBUG 2025-04-30 17:04:04,536 views 10072 22264 提取到的发病部位: []
DEBUG 2025-04-30 17:04:04,536 views 10072 22264 提取到的气象条件: []
DEBUG 2025-04-30 17:04:04,536 views 10072 22264 提取到的生育期: []
DEBUG 2025-04-30 17:04:04,536 views 10072 22264 提取到的种植区: []
INFO 2025-04-30 17:04:04,537 views 10072 22264 症状提取结果: {}
INFO 2025-04-30 17:04:04,537 views 10072 22264 开始更新症状信息 - 会话ID: 1746003383417_8941, 新症状: {}
INFO 2025-04-30 17:04:04,537 views 10072 22264 获取现有会话: 1746003383417_8941
INFO 2025-04-30 17:04:04,538 views 10072 22264 会话已保存到 Redis: 1746003383417_8941
INFO 2025-04-30 17:04:04,538 views 10072 22264 症状信息更新完成 - 会话ID: 1746003383417_8941, 最终症状: {'plant_part': '叶片'}
INFO 2025-04-30 17:04:04,538 views 10072 22264 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-30 17:04:04,539 views 10072 22264 已收集的信息: 目前已经收集到的信息：

- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 种植区
INFO 2025-04-30 17:04:07,208 services 10072 22264 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 17:04:07,208 services 10072 22264 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 17:04:07,212 services 10072 22264 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 17:04:07,235 services 10072 22264 查询结果: <neo4j._sync.work.result.Result object at 0x000001DE47863770>
DEBUG 2025-04-30 17:04:28,690 views 10072 22264 添加历史记录成功 - 会话ID: 1746003383417_8941, 角色: user
DEBUG 2025-04-30 17:04:28,693 views 10072 22264 添加历史记录成功 - 会话ID: 1746003383417_8941, 角色: assistant
INFO 2025-04-30 17:04:28,697 basehttp 10072 22264 "GET /api/chat/stream_chat/?message=%E5%B0%8F%E9%BA%A6%E5%85%B7%E4%BD%93%E6%98%AF%E5%BE%97%E4%BA%86%E4%BB%80%E4%B9%88%E7%97%85%E5%91%A2&session_id=1746003383417_8941 HTTP/1.1" 200 5085
INFO 2025-04-30 17:04:31,399 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 17:04:33,448 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 17:04:33,452 views 10072 17768 获取所有历史会话 - 会话数: 2
INFO 2025-04-30 17:04:33,452 basehttp 10072 17768 "GET /api/chat/get_history/ HTTP/1.1" 200 900
INFO 2025-04-30 17:07:19,150 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 17:07:21,196 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 17:07:21,196 views 10072 17768 创建新会话成功 - 会话ID: 1746004041196_6880
INFO 2025-04-30 17:07:21,196 basehttp 10072 17768 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:07:23,532 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 17:07:25,583 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 17:07:25,591 views 10072 17768 获取所有历史会话 - 会话数: 2
INFO 2025-04-30 17:07:25,592 basehttp 10072 17768 "GET /api/chat/get_history/ HTTP/1.1" 200 900
INFO 2025-04-30 17:07:27,920 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 17:07:29,987 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 17:07:29,994 views 10072 17768 获取所有历史会话 - 会话数: 2
INFO 2025-04-30 17:07:29,995 basehttp 10072 17768 "GET /api/chat/get_history/ HTTP/1.1" 200 900
INFO 2025-04-30 17:07:56,621 views 10072 13332 Neo4j服务初始化成功
DEBUG 2025-04-30 17:07:58,690 views 10072 13332 ChatAPI实例初始化完成
DEBUG 2025-04-30 17:07:58,690 views 10072 13332 收到stream_chat请求: {'message': ['我的小麦叶边有问题，且种植地在河北'], 'session_id': ['1746004041196_6880']}
DEBUG 2025-04-30 17:07:58,690 views 10072 13332 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 17:07:58,690 views 10072 13332 处理消息: 我的小麦叶边有问题，且种植地在河北, 会话ID: 1746004041196_6880
INFO 2025-04-30 17:07:58,690 views 10072 13332 获取现有会话: 1746004041196_6880
INFO 2025-04-30 17:07:58,690 views 10072 13332 获取会话历史 - 会话ID: 1746004041196_6880, 历史记录数: 0
DEBUG 2025-04-30 17:07:58,690 views 10072 13332 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦叶边有问题，且种植地在河北'}]
DEBUG 2025-04-30 17:07:58,690 views 10072 13332 构建的消息列表长度: 2
INFO 2025-04-30 17:07:58,690 views 10072 13332 检查会话状态: 1746004041196_6880
INFO 2025-04-30 17:07:58,694 views 10072 13332 从Redis获取症状信息 - 会话ID: 1746004041196_6880, 症状: {}
INFO 2025-04-30 17:07:58,694 views 10072 13332 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-30 17:07:58,694 views 10072 13332 创建新会话: 1746004041196_6880
INFO 2025-04-30 17:07:58,694 views 10072 13332 当前症状收集状态: {'1746004041196_6880': {'collecting': True, 'symptoms': {}}}
DEBUG 2025-04-30 17:07:58,694 views 10072 13332 当前症状信息: {}
DEBUG 2025-04-30 17:07:58,694 views 10072 13332 开始提取症状，输入消息: 我的小麦叶边有问题，且种植地在河北
DEBUG 2025-04-30 17:07:58,694 views 10072 13332 分句结果: ['我的小麦叶边有问题', '且种植地在河北', '我的小麦叶边有问题，且种植地在河北']
DEBUG 2025-04-30 17:07:58,694 views 10072 13332 提取到的发病部位: []
DEBUG 2025-04-30 17:07:58,696 views 10072 13332 提取到的气象条件: []
DEBUG 2025-04-30 17:07:58,696 views 10072 13332 提取到的生育期: []
DEBUG 2025-04-30 17:07:58,696 views 10072 13332 提取到的种植区: []
DEBUG 2025-04-30 17:07:58,696 views 10072 13332 提取到的发病部位: []
DEBUG 2025-04-30 17:07:58,697 views 10072 13332 提取到的气象条件: []
DEBUG 2025-04-30 17:07:58,697 views 10072 13332 提取到的生育期: []
DEBUG 2025-04-30 17:07:58,697 views 10072 13332 提取到的种植区: ['河北']
DEBUG 2025-04-30 17:07:58,697 views 10072 13332 提取到的发病部位: []
DEBUG 2025-04-30 17:07:58,697 views 10072 13332 提取到的气象条件: []
DEBUG 2025-04-30 17:07:58,698 views 10072 13332 提取到的生育期: []
DEBUG 2025-04-30 17:07:58,698 views 10072 13332 提取到的种植区: ['河北']
INFO 2025-04-30 17:07:58,698 views 10072 13332 症状提取结果: {'region': '河北'}
INFO 2025-04-30 17:07:58,698 views 10072 13332 开始更新症状信息 - 会话ID: 1746004041196_6880, 新症状: {'region': '河北'}
INFO 2025-04-30 17:07:58,698 views 10072 13332 更新症状类别 - 会话ID: 1746004041196_6880, 类别: region, 值: 河北
INFO 2025-04-30 17:07:58,699 views 10072 13332 获取现有会话: 1746004041196_6880
INFO 2025-04-30 17:07:58,699 views 10072 13332 会话已保存到 Redis: 1746004041196_6880
INFO 2025-04-30 17:07:58,700 views 10072 13332 症状信息更新完成 - 会话ID: 1746004041196_6880, 最终症状: {'region': '河北'}
INFO 2025-04-30 17:07:58,700 views 10072 13332 更新后的症状信息: {'region': '河北'}
INFO 2025-04-30 17:07:58,700 views 10072 13332 已收集的信息: 目前已经收集到的信息：

- 种植区：河北

还需要补充的信息：
- 发病部位
- 气象条件
- 生育期
INFO 2025-04-30 17:08:01,364 services 10072 13332 查询参数: {'plant_part': None, 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-30 17:08:01,364 services 10072 13332 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:OCCURS_IN_REGION]->(r:Region {name: $region}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 17:08:01,364 services 10072 13332 查询参数: {'plant_part': None, 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-30 17:08:01,464 services 10072 13332 查询结果: <neo4j._sync.work.result.Result object at 0x000001DE478F7200>
DEBUG 2025-04-30 17:08:12,276 views 10072 13332 添加历史记录成功 - 会话ID: 1746004041196_6880, 角色: user
DEBUG 2025-04-30 17:08:12,276 views 10072 13332 添加历史记录成功 - 会话ID: 1746004041196_6880, 角色: assistant
INFO 2025-04-30 17:08:12,280 basehttp 10072 13332 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%8F%B6%E8%BE%B9%E6%9C%89%E9%97%AE%E9%A2%98%EF%BC%8C%E4%B8%94%E7%A7%8D%E6%A4%8D%E5%9C%B0%E5%9C%A8%E6%B2%B3%E5%8C%97&session_id=1746004041196_6880 HTTP/1.1" 200 2843
INFO 2025-04-30 17:08:14,697 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 17:08:16,751 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 17:08:16,759 views 10072 17768 获取所有历史会话 - 会话数: 3
INFO 2025-04-30 17:08:16,759 basehttp 10072 17768 "GET /api/chat/get_history/ HTTP/1.1" 200 1302
INFO 2025-04-30 17:10:45,196 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 17:10:47,263 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 17:10:47,263 views 10072 17768 创建新会话成功 - 会话ID: 1746004247263_9306
INFO 2025-04-30 17:10:47,263 basehttp 10072 17768 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:10:49,627 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 17:10:51,667 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 17:10:51,698 views 10072 17768 获取所有历史会话 - 会话数: 3
INFO 2025-04-30 17:10:51,699 basehttp 10072 17768 "GET /api/chat/get_history/ HTTP/1.1" 200 1302
INFO 2025-04-30 17:10:54,073 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 17:10:56,127 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 17:10:56,135 views 10072 17768 获取所有历史会话 - 会话数: 3
INFO 2025-04-30 17:10:56,139 basehttp 10072 17768 "GET /api/chat/get_history/ HTTP/1.1" 200 1302
INFO 2025-04-30 17:13:21,059 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 17:13:23,116 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 17:13:23,120 views 10072 17768 创建新会话成功 - 会话ID: 1746004403120_8982
INFO 2025-04-30 17:13:23,120 basehttp 10072 17768 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:13:23,373 views 10072 23992 Neo4j服务初始化成功
DEBUG 2025-04-30 17:13:25,425 views 10072 23992 ChatAPI实例初始化完成
INFO 2025-04-30 17:13:25,425 views 10072 23992 创建新会话成功 - 会话ID: 1746004405425_5037
INFO 2025-04-30 17:13:25,425 basehttp 10072 23992 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:13:25,441 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 17:13:27,515 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 17:13:27,519 views 10072 17768 获取所有历史会话 - 会话数: 3
INFO 2025-04-30 17:13:27,523 basehttp 10072 17768 "GET /api/chat/get_history/ HTTP/1.1" 200 1302
INFO 2025-04-30 17:13:29,853 views 10072 23992 Neo4j服务初始化成功
DEBUG 2025-04-30 17:13:31,926 views 10072 23992 ChatAPI实例初始化完成
INFO 2025-04-30 17:13:31,934 views 10072 23992 获取所有历史会话 - 会话数: 3
INFO 2025-04-30 17:13:31,934 basehttp 10072 23992 "GET /api/chat/get_history/ HTTP/1.1" 200 1302
INFO 2025-04-30 17:13:34,245 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 17:13:36,273 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 17:13:36,281 views 10072 17768 获取所有历史会话 - 会话数: 3
INFO 2025-04-30 17:13:36,281 basehttp 10072 17768 "GET /api/chat/get_history/ HTTP/1.1" 200 1302
INFO 2025-04-30 17:13:38,611 views 10072 23992 Neo4j服务初始化成功
DEBUG 2025-04-30 17:13:40,687 views 10072 23992 ChatAPI实例初始化完成
INFO 2025-04-30 17:13:40,695 views 10072 23992 获取所有历史会话 - 会话数: 3
INFO 2025-04-30 17:13:40,695 basehttp 10072 23992 "GET /api/chat/get_history/ HTTP/1.1" 200 1302
INFO 2025-04-30 17:14:36,224 views 10072 24404 Neo4j服务初始化成功
DEBUG 2025-04-30 17:14:38,290 views 10072 24404 ChatAPI实例初始化完成
DEBUG 2025-04-30 17:14:38,290 views 10072 24404 收到stream_chat请求: {'message': ['小麦的问题出现在叶片上，然后我目前所在地是在河北'], 'session_id': ['1746004405425_5037']}
DEBUG 2025-04-30 17:14:38,290 views 10072 24404 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 17:14:38,294 views 10072 24404 处理消息: 小麦的问题出现在叶片上，然后我目前所在地是在河北, 会话ID: 1746004405425_5037
INFO 2025-04-30 17:14:38,294 views 10072 24404 获取现有会话: 1746004405425_5037
INFO 2025-04-30 17:14:38,294 views 10072 24404 获取会话历史 - 会话ID: 1746004405425_5037, 历史记录数: 0
DEBUG 2025-04-30 17:14:38,294 views 10072 24404 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '小麦的问题出现在叶片上，然后我目前所在地是在河北'}]
DEBUG 2025-04-30 17:14:38,294 views 10072 24404 构建的消息列表长度: 2
INFO 2025-04-30 17:14:38,294 views 10072 24404 检查会话状态: 1746004405425_5037
INFO 2025-04-30 17:14:38,294 views 10072 24404 从Redis获取症状信息 - 会话ID: 1746004405425_5037, 症状: {}
INFO 2025-04-30 17:14:38,294 views 10072 24404 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-30 17:14:38,294 views 10072 24404 创建新会话: 1746004405425_5037
INFO 2025-04-30 17:14:38,294 views 10072 24404 当前症状收集状态: {'1746004405425_5037': {'collecting': True, 'symptoms': {}}}
DEBUG 2025-04-30 17:14:38,294 views 10072 24404 当前症状信息: {}
DEBUG 2025-04-30 17:14:38,298 views 10072 24404 开始提取症状，输入消息: 小麦的问题出现在叶片上，然后我目前所在地是在河北
DEBUG 2025-04-30 17:14:38,298 views 10072 24404 分句结果: ['小麦的问题出现在叶片上', '然后我目前所在地是在河北', '小麦的问题出现在叶片上，然后我目前所在地是在河北']
DEBUG 2025-04-30 17:14:38,298 views 10072 24404 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 17:14:38,298 views 10072 24404 提取到的气象条件: []
DEBUG 2025-04-30 17:14:38,298 views 10072 24404 提取到的生育期: []
DEBUG 2025-04-30 17:14:38,298 views 10072 24404 提取到的种植区: []
DEBUG 2025-04-30 17:14:38,298 views 10072 24404 提取到的发病部位: []
DEBUG 2025-04-30 17:14:38,299 views 10072 24404 提取到的气象条件: []
DEBUG 2025-04-30 17:14:38,299 views 10072 24404 提取到的生育期: []
DEBUG 2025-04-30 17:14:38,299 views 10072 24404 提取到的种植区: ['河北']
DEBUG 2025-04-30 17:14:38,299 views 10072 24404 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 17:14:38,299 views 10072 24404 提取到的气象条件: []
DEBUG 2025-04-30 17:14:38,300 views 10072 24404 提取到的生育期: []
DEBUG 2025-04-30 17:14:38,301 views 10072 24404 提取到的种植区: ['河北']
INFO 2025-04-30 17:14:38,301 views 10072 24404 症状提取结果: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-30 17:14:38,301 views 10072 24404 开始更新症状信息 - 会话ID: 1746004405425_5037, 新症状: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-30 17:14:38,302 views 10072 24404 更新症状类别 - 会话ID: 1746004405425_5037, 类别: plant_part, 值: 叶片
INFO 2025-04-30 17:14:38,302 views 10072 24404 更新症状类别 - 会话ID: 1746004405425_5037, 类别: region, 值: 河北
INFO 2025-04-30 17:14:38,303 views 10072 24404 获取现有会话: 1746004405425_5037
INFO 2025-04-30 17:14:38,307 views 10072 24404 会话已保存到 Redis: 1746004405425_5037
INFO 2025-04-30 17:14:38,307 views 10072 24404 症状信息更新完成 - 会话ID: 1746004405425_5037, 最终症状: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-30 17:14:38,308 views 10072 24404 更新后的症状信息: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-30 17:14:38,308 views 10072 24404 已收集的信息: 目前已经收集到的信息：

- 发病部位：叶片
- 种植区：河北

还需要补充的信息：
- 气象条件
- 生育期
INFO 2025-04-30 17:14:41,134 services 10072 24404 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-30 17:14:41,134 services 10072 24404 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) MATCH (d)-[:OCCURS_IN_REGION]->(r:Region {name: $region}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 17:14:41,143 services 10072 24404 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-30 17:14:41,157 services 10072 24404 查询结果: <neo4j._sync.work.result.Result object at 0x000001DE47A2A540>
DEBUG 2025-04-30 17:14:55,236 views 10072 24404 添加历史记录成功 - 会话ID: 1746004405425_5037, 角色: user
DEBUG 2025-04-30 17:14:55,244 views 10072 24404 添加历史记录成功 - 会话ID: 1746004405425_5037, 角色: assistant
INFO 2025-04-30 17:14:55,244 basehttp 10072 24404 "GET /api/chat/stream_chat/?message=%E5%B0%8F%E9%BA%A6%E7%9A%84%E9%97%AE%E9%A2%98%E5%87%BA%E7%8E%B0%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%EF%BC%8C%E7%84%B6%E5%90%8E%E6%88%91%E7%9B%AE%E5%89%8D%E6%89%80%E5%9C%A8%E5%9C%B0%E6%98%AF%E5%9C%A8%E6%B2%B3%E5%8C%97&session_id=1746004405425_5037 HTTP/1.1" 200 3532
INFO 2025-04-30 17:14:57,848 views 10072 23992 Neo4j服务初始化成功
DEBUG 2025-04-30 17:14:59,914 views 10072 23992 ChatAPI实例初始化完成
INFO 2025-04-30 17:14:59,920 views 10072 23992 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:14:59,924 basehttp 10072 23992 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:18:28,822 views 10072 23992 Neo4j服务初始化成功
INFO 2025-04-30 17:18:28,837 views 10072 17768 Neo4j服务初始化成功
DEBUG 2025-04-30 17:18:30,870 views 10072 23992 ChatAPI实例初始化完成
INFO 2025-04-30 17:18:30,870 views 10072 23992 创建新会话成功 - 会话ID: 1746004710870_6372
INFO 2025-04-30 17:18:30,871 basehttp 10072 23992 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:18:30,887 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 17:18:30,888 views 10072 17768 创建新会话成功 - 会话ID: 1746004710887_3526
INFO 2025-04-30 17:18:30,888 basehttp 10072 17768 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:18:31,265 views 10072 12768 Neo4j服务初始化成功
INFO 2025-04-30 17:18:31,266 views 10072 23120 Neo4j服务初始化成功
INFO 2025-04-30 17:18:33,205 views 10072 23992 Neo4j服务初始化成功
DEBUG 2025-04-30 17:18:33,299 views 10072 23120 ChatAPI实例初始化完成
INFO 2025-04-30 17:18:33,300 views 10072 23120 创建新会话成功 - 会话ID: 1746004713299_1486
INFO 2025-04-30 17:18:33,301 basehttp 10072 23120 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:18:33,314 views 10072 12768 ChatAPI实例初始化完成
INFO 2025-04-30 17:18:33,316 views 10072 12768 创建新会话成功 - 会话ID: 1746004713315_2030
INFO 2025-04-30 17:18:33,317 basehttp 10072 12768 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:18:34,300 views 10072 17768 Neo4j服务初始化成功
INFO 2025-04-30 17:18:34,300 views 10072 16828 Neo4j服务初始化成功
DEBUG 2025-04-30 17:18:35,231 views 10072 23992 ChatAPI实例初始化完成
INFO 2025-04-30 17:18:35,241 views 10072 23992 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:18:35,241 basehttp 10072 23992 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:18:36,351 views 10072 17768 ChatAPI实例初始化完成
INFO 2025-04-30 17:18:36,353 views 10072 17768 创建新会话成功 - 会话ID: 1746004716351_3994
INFO 2025-04-30 17:18:36,355 basehttp 10072 17768 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:18:36,363 views 10072 16828 ChatAPI实例初始化完成
INFO 2025-04-30 17:18:36,365 views 10072 16828 创建新会话成功 - 会话ID: 1746004716364_5821
INFO 2025-04-30 17:18:36,366 basehttp 10072 16828 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:18:36,922 views 10072 23120 Neo4j服务初始化成功
INFO 2025-04-30 17:18:36,922 views 10072 12768 Neo4j服务初始化成功
INFO 2025-04-30 17:18:37,565 views 10072 13020 Neo4j服务初始化成功
DEBUG 2025-04-30 17:18:38,981 views 10072 12768 ChatAPI实例初始化完成
DEBUG 2025-04-30 17:18:38,981 views 10072 23120 ChatAPI实例初始化完成
INFO 2025-04-30 17:18:38,981 views 10072 12768 创建新会话成功 - 会话ID: 1746004718981_2552
INFO 2025-04-30 17:18:38,981 basehttp 10072 12768 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:18:38,981 views 10072 23120 创建新会话成功 - 会话ID: 1746004718981_7212
INFO 2025-04-30 17:18:38,981 basehttp 10072 23120 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:18:39,627 views 10072 13020 ChatAPI实例初始化完成
INFO 2025-04-30 17:18:39,640 views 10072 13020 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:18:39,641 basehttp 10072 13020 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:18:42,002 views 10072 23120 Neo4j服务初始化成功
INFO 2025-04-30 17:18:43,706 views 10072 12768 Neo4j服务初始化成功
INFO 2025-04-30 17:18:43,746 views 10072 13020 Neo4j服务初始化成功
DEBUG 2025-04-30 17:18:44,084 views 10072 23120 ChatAPI实例初始化完成
INFO 2025-04-30 17:18:44,096 views 10072 23120 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:18:44,096 basehttp 10072 23120 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:18:45,749 views 10072 12768 ChatAPI实例初始化完成
INFO 2025-04-30 17:18:45,749 views 10072 12768 创建新会话成功 - 会话ID: 1746004725749_4748
INFO 2025-04-30 17:18:45,751 basehttp 10072 12768 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:18:45,764 views 10072 13020 ChatAPI实例初始化完成
INFO 2025-04-30 17:18:45,765 views 10072 13020 创建新会话成功 - 会话ID: 1746004725764_7340
INFO 2025-04-30 17:18:45,766 basehttp 10072 13020 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:18:46,432 views 10072 16828 Neo4j服务初始化成功
DEBUG 2025-04-30 17:18:48,511 views 10072 16828 ChatAPI实例初始化完成
INFO 2025-04-30 17:18:48,535 views 10072 16828 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:18:48,535 basehttp 10072 16828 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:18:50,915 autoreload 10072 13764 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 17:18:51,801 autoreload 14376 3020 Watching for file changes with StatReloader
INFO 2025-04-30 17:18:56,160 views 14376 13244 Neo4j服务初始化成功
DEBUG 2025-04-30 17:18:58,215 views 14376 13244 ChatAPI实例初始化完成
INFO 2025-04-30 17:18:58,232 views 14376 13244 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:18:58,234 basehttp 14376 13244 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:19:00,550 views 14376 3404 Neo4j服务初始化成功
INFO 2025-04-30 17:19:01,348 views 14376 13244 Neo4j服务初始化成功
INFO 2025-04-30 17:19:02,013 views 14376 1852 Neo4j服务初始化成功
DEBUG 2025-04-30 17:19:02,601 views 14376 3404 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:02,611 views 14376 3404 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:19:02,612 basehttp 14376 3404 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:19:03,419 views 14376 13244 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:03,448 views 14376 13244 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:19:03,448 basehttp 14376 13244 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:19:04,051 views 14376 1852 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:04,069 views 14376 1852 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:19:04,070 basehttp 14376 1852 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:19:04,924 views 14376 21180 Neo4j服务初始化成功
DEBUG 2025-04-30 17:19:06,976 views 14376 21180 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:06,988 views 14376 21180 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:19:06,988 basehttp 14376 21180 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:19:08,204 views 14376 13244 Neo4j服务初始化成功
INFO 2025-04-30 17:19:08,221 views 14376 1852 Neo4j服务初始化成功
INFO 2025-04-30 17:19:09,346 views 14376 3404 Neo4j服务初始化成功
DEBUG 2025-04-30 17:19:10,252 views 14376 13244 ChatAPI实例初始化完成
DEBUG 2025-04-30 17:19:10,254 views 14376 1852 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:10,274 views 14376 13244 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:19:10,275 basehttp 14376 13244 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:19:10,277 views 14376 1852 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:19:10,278 basehttp 14376 1852 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:19:11,398 views 14376 3404 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:11,407 views 14376 3404 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:19:11,407 basehttp 14376 3404 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:19:13,747 views 14376 1852 Neo4j服务初始化成功
DEBUG 2025-04-30 17:19:15,777 views 14376 1852 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:15,788 views 14376 1852 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:19:15,788 basehttp 14376 1852 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:19:18,112 views 14376 3404 Neo4j服务初始化成功
INFO 2025-04-30 17:19:19,565 views 14376 1852 Neo4j服务初始化成功
INFO 2025-04-30 17:19:19,589 views 14376 13244 Neo4j服务初始化成功
DEBUG 2025-04-30 17:19:20,152 views 14376 3404 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:20,164 views 14376 3404 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:19:20,164 basehttp 14376 3404 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:19:21,406 views 14376 688 Neo4j服务初始化成功
INFO 2025-04-30 17:19:21,410 views 14376 21180 Neo4j服务初始化成功
DEBUG 2025-04-30 17:19:21,598 views 14376 1852 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:21,602 views 14376 1852 创建新会话成功 - 会话ID: 1746004761602_6942
INFO 2025-04-30 17:19:21,602 basehttp 14376 1852 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:19:21,639 views 14376 13244 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:21,639 views 14376 13244 创建新会话成功 - 会话ID: 1746004761639_9069
INFO 2025-04-30 17:19:21,643 basehttp 14376 13244 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:19:22,498 views 14376 3856 Neo4j服务初始化成功
DEBUG 2025-04-30 17:19:23,443 views 14376 21180 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:23,444 views 14376 21180 创建新会话成功 - 会话ID: 1746004763444_4077
INFO 2025-04-30 17:19:23,444 basehttp 14376 21180 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:19:23,454 views 14376 688 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:23,458 views 14376 688 创建新会话成功 - 会话ID: 1746004763458_3372
INFO 2025-04-30 17:19:23,458 basehttp 14376 688 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:19:24,359 views 14376 1852 Neo4j服务初始化成功
INFO 2025-04-30 17:19:24,363 views 14376 13244 Neo4j服务初始化成功
DEBUG 2025-04-30 17:19:24,564 views 14376 3856 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:24,595 views 14376 3856 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:19:24,596 basehttp 14376 3856 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:19:25,813 views 14376 21180 Neo4j服务初始化成功
INFO 2025-04-30 17:19:26,184 views 14376 3404 Neo4j服务初始化成功
INFO 2025-04-30 17:19:26,188 views 14376 688 Neo4j服务初始化成功
DEBUG 2025-04-30 17:19:26,432 views 14376 1852 ChatAPI实例初始化完成
DEBUG 2025-04-30 17:19:26,433 views 14376 13244 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:26,433 views 14376 1852 创建新会话成功 - 会话ID: 1746004766433_8440
INFO 2025-04-30 17:19:26,435 views 14376 13244 创建新会话成功 - 会话ID: 1746004766434_3073
INFO 2025-04-30 17:19:26,437 basehttp 14376 1852 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:19:26,437 basehttp 14376 13244 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:19:26,902 views 14376 3856 Neo4j服务初始化成功
DEBUG 2025-04-30 17:19:27,863 views 14376 21180 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:27,871 views 14376 21180 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:19:27,872 basehttp 14376 21180 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:19:28,227 views 14376 3404 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:28,228 views 14376 3404 创建新会话成功 - 会话ID: 1746004768228_5203
INFO 2025-04-30 17:19:28,228 basehttp 14376 3404 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:19:28,245 views 14376 688 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:28,245 views 14376 688 创建新会话成功 - 会话ID: 1746004768245_5413
INFO 2025-04-30 17:19:28,246 basehttp 14376 688 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:19:28,957 views 14376 3856 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:28,970 views 14376 3856 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:19:28,974 basehttp 14376 3856 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:19:31,316 views 14376 688 Neo4j服务初始化成功
DEBUG 2025-04-30 17:19:33,345 views 14376 688 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:33,356 views 14376 688 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:19:33,357 basehttp 14376 688 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:19:35,685 views 14376 3856 Neo4j服务初始化成功
DEBUG 2025-04-30 17:19:37,724 views 14376 3856 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:37,732 views 14376 3856 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:19:37,737 basehttp 14376 3856 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:19:40,098 views 14376 688 Neo4j服务初始化成功
DEBUG 2025-04-30 17:19:42,134 views 14376 688 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:42,147 views 14376 688 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:19:42,148 basehttp 14376 688 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:19:44,478 views 14376 3856 Neo4j服务初始化成功
INFO 2025-04-30 17:19:45,799 views 14376 688 Neo4j服务初始化成功
DEBUG 2025-04-30 17:19:46,518 views 14376 3856 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:46,531 views 14376 3856 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:19:46,532 basehttp 14376 3856 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:19:47,860 views 14376 688 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:47,868 views 14376 688 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:19:47,868 basehttp 14376 688 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:19:48,903 views 14376 3404 Neo4j服务初始化成功
INFO 2025-04-30 17:19:48,903 views 14376 21180 Neo4j服务初始化成功
INFO 2025-04-30 17:19:48,967 views 14376 13244 Neo4j服务初始化成功
INFO 2025-04-30 17:19:50,583 views 14376 688 Neo4j服务初始化成功
DEBUG 2025-04-30 17:19:50,951 views 14376 3404 ChatAPI实例初始化完成
DEBUG 2025-04-30 17:19:50,951 views 14376 21180 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:50,968 views 14376 3404 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:19:50,969 views 14376 21180 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:19:50,970 basehttp 14376 3404 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:19:50,970 basehttp 14376 21180 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:19:50,995 views 14376 13244 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:51,004 views 14376 13244 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:19:51,004 basehttp 14376 13244 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:19:52,030 autoreload 14376 3020 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 17:19:52,993 autoreload 16952 12776 Watching for file changes with StatReloader
INFO 2025-04-30 17:19:57,251 views 16952 5496 Neo4j服务初始化成功
DEBUG 2025-04-30 17:19:59,295 views 16952 5496 ChatAPI实例初始化完成
INFO 2025-04-30 17:19:59,311 views 16952 5496 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:19:59,313 basehttp 16952 5496 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:01,776 views 16952 17432 Neo4j服务初始化成功
INFO 2025-04-30 17:20:02,659 views 16952 14784 Neo4j服务初始化成功
INFO 2025-04-30 17:20:02,690 views 16952 5496 Neo4j服务初始化成功
INFO 2025-04-30 17:20:03,790 views 16952 4452 Neo4j服务初始化成功
INFO 2025-04-30 17:20:03,805 views 16952 21048 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:03,820 views 16952 17432 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:03,834 views 16952 17432 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:03,834 basehttp 16952 17432 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:20:04,734 views 16952 14784 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:04,736 views 16952 14784 创建新会话成功 - 会话ID: 1746004804736_7287
INFO 2025-04-30 17:20:04,741 basehttp 16952 14784 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:20:04,750 views 16952 5496 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:04,752 views 16952 5496 创建新会话成功 - 会话ID: 1746004804752_4481
INFO 2025-04-30 17:20:04,753 basehttp 16952 5496 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:20:05,112 views 16952 20688 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:05,814 views 16952 4452 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:05,814 views 16952 4452 创建新会话成功 - 会话ID: 1746004805814_9500
INFO 2025-04-30 17:20:05,815 basehttp 16952 4452 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:20:05,845 views 16952 21048 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:05,846 views 16952 21048 创建新会话成功 - 会话ID: 1746004805846_2788
INFO 2025-04-30 17:20:05,847 basehttp 16952 21048 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:20:06,251 views 16952 17432 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:07,163 views 16952 20688 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:07,164 views 16952 20688 创建新会话成功 - 会话ID: 1746004807163_4793
INFO 2025-04-30 17:20:07,164 basehttp 16952 20688 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:20:07,181 views 16952 5496 Neo4j服务初始化成功
INFO 2025-04-30 17:20:07,182 views 16952 14784 Neo4j服务初始化成功
INFO 2025-04-30 17:20:08,171 views 16952 4452 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:08,281 views 16952 17432 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:08,282 views 16952 17432 创建新会话成功 - 会话ID: 1746004808282_4223
INFO 2025-04-30 17:20:08,283 basehttp 16952 17432 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:20:08,872 views 16952 21048 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:09,226 views 16952 5496 ChatAPI实例初始化完成
DEBUG 2025-04-30 17:20:09,227 views 16952 14784 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:09,228 views 16952 5496 创建新会话成功 - 会话ID: 1746004809228_8693
INFO 2025-04-30 17:20:09,229 basehttp 16952 5496 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:20:09,243 views 16952 14784 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:09,245 basehttp 16952 14784 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:09,515 views 16952 20688 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:10,236 views 16952 4452 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:10,237 views 16952 4452 创建新会话成功 - 会话ID: 1746004810236_9439
INFO 2025-04-30 17:20:10,237 basehttp 16952 4452 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:20:10,918 views 16952 21048 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:10,918 views 16952 21048 创建新会话成功 - 会话ID: 1746004810918_9019
INFO 2025-04-30 17:20:10,919 basehttp 16952 21048 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:20:11,565 views 16952 20688 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:11,566 views 16952 20688 创建新会话成功 - 会话ID: 1746004811565_3211
INFO 2025-04-30 17:20:11,566 basehttp 16952 20688 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:20:11,608 views 16952 17432 Neo4j服务初始化成功
INFO 2025-04-30 17:20:11,699 views 16952 5496 Neo4j服务初始化成功
INFO 2025-04-30 17:20:11,726 views 16952 14784 Neo4j服务初始化成功
INFO 2025-04-30 17:20:12,543 views 16952 4452 Neo4j服务初始化成功
INFO 2025-04-30 17:20:13,267 views 16952 21048 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:13,660 views 16952 17432 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:13,662 views 16952 17432 创建新会话成功 - 会话ID: 1746004813661_7158
INFO 2025-04-30 17:20:13,662 basehttp 16952 17432 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:20:13,726 views 16952 5496 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:13,727 views 16952 5496 创建新会话成功 - 会话ID: 1746004813727_3115
INFO 2025-04-30 17:20:13,728 basehttp 16952 5496 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:20:13,756 views 16952 14784 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:13,771 views 16952 14784 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:13,772 basehttp 16952 14784 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:13,885 views 16952 20688 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:14,601 views 16952 4452 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:14,602 views 16952 4452 创建新会话成功 - 会话ID: 1746004814602_3367
INFO 2025-04-30 17:20:14,603 basehttp 16952 4452 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:20:15,304 views 16952 21048 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:15,305 views 16952 21048 创建新会话成功 - 会话ID: 1746004815304_7388
INFO 2025-04-30 17:20:15,306 basehttp 16952 21048 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:20:15,917 views 16952 20688 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:15,934 views 16952 20688 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:15,935 basehttp 16952 20688 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:16,191 views 16952 17432 Neo4j服务初始化成功
INFO 2025-04-30 17:20:16,208 views 16952 5496 Neo4j服务初始化成功
INFO 2025-04-30 17:20:16,253 views 16952 14784 Neo4j服务初始化成功
INFO 2025-04-30 17:20:17,001 views 16952 4452 Neo4j服务初始化成功
INFO 2025-04-30 17:20:17,642 views 16952 21048 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:18,230 views 16952 17432 ChatAPI实例初始化完成
DEBUG 2025-04-30 17:20:18,246 views 16952 5496 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:18,247 views 16952 5496 创建新会话成功 - 会话ID: 1746004818247_5049
INFO 2025-04-30 17:20:18,249 basehttp 16952 5496 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:20:18,253 views 16952 17432 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:18,253 basehttp 16952 17432 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:20:18,356 views 16952 14784 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:18,356 views 16952 20688 Neo4j服务初始化成功
INFO 2025-04-30 17:20:18,359 views 16952 14784 创建新会话成功 - 会话ID: 1746004818358_6104
INFO 2025-04-30 17:20:18,359 basehttp 16952 14784 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:20:19,044 views 16952 4452 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:19,045 views 16952 4452 创建新会话成功 - 会话ID: 1746004819044_7874
INFO 2025-04-30 17:20:19,045 basehttp 16952 4452 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:20:19,692 views 16952 21048 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:19,692 views 16952 21048 创建新会话成功 - 会话ID: 1746004819692_4819
INFO 2025-04-30 17:20:19,692 basehttp 16952 21048 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:20:20,426 views 16952 20688 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:20,437 views 16952 20688 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:20,437 basehttp 16952 20688 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:20,851 views 16952 5496 Neo4j服务初始化成功
INFO 2025-04-30 17:20:20,882 views 16952 17432 Neo4j服务初始化成功
INFO 2025-04-30 17:20:20,922 views 16952 14784 Neo4j服务初始化成功
INFO 2025-04-30 17:20:21,376 views 16952 4452 Neo4j服务初始化成功
INFO 2025-04-30 17:20:22,136 views 16952 21048 Neo4j服务初始化成功
INFO 2025-04-30 17:20:22,740 views 16952 20688 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:22,896 views 16952 5496 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:22,911 views 16952 5496 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:22,912 basehttp 16952 5496 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:20:22,913 views 16952 17432 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:22,930 views 16952 17432 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:22,931 basehttp 16952 17432 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:20:22,974 views 16952 14784 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:22,975 views 16952 14784 创建新会话成功 - 会话ID: 1746004822974_8393
INFO 2025-04-30 17:20:22,975 basehttp 16952 14784 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:20:23,412 views 16952 4452 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:23,413 views 16952 4452 创建新会话成功 - 会话ID: 1746004823413_1757
INFO 2025-04-30 17:20:23,413 basehttp 16952 4452 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:20:24,185 views 16952 21048 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:24,189 views 16952 21048 创建新会话成功 - 会话ID: 1746004824189_3949
INFO 2025-04-30 17:20:24,189 basehttp 16952 21048 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:20:24,812 views 16952 20688 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:24,816 views 16952 20688 创建新会话成功 - 会话ID: 1746004824816_5571
INFO 2025-04-30 17:20:24,816 basehttp 16952 20688 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:20:25,366 views 16952 5496 Neo4j服务初始化成功
INFO 2025-04-30 17:20:25,395 views 16952 17432 Neo4j服务初始化成功
INFO 2025-04-30 17:20:25,422 views 16952 14784 Neo4j服务初始化成功
INFO 2025-04-30 17:20:27,106 views 16952 21048 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:27,431 views 16952 5496 ChatAPI实例初始化完成
DEBUG 2025-04-30 17:20:27,435 views 16952 17432 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:27,435 views 16952 5496 创建新会话成功 - 会话ID: 1746004827435_6780
INFO 2025-04-30 17:20:27,435 views 16952 17432 创建新会话成功 - 会话ID: 1746004827435_2098
INFO 2025-04-30 17:20:27,435 basehttp 16952 5496 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:20:27,435 basehttp 16952 17432 "POST /api/chat/create_session/ HTTP/1.1" 200 57
DEBUG 2025-04-30 17:20:27,478 views 16952 14784 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:27,492 views 16952 14784 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:27,493 basehttp 16952 14784 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:28,255 views 16952 20688 Neo4j服务初始化成功
INFO 2025-04-30 17:20:28,289 views 16952 4452 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:29,171 views 16952 21048 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:29,186 views 16952 21048 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:29,187 basehttp 16952 21048 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:29,819 views 16952 5496 Neo4j服务初始化成功
INFO 2025-04-30 17:20:29,883 views 16952 17432 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:30,293 views 16952 20688 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:30,306 views 16952 20688 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:30,306 basehttp 16952 20688 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:20:30,340 views 16952 4452 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:30,348 views 16952 4452 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:30,348 basehttp 16952 4452 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:31,554 views 16952 21048 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:31,866 views 16952 5496 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:31,877 views 16952 5496 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:31,878 basehttp 16952 5496 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:20:31,922 views 16952 17432 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:31,936 views 16952 17432 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:31,937 basehttp 16952 17432 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:32,582 views 16952 14784 Neo4j服务初始化成功
INFO 2025-04-30 17:20:33,245 views 16952 4452 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:33,589 views 16952 21048 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:33,602 views 16952 21048 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:33,603 basehttp 16952 21048 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:33,913 views 16952 20688 Neo4j服务初始化成功
INFO 2025-04-30 17:20:34,272 views 16952 5496 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:34,629 views 16952 14784 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:34,642 views 16952 14784 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:34,644 basehttp 16952 14784 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:20:35,313 views 16952 4452 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:35,328 views 16952 4452 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:35,329 basehttp 16952 4452 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:20:35,973 views 16952 20688 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:35,986 views 16952 20688 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:35,987 basehttp 16952 20688 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:36,115 views 16952 21048 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:36,317 views 16952 5496 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:36,331 views 16952 5496 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:36,332 basehttp 16952 5496 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:36,925 views 16952 17432 Neo4j服务初始化成功
INFO 2025-04-30 17:20:37,662 views 16952 14784 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:38,171 views 16952 21048 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:38,189 views 16952 21048 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:38,189 basehttp 16952 21048 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:38,643 views 16952 20688 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:38,989 views 16952 17432 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:39,016 views 16952 17432 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:39,016 basehttp 16952 17432 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:20:39,714 views 16952 14784 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:39,729 views 16952 14784 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:39,731 basehttp 16952 14784 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:40,691 views 16952 21048 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:40,707 views 16952 20688 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:40,719 views 16952 20688 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:40,720 basehttp 16952 20688 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:41,387 views 16952 17432 Neo4j服务初始化成功
INFO 2025-04-30 17:20:42,078 views 16952 14784 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:42,735 views 16952 21048 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:42,748 views 16952 21048 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:42,748 basehttp 16952 21048 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:43,023 views 16952 5496 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:43,433 views 16952 17432 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:43,451 views 16952 17432 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:43,451 basehttp 16952 17432 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:20:44,139 views 16952 14784 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:44,152 views 16952 14784 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:44,152 basehttp 16952 14784 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:20:45,069 views 16952 5496 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:45,084 views 16952 5496 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:45,085 basehttp 16952 5496 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:45,763 views 16952 21048 Neo4j服务初始化成功
INFO 2025-04-30 17:20:46,545 views 16952 14784 Neo4j服务初始化成功
INFO 2025-04-30 17:20:47,181 views 16952 17432 Neo4j服务初始化成功
INFO 2025-04-30 17:20:47,390 views 16952 20688 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:47,817 views 16952 21048 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:47,829 views 16952 21048 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:47,830 basehttp 16952 21048 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:20:48,612 views 16952 14784 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:48,625 views 16952 14784 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:48,626 basehttp 16952 14784 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:20:49,237 views 16952 17432 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:49,253 views 16952 17432 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:49,254 basehttp 16952 17432 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:20:49,488 views 16952 20688 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:49,503 views 16952 20688 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:49,503 basehttp 16952 20688 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:49,860 views 16952 5496 Neo4j服务初始化成功
INFO 2025-04-30 17:20:49,905 views 16952 4452 Neo4j服务初始化成功
INFO 2025-04-30 17:20:51,515 views 16952 14784 Neo4j服务初始化成功
INFO 2025-04-30 17:20:51,823 views 16952 17432 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:51,926 views 16952 5496 ChatAPI实例初始化完成
DEBUG 2025-04-30 17:20:51,938 views 16952 4452 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:51,942 views 16952 5496 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:51,942 basehttp 16952 5496 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:51,955 views 16952 4452 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:51,956 basehttp 16952 4452 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:52,674 views 16952 20688 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:53,584 views 16952 14784 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:53,597 views 16952 14784 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:53,598 basehttp 16952 14784 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:20:53,873 views 16952 17432 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:53,881 views 16952 17432 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:53,885 basehttp 16952 17432 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:54,327 views 16952 21048 Neo4j服务初始化成功
INFO 2025-04-30 17:20:54,327 views 16952 5496 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:54,732 views 16952 20688 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:54,765 views 16952 20688 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:54,766 basehttp 16952 20688 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:55,924 views 16952 14784 Neo4j服务初始化成功
INFO 2025-04-30 17:20:56,191 views 16952 4452 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:56,386 views 16952 21048 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:56,399 views 16952 21048 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:56,400 basehttp 16952 21048 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:20:56,402 views 16952 5496 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:56,415 views 16952 5496 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:56,416 basehttp 16952 5496 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:57,657 views 16952 20688 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:57,969 views 16952 14784 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:57,983 views 16952 14784 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:57,984 basehttp 16952 14784 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:20:58,241 views 16952 4452 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:58,249 views 16952 4452 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:58,254 basehttp 16952 4452 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:20:58,344 views 16952 17432 Neo4j服务初始化成功
INFO 2025-04-30 17:20:58,722 views 16952 21048 Neo4j服务初始化成功
DEBUG 2025-04-30 17:20:59,723 views 16952 20688 ChatAPI实例初始化完成
INFO 2025-04-30 17:20:59,737 views 16952 20688 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:20:59,738 basehttp 16952 20688 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:21:00,412 views 16952 17432 ChatAPI实例初始化完成
INFO 2025-04-30 17:21:00,429 views 16952 17432 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:21:00,430 basehttp 16952 17432 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:21:00,623 views 16952 14784 Neo4j服务初始化成功
INFO 2025-04-30 17:21:00,658 views 16952 5496 Neo4j服务初始化成功
DEBUG 2025-04-30 17:21:00,770 views 16952 21048 ChatAPI实例初始化完成
INFO 2025-04-30 17:21:00,785 views 16952 21048 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:21:00,786 basehttp 16952 21048 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:21:02,048 views 16952 4452 Neo4j服务初始化成功
DEBUG 2025-04-30 17:21:02,659 views 16952 14784 ChatAPI实例初始化完成
INFO 2025-04-30 17:21:02,675 views 16952 14784 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:21:02,676 basehttp 16952 14784 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:21:02,692 views 16952 5496 ChatAPI实例初始化完成
INFO 2025-04-30 17:21:02,705 views 16952 5496 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:21:02,706 basehttp 16952 5496 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:21:03,060 views 16952 17432 Neo4j服务初始化成功
DEBUG 2025-04-30 17:21:04,090 views 16952 4452 ChatAPI实例初始化完成
INFO 2025-04-30 17:21:04,105 views 16952 4452 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:21:04,106 basehttp 16952 4452 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:21:05,009 views 16952 14784 Neo4j服务初始化成功
DEBUG 2025-04-30 17:21:05,117 views 16952 17432 ChatAPI实例初始化完成
INFO 2025-04-30 17:21:05,129 views 16952 17432 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:21:05,130 basehttp 16952 17432 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:21:05,779 views 16952 5496 Neo4j服务初始化成功
INFO 2025-04-30 17:21:06,517 views 16952 4452 Neo4j服务初始化成功
DEBUG 2025-04-30 17:21:07,098 views 16952 14784 ChatAPI实例初始化完成
INFO 2025-04-30 17:21:07,110 views 16952 14784 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:21:07,110 basehttp 16952 14784 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:21:07,444 views 16952 21048 Neo4j服务初始化成功
DEBUG 2025-04-30 17:21:07,843 views 16952 5496 ChatAPI实例初始化完成
INFO 2025-04-30 17:21:07,879 views 16952 5496 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:21:07,879 basehttp 16952 5496 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:21:08,548 views 16952 4452 ChatAPI实例初始化完成
INFO 2025-04-30 17:21:08,562 views 16952 4452 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:21:08,563 basehttp 16952 4452 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:21:09,437 views 16952 17432 Neo4j服务初始化成功
DEBUG 2025-04-30 17:21:09,501 views 16952 21048 ChatAPI实例初始化完成
INFO 2025-04-30 17:21:09,509 views 16952 21048 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:21:09,514 basehttp 16952 21048 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:21:10,978 views 16952 4452 Neo4j服务初始化成功
DEBUG 2025-04-30 17:21:11,494 views 16952 17432 ChatAPI实例初始化完成
INFO 2025-04-30 17:21:11,508 views 16952 17432 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:21:11,508 basehttp 16952 17432 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:21:11,628 views 16952 5496 Neo4j服务初始化成功
INFO 2025-04-30 17:21:11,853 views 16952 14784 Neo4j服务初始化成功
DEBUG 2025-04-30 17:21:13,031 views 16952 4452 ChatAPI实例初始化完成
INFO 2025-04-30 17:21:13,047 views 16952 4452 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:21:13,047 basehttp 16952 4452 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:21:13,701 views 16952 5496 ChatAPI实例初始化完成
INFO 2025-04-30 17:21:13,713 views 16952 5496 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:21:13,714 basehttp 16952 5496 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:21:13,831 views 16952 21048 Neo4j服务初始化成功
DEBUG 2025-04-30 17:21:13,936 views 16952 14784 ChatAPI实例初始化完成
INFO 2025-04-30 17:21:13,953 views 16952 14784 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:21:13,953 basehttp 16952 14784 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
DEBUG 2025-04-30 17:21:15,875 views 16952 21048 ChatAPI实例初始化完成
INFO 2025-04-30 17:21:15,889 views 16952 21048 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:21:15,890 basehttp 16952 21048 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:26:20,856 views 16952 13772 Neo4j服务初始化成功
DEBUG 2025-04-30 17:26:22,899 views 16952 13772 ChatAPI实例初始化完成
INFO 2025-04-30 17:26:22,899 views 16952 13772 创建新会话成功 - 会话ID: 1746005182899_3106
INFO 2025-04-30 17:26:22,906 basehttp 16952 13772 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:26:25,277 views 16952 13772 Neo4j服务初始化成功
DEBUG 2025-04-30 17:26:27,333 views 16952 13772 ChatAPI实例初始化完成
INFO 2025-04-30 17:26:27,349 views 16952 13772 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:26:27,350 basehttp 16952 13772 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:26:29,687 views 16952 13772 Neo4j服务初始化成功
DEBUG 2025-04-30 17:26:31,746 views 16952 13772 ChatAPI实例初始化完成
INFO 2025-04-30 17:26:31,763 views 16952 13772 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 17:26:31,764 basehttp 16952 13772 "GET /api/chat/get_history/ HTTP/1.1" 200 1741
INFO 2025-04-30 17:26:51,476 views 16952 24380 Neo4j服务初始化成功
DEBUG 2025-04-30 17:26:53,529 views 16952 24380 ChatAPI实例初始化完成
DEBUG 2025-04-30 17:26:53,533 views 16952 24380 收到stream_chat请求: {'message': ['我的小麦叶片出现了问题，而且我的种植区在河北'], 'session_id': ['1746005182899_3106']}
DEBUG 2025-04-30 17:26:53,534 views 16952 24380 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 17:26:53,534 views 16952 24380 处理消息: 我的小麦叶片出现了问题，而且我的种植区在河北, 会话ID: 1746005182899_3106
INFO 2025-04-30 17:26:53,537 views 16952 24380 获取现有会话: 1746005182899_3106
INFO 2025-04-30 17:26:53,538 views 16952 24380 获取会话历史 - 会话ID: 1746005182899_3106, 历史记录数: 0
DEBUG 2025-04-30 17:26:53,538 views 16952 24380 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦叶片出现了问题，而且我的种植区在河北'}]
DEBUG 2025-04-30 17:26:53,538 views 16952 24380 构建的消息列表长度: 2
INFO 2025-04-30 17:26:53,539 views 16952 24380 检查会话状态: 1746005182899_3106
INFO 2025-04-30 17:26:53,539 views 16952 24380 从Redis获取症状信息 - 会话ID: 1746005182899_3106, 症状: {}
INFO 2025-04-30 17:26:53,540 views 16952 24380 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-30 17:26:53,540 views 16952 24380 创建新会话: 1746005182899_3106
INFO 2025-04-30 17:26:53,540 views 16952 24380 当前症状收集状态: {'1746005182899_3106': {'collecting': True, 'symptoms': {}}}
DEBUG 2025-04-30 17:26:53,540 views 16952 24380 当前症状信息: {}
DEBUG 2025-04-30 17:26:53,541 views 16952 24380 开始提取症状，输入消息: 我的小麦叶片出现了问题，而且我的种植区在河北
DEBUG 2025-04-30 17:26:53,541 views 16952 24380 分句结果: ['我的小麦叶片出现了问题', '而且我的种植区在河北', '我的小麦叶片出现了问题，而且我的种植区在河北']
DEBUG 2025-04-30 17:26:53,541 views 16952 24380 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 17:26:53,541 views 16952 24380 提取到的气象条件: []
DEBUG 2025-04-30 17:26:53,542 views 16952 24380 提取到的生育期: []
DEBUG 2025-04-30 17:26:53,542 views 16952 24380 提取到的种植区: []
DEBUG 2025-04-30 17:26:53,542 views 16952 24380 提取到的发病部位: []
DEBUG 2025-04-30 17:26:53,542 views 16952 24380 提取到的气象条件: []
DEBUG 2025-04-30 17:26:53,542 views 16952 24380 提取到的生育期: []
DEBUG 2025-04-30 17:26:53,543 views 16952 24380 提取到的种植区: ['河北']
DEBUG 2025-04-30 17:26:53,543 views 16952 24380 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 17:26:53,543 views 16952 24380 提取到的气象条件: []
DEBUG 2025-04-30 17:26:53,543 views 16952 24380 提取到的生育期: []
DEBUG 2025-04-30 17:26:53,543 views 16952 24380 提取到的种植区: ['河北']
INFO 2025-04-30 17:26:53,544 views 16952 24380 症状提取结果: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-30 17:26:53,544 views 16952 24380 开始更新症状信息 - 会话ID: 1746005182899_3106, 新症状: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-30 17:26:53,544 views 16952 24380 更新症状类别 - 会话ID: 1746005182899_3106, 类别: plant_part, 值: 叶片
INFO 2025-04-30 17:26:53,545 views 16952 24380 更新症状类别 - 会话ID: 1746005182899_3106, 类别: region, 值: 河北
INFO 2025-04-30 17:26:53,545 views 16952 24380 获取现有会话: 1746005182899_3106
INFO 2025-04-30 17:26:53,545 views 16952 24380 会话已保存到 Redis: 1746005182899_3106
INFO 2025-04-30 17:26:53,546 views 16952 24380 症状信息更新完成 - 会话ID: 1746005182899_3106, 最终症状: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-30 17:26:53,546 views 16952 24380 更新后的症状信息: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-30 17:26:53,546 views 16952 24380 已收集的信息: 目前已经收集到的信息：

- 发病部位：叶片
- 种植区：河北

还需要补充的信息：
- 气象条件
- 生育期
INFO 2025-04-30 17:26:56,371 services 16952 24380 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-30 17:26:56,371 services 16952 24380 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) MATCH (d)-[:OCCURS_IN_REGION]->(r:Region {name: $region}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 17:26:56,380 services 16952 24380 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-30 17:26:56,393 services 16952 24380 查询结果: <neo4j._sync.work.result.Result object at 0x0000022D195ABAA0>
DEBUG 2025-04-30 17:27:10,480 views 16952 24380 添加历史记录成功 - 会话ID: 1746005182899_3106, 角色: user
DEBUG 2025-04-30 17:27:10,484 views 16952 24380 添加历史记录成功 - 会话ID: 1746005182899_3106, 角色: assistant
INFO 2025-04-30 17:27:10,484 basehttp 16952 24380 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%8F%B6%E7%89%87%E5%87%BA%E7%8E%B0%E4%BA%86%E9%97%AE%E9%A2%98%EF%BC%8C%E8%80%8C%E4%B8%94%E6%88%91%E7%9A%84%E7%A7%8D%E6%A4%8D%E5%8C%BA%E5%9C%A8%E6%B2%B3%E5%8C%97&session_id=1746005182899_3106 HTTP/1.1" 200 3552
INFO 2025-04-30 17:27:13,131 views 16952 13772 Neo4j服务初始化成功
DEBUG 2025-04-30 17:27:15,190 views 16952 13772 ChatAPI实例初始化完成
INFO 2025-04-30 17:27:15,203 views 16952 13772 获取所有历史会话 - 会话数: 5
INFO 2025-04-30 17:27:15,204 basehttp 16952 13772 "GET /api/chat/get_history/ HTTP/1.1" 200 2180
INFO 2025-04-30 17:27:36,924 views 16952 13772 Neo4j服务初始化成功
DEBUG 2025-04-30 17:27:38,981 views 16952 13772 ChatAPI实例初始化完成
INFO 2025-04-30 17:27:38,985 views 16952 13772 已清除会话 1746003383417_8941 的所有信息
INFO 2025-04-30 17:27:38,985 basehttp 16952 13772 "POST /api/chat/clear_history/ HTTP/1.1" 200 108
INFO 2025-04-30 17:27:39,222 views 16952 23960 Neo4j服务初始化成功
DEBUG 2025-04-30 17:27:41,284 views 16952 23960 ChatAPI实例初始化完成
INFO 2025-04-30 17:27:41,284 views 16952 23960 已清除会话 1746004041196_6880 的所有信息
INFO 2025-04-30 17:27:41,284 basehttp 16952 23960 "POST /api/chat/clear_history/ HTTP/1.1" 200 108
INFO 2025-04-30 17:27:41,363 views 16952 13772 Neo4j服务初始化成功
INFO 2025-04-30 17:27:41,502 views 16952 21960 Neo4j服务初始化成功
DEBUG 2025-04-30 17:27:43,378 views 16952 13772 ChatAPI实例初始化完成
INFO 2025-04-30 17:27:43,394 views 16952 13772 获取所有历史会话 - 会话数: 3
INFO 2025-04-30 17:27:43,395 basehttp 16952 13772 "GET /api/chat/get_history/ HTTP/1.1" 200 1375
DEBUG 2025-04-30 17:27:43,529 views 16952 21960 ChatAPI实例初始化完成
INFO 2025-04-30 17:27:43,533 views 16952 21960 已清除会话 1746004405425_5037 的所有信息
INFO 2025-04-30 17:27:43,533 basehttp 16952 21960 "POST /api/chat/clear_history/ HTTP/1.1" 200 108
INFO 2025-04-30 17:27:43,711 views 16952 23960 Neo4j服务初始化成功
INFO 2025-04-30 17:27:45,752 views 16952 19248 Neo4j服务初始化成功
DEBUG 2025-04-30 17:27:45,756 views 16952 23960 ChatAPI实例初始化完成
INFO 2025-04-30 17:27:45,756 views 16952 23960 已清除会话 1746005182899_3106 的所有信息
INFO 2025-04-30 17:27:45,756 basehttp 16952 23960 "POST /api/chat/clear_history/ HTTP/1.1" 200 108
INFO 2025-04-30 17:27:45,932 views 16952 21960 Neo4j服务初始化成功
DEBUG 2025-04-30 17:27:47,833 views 16952 19248 ChatAPI实例初始化完成
INFO 2025-04-30 17:27:47,845 views 16952 19248 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 17:27:47,846 basehttp 16952 19248 "GET /api/chat/get_history/ HTTP/1.1" 200 497
DEBUG 2025-04-30 17:27:47,972 views 16952 21960 ChatAPI实例初始化完成
INFO 2025-04-30 17:27:47,972 views 16952 21960 已清除会话 1745999606549_6123 的所有信息
INFO 2025-04-30 17:27:47,972 basehttp 16952 21960 "POST /api/chat/clear_history/ HTTP/1.1" 200 108
INFO 2025-04-30 17:27:50,165 views 16952 23960 Neo4j服务初始化成功
DEBUG 2025-04-30 17:27:52,192 views 16952 23960 ChatAPI实例初始化完成
INFO 2025-04-30 17:27:52,209 views 16952 23960 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 17:27:52,210 basehttp 16952 23960 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-30 17:27:54,521 views 16952 21960 Neo4j服务初始化成功
DEBUG 2025-04-30 17:27:56,567 views 16952 21960 ChatAPI实例初始化完成
INFO 2025-04-30 17:27:56,579 views 16952 21960 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 17:27:56,580 basehttp 16952 21960 - Broken pipe from ('127.0.0.1', 58753)
INFO 2025-04-30 17:28:07,490 views 16952 23960 Neo4j服务初始化成功
DEBUG 2025-04-30 17:28:09,560 views 16952 23960 ChatAPI实例初始化完成
INFO 2025-04-30 17:28:09,560 views 16952 23960 创建新会话成功 - 会话ID: 1746005289560_9254
INFO 2025-04-30 17:28:09,560 basehttp 16952 23960 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:28:11,886 views 16952 23960 Neo4j服务初始化成功
DEBUG 2025-04-30 17:28:13,947 views 16952 23960 ChatAPI实例初始化完成
INFO 2025-04-30 17:28:13,969 views 16952 23960 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 17:28:13,970 basehttp 16952 23960 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-30 17:28:16,297 views 16952 23960 Neo4j服务初始化成功
DEBUG 2025-04-30 17:28:18,349 views 16952 23960 ChatAPI实例初始化完成
INFO 2025-04-30 17:28:18,372 views 16952 23960 获取所有历史会话 - 会话数: 0
INFO 2025-04-30 17:28:18,372 basehttp 16952 23960 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-04-30 17:28:52,498 views 16952 15460 Neo4j服务初始化成功
DEBUG 2025-04-30 17:28:54,535 views 16952 15460 ChatAPI实例初始化完成
DEBUG 2025-04-30 17:28:54,535 views 16952 15460 收到stream_chat请求: {'message': ['你好，我的小麦好像生病了，叶片部位似乎有很大的问题'], 'session_id': ['1746005289560_9254']}
DEBUG 2025-04-30 17:28:54,539 views 16952 15460 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 17:28:54,546 views 16952 15460 处理消息: 你好，我的小麦好像生病了，叶片部位似乎有很大的问题, 会话ID: 1746005289560_9254
INFO 2025-04-30 17:28:54,549 views 16952 15460 获取现有会话: 1746005289560_9254
INFO 2025-04-30 17:28:54,550 views 16952 15460 获取会话历史 - 会话ID: 1746005289560_9254, 历史记录数: 0
DEBUG 2025-04-30 17:28:54,551 views 16952 15460 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好，我的小麦好像生病了，叶片部位似乎有很大的问题'}]
DEBUG 2025-04-30 17:28:54,553 views 16952 15460 构建的消息列表长度: 2
INFO 2025-04-30 17:28:54,554 views 16952 15460 检查会话状态: 1746005289560_9254
INFO 2025-04-30 17:28:54,555 views 16952 15460 从Redis获取症状信息 - 会话ID: 1746005289560_9254, 症状: {}
INFO 2025-04-30 17:28:54,555 views 16952 15460 从缓存获取的症状信息: {'collecting': True, 'symptoms': {}}
INFO 2025-04-30 17:28:54,555 views 16952 15460 创建新会话: 1746005289560_9254
INFO 2025-04-30 17:28:54,555 views 16952 15460 当前症状收集状态: {'1746005289560_9254': {'collecting': True, 'symptoms': {}}}
DEBUG 2025-04-30 17:28:54,556 views 16952 15460 当前症状信息: {}
DEBUG 2025-04-30 17:28:54,556 views 16952 15460 开始提取症状，输入消息: 你好，我的小麦好像生病了，叶片部位似乎有很大的问题
DEBUG 2025-04-30 17:28:54,556 views 16952 15460 分句结果: ['你好', '我的小麦好像生病了', '叶片部位似乎有很大的问题', '你好，我的小麦好像生病了，叶片部位似乎有很大的问题']
DEBUG 2025-04-30 17:28:54,556 views 16952 15460 提取到的发病部位: []
DEBUG 2025-04-30 17:28:54,556 views 16952 15460 提取到的气象条件: []
DEBUG 2025-04-30 17:28:54,557 views 16952 15460 提取到的生育期: []
DEBUG 2025-04-30 17:28:54,557 views 16952 15460 提取到的种植区: []
DEBUG 2025-04-30 17:28:54,557 views 16952 15460 提取到的发病部位: []
DEBUG 2025-04-30 17:28:54,557 views 16952 15460 提取到的气象条件: []
DEBUG 2025-04-30 17:28:54,557 views 16952 15460 提取到的生育期: []
DEBUG 2025-04-30 17:28:54,558 views 16952 15460 提取到的种植区: []
DEBUG 2025-04-30 17:28:54,558 views 16952 15460 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 17:28:54,558 views 16952 15460 提取到的气象条件: []
DEBUG 2025-04-30 17:28:54,558 views 16952 15460 提取到的生育期: []
DEBUG 2025-04-30 17:28:54,558 views 16952 15460 提取到的种植区: []
DEBUG 2025-04-30 17:28:54,559 views 16952 15460 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 17:28:54,559 views 16952 15460 提取到的气象条件: []
DEBUG 2025-04-30 17:28:54,559 views 16952 15460 提取到的生育期: []
DEBUG 2025-04-30 17:28:54,559 views 16952 15460 提取到的种植区: []
INFO 2025-04-30 17:28:54,560 views 16952 15460 症状提取结果: {'plant_part': '叶片'}
INFO 2025-04-30 17:28:54,560 views 16952 15460 开始更新症状信息 - 会话ID: 1746005289560_9254, 新症状: {'plant_part': '叶片'}
INFO 2025-04-30 17:28:54,560 views 16952 15460 更新症状类别 - 会话ID: 1746005289560_9254, 类别: plant_part, 值: 叶片
INFO 2025-04-30 17:28:54,561 views 16952 15460 获取现有会话: 1746005289560_9254
INFO 2025-04-30 17:28:54,562 views 16952 15460 会话已保存到 Redis: 1746005289560_9254
INFO 2025-04-30 17:28:54,562 views 16952 15460 症状信息更新完成 - 会话ID: 1746005289560_9254, 最终症状: {'plant_part': '叶片'}
INFO 2025-04-30 17:28:54,562 views 16952 15460 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-30 17:28:54,563 views 16952 15460 已收集的信息: 目前已经收集到的信息：

- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 种植区
INFO 2025-04-30 17:28:57,228 services 16952 15460 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 17:28:57,228 services 16952 15460 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 17:28:57,228 services 16952 15460 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 17:28:57,236 services 16952 15460 查询结果: <neo4j._sync.work.result.Result object at 0x0000022D1A732C30>
DEBUG 2025-04-30 17:29:18,731 views 16952 15460 添加历史记录成功 - 会话ID: 1746005289560_9254, 角色: user
DEBUG 2025-04-30 17:29:18,731 views 16952 15460 添加历史记录成功 - 会话ID: 1746005289560_9254, 角色: assistant
INFO 2025-04-30 17:29:18,731 basehttp 16952 15460 "GET /api/chat/stream_chat/?message=%E4%BD%A0%E5%A5%BD%EF%BC%8C%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%A5%BD%E5%83%8F%E7%94%9F%E7%97%85%E4%BA%86%EF%BC%8C%E5%8F%B6%E7%89%87%E9%83%A8%E4%BD%8D%E4%BC%BC%E4%B9%8E%E6%9C%89%E5%BE%88%E5%A4%A7%E7%9A%84%E9%97%AE%E9%A2%98&session_id=1746005289560_9254 HTTP/1.1" 200 5108
INFO 2025-04-30 17:29:21,457 views 16952 23960 Neo4j服务初始化成功
DEBUG 2025-04-30 17:29:23,501 views 16952 23960 ChatAPI实例初始化完成
INFO 2025-04-30 17:29:23,516 views 16952 23960 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 17:29:23,517 basehttp 16952 23960 "GET /api/chat/get_history/ HTTP/1.1" 200 437
INFO 2025-04-30 17:29:51,658 views 16952 22936 Neo4j服务初始化成功
DEBUG 2025-04-30 17:29:53,701 views 16952 22936 ChatAPI实例初始化完成
DEBUG 2025-04-30 17:29:53,701 views 16952 22936 收到stream_chat请求: {'message': ['小麦的种植区是河北'], 'session_id': ['1746005289560_9254']}
DEBUG 2025-04-30 17:29:53,701 views 16952 22936 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 17:29:53,701 views 16952 22936 处理消息: 小麦的种植区是河北, 会话ID: 1746005289560_9254
INFO 2025-04-30 17:29:53,701 views 16952 22936 获取现有会话: 1746005289560_9254
INFO 2025-04-30 17:29:53,701 views 16952 22936 获取会话历史 - 会话ID: 1746005289560_9254, 历史记录数: 2
DEBUG 2025-04-30 17:29:53,701 views 16952 22936 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好，我的小麦好像生病了，叶片部位似乎有很大的问题', 'timestamp': 1746005358.7312198}, {'role': 'assistant', 'content': '根据目前掌握的信息：\n发病部位：叶片\n\n可能的病害有：\n\n1. 小麦黑颖病\n   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或不饱满，发病轻的种子颜色变深；叶片染病初呈水渍状小点，渐沿叶脉向上、下扩展为黄褐色条状斑；穗...\n\n2. 小麦黑节病\n   主要特征: 叶片染病初生水渍状条斑，后变为黄褐色，最后呈浓褐色，病斑长椭圆形，也有中间色浅些的；叶鞘染病沿叶脉形成黑褐色长形条斑，多与叶上病斑相连，后叶鞘全部变为浅褐色；茎秆染病主要为害节部，病部呈浓褐色，内部也...\n\n3. 小麦黄矮病毒病\n   主要特征: 叶片典型症状是新叶发病从叶尖渐向叶基扩展变黄，黄化部分占全叶的1/3 - 1/2，叶基仍为绿色，且保持较长时间，有时出现与叶脉平行但不受叶脉限制的黄绿相间条纹，病叶较光滑，发病早植株矮化严重，但因品种...\n\n请补充更多信息，以便我更准确地判断。', 'timestamp': 1746005358.7312198}, {'role': 'user', 'content': '小麦的种植区是河北'}]
DEBUG 2025-04-30 17:29:53,705 views 16952 22936 构建的消息列表长度: 4
DEBUG 2025-04-30 17:29:57,033 views 16952 22936 添加历史记录成功 - 会话ID: 1746005289560_9254, 角色: user
DEBUG 2025-04-30 17:29:57,033 views 16952 22936 添加历史记录成功 - 会话ID: 1746005289560_9254, 角色: assistant
INFO 2025-04-30 17:29:57,033 basehttp 16952 22936 "GET /api/chat/stream_chat/?message=%E5%B0%8F%E9%BA%A6%E7%9A%84%E7%A7%8D%E6%A4%8D%E5%8C%BA%E6%98%AF%E6%B2%B3%E5%8C%97&session_id=1746005289560_9254 HTTP/1.1" 200 1561
INFO 2025-04-30 17:29:59,488 views 16952 23960 Neo4j服务初始化成功
DEBUG 2025-04-30 17:30:01,543 views 16952 23960 ChatAPI实例初始化完成
INFO 2025-04-30 17:30:01,567 views 16952 23960 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 17:30:01,569 basehttp 16952 23960 "GET /api/chat/get_history/ HTTP/1.1" 200 501
INFO 2025-04-30 17:30:49,065 views 16952 21672 Neo4j服务初始化成功
DEBUG 2025-04-30 17:30:51,118 views 16952 21672 ChatAPI实例初始化完成
DEBUG 2025-04-30 17:30:51,122 views 16952 21672 收到stream_chat请求: {'message': ['小麦的生病部位是叶片'], 'session_id': ['1746005289560_9254']}
DEBUG 2025-04-30 17:30:51,122 views 16952 21672 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 17:30:51,122 views 16952 21672 处理消息: 小麦的生病部位是叶片, 会话ID: 1746005289560_9254
INFO 2025-04-30 17:30:51,122 views 16952 21672 获取现有会话: 1746005289560_9254
INFO 2025-04-30 17:30:51,126 views 16952 21672 获取会话历史 - 会话ID: 1746005289560_9254, 历史记录数: 4
DEBUG 2025-04-30 17:30:51,126 views 16952 21672 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '你好，我的小麦好像生病了，叶片部位似乎有很大的问题', 'timestamp': 1746005358.7312198}, {'role': 'assistant', 'content': '根据目前掌握的信息：\n发病部位：叶片\n\n可能的病害有：\n\n1. 小麦黑颖病\n   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或不饱满，发病轻的种子颜色变深；叶片染病初呈水渍状小点，渐沿叶脉向上、下扩展为黄褐色条状斑；穗...\n\n2. 小麦黑节病\n   主要特征: 叶片染病初生水渍状条斑，后变为黄褐色，最后呈浓褐色，病斑长椭圆形，也有中间色浅些的；叶鞘染病沿叶脉形成黑褐色长形条斑，多与叶上病斑相连，后叶鞘全部变为浅褐色；茎秆染病主要为害节部，病部呈浓褐色，内部也...\n\n3. 小麦黄矮病毒病\n   主要特征: 叶片典型症状是新叶发病从叶尖渐向叶基扩展变黄，黄化部分占全叶的1/3 - 1/2，叶基仍为绿色，且保持较长时间，有时出现与叶脉平行但不受叶脉限制的黄绿相间条纹，病叶较光滑，发病早植株矮化严重，但因品种...\n\n请补充更多信息，以便我更准确地判断。', 'timestamp': 1746005358.7312198}, {'role': 'user', 'content': '小麦的种植区是河北', 'timestamp': 1746005397.0330646}, {'role': 'assistant', 'content': '仅知道种植区为河北，信息还不够充分。还请您告诉我小麦从哪个部位最先开始发病，发病时的气象条件（比如温度、湿度、是否多雨等），小麦处于什么生育期（比如苗期、拔节期、抽穗期等 ），以及叶片具体呈现怎样的症状（如是否有斑点、霉层、变色、萎蔫等 ），这样我就能更精准地诊断小麦病害。 ', 'timestamp': 1746005397.0330646}, {'role': 'user', 'content': '小麦的生病部位是叶片'}]
DEBUG 2025-04-30 17:30:51,127 views 16952 21672 构建的消息列表长度: 6
INFO 2025-04-30 17:30:51,127 views 16952 21672 检查会话状态: 1746005289560_9254
INFO 2025-04-30 17:30:51,129 views 16952 21672 从Redis获取症状信息 - 会话ID: 1746005289560_9254, 症状: {'plant_part': '叶片'}
INFO 2025-04-30 17:30:51,129 views 16952 21672 从缓存获取的症状信息: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
INFO 2025-04-30 17:30:51,129 views 16952 21672 创建新会话: 1746005289560_9254
INFO 2025-04-30 17:30:51,129 views 16952 21672 当前症状收集状态: {'1746005289560_9254': {'collecting': True, 'symptoms': {'plant_part': '叶片'}}}
DEBUG 2025-04-30 17:30:51,129 views 16952 21672 当前症状信息: {'plant_part': '叶片'}
DEBUG 2025-04-30 17:30:51,130 views 16952 21672 开始提取症状，输入消息: 小麦的生病部位是叶片
DEBUG 2025-04-30 17:30:51,130 views 16952 21672 分句结果: ['小麦的生病部位是叶片', '小麦的生病部位是叶片']
DEBUG 2025-04-30 17:30:51,130 views 16952 21672 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 17:30:51,130 views 16952 21672 提取到的气象条件: []
DEBUG 2025-04-30 17:30:51,130 views 16952 21672 提取到的生育期: []
DEBUG 2025-04-30 17:30:51,131 views 16952 21672 提取到的种植区: []
DEBUG 2025-04-30 17:30:51,131 views 16952 21672 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 17:30:51,131 views 16952 21672 提取到的气象条件: []
DEBUG 2025-04-30 17:30:51,131 views 16952 21672 提取到的生育期: []
DEBUG 2025-04-30 17:30:51,131 views 16952 21672 提取到的种植区: []
INFO 2025-04-30 17:30:51,131 views 16952 21672 症状提取结果: {'plant_part': '叶片'}
INFO 2025-04-30 17:30:51,132 views 16952 21672 开始更新症状信息 - 会话ID: 1746005289560_9254, 新症状: {'plant_part': '叶片'}
INFO 2025-04-30 17:30:51,132 views 16952 21672 更新症状类别 - 会话ID: 1746005289560_9254, 类别: plant_part, 值: 叶片
INFO 2025-04-30 17:30:51,132 views 16952 21672 获取现有会话: 1746005289560_9254
INFO 2025-04-30 17:30:51,133 views 16952 21672 会话已保存到 Redis: 1746005289560_9254
INFO 2025-04-30 17:30:51,133 views 16952 21672 症状信息更新完成 - 会话ID: 1746005289560_9254, 最终症状: {'plant_part': '叶片'}
INFO 2025-04-30 17:30:51,133 views 16952 21672 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-30 17:30:51,134 views 16952 21672 已收集的信息: 目前已经收集到的信息：

- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 种植区
INFO 2025-04-30 17:30:53,802 services 16952 21672 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 17:30:53,802 services 16952 21672 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 17:30:53,802 services 16952 21672 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 17:30:53,805 services 16952 21672 查询结果: <neo4j._sync.work.result.Result object at 0x0000022D1B7ADA90>
DEBUG 2025-04-30 17:31:15,272 views 16952 21672 添加历史记录成功 - 会话ID: 1746005289560_9254, 角色: user
DEBUG 2025-04-30 17:31:15,272 views 16952 21672 添加历史记录成功 - 会话ID: 1746005289560_9254, 角色: assistant
INFO 2025-04-30 17:31:15,272 basehttp 16952 21672 "GET /api/chat/stream_chat/?message=%E5%B0%8F%E9%BA%A6%E7%9A%84%E7%94%9F%E7%97%85%E9%83%A8%E4%BD%8D%E6%98%AF%E5%8F%B6%E7%89%87&session_id=1746005289560_9254 HTTP/1.1" 200 5108
INFO 2025-04-30 17:31:18,148 views 16952 23960 Neo4j服务初始化成功
DEBUG 2025-04-30 17:31:20,205 views 16952 23960 ChatAPI实例初始化完成
INFO 2025-04-30 17:31:20,220 views 16952 23960 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 17:31:20,220 basehttp 16952 23960 "GET /api/chat/get_history/ HTTP/1.1" 200 437
INFO 2025-04-30 17:33:15,965 autoreload 16952 12776 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 17:33:16,915 autoreload 10188 20244 Watching for file changes with StatReloader
INFO 2025-04-30 17:35:06,396 autoreload 10188 20244 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 17:35:07,205 autoreload 16276 4744 Watching for file changes with StatReloader
INFO 2025-04-30 17:35:12,179 views 16276 1916 Neo4j服务初始化成功
DEBUG 2025-04-30 17:35:14,225 views 16276 1916 ChatAPI实例初始化完成
INFO 2025-04-30 17:35:14,229 views 16276 1916 创建新会话成功 - 会话ID: 1746005714225_7968
INFO 2025-04-30 17:35:14,231 basehttp 16276 1916 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:35:16,557 views 16276 1916 Neo4j服务初始化成功
DEBUG 2025-04-30 17:35:18,612 views 16276 1916 ChatAPI实例初始化完成
INFO 2025-04-30 17:35:18,624 views 16276 1916 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 17:35:18,625 basehttp 16276 1916 "GET /api/chat/get_history/ HTTP/1.1" 200 437
INFO 2025-04-30 17:35:20,971 views 16276 1916 Neo4j服务初始化成功
DEBUG 2025-04-30 17:35:23,043 views 16276 1916 ChatAPI实例初始化完成
INFO 2025-04-30 17:35:23,055 views 16276 1916 获取所有历史会话 - 会话数: 1
INFO 2025-04-30 17:35:23,059 basehttp 16276 1916 "GET /api/chat/get_history/ HTTP/1.1" 200 437
INFO 2025-04-30 17:35:41,122 views 16276 21652 Neo4j服务初始化成功
DEBUG 2025-04-30 17:35:43,171 views 16276 21652 ChatAPI实例初始化完成
DEBUG 2025-04-30 17:35:43,173 views 16276 21652 收到stream_chat请求: {'message': ['我的小麦出现问题了，目前看来叶片的问题很严重'], 'session_id': ['1746005714225_7968']}
DEBUG 2025-04-30 17:35:43,173 views 16276 21652 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 17:35:43,177 views 16276 21652 处理消息: 我的小麦出现问题了，目前看来叶片的问题很严重, 会话ID: 1746005714225_7968
INFO 2025-04-30 17:35:43,181 views 16276 21652 获取现有会话: 1746005714225_7968
INFO 2025-04-30 17:35:43,181 views 16276 21652 获取会话历史 - 会话ID: 1746005714225_7968, 历史记录数: 0
DEBUG 2025-04-30 17:35:43,181 views 16276 21652 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦出现问题了，目前看来叶片的问题很严重'}]
DEBUG 2025-04-30 17:35:43,181 views 16276 21652 构建的消息列表长度: 2
INFO 2025-04-30 17:35:43,181 views 16276 21652 检查会话状态: 1746005714225_7968
INFO 2025-04-30 17:35:43,181 views 16276 21652 创建新会话: 1746005714225_7968
INFO 2025-04-30 17:35:43,181 views 16276 21652 当前症状收集状态: {'collecting': True, 'symptoms': {}}
DEBUG 2025-04-30 17:35:43,181 views 16276 21652 当前症状信息: {}
DEBUG 2025-04-30 17:35:43,181 views 16276 21652 开始提取症状，输入消息: 我的小麦出现问题了，目前看来叶片的问题很严重
DEBUG 2025-04-30 17:35:43,181 views 16276 21652 分句结果: ['我的小麦出现问题了', '目前看来叶片的问题很严重', '我的小麦出现问题了，目前看来叶片的问题很严重']
DEBUG 2025-04-30 17:35:43,181 views 16276 21652 提取到的发病部位: []
DEBUG 2025-04-30 17:35:43,185 views 16276 21652 提取到的气象条件: []
DEBUG 2025-04-30 17:35:43,185 views 16276 21652 提取到的生育期: []
DEBUG 2025-04-30 17:35:43,185 views 16276 21652 提取到的种植区: []
DEBUG 2025-04-30 17:35:43,185 views 16276 21652 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 17:35:43,185 views 16276 21652 提取到的气象条件: []
DEBUG 2025-04-30 17:35:43,185 views 16276 21652 提取到的生育期: []
DEBUG 2025-04-30 17:35:43,185 views 16276 21652 提取到的种植区: []
DEBUG 2025-04-30 17:35:43,185 views 16276 21652 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 17:35:43,185 views 16276 21652 提取到的气象条件: []
DEBUG 2025-04-30 17:35:43,187 views 16276 21652 提取到的生育期: []
DEBUG 2025-04-30 17:35:43,187 views 16276 21652 提取到的种植区: []
INFO 2025-04-30 17:35:43,188 views 16276 21652 症状提取结果: {'plant_part': '叶片'}
INFO 2025-04-30 17:35:43,188 views 16276 21652 开始更新症状信息 - 会话ID: 1746005714225_7968, 新症状: {'plant_part': '叶片'}
DEBUG 2025-04-30 17:35:43,188 views 16276 21652 从Redis获取到的现有症状: {}
INFO 2025-04-30 17:35:43,188 views 16276 21652 更新症状类别 - 会话ID: 1746005714225_7968, 类别: plant_part, 值: 叶片
INFO 2025-04-30 17:35:43,188 views 16276 21652 保存症状信息到Redis - 会话ID: 1746005714225_7968, 症状: {'plant_part': '叶片'}
INFO 2025-04-30 17:35:43,188 views 16276 21652 获取现有会话: 1746005714225_7968
INFO 2025-04-30 17:35:43,188 views 16276 21652 会话已保存到 Redis: 1746005714225_7968
INFO 2025-04-30 17:35:43,188 views 16276 21652 症状信息更新完成 - 会话ID: 1746005714225_7968, 最终症状: {'plant_part': '叶片'}
INFO 2025-04-30 17:35:43,188 views 16276 21652 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-30 17:35:43,188 views 16276 21652 已收集的信息: 目前已经收集到的信息：

- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 种植区
INFO 2025-04-30 17:35:45,870 services 16276 21652 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 17:35:45,870 services 16276 21652 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 17:35:45,870 services 16276 21652 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 17:35:45,874 services 16276 21652 查询结果: <neo4j._sync.work.result.Result object at 0x000001888B232480>
DEBUG 2025-04-30 17:36:07,343 views 16276 21652 添加历史记录成功 - 会话ID: 1746005714225_7968, 角色: user
DEBUG 2025-04-30 17:36:07,343 views 16276 21652 添加历史记录成功 - 会话ID: 1746005714225_7968, 角色: assistant
INFO 2025-04-30 17:36:07,343 basehttp 16276 21652 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%87%BA%E7%8E%B0%E9%97%AE%E9%A2%98%E4%BA%86%EF%BC%8C%E7%9B%AE%E5%89%8D%E7%9C%8B%E6%9D%A5%E5%8F%B6%E7%89%87%E7%9A%84%E9%97%AE%E9%A2%98%E5%BE%88%E4%B8%A5%E9%87%8D&session_id=1746005714225_7968 HTTP/1.1" 200 5108
INFO 2025-04-30 17:36:10,052 views 16276 1916 Neo4j服务初始化成功
DEBUG 2025-04-30 17:36:12,135 views 16276 1916 ChatAPI实例初始化完成
INFO 2025-04-30 17:36:12,151 views 16276 1916 获取所有历史会话 - 会话数: 2
INFO 2025-04-30 17:36:12,151 basehttp 16276 1916 "GET /api/chat/get_history/ HTTP/1.1" 200 840
INFO 2025-04-30 17:36:24,289 views 16276 13576 Neo4j服务初始化成功
DEBUG 2025-04-30 17:36:26,350 views 16276 13576 ChatAPI实例初始化完成
DEBUG 2025-04-30 17:36:26,350 views 16276 13576 收到stream_chat请求: {'message': ['小麦的种植区是河北'], 'session_id': ['1746005714225_7968']}
DEBUG 2025-04-30 17:36:26,354 views 16276 13576 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 17:36:26,354 views 16276 13576 处理消息: 小麦的种植区是河北, 会话ID: 1746005714225_7968
INFO 2025-04-30 17:36:26,354 views 16276 13576 获取现有会话: 1746005714225_7968
INFO 2025-04-30 17:36:26,354 views 16276 13576 获取会话历史 - 会话ID: 1746005714225_7968, 历史记录数: 2
DEBUG 2025-04-30 17:36:26,354 views 16276 13576 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦出现问题了，目前看来叶片的问题很严重', 'timestamp': 1746005767.3432481}, {'role': 'assistant', 'content': '根据目前掌握的信息：\n发病部位：叶片\n\n可能的病害有：\n\n1. 小麦黑颖病\n   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或不饱满，发病轻的种子颜色变深；叶片染病初呈水渍状小点，渐沿叶脉向上、下扩展为黄褐色条状斑；穗...\n\n2. 小麦黑节病\n   主要特征: 叶片染病初生水渍状条斑，后变为黄褐色，最后呈浓褐色，病斑长椭圆形，也有中间色浅些的；叶鞘染病沿叶脉形成黑褐色长形条斑，多与叶上病斑相连，后叶鞘全部变为浅褐色；茎秆染病主要为害节部，病部呈浓褐色，内部也...\n\n3. 小麦黄矮病毒病\n   主要特征: 叶片典型症状是新叶发病从叶尖渐向叶基扩展变黄，黄化部分占全叶的1/3 - 1/2，叶基仍为绿色，且保持较长时间，有时出现与叶脉平行但不受叶脉限制的黄绿相间条纹，病叶较光滑，发病早植株矮化严重，但因品种...\n\n请补充更多信息，以便我更准确地判断。', 'timestamp': 1746005767.3432481}, {'role': 'user', 'content': '小麦的种植区是河北'}]
DEBUG 2025-04-30 17:36:26,354 views 16276 13576 构建的消息列表长度: 4
DEBUG 2025-04-30 17:36:32,493 views 16276 13576 添加历史记录成功 - 会话ID: 1746005714225_7968, 角色: user
DEBUG 2025-04-30 17:36:32,493 views 16276 13576 添加历史记录成功 - 会话ID: 1746005714225_7968, 角色: assistant
INFO 2025-04-30 17:36:32,493 basehttp 16276 13576 "GET /api/chat/stream_chat/?message=%E5%B0%8F%E9%BA%A6%E7%9A%84%E7%A7%8D%E6%A4%8D%E5%8C%BA%E6%98%AF%E6%B2%B3%E5%8C%97&session_id=1746005714225_7968 HTTP/1.1" 200 1706
INFO 2025-04-30 17:36:34,971 views 16276 1916 Neo4j服务初始化成功
DEBUG 2025-04-30 17:36:37,025 views 16276 1916 ChatAPI实例初始化完成
INFO 2025-04-30 17:36:37,033 views 16276 1916 获取所有历史会话 - 会话数: 2
INFO 2025-04-30 17:36:37,037 basehttp 16276 1916 "GET /api/chat/get_history/ HTTP/1.1" 200 904
INFO 2025-04-30 17:40:10,183 views 16276 9480 Neo4j服务初始化成功
DEBUG 2025-04-30 17:40:12,240 views 16276 9480 ChatAPI实例初始化完成
DEBUG 2025-04-30 17:40:12,240 views 16276 9480 收到stream_chat请求: {'message': ['目前已知什么消息'], 'session_id': ['1746005714225_7968']}
DEBUG 2025-04-30 17:40:12,240 views 16276 9480 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 17:40:12,240 views 16276 9480 处理消息: 目前已知什么消息, 会话ID: 1746005714225_7968
INFO 2025-04-30 17:40:12,244 views 16276 9480 获取现有会话: 1746005714225_7968
INFO 2025-04-30 17:40:12,244 views 16276 9480 获取会话历史 - 会话ID: 1746005714225_7968, 历史记录数: 4
DEBUG 2025-04-30 17:40:12,244 views 16276 9480 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦出现问题了，目前看来叶片的问题很严重', 'timestamp': 1746005767.3432481}, {'role': 'assistant', 'content': '根据目前掌握的信息：\n发病部位：叶片\n\n可能的病害有：\n\n1. 小麦黑颖病\n   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或不饱满，发病轻的种子颜色变深；叶片染病初呈水渍状小点，渐沿叶脉向上、下扩展为黄褐色条状斑；穗...\n\n2. 小麦黑节病\n   主要特征: 叶片染病初生水渍状条斑，后变为黄褐色，最后呈浓褐色，病斑长椭圆形，也有中间色浅些的；叶鞘染病沿叶脉形成黑褐色长形条斑，多与叶上病斑相连，后叶鞘全部变为浅褐色；茎秆染病主要为害节部，病部呈浓褐色，内部也...\n\n3. 小麦黄矮病毒病\n   主要特征: 叶片典型症状是新叶发病从叶尖渐向叶基扩展变黄，黄化部分占全叶的1/3 - 1/2，叶基仍为绿色，且保持较长时间，有时出现与叶脉平行但不受叶脉限制的黄绿相间条纹，病叶较光滑，发病早植株矮化严重，但因品种...\n\n请补充更多信息，以便我更准确地判断。', 'timestamp': 1746005767.3432481}, {'role': 'user', 'content': '小麦的种植区是河北', 'timestamp': 1746005792.4898849}, {'role': 'assistant', 'content': '仅知道种植区为河北，关于小麦叶片具体症状信息还是较少。为更准确诊断，还请告知：从叶片哪个部位开始发病（叶尖、叶基部等），发病时的气象条件（温度、湿度、降雨等情况），小麦处于什么生育期（苗期、拔节期、抽穗期等），叶片除了有问题，是否有其他异常表现（如霉层、斑点颜色等） 。这些信息对判断病害类型很关键。 ', 'timestamp': 1746005792.4938736}, {'role': 'user', 'content': '目前已知什么消息'}]
DEBUG 2025-04-30 17:40:12,248 views 16276 9480 构建的消息列表长度: 6
DEBUG 2025-04-30 17:40:21,960 views 16276 9480 添加历史记录成功 - 会话ID: 1746005714225_7968, 角色: user
DEBUG 2025-04-30 17:40:21,960 views 16276 9480 添加历史记录成功 - 会话ID: 1746005714225_7968, 角色: assistant
INFO 2025-04-30 17:40:21,960 basehttp 16276 9480 "GET /api/chat/stream_chat/?message=%E7%9B%AE%E5%89%8D%E5%B7%B2%E7%9F%A5%E4%BB%80%E4%B9%88%E6%B6%88%E6%81%AF&session_id=1746005714225_7968 HTTP/1.1" 200 5311
INFO 2025-04-30 17:40:25,018 views 16276 1916 Neo4j服务初始化成功
DEBUG 2025-04-30 17:40:27,082 views 16276 1916 ChatAPI实例初始化完成
INFO 2025-04-30 17:40:27,100 views 16276 1916 获取所有历史会话 - 会话数: 2
INFO 2025-04-30 17:40:27,100 basehttp 16276 1916 "GET /api/chat/get_history/ HTTP/1.1" 200 860
INFO 2025-04-30 17:44:15,959 autoreload 22108 18452 Watching for file changes with StatReloader
INFO 2025-04-30 17:49:28,587 views 22108 1708 Neo4j服务初始化成功
DEBUG 2025-04-30 17:49:30,627 views 22108 1708 ChatAPI实例初始化完成
INFO 2025-04-30 17:49:30,641 views 22108 1708 创建新会话成功 - 会话ID: 1746006570627_7907
INFO 2025-04-30 17:49:30,642 basehttp 22108 1708 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:49:32,992 views 22108 24216 Neo4j服务初始化成功
DEBUG 2025-04-30 17:49:35,043 views 22108 24216 ChatAPI实例初始化完成
INFO 2025-04-30 17:49:35,070 views 22108 24216 获取所有历史会话 - 会话数: 2
INFO 2025-04-30 17:49:35,071 basehttp 22108 24216 "GET /api/chat/get_history/ HTTP/1.1" 200 860
INFO 2025-04-30 17:49:37,405 views 22108 24216 Neo4j服务初始化成功
DEBUG 2025-04-30 17:49:39,471 views 22108 24216 ChatAPI实例初始化完成
INFO 2025-04-30 17:49:39,496 views 22108 24216 获取所有历史会话 - 会话数: 2
INFO 2025-04-30 17:49:39,497 basehttp 22108 24216 "GET /api/chat/get_history/ HTTP/1.1" 200 860
INFO 2025-04-30 17:49:58,868 views 22108 23780 Neo4j服务初始化成功
DEBUG 2025-04-30 17:50:00,927 views 22108 23780 ChatAPI实例初始化完成
DEBUG 2025-04-30 17:50:00,927 views 22108 23780 收到stream_chat请求: {'message': ['我的小麦出了些问题，叶片问题很大'], 'session_id': ['1746006570627_7907']}
DEBUG 2025-04-30 17:50:00,927 views 22108 23780 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 17:50:00,927 views 22108 23780 处理消息: 我的小麦出了些问题，叶片问题很大, 会话ID: 1746006570627_7907
INFO 2025-04-30 17:50:00,927 views 22108 23780 获取现有会话: 1746006570627_7907
INFO 2025-04-30 17:50:00,927 views 22108 23780 获取会话历史 - 会话ID: 1746006570627_7907, 历史记录数: 0
DEBUG 2025-04-30 17:50:00,927 views 22108 23780 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦出了些问题，叶片问题很大'}]
DEBUG 2025-04-30 17:50:00,931 views 22108 23780 构建的消息列表长度: 2
INFO 2025-04-30 17:50:00,931 views 22108 23780 检查会话状态: 1746006570627_7907
INFO 2025-04-30 17:50:00,931 views 22108 23780 创建新会话: 1746006570627_7907
INFO 2025-04-30 17:50:00,931 views 22108 23780 当前症状收集状态: {'collecting': True, 'symptoms': {}}
DEBUG 2025-04-30 17:50:00,931 views 22108 23780 当前症状信息: {}
DEBUG 2025-04-30 17:50:00,931 views 22108 23780 开始提取症状，输入消息: 我的小麦出了些问题，叶片问题很大
DEBUG 2025-04-30 17:50:00,931 views 22108 23780 分句结果: ['我的小麦出了些问题', '叶片问题很大', '我的小麦出了些问题，叶片问题很大']
DEBUG 2025-04-30 17:50:00,933 views 22108 23780 提取到的发病部位: []
DEBUG 2025-04-30 17:50:00,933 views 22108 23780 提取到的气象条件: []
DEBUG 2025-04-30 17:50:00,933 views 22108 23780 提取到的生育期: []
DEBUG 2025-04-30 17:50:00,934 views 22108 23780 提取到的种植区: []
DEBUG 2025-04-30 17:50:00,934 views 22108 23780 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 17:50:00,934 views 22108 23780 提取到的气象条件: []
DEBUG 2025-04-30 17:50:00,934 views 22108 23780 提取到的生育期: []
DEBUG 2025-04-30 17:50:00,935 views 22108 23780 提取到的种植区: []
DEBUG 2025-04-30 17:50:00,935 views 22108 23780 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 17:50:00,935 views 22108 23780 提取到的气象条件: []
DEBUG 2025-04-30 17:50:00,935 views 22108 23780 提取到的生育期: []
DEBUG 2025-04-30 17:50:00,935 views 22108 23780 提取到的种植区: []
INFO 2025-04-30 17:50:00,936 views 22108 23780 症状提取结果: {'plant_part': '叶片'}
INFO 2025-04-30 17:50:00,936 views 22108 23780 开始更新症状信息 - 会话ID: 1746006570627_7907, 新症状: {'plant_part': '叶片'}
DEBUG 2025-04-30 17:50:00,936 views 22108 23780 从Redis获取到的现有症状: {}
INFO 2025-04-30 17:50:00,936 views 22108 23780 更新症状类别 - 会话ID: 1746006570627_7907, 类别: plant_part, 值: 叶片
INFO 2025-04-30 17:50:00,937 views 22108 23780 保存症状信息到Redis - 会话ID: 1746006570627_7907, 症状: {'plant_part': '叶片'}
INFO 2025-04-30 17:50:00,937 views 22108 23780 获取现有会话: 1746006570627_7907
INFO 2025-04-30 17:50:00,938 views 22108 23780 会话已保存到 Redis: 1746006570627_7907
INFO 2025-04-30 17:50:00,938 views 22108 23780 症状信息更新完成 - 会话ID: 1746006570627_7907, 最终症状: {'plant_part': '叶片'}
INFO 2025-04-30 17:50:00,938 views 22108 23780 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-30 17:50:00,939 views 22108 23780 已收集的信息: 目前已经收集到的信息：

- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 种植区
INFO 2025-04-30 17:50:03,602 services 22108 23780 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 17:50:03,602 services 22108 23780 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 17:50:03,605 services 22108 23780 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 17:50:03,611 services 22108 23780 查询结果: <neo4j._sync.work.result.Result object at 0x000002195BBFC140>
DEBUG 2025-04-30 17:50:25,013 views 22108 23780 添加历史记录成功 - 会话ID: 1746006570627_7907, 角色: user
DEBUG 2025-04-30 17:50:25,013 views 22108 23780 添加历史记录成功 - 会话ID: 1746006570627_7907, 角色: assistant
INFO 2025-04-30 17:50:25,013 basehttp 22108 23780 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%87%BA%E4%BA%86%E4%BA%9B%E9%97%AE%E9%A2%98%EF%BC%8C%E5%8F%B6%E7%89%87%E9%97%AE%E9%A2%98%E5%BE%88%E5%A4%A7&session_id=1746006570627_7907 HTTP/1.1" 200 5108
INFO 2025-04-30 17:50:27,783 views 22108 24216 Neo4j服务初始化成功
DEBUG 2025-04-30 17:50:29,824 views 22108 24216 ChatAPI实例初始化完成
INFO 2025-04-30 17:50:29,837 views 22108 24216 获取所有历史会话 - 会话数: 3
INFO 2025-04-30 17:50:29,837 basehttp 22108 24216 "GET /api/chat/get_history/ HTTP/1.1" 200 1260
INFO 2025-04-30 17:50:40,839 views 22108 23828 Neo4j服务初始化成功
DEBUG 2025-04-30 17:50:42,904 views 22108 23828 ChatAPI实例初始化完成
DEBUG 2025-04-30 17:50:42,904 views 22108 23828 收到stream_chat请求: {'message': ['我的种植区是在河北'], 'session_id': ['1746006570627_7907']}
DEBUG 2025-04-30 17:50:42,908 views 22108 23828 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 17:50:42,912 views 22108 23828 处理消息: 我的种植区是在河北, 会话ID: 1746006570627_7907
INFO 2025-04-30 17:50:42,914 views 22108 23828 获取现有会话: 1746006570627_7907
INFO 2025-04-30 17:50:42,915 views 22108 23828 获取会话历史 - 会话ID: 1746006570627_7907, 历史记录数: 2
DEBUG 2025-04-30 17:50:42,916 views 22108 23828 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦出了些问题，叶片问题很大', 'timestamp': 1746006625.013834}, {'role': 'assistant', 'content': '根据目前掌握的信息：\n发病部位：叶片\n\n可能的病害有：\n\n1. 小麦黑颖病\n   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或不饱满，发病轻的种子颜色变深；叶片染病初呈水渍状小点，渐沿叶脉向上、下扩展为黄褐色条状斑；穗...\n\n2. 小麦黑节病\n   主要特征: 叶片染病初生水渍状条斑，后变为黄褐色，最后呈浓褐色，病斑长椭圆形，也有中间色浅些的；叶鞘染病沿叶脉形成黑褐色长形条斑，多与叶上病斑相连，后叶鞘全部变为浅褐色；茎秆染病主要为害节部，病部呈浓褐色，内部也...\n\n3. 小麦黄矮病毒病\n   主要特征: 叶片典型症状是新叶发病从叶尖渐向叶基扩展变黄，黄化部分占全叶的1/3 - 1/2，叶基仍为绿色，且保持较长时间，有时出现与叶脉平行但不受叶脉限制的黄绿相间条纹，病叶较光滑，发病早植株矮化严重，但因品种...\n\n请补充更多信息，以便我更准确地判断。', 'timestamp': 1746006625.013834}, {'role': 'user', 'content': '我的种植区是在河北'}]
DEBUG 2025-04-30 17:50:42,917 views 22108 23828 构建的消息列表长度: 4
DEBUG 2025-04-30 17:50:47,097 views 22108 23828 添加历史记录成功 - 会话ID: 1746006570627_7907, 角色: user
DEBUG 2025-04-30 17:50:47,097 views 22108 23828 添加历史记录成功 - 会话ID: 1746006570627_7907, 角色: assistant
INFO 2025-04-30 17:50:47,101 basehttp 22108 23828 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9A%84%E7%A7%8D%E6%A4%8D%E5%8C%BA%E6%98%AF%E5%9C%A8%E6%B2%B3%E5%8C%97&session_id=1746006570627_7907 HTTP/1.1" 200 1508
INFO 2025-04-30 17:50:49,563 views 22108 24216 Neo4j服务初始化成功
DEBUG 2025-04-30 17:50:51,617 views 22108 24216 ChatAPI实例初始化完成
INFO 2025-04-30 17:50:51,630 views 22108 24216 获取所有历史会话 - 会话数: 3
INFO 2025-04-30 17:50:51,631 basehttp 22108 24216 "GET /api/chat/get_history/ HTTP/1.1" 200 1325
INFO 2025-04-30 17:52:47,224 autoreload 22108 18452 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 17:52:48,043 autoreload 17552 2012 Watching for file changes with StatReloader
INFO 2025-04-30 17:56:58,970 autoreload 17552 2012 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 17:56:59,831 autoreload 8684 17804 Watching for file changes with StatReloader
INFO 2025-04-30 17:57:27,647 views 8684 16864 Neo4j服务初始化成功
INFO 2025-04-30 17:57:28,133 views 8684 21236 Neo4j服务初始化成功
ERROR 2025-04-30 17:57:29,713 views 8684 16864 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 17:57:29,713 views 8684 16864 ChatAPI实例初始化完成
INFO 2025-04-30 17:57:29,719 basehttp 8684 16864 - Broken pipe from ('127.0.0.1', 59600)
ERROR 2025-04-30 17:57:30,171 views 8684 21236 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 17:57:30,171 views 8684 21236 ChatAPI实例初始化完成
INFO 2025-04-30 17:57:30,172 basehttp 8684 21236 - Broken pipe from ('127.0.0.1', 59602)
INFO 2025-04-30 17:57:36,362 views 8684 15884 Neo4j服务初始化成功
ERROR 2025-04-30 17:57:38,402 views 8684 15884 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 17:57:38,402 views 8684 15884 ChatAPI实例初始化完成
INFO 2025-04-30 17:57:38,402 views 8684 15884 创建新会话成功 - 会话ID: 1746007058402_1996
INFO 2025-04-30 17:57:38,402 basehttp 8684 15884 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 17:57:40,734 views 8684 8744 Neo4j服务初始化成功
ERROR 2025-04-30 17:57:42,767 views 8684 8744 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 17:57:42,767 views 8684 8744 ChatAPI实例初始化完成
INFO 2025-04-30 17:57:42,781 views 8684 8744 获取所有历史会话 - 会话数: 3
INFO 2025-04-30 17:57:42,782 basehttp 8684 8744 "GET /api/chat/get_history/ HTTP/1.1" 200 1324
INFO 2025-04-30 17:57:45,128 views 8684 8744 Neo4j服务初始化成功
ERROR 2025-04-30 17:57:47,156 views 8684 8744 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 17:57:47,156 views 8684 8744 ChatAPI实例初始化完成
INFO 2025-04-30 17:57:47,171 views 8684 8744 获取所有历史会话 - 会话数: 3
INFO 2025-04-30 17:57:47,172 basehttp 8684 8744 "GET /api/chat/get_history/ HTTP/1.1" 200 1324
INFO 2025-04-30 18:02:59,636 views 8684 13068 Neo4j服务初始化成功
ERROR 2025-04-30 18:03:01,689 views 8684 13068 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:03:01,689 views 8684 13068 ChatAPI实例初始化完成
DEBUG 2025-04-30 18:03:01,689 views 8684 13068 收到stream_chat请求: {'message': ['我的小麦出现了一些问题，例如在叶片上有锈斑'], 'session_id': ['1746007058402_1996']}
DEBUG 2025-04-30 18:03:01,689 views 8684 13068 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 18:03:01,689 views 8684 13068 处理消息: 我的小麦出现了一些问题，例如在叶片上有锈斑, 会话ID: 1746007058402_1996
INFO 2025-04-30 18:03:01,689 views 8684 13068 获取现有会话: 1746007058402_1996
INFO 2025-04-30 18:03:01,689 views 8684 13068 获取会话历史 - 会话ID: 1746007058402_1996, 历史记录数: 0
DEBUG 2025-04-30 18:03:01,689 views 8684 13068 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦出现了一些问题，例如在叶片上有锈斑'}]
DEBUG 2025-04-30 18:03:01,693 views 8684 13068 构建的消息列表长度: 2
INFO 2025-04-30 18:03:01,693 views 8684 13068 检查会话状态: 1746007058402_1996
INFO 2025-04-30 18:03:01,693 views 8684 13068 创建新会话: 1746007058402_1996
INFO 2025-04-30 18:03:01,693 views 8684 13068 当前症状收集状态: {'collecting': True, 'symptoms': {}}
DEBUG 2025-04-30 18:03:01,693 views 8684 13068 当前症状信息: {}
DEBUG 2025-04-30 18:03:01,693 views 8684 13068 开始提取症状，输入消息: 我的小麦出现了一些问题，例如在叶片上有锈斑
DEBUG 2025-04-30 18:03:01,695 views 8684 13068 分句结果: ['我的小麦出现了一些问题', '例如在叶片上有锈斑', '我的小麦出现了一些问题，例如在叶片上有锈斑']
DEBUG 2025-04-30 18:03:01,695 views 8684 13068 提取到的发病部位: []
DEBUG 2025-04-30 18:03:01,695 views 8684 13068 提取到的气象条件: []
DEBUG 2025-04-30 18:03:01,696 views 8684 13068 提取到的生育期: []
DEBUG 2025-04-30 18:03:01,696 views 8684 13068 提取到的种植区: []
DEBUG 2025-04-30 18:03:01,696 views 8684 13068 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 18:03:01,696 views 8684 13068 提取到的气象条件: []
DEBUG 2025-04-30 18:03:01,697 views 8684 13068 提取到的生育期: []
DEBUG 2025-04-30 18:03:01,698 views 8684 13068 提取到的种植区: []
DEBUG 2025-04-30 18:03:01,698 views 8684 13068 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 18:03:01,698 views 8684 13068 提取到的气象条件: []
DEBUG 2025-04-30 18:03:01,699 views 8684 13068 提取到的生育期: []
DEBUG 2025-04-30 18:03:01,699 views 8684 13068 提取到的种植区: []
INFO 2025-04-30 18:03:01,699 views 8684 13068 症状提取结果: {'plant_part': '叶片'}
INFO 2025-04-30 18:03:01,699 views 8684 13068 从消息中提取的新症状: {'plant_part': '叶片'}
INFO 2025-04-30 18:03:01,700 views 8684 13068 开始更新症状信息 - 会话ID: 1746007058402_1996, 新症状: {'plant_part': '叶片'}
DEBUG 2025-04-30 18:03:01,700 views 8684 13068 从Redis获取到的现有症状: {}
INFO 2025-04-30 18:03:01,700 views 8684 13068 更新症状类别 - 会话ID: 1746007058402_1996, 类别: plant_part, 值: 叶片
INFO 2025-04-30 18:03:01,701 views 8684 13068 保存症状信息到Redis - 会话ID: 1746007058402_1996, 症状: {'plant_part': '叶片'}
INFO 2025-04-30 18:03:01,701 views 8684 13068 获取现有会话: 1746007058402_1996
INFO 2025-04-30 18:03:01,701 views 8684 13068 会话已保存到 Redis: 1746007058402_1996
INFO 2025-04-30 18:03:01,702 views 8684 13068 症状信息更新完成 - 会话ID: 1746007058402_1996, 最终症状: {'plant_part': '叶片'}
INFO 2025-04-30 18:03:01,702 views 8684 13068 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-30 18:03:01,702 views 8684 13068 已收集的信息: 目前已经收集到的信息：

- 发病部位：叶片

还需要补充的信息：
- 气象条件
- 生育期
- 种植区
INFO 2025-04-30 18:03:04,355 services 8684 13068 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 18:03:04,355 services 8684 13068 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 18:03:04,355 services 8684 13068 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 18:03:04,361 services 8684 13068 查询结果: <neo4j._sync.work.result.Result object at 0x000001F484BE7D10>
DEBUG 2025-04-30 18:03:25,720 views 8684 13068 添加历史记录成功 - 会话ID: 1746007058402_1996, 角色: user
DEBUG 2025-04-30 18:03:25,720 views 8684 13068 添加历史记录成功 - 会话ID: 1746007058402_1996, 角色: assistant
INFO 2025-04-30 18:03:25,720 basehttp 8684 13068 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%87%BA%E7%8E%B0%E4%BA%86%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%EF%BC%8C%E4%BE%8B%E5%A6%82%E5%9C%A8%E5%8F%B6%E7%89%87%E4%B8%8A%E6%9C%89%E9%94%88%E6%96%91&session_id=1746007058402_1996 HTTP/1.1" 200 5110
INFO 2025-04-30 18:03:28,419 views 8684 12668 Neo4j服务初始化成功
ERROR 2025-04-30 18:03:30,478 views 8684 12668 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:03:30,478 views 8684 12668 ChatAPI实例初始化完成
INFO 2025-04-30 18:03:30,492 views 8684 12668 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 18:03:30,493 basehttp 8684 12668 "GET /api/chat/get_history/ HTTP/1.1" 200 1727
INFO 2025-04-30 18:04:16,456 views 8684 12204 Neo4j服务初始化成功
ERROR 2025-04-30 18:04:18,502 views 8684 12204 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:04:18,502 views 8684 12204 ChatAPI实例初始化完成
DEBUG 2025-04-30 18:04:18,502 views 8684 12204 收到stream_chat请求: {'message': ['小麦的种植区是在河北'], 'session_id': ['1746007058402_1996']}
DEBUG 2025-04-30 18:04:18,506 views 8684 12204 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 18:04:18,510 views 8684 12204 处理消息: 小麦的种植区是在河北, 会话ID: 1746007058402_1996
INFO 2025-04-30 18:04:18,512 views 8684 12204 获取现有会话: 1746007058402_1996
INFO 2025-04-30 18:04:18,513 views 8684 12204 获取会话历史 - 会话ID: 1746007058402_1996, 历史记录数: 2
DEBUG 2025-04-30 18:04:18,513 views 8684 12204 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦出现了一些问题，例如在叶片上有锈斑', 'timestamp': 1746007405.7201312}, {'role': 'assistant', 'content': '根据目前掌握的信息：\n发病部位：叶片\n\n可能的病害有：\n\n1. 小麦黑颖病\n   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或不饱满，发病轻的种子颜色变深；叶片染病初呈水渍状小点，渐沿叶脉向上、下扩展为黄褐色条状斑；穗...\n\n2. 小麦黑节病\n   主要特征: 叶片染病初生水渍状条斑，后变为黄褐色，最后呈浓褐色，病斑长椭圆形，也有中间色浅些的；叶鞘染病沿叶脉形成黑褐色长形条斑，多与叶上病斑相连，后叶鞘全部变为浅褐色；茎秆染病主要为害节部，病部呈浓褐色，内部也...\n\n3. 小麦黄矮病毒病\n   主要特征: 叶片典型症状是新叶发病从叶尖渐向叶基扩展变黄，黄化部分占全叶的1/3 - 1/2，叶基仍为绿色，且保持较长时间，有时出现与叶脉平行但不受叶脉限制的黄绿相间条纹，病叶较光滑，发病早植株矮化严重，但因品种...\n\n请补充更多信息，以便我更准确地判断。', 'timestamp': 1746007405.7201312}, {'role': 'user', 'content': '小麦的种植区是在河北'}]
DEBUG 2025-04-30 18:04:18,516 views 8684 12204 构建的消息列表长度: 4
INFO 2025-04-30 18:04:18,517 views 8684 12204 检查会话状态: 1746007058402_1996
INFO 2025-04-30 18:04:18,518 views 8684 12204 创建新会话: 1746007058402_1996
INFO 2025-04-30 18:04:18,518 views 8684 12204 当前症状收集状态: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
DEBUG 2025-04-30 18:04:18,518 views 8684 12204 当前症状信息: {'plant_part': '叶片'}
DEBUG 2025-04-30 18:04:18,518 views 8684 12204 开始提取症状，输入消息: 小麦的种植区是在河北
DEBUG 2025-04-30 18:04:18,519 views 8684 12204 分句结果: ['小麦的种植区是在河北', '小麦的种植区是在河北']
DEBUG 2025-04-30 18:04:18,519 views 8684 12204 提取到的发病部位: []
DEBUG 2025-04-30 18:04:18,519 views 8684 12204 提取到的气象条件: []
DEBUG 2025-04-30 18:04:18,520 views 8684 12204 提取到的生育期: []
DEBUG 2025-04-30 18:04:18,520 views 8684 12204 提取到的种植区: ['河北']
DEBUG 2025-04-30 18:04:18,520 views 8684 12204 提取到的发病部位: []
DEBUG 2025-04-30 18:04:18,521 views 8684 12204 提取到的气象条件: []
DEBUG 2025-04-30 18:04:18,521 views 8684 12204 提取到的生育期: []
DEBUG 2025-04-30 18:04:18,521 views 8684 12204 提取到的种植区: ['河北']
INFO 2025-04-30 18:04:18,521 views 8684 12204 症状提取结果: {'region': '河北'}
INFO 2025-04-30 18:04:18,522 views 8684 12204 从消息中提取的新症状: {'region': '河北'}
INFO 2025-04-30 18:04:18,522 views 8684 12204 开始更新症状信息 - 会话ID: 1746007058402_1996, 新症状: {'region': '河北'}
DEBUG 2025-04-30 18:04:18,523 views 8684 12204 从Redis获取到的现有症状: {'plant_part': '叶片'}
INFO 2025-04-30 18:04:18,523 views 8684 12204 更新症状类别 - 会话ID: 1746007058402_1996, 类别: region, 值: 河北
INFO 2025-04-30 18:04:18,523 views 8684 12204 保存症状信息到Redis - 会话ID: 1746007058402_1996, 症状: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-30 18:04:18,524 views 8684 12204 获取现有会话: 1746007058402_1996
INFO 2025-04-30 18:04:18,525 views 8684 12204 会话已保存到 Redis: 1746007058402_1996
INFO 2025-04-30 18:04:18,525 views 8684 12204 症状信息更新完成 - 会话ID: 1746007058402_1996, 最终症状: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-30 18:04:18,526 views 8684 12204 更新后的症状信息: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-30 18:04:18,526 views 8684 12204 已收集的信息: 目前已经收集到的信息：

- 发病部位：叶片
- 种植区：河北

还需要补充的信息：
- 气象条件
- 生育期
INFO 2025-04-30 18:04:21,334 services 8684 12204 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-30 18:04:21,334 services 8684 12204 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) MATCH (d)-[:OCCURS_IN_REGION]->(r:Region {name: $region}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 18:04:21,338 services 8684 12204 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-30 18:04:21,341 services 8684 12204 查询结果: <neo4j._sync.work.result.Result object at 0x000001F4854F22D0>
DEBUG 2025-04-30 18:04:35,336 views 8684 12204 添加历史记录成功 - 会话ID: 1746007058402_1996, 角色: user
DEBUG 2025-04-30 18:04:35,336 views 8684 12204 添加历史记录成功 - 会话ID: 1746007058402_1996, 角色: assistant
INFO 2025-04-30 18:04:35,336 basehttp 8684 12204 "GET /api/chat/stream_chat/?message=%E5%B0%8F%E9%BA%A6%E7%9A%84%E7%A7%8D%E6%A4%8D%E5%8C%BA%E6%98%AF%E5%9C%A8%E6%B2%B3%E5%8C%97&session_id=1746007058402_1996 HTTP/1.1" 200 3554
INFO 2025-04-30 18:04:38,012 views 8684 12668 Neo4j服务初始化成功
ERROR 2025-04-30 18:04:40,081 views 8684 12668 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:04:40,081 views 8684 12668 ChatAPI实例初始化完成
INFO 2025-04-30 18:04:40,097 views 8684 12668 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 18:04:40,098 basehttp 8684 12668 "GET /api/chat/get_history/ HTTP/1.1" 200 1763
INFO 2025-04-30 18:08:07,753 views 8684 6744 Neo4j服务初始化成功
ERROR 2025-04-30 18:08:09,801 views 8684 6744 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:08:09,801 views 8684 6744 ChatAPI实例初始化完成
DEBUG 2025-04-30 18:08:09,801 views 8684 6744 收到stream_chat请求: {'message': ['根据这种病，你觉得我应该如何治理'], 'session_id': ['1746007058402_1996']}
DEBUG 2025-04-30 18:08:09,801 views 8684 6744 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 18:08:09,801 views 8684 6744 处理消息: 根据这种病，你觉得我应该如何治理, 会话ID: 1746007058402_1996
INFO 2025-04-30 18:08:09,801 views 8684 6744 获取现有会话: 1746007058402_1996
INFO 2025-04-30 18:08:09,801 views 8684 6744 获取会话历史 - 会话ID: 1746007058402_1996, 历史记录数: 4
DEBUG 2025-04-30 18:08:09,801 views 8684 6744 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦出现了一些问题，例如在叶片上有锈斑', 'timestamp': 1746007405.7201312}, {'role': 'assistant', 'content': '根据目前掌握的信息：\n发病部位：叶片\n\n可能的病害有：\n\n1. 小麦黑颖病\n   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或不饱满，发病轻的种子颜色变深；叶片染病初呈水渍状小点，渐沿叶脉向上、下扩展为黄褐色条状斑；穗...\n\n2. 小麦黑节病\n   主要特征: 叶片染病初生水渍状条斑，后变为黄褐色，最后呈浓褐色，病斑长椭圆形，也有中间色浅些的；叶鞘染病沿叶脉形成黑褐色长形条斑，多与叶上病斑相连，后叶鞘全部变为浅褐色；茎秆染病主要为害节部，病部呈浓褐色，内部也...\n\n3. 小麦黄矮病毒病\n   主要特征: 叶片典型症状是新叶发病从叶尖渐向叶基扩展变黄，黄化部分占全叶的1/3 - 1/2，叶基仍为绿色，且保持较长时间，有时出现与叶脉平行但不受叶脉限制的黄绿相间条纹，病叶较光滑，发病早植株矮化严重，但因品种...\n\n请补充更多信息，以便我更准确地判断。', 'timestamp': 1746007405.7201312}, {'role': 'user', 'content': '小麦的种植区是在河北', 'timestamp': 1746007475.3361926}, {'role': 'assistant', 'content': '根据您提供的信息：\n发病部位：叶片\n种植区：河北\n\n诊断结果为小麦叶锈病。\n\n病害特征：\n夏孢子堆圆形至长椭圆形，桔红色，散生，成熟后表皮开裂散出夏孢子；冬孢子堆主要在叶片背面和叶鞘上，圆形或长椭圆形，黑色，扁平，成熟时不破裂\n\n防治建议：\n药剂防治：药剂拌种用种子重量的0.03% - 0.04%(有效成分)叶锈特或用种子重量0.2%的20%三唑酮乳油拌种；使用15%保丰1号种衣剂包衣种子；于发病初期喷洒20%三唑酮乳油1000倍液，隔10 - 20天1次，防治1 - 2次。农业防治：适期播种，消灭杂草和自生麦苗，雨季及时排水，防止湿气滞留\n', 'timestamp': 1746007475.3361926}, {'role': 'user', 'content': '根据这种病，你觉得我应该如何治理'}]
DEBUG 2025-04-30 18:08:09,805 views 8684 6744 构建的消息列表长度: 6
INFO 2025-04-30 18:08:09,805 views 8684 6744 检查会话状态: 1746007058402_1996
INFO 2025-04-30 18:08:09,805 views 8684 6744 创建新会话: 1746007058402_1996
INFO 2025-04-30 18:08:09,805 views 8684 6744 当前症状收集状态: {'collecting': True, 'symptoms': {'plant_part': '叶片', 'region': '河北'}}
DEBUG 2025-04-30 18:08:09,808 views 8684 6744 当前症状信息: {'plant_part': '叶片', 'region': '河北'}
DEBUG 2025-04-30 18:08:09,808 views 8684 6744 开始提取症状，输入消息: 根据这种病，你觉得我应该如何治理
DEBUG 2025-04-30 18:08:09,808 views 8684 6744 分句结果: ['根据这种病', '你觉得我应该如何治理', '根据这种病，你觉得我应该如何治理']
DEBUG 2025-04-30 18:08:09,808 views 8684 6744 提取到的发病部位: []
DEBUG 2025-04-30 18:08:09,809 views 8684 6744 提取到的气象条件: []
DEBUG 2025-04-30 18:08:09,809 views 8684 6744 提取到的生育期: []
DEBUG 2025-04-30 18:08:09,809 views 8684 6744 提取到的种植区: []
DEBUG 2025-04-30 18:08:09,809 views 8684 6744 提取到的发病部位: []
DEBUG 2025-04-30 18:08:09,810 views 8684 6744 提取到的气象条件: []
DEBUG 2025-04-30 18:08:09,810 views 8684 6744 提取到的生育期: []
DEBUG 2025-04-30 18:08:09,810 views 8684 6744 提取到的种植区: []
DEBUG 2025-04-30 18:08:09,810 views 8684 6744 提取到的发病部位: []
DEBUG 2025-04-30 18:08:09,810 views 8684 6744 提取到的气象条件: []
DEBUG 2025-04-30 18:08:09,811 views 8684 6744 提取到的生育期: []
DEBUG 2025-04-30 18:08:09,811 views 8684 6744 提取到的种植区: []
INFO 2025-04-30 18:08:09,811 views 8684 6744 症状提取结果: {}
INFO 2025-04-30 18:08:09,811 views 8684 6744 从消息中提取的新症状: {}
DEBUG 2025-04-30 18:08:28,684 views 8684 6744 添加历史记录成功 - 会话ID: 1746007058402_1996, 角色: user
DEBUG 2025-04-30 18:08:28,684 views 8684 6744 添加历史记录成功 - 会话ID: 1746007058402_1996, 角色: assistant
INFO 2025-04-30 18:08:28,684 basehttp 8684 6744 "GET /api/chat/stream_chat/?message=%E6%A0%B9%E6%8D%AE%E8%BF%99%E7%A7%8D%E7%97%85%EF%BC%8C%E4%BD%A0%E8%A7%89%E5%BE%97%E6%88%91%E5%BA%94%E8%AF%A5%E5%A6%82%E4%BD%95%E6%B2%BB%E7%90%86&session_id=1746007058402_1996 HTTP/1.1" 200 9475
INFO 2025-04-30 18:08:32,304 views 8684 12668 Neo4j服务初始化成功
ERROR 2025-04-30 18:08:34,374 views 8684 12668 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:08:34,374 views 8684 12668 ChatAPI实例初始化完成
INFO 2025-04-30 18:08:34,387 views 8684 12668 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 18:08:34,388 basehttp 8684 12668 "GET /api/chat/get_history/ HTTP/1.1" 200 1734
INFO 2025-04-30 18:10:53,469 autoreload 8684 17804 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 18:10:54,411 autoreload 1096 15844 Watching for file changes with StatReloader
INFO 2025-04-30 18:10:56,145 autoreload 1096 15844 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 18:10:56,739 autoreload 22620 12388 Watching for file changes with StatReloader
INFO 2025-04-30 18:12:02,443 autoreload 22620 12388 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 18:12:03,314 autoreload 13968 16236 Watching for file changes with StatReloader
INFO 2025-04-30 18:13:16,037 autoreload 13968 16236 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 18:13:16,813 autoreload 624 18080 Watching for file changes with StatReloader
INFO 2025-04-30 18:13:27,062 autoreload 624 18080 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 18:13:27,842 autoreload 11576 12120 Watching for file changes with StatReloader
INFO 2025-04-30 18:22:13,531 views 11576 24180 Neo4j服务初始化成功
ERROR 2025-04-30 18:22:15,556 views 11576 24180 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:22:15,556 views 11576 24180 ChatAPI实例初始化完成
INFO 2025-04-30 18:22:15,560 views 11576 24180 创建新会话成功 - 会话ID: 1746008535556_3922
INFO 2025-04-30 18:22:15,564 basehttp 11576 24180 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 18:22:17,929 views 11576 24180 Neo4j服务初始化成功
ERROR 2025-04-30 18:22:19,964 views 11576 24180 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:22:19,964 views 11576 24180 ChatAPI实例初始化完成
INFO 2025-04-30 18:22:19,978 views 11576 24180 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 18:22:19,979 basehttp 11576 24180 "GET /api/chat/get_history/ HTTP/1.1" 200 1734
INFO 2025-04-30 18:22:22,289 views 11576 24180 Neo4j服务初始化成功
ERROR 2025-04-30 18:22:24,348 views 11576 24180 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:22:24,348 views 11576 24180 ChatAPI实例初始化完成
INFO 2025-04-30 18:22:24,362 views 11576 24180 获取所有历史会话 - 会话数: 4
INFO 2025-04-30 18:22:24,362 basehttp 11576 24180 "GET /api/chat/get_history/ HTTP/1.1" 200 1734
INFO 2025-04-30 18:22:44,990 views 11576 18080 Neo4j服务初始化成功
ERROR 2025-04-30 18:22:47,028 views 11576 18080 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:22:47,028 views 11576 18080 ChatAPI实例初始化完成
DEBUG 2025-04-30 18:22:47,028 views 11576 18080 收到stream_chat请求: {'message': ['我的小麦叶片部分好像出了点问题'], 'session_id': ['1746008535556_3922']}
DEBUG 2025-04-30 18:22:47,028 views 11576 18080 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 18:22:47,028 views 11576 18080 处理消息: 我的小麦叶片部分好像出了点问题, 会话ID: 1746008535556_3922
INFO 2025-04-30 18:22:47,032 views 11576 18080 获取现有会话: 1746008535556_3922
INFO 2025-04-30 18:22:47,032 views 11576 18080 获取会话历史 - 会话ID: 1746008535556_3922, 历史记录数: 0
DEBUG 2025-04-30 18:22:47,032 views 11576 18080 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦叶片部分好像出了点问题'}]
DEBUG 2025-04-30 18:22:47,032 views 11576 18080 构建的消息列表长度: 2
INFO 2025-04-30 18:22:47,032 views 11576 18080 检查会话状态: 1746008535556_3922
INFO 2025-04-30 18:22:47,034 views 11576 18080 创建新会话: 1746008535556_3922
INFO 2025-04-30 18:22:47,034 views 11576 18080 当前症状收集状态: {'collecting': True, 'symptoms': {}}
DEBUG 2025-04-30 18:22:47,034 views 11576 18080 当前症状信息: {}
DEBUG 2025-04-30 18:22:47,034 views 11576 18080 开始提取症状，输入消息: 我的小麦叶片部分好像出了点问题
DEBUG 2025-04-30 18:22:47,035 views 11576 18080 分句结果: ['我的小麦叶片部分好像出了点问题', '我的小麦叶片部分好像出了点问题']
DEBUG 2025-04-30 18:22:47,035 views 11576 18080 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 18:22:47,036 views 11576 18080 提取到的气象条件: []
DEBUG 2025-04-30 18:22:47,036 views 11576 18080 提取到的生育期: []
DEBUG 2025-04-30 18:22:47,036 views 11576 18080 提取到的种植区: []
DEBUG 2025-04-30 18:22:47,036 views 11576 18080 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 18:22:47,037 views 11576 18080 提取到的气象条件: []
DEBUG 2025-04-30 18:22:47,037 views 11576 18080 提取到的生育期: []
DEBUG 2025-04-30 18:22:47,037 views 11576 18080 提取到的种植区: []
INFO 2025-04-30 18:22:47,037 views 11576 18080 症状提取结果: {'plant_part': '叶片'}
INFO 2025-04-30 18:22:47,038 views 11576 18080 从消息中提取的新症状: {'plant_part': '叶片'}
INFO 2025-04-30 18:22:47,038 views 11576 18080 开始更新症状信息 - 会话ID: 1746008535556_3922, 新症状: {'plant_part': '叶片'}
DEBUG 2025-04-30 18:22:47,038 views 11576 18080 从Redis获取到的现有症状: {}
INFO 2025-04-30 18:22:47,038 views 11576 18080 更新症状类别 - 会话ID: 1746008535556_3922, 类别: plant_part, 值: 叶片
INFO 2025-04-30 18:22:47,039 views 11576 18080 保存症状信息到Redis - 会话ID: 1746008535556_3922, 症状: {'plant_part': '叶片'}
INFO 2025-04-30 18:22:47,039 views 11576 18080 获取现有会话: 1746008535556_3922
INFO 2025-04-30 18:22:47,040 views 11576 18080 会话已保存到 Redis: 1746008535556_3922
INFO 2025-04-30 18:22:47,040 views 11576 18080 症状信息更新完成 - 会话ID: 1746008535556_3922, 最终症状: {'plant_part': '叶片'}
INFO 2025-04-30 18:22:47,040 views 11576 18080 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-30 18:22:47,040 views 11576 18080 已收集的信息: 目前已经收集到的信息：
发病部位：叶片

还需要补充：气象条件, 生育期, 种植区
INFO 2025-04-30 18:22:49,133 services 11576 18080 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 18:22:49,133 services 11576 18080 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 18:22:49,135 services 11576 18080 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 18:22:49,143 services 11576 18080 查询结果: <neo4j._sync.work.result.Result object at 0x00000205551861B0>
DEBUG 2025-04-30 18:23:10,358 views 11576 18080 添加历史记录成功 - 会话ID: 1746008535556_3922, 角色: user
DEBUG 2025-04-30 18:23:10,358 views 11576 18080 添加历史记录成功 - 会话ID: 1746008535556_3922, 角色: assistant
INFO 2025-04-30 18:23:10,358 basehttp 11576 18080 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E5%8F%B6%E7%89%87%E9%83%A8%E5%88%86%E5%A5%BD%E5%83%8F%E5%87%BA%E4%BA%86%E7%82%B9%E9%97%AE%E9%A2%98&session_id=1746008535556_3922 HTTP/1.1" 200 4971
INFO 2025-04-30 18:23:13,037 views 11576 24180 Neo4j服务初始化成功
ERROR 2025-04-30 18:23:15,077 views 11576 24180 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:23:15,077 views 11576 24180 ChatAPI实例初始化完成
INFO 2025-04-30 18:23:15,092 views 11576 24180 获取所有历史会话 - 会话数: 5
INFO 2025-04-30 18:23:15,092 basehttp 11576 24180 "GET /api/chat/get_history/ HTTP/1.1" 200 2140
INFO 2025-04-30 18:23:41,093 views 11576 17740 Neo4j服务初始化成功
ERROR 2025-04-30 18:23:43,150 views 11576 17740 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:23:43,150 views 11576 17740 ChatAPI实例初始化完成
DEBUG 2025-04-30 18:23:43,150 views 11576 17740 收到stream_chat请求: {'message': ['小麦的种植区是在河北'], 'session_id': ['1746008535556_3922']}
DEBUG 2025-04-30 18:23:43,157 views 11576 17740 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 18:23:43,162 views 11576 17740 处理消息: 小麦的种植区是在河北, 会话ID: 1746008535556_3922
INFO 2025-04-30 18:23:43,164 views 11576 17740 获取现有会话: 1746008535556_3922
INFO 2025-04-30 18:23:43,165 views 11576 17740 获取会话历史 - 会话ID: 1746008535556_3922, 历史记录数: 2
DEBUG 2025-04-30 18:23:43,165 views 11576 17740 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦叶片部分好像出了点问题', 'timestamp': 1746008590.358026}, {'role': 'assistant', 'content': '根据目前掌握的信息：\n发病部位：叶片\n\n可能的病害有：\n1. 小麦黑颖病\n   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或不饱满，发病轻的种子颜色变深；叶片染病初呈水渍状小点，渐沿叶脉向上、下扩展为黄褐色条状斑；穗...\n2. 小麦黑节病\n   主要特征: 叶片染病初生水渍状条斑，后变为黄褐色，最后呈浓褐色，病斑长椭圆形，也有中间色浅些的；叶鞘染病沿叶脉形成黑褐色长形条斑，多与叶上病斑相连，后叶鞘全部变为浅褐色；茎秆染病主要为害节部，病部呈浓褐色，内部也...\n3. 小麦黄矮病毒病\n   主要特征: 叶片典型症状是新叶发病从叶尖渐向叶基扩展变黄，黄化部分占全叶的1/3 - 1/2，叶基仍为绿色，且保持较长时间，有时出现与叶脉平行但不受叶脉限制的黄绿相间条纹，病叶较光滑，发病早植株矮化严重，但因品种...\n\n请补充更多信息，以便我更准确地判断。', 'timestamp': 1746008590.358026}, {'role': 'user', 'content': '小麦的种植区是在河北'}]
DEBUG 2025-04-30 18:23:43,170 views 11576 17740 构建的消息列表长度: 4
INFO 2025-04-30 18:23:43,171 views 11576 17740 检查会话状态: 1746008535556_3922
INFO 2025-04-30 18:23:43,172 views 11576 17740 创建新会话: 1746008535556_3922
INFO 2025-04-30 18:23:43,172 views 11576 17740 当前症状收集状态: {'collecting': True, 'symptoms': {'plant_part': '叶片'}}
DEBUG 2025-04-30 18:23:43,172 views 11576 17740 当前症状信息: {'plant_part': '叶片'}
DEBUG 2025-04-30 18:23:43,173 views 11576 17740 开始提取症状，输入消息: 小麦的种植区是在河北
DEBUG 2025-04-30 18:23:43,173 views 11576 17740 分句结果: ['小麦的种植区是在河北', '小麦的种植区是在河北']
DEBUG 2025-04-30 18:23:43,173 views 11576 17740 提取到的发病部位: []
DEBUG 2025-04-30 18:23:43,173 views 11576 17740 提取到的气象条件: []
DEBUG 2025-04-30 18:23:43,173 views 11576 17740 提取到的生育期: []
DEBUG 2025-04-30 18:23:43,174 views 11576 17740 提取到的种植区: ['河北']
DEBUG 2025-04-30 18:23:43,174 views 11576 17740 提取到的发病部位: []
DEBUG 2025-04-30 18:23:43,174 views 11576 17740 提取到的气象条件: []
DEBUG 2025-04-30 18:23:43,174 views 11576 17740 提取到的生育期: []
DEBUG 2025-04-30 18:23:43,175 views 11576 17740 提取到的种植区: ['河北']
INFO 2025-04-30 18:23:43,175 views 11576 17740 症状提取结果: {'region': '河北'}
INFO 2025-04-30 18:23:43,175 views 11576 17740 从消息中提取的新症状: {'region': '河北'}
INFO 2025-04-30 18:23:43,175 views 11576 17740 开始更新症状信息 - 会话ID: 1746008535556_3922, 新症状: {'region': '河北'}
DEBUG 2025-04-30 18:23:43,176 views 11576 17740 从Redis获取到的现有症状: {'plant_part': '叶片'}
INFO 2025-04-30 18:23:43,176 views 11576 17740 更新症状类别 - 会话ID: 1746008535556_3922, 类别: region, 值: 河北
INFO 2025-04-30 18:23:43,176 views 11576 17740 保存症状信息到Redis - 会话ID: 1746008535556_3922, 症状: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-30 18:23:43,177 views 11576 17740 获取现有会话: 1746008535556_3922
INFO 2025-04-30 18:23:43,177 views 11576 17740 会话已保存到 Redis: 1746008535556_3922
INFO 2025-04-30 18:23:43,177 views 11576 17740 症状信息更新完成 - 会话ID: 1746008535556_3922, 最终症状: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-30 18:23:43,178 views 11576 17740 更新后的症状信息: {'plant_part': '叶片', 'region': '河北'}
INFO 2025-04-30 18:23:43,178 views 11576 17740 已收集的信息: 目前已经收集到的信息：
发病部位：叶片，种植区：河北

还需要补充：气象条件, 生育期
INFO 2025-04-30 18:23:45,411 services 11576 17740 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-30 18:23:45,411 services 11576 17740 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) MATCH (d)-[:OCCURS_IN_REGION]->(r:Region {name: $region}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 18:23:45,417 services 11576 17740 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': '河北'}
INFO 2025-04-30 18:23:45,430 services 11576 17740 查询结果: <neo4j._sync.work.result.Result object at 0x0000020555185A30>
DEBUG 2025-04-30 18:23:59,186 views 11576 17740 添加历史记录成功 - 会话ID: 1746008535556_3922, 角色: user
DEBUG 2025-04-30 18:23:59,186 views 11576 17740 添加历史记录成功 - 会话ID: 1746008535556_3922, 角色: assistant
INFO 2025-04-30 18:23:59,186 basehttp 11576 17740 "GET /api/chat/stream_chat/?message=%E5%B0%8F%E9%BA%A6%E7%9A%84%E7%A7%8D%E6%A4%8D%E5%8C%BA%E6%98%AF%E5%9C%A8%E6%B2%B3%E5%8C%97&session_id=1746008535556_3922 HTTP/1.1" 200 3389
INFO 2025-04-30 18:24:01,802 views 11576 24180 Neo4j服务初始化成功
ERROR 2025-04-30 18:24:03,860 views 11576 24180 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:24:03,860 views 11576 24180 ChatAPI实例初始化完成
INFO 2025-04-30 18:24:03,877 views 11576 24180 获取所有历史会话 - 会话数: 5
INFO 2025-04-30 18:24:03,878 basehttp 11576 24180 "GET /api/chat/get_history/ HTTP/1.1" 200 2184
INFO 2025-04-30 18:24:43,380 views 11576 20448 Neo4j服务初始化成功
ERROR 2025-04-30 18:24:45,430 views 11576 20448 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:24:45,431 views 11576 20448 ChatAPI实例初始化完成
DEBUG 2025-04-30 18:24:45,431 views 11576 20448 收到stream_chat请求: {'message': ['那我应该如何治理这种病呢'], 'session_id': ['1746008535556_3922']}
DEBUG 2025-04-30 18:24:45,432 views 11576 20448 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 18:24:45,432 views 11576 20448 处理消息: 那我应该如何治理这种病呢, 会话ID: 1746008535556_3922
INFO 2025-04-30 18:24:45,433 views 11576 20448 获取现有会话: 1746008535556_3922
INFO 2025-04-30 18:24:45,434 views 11576 20448 获取会话历史 - 会话ID: 1746008535556_3922, 历史记录数: 4
DEBUG 2025-04-30 18:24:45,434 views 11576 20448 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦叶片部分好像出了点问题', 'timestamp': 1746008590.358026}, {'role': 'assistant', 'content': '根据目前掌握的信息：\n发病部位：叶片\n\n可能的病害有：\n1. 小麦黑颖病\n   主要特征: 穗部染病穗上病部为褐色至黑色的条斑，多个病斑融合在一起后颖片变黑发亮，颖片染病后引起种子感染，致病种子皱缩或不饱满，发病轻的种子颜色变深；叶片染病初呈水渍状小点，渐沿叶脉向上、下扩展为黄褐色条状斑；穗...\n2. 小麦黑节病\n   主要特征: 叶片染病初生水渍状条斑，后变为黄褐色，最后呈浓褐色，病斑长椭圆形，也有中间色浅些的；叶鞘染病沿叶脉形成黑褐色长形条斑，多与叶上病斑相连，后叶鞘全部变为浅褐色；茎秆染病主要为害节部，病部呈浓褐色，内部也...\n3. 小麦黄矮病毒病\n   主要特征: 叶片典型症状是新叶发病从叶尖渐向叶基扩展变黄，黄化部分占全叶的1/3 - 1/2，叶基仍为绿色，且保持较长时间，有时出现与叶脉平行但不受叶脉限制的黄绿相间条纹，病叶较光滑，发病早植株矮化严重，但因品种...\n\n请补充更多信息，以便我更准确地判断。', 'timestamp': 1746008590.358026}, {'role': 'user', 'content': '小麦的种植区是在河北', 'timestamp': 1746008639.186499}, {'role': 'assistant', 'content': '根据您提供的信息：\n发病部位：叶片，种植区：河北\n\n诊断结果为小麦叶锈病。\n病害特征：夏孢子堆圆形至长椭圆形，桔红色，散生，成熟后表皮开裂散出夏孢子；冬孢子堆主要在叶片背面和叶鞘上，圆形或长椭圆形，黑色，扁平，成熟时不破裂\n防治建议：药剂防治：药剂拌种用种子重量的0.03% - 0.04%(有效成分)叶锈特或用种子重量0.2%的20%三唑酮乳油拌种；使用15%保丰1号种衣剂包衣种子；于发病初期喷洒20%三唑酮乳油1000倍液，隔10 - 20天1次，防治1 - 2次。农业防治：适期播种，消灭杂草和自生麦苗，雨季及时排水，防止湿气滞留', 'timestamp': 1746008639.186499}, {'role': 'user', 'content': '那我应该如何治理这种病呢'}]
DEBUG 2025-04-30 18:24:45,435 views 11576 20448 构建的消息列表长度: 6
INFO 2025-04-30 18:24:45,435 views 11576 20448 检查会话状态: 1746008535556_3922
INFO 2025-04-30 18:24:45,436 views 11576 20448 创建新会话: 1746008535556_3922
INFO 2025-04-30 18:24:45,436 views 11576 20448 当前症状收集状态: {'collecting': True, 'symptoms': {'plant_part': '叶片', 'region': '河北'}}
DEBUG 2025-04-30 18:24:45,436 views 11576 20448 当前症状信息: {'plant_part': '叶片', 'region': '河北'}
DEBUG 2025-04-30 18:24:45,436 views 11576 20448 开始提取症状，输入消息: 那我应该如何治理这种病呢
DEBUG 2025-04-30 18:24:45,436 views 11576 20448 分句结果: ['那我应该如何治理这种病呢', '那我应该如何治理这种病呢']
DEBUG 2025-04-30 18:24:45,437 views 11576 20448 提取到的发病部位: []
DEBUG 2025-04-30 18:24:45,437 views 11576 20448 提取到的气象条件: []
DEBUG 2025-04-30 18:24:45,437 views 11576 20448 提取到的生育期: []
DEBUG 2025-04-30 18:24:45,437 views 11576 20448 提取到的种植区: []
DEBUG 2025-04-30 18:24:45,437 views 11576 20448 提取到的发病部位: []
DEBUG 2025-04-30 18:24:45,438 views 11576 20448 提取到的气象条件: []
DEBUG 2025-04-30 18:24:45,438 views 11576 20448 提取到的生育期: []
DEBUG 2025-04-30 18:24:45,438 views 11576 20448 提取到的种植区: []
INFO 2025-04-30 18:24:45,438 views 11576 20448 症状提取结果: {}
INFO 2025-04-30 18:24:45,438 views 11576 20448 从消息中提取的新症状: {}
DEBUG 2025-04-30 18:25:01,829 views 11576 20448 添加历史记录成功 - 会话ID: 1746008535556_3922, 角色: user
DEBUG 2025-04-30 18:25:01,829 views 11576 20448 添加历史记录成功 - 会话ID: 1746008535556_3922, 角色: assistant
INFO 2025-04-30 18:25:01,829 basehttp 11576 20448 "GET /api/chat/stream_chat/?message=%E9%82%A3%E6%88%91%E5%BA%94%E8%AF%A5%E5%A6%82%E4%BD%95%E6%B2%BB%E7%90%86%E8%BF%99%E7%A7%8D%E7%97%85%E5%91%A2&session_id=1746008535556_3922 HTTP/1.1" 200 7487
INFO 2025-04-30 18:25:05,184 views 11576 24180 Neo4j服务初始化成功
ERROR 2025-04-30 18:25:07,248 views 11576 24180 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:25:07,248 views 11576 24180 ChatAPI实例初始化完成
INFO 2025-04-30 18:25:07,272 views 11576 24180 获取所有历史会话 - 会话数: 5
INFO 2025-04-30 18:25:07,273 basehttp 11576 24180 "GET /api/chat/get_history/ HTTP/1.1" 200 2143
INFO 2025-04-30 18:30:07,781 views 11576 16544 Neo4j服务初始化成功
ERROR 2025-04-30 18:30:09,821 views 11576 16544 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:30:09,821 views 11576 16544 ChatAPI实例初始化完成
INFO 2025-04-30 18:30:09,821 views 11576 16544 创建新会话成功 - 会话ID: 1746009009821_4425
INFO 2025-04-30 18:30:09,821 basehttp 11576 16544 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 18:30:12,149 views 11576 16544 Neo4j服务初始化成功
ERROR 2025-04-30 18:30:14,211 views 11576 16544 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:30:14,211 views 11576 16544 ChatAPI实例初始化完成
INFO 2025-04-30 18:30:14,238 views 11576 16544 获取所有历史会话 - 会话数: 5
INFO 2025-04-30 18:30:14,239 basehttp 11576 16544 "GET /api/chat/get_history/ HTTP/1.1" 200 2143
INFO 2025-04-30 18:30:16,582 views 11576 16544 Neo4j服务初始化成功
ERROR 2025-04-30 18:30:18,631 views 11576 16544 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:30:18,631 views 11576 16544 ChatAPI实例初始化完成
INFO 2025-04-30 18:30:18,651 views 11576 16544 获取所有历史会话 - 会话数: 5
INFO 2025-04-30 18:30:18,652 basehttp 11576 16544 "GET /api/chat/get_history/ HTTP/1.1" 200 2143
INFO 2025-04-30 18:30:48,395 views 11576 16192 Neo4j服务初始化成功
ERROR 2025-04-30 18:30:50,453 views 11576 16192 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:30:50,453 views 11576 16192 ChatAPI实例初始化完成
DEBUG 2025-04-30 18:30:50,453 views 11576 16192 收到stream_chat请求: {'message': ['我的小麦目前是幼苗期'], 'session_id': ['1746009009821_4425']}
DEBUG 2025-04-30 18:30:50,457 views 11576 16192 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 18:30:50,457 views 11576 16192 处理消息: 我的小麦目前是幼苗期, 会话ID: 1746009009821_4425
INFO 2025-04-30 18:30:50,457 views 11576 16192 获取现有会话: 1746009009821_4425
INFO 2025-04-30 18:30:50,457 views 11576 16192 获取会话历史 - 会话ID: 1746009009821_4425, 历史记录数: 0
DEBUG 2025-04-30 18:30:50,457 views 11576 16192 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦目前是幼苗期'}]
DEBUG 2025-04-30 18:30:50,460 views 11576 16192 构建的消息列表长度: 2
INFO 2025-04-30 18:30:50,460 views 11576 16192 检查会话状态: 1746009009821_4425
INFO 2025-04-30 18:30:50,460 views 11576 16192 创建新会话: 1746009009821_4425
INFO 2025-04-30 18:30:50,460 views 11576 16192 当前症状收集状态: {'collecting': True, 'symptoms': {}}
DEBUG 2025-04-30 18:30:50,462 views 11576 16192 当前症状信息: {}
DEBUG 2025-04-30 18:30:50,462 views 11576 16192 开始提取症状，输入消息: 我的小麦目前是幼苗期
DEBUG 2025-04-30 18:30:50,462 views 11576 16192 分句结果: ['我的小麦目前是幼苗期', '我的小麦目前是幼苗期']
DEBUG 2025-04-30 18:30:50,462 views 11576 16192 提取到的发病部位: ['幼苗']
DEBUG 2025-04-30 18:30:50,462 views 11576 16192 提取到的气象条件: []
DEBUG 2025-04-30 18:30:50,463 views 11576 16192 提取到的生育期: ['幼苗期']
DEBUG 2025-04-30 18:30:50,463 views 11576 16192 提取到的种植区: []
DEBUG 2025-04-30 18:30:50,463 views 11576 16192 提取到的发病部位: ['幼苗']
DEBUG 2025-04-30 18:30:50,463 views 11576 16192 提取到的气象条件: []
DEBUG 2025-04-30 18:30:50,463 views 11576 16192 提取到的生育期: ['幼苗期']
DEBUG 2025-04-30 18:30:50,463 views 11576 16192 提取到的种植区: []
INFO 2025-04-30 18:30:50,464 views 11576 16192 症状提取结果: {'plant_part': '幼苗', 'growth_stage': '幼苗期'}
INFO 2025-04-30 18:30:50,464 views 11576 16192 从消息中提取的新症状: {'plant_part': '幼苗', 'growth_stage': '幼苗期'}
INFO 2025-04-30 18:30:50,464 views 11576 16192 开始更新症状信息 - 会话ID: 1746009009821_4425, 新症状: {'plant_part': '幼苗', 'growth_stage': '幼苗期'}
DEBUG 2025-04-30 18:30:50,464 views 11576 16192 从Redis获取到的现有症状: {}
INFO 2025-04-30 18:30:50,464 views 11576 16192 更新症状类别 - 会话ID: 1746009009821_4425, 类别: plant_part, 值: 幼苗
INFO 2025-04-30 18:30:50,464 views 11576 16192 更新症状类别 - 会话ID: 1746009009821_4425, 类别: growth_stage, 值: 幼苗期
INFO 2025-04-30 18:30:50,464 views 11576 16192 保存症状信息到Redis - 会话ID: 1746009009821_4425, 症状: {'plant_part': '幼苗', 'growth_stage': '幼苗期'}
INFO 2025-04-30 18:30:50,466 views 11576 16192 获取现有会话: 1746009009821_4425
INFO 2025-04-30 18:30:50,466 views 11576 16192 会话已保存到 Redis: 1746009009821_4425
INFO 2025-04-30 18:30:50,466 views 11576 16192 症状信息更新完成 - 会话ID: 1746009009821_4425, 最终症状: {'plant_part': '幼苗', 'growth_stage': '幼苗期'}
INFO 2025-04-30 18:30:50,467 views 11576 16192 更新后的症状信息: {'plant_part': '幼苗', 'growth_stage': '幼苗期'}
INFO 2025-04-30 18:30:50,467 views 11576 16192 已收集的信息: 目前已经收集到的信息：
发病部位：幼苗，生育期：幼苗期

还需要补充：气象条件, 种植区
INFO 2025-04-30 18:30:52,711 services 11576 16192 查询参数: {'plant_part': '幼苗', 'weather': None, 'growth_stage': '幼苗期', 'region': None}
INFO 2025-04-30 18:30:52,711 services 11576 16192 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) MATCH (d)-[:OCCURS_IN_STAGE]->(s:GrowthStage {name: $growth_stage}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 18:30:52,711 services 11576 16192 查询参数: {'plant_part': '幼苗', 'weather': None, 'growth_stage': '幼苗期', 'region': None}
INFO 2025-04-30 18:30:52,858 services 11576 16192 查询结果: <neo4j._sync.work.result.Result object at 0x0000020555083BC0>
DEBUG 2025-04-30 18:31:14,555 views 11576 16192 添加历史记录成功 - 会话ID: 1746009009821_4425, 角色: user
DEBUG 2025-04-30 18:31:14,559 views 11576 16192 添加历史记录成功 - 会话ID: 1746009009821_4425, 角色: assistant
INFO 2025-04-30 18:31:14,559 basehttp 11576 16192 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9A%84%E5%B0%8F%E9%BA%A6%E7%9B%AE%E5%89%8D%E6%98%AF%E5%B9%BC%E8%8B%97%E6%9C%9F&session_id=1746009009821_4425 HTTP/1.1" 200 5136
INFO 2025-04-30 18:31:17,313 views 11576 16544 Neo4j服务初始化成功
ERROR 2025-04-30 18:31:19,393 views 11576 16544 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:31:19,393 views 11576 16544 ChatAPI实例初始化完成
INFO 2025-04-30 18:31:19,406 views 11576 16544 获取所有历史会话 - 会话数: 6
INFO 2025-04-30 18:31:19,406 basehttp 11576 16544 "GET /api/chat/get_history/ HTTP/1.1" 200 2560
INFO 2025-04-30 18:31:47,915 views 11576 7552 Neo4j服务初始化成功
ERROR 2025-04-30 18:31:49,980 views 11576 7552 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:31:49,980 views 11576 7552 ChatAPI实例初始化完成
DEBUG 2025-04-30 18:31:49,980 views 11576 7552 收到stream_chat请求: {'message': ['我在东北，而且根系也有问题'], 'session_id': ['1746009009821_4425']}
DEBUG 2025-04-30 18:31:49,980 views 11576 7552 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 18:31:49,984 views 11576 7552 处理消息: 我在东北，而且根系也有问题, 会话ID: 1746009009821_4425
INFO 2025-04-30 18:31:49,984 views 11576 7552 获取现有会话: 1746009009821_4425
INFO 2025-04-30 18:31:49,984 views 11576 7552 获取会话历史 - 会话ID: 1746009009821_4425, 历史记录数: 2
DEBUG 2025-04-30 18:31:49,984 views 11576 7552 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '我的小麦目前是幼苗期', 'timestamp': 1746009074.5553172}, {'role': 'assistant', 'content': '根据目前掌握的信息：\n发病部位：幼苗，生育期：幼苗期\n\n可能的病害有：\n1. 小麦赤霉病\n   主要特征: 苗腐：种子带菌或土壤中病残体侵染所致，芽变褐，根冠随之腐烂，轻者病苗黄瘦，重者死亡，枯死苗湿度大时产生粉红色霉状物。穗腐：小麦扬花时，在小穗和颖片上产生水浸状浅褐色斑，渐扩大至整个小穗，小穗枯黄，湿度...\n2. 小麦蠕孢叶斑根腐病\n   主要特征: 芽腐、苗枯：染病重的种子不能发芽或刚萌芽就变褐腐烂不能出土，发病轻的可萌发出土但胚芽鞘或其他地下部分发病，多在冬前死掉或产生弱苗；根腐、茎基腐：在苗期的胚芽鞘、地下茎或幼根上出现褐色病变、局部组织腐烂...\n3. 小麦秆枯病\n   主要特征: 幼苗发病初在第一片叶与芽鞘之间有针尖大小的小黑点，以后扩展到叶鞘和叶片上，呈梭形褐边白斑并有虫粪状物；拔节期在叶鞘上形成褐色云斑，边缘明显，病斑上有灰黑色虫粪状物，叶鞘内有一层白色菌丝，有的茎秆内也充...\n\n请补充更多信息，以便我更准确地判断。', 'timestamp': 1746009074.5593576}, {'role': 'user', 'content': '我在东北，而且根系也有问题'}]
DEBUG 2025-04-30 18:31:49,984 views 11576 7552 构建的消息列表长度: 4
INFO 2025-04-30 18:31:49,984 views 11576 7552 检查会话状态: 1746009009821_4425
INFO 2025-04-30 18:31:49,984 views 11576 7552 创建新会话: 1746009009821_4425
INFO 2025-04-30 18:31:49,988 views 11576 7552 当前症状收集状态: {'collecting': True, 'symptoms': {'plant_part': '幼苗', 'growth_stage': '幼苗期'}}
DEBUG 2025-04-30 18:31:49,989 views 11576 7552 当前症状信息: {'plant_part': '幼苗', 'growth_stage': '幼苗期'}
DEBUG 2025-04-30 18:31:49,989 views 11576 7552 开始提取症状，输入消息: 我在东北，而且根系也有问题
DEBUG 2025-04-30 18:31:49,989 views 11576 7552 分句结果: ['我在东北', '而且根系也有问题', '我在东北，而且根系也有问题']
DEBUG 2025-04-30 18:31:49,989 views 11576 7552 提取到的发病部位: []
DEBUG 2025-04-30 18:31:49,989 views 11576 7552 提取到的气象条件: []
DEBUG 2025-04-30 18:31:49,989 views 11576 7552 提取到的生育期: []
DEBUG 2025-04-30 18:31:49,989 views 11576 7552 提取到的种植区: ['东北']
DEBUG 2025-04-30 18:31:49,989 views 11576 7552 提取到的发病部位: ['根系']
DEBUG 2025-04-30 18:31:49,989 views 11576 7552 提取到的气象条件: []
DEBUG 2025-04-30 18:31:49,990 views 11576 7552 提取到的生育期: []
DEBUG 2025-04-30 18:31:49,990 views 11576 7552 提取到的种植区: []
DEBUG 2025-04-30 18:31:49,990 views 11576 7552 提取到的发病部位: ['根系']
DEBUG 2025-04-30 18:31:49,990 views 11576 7552 提取到的气象条件: []
DEBUG 2025-04-30 18:31:49,990 views 11576 7552 提取到的生育期: []
DEBUG 2025-04-30 18:31:49,991 views 11576 7552 提取到的种植区: ['东北']
INFO 2025-04-30 18:31:49,991 views 11576 7552 症状提取结果: {'plant_part': '根系', 'region': '东北'}
INFO 2025-04-30 18:31:49,991 views 11576 7552 从消息中提取的新症状: {'plant_part': '根系', 'region': '东北'}
INFO 2025-04-30 18:31:49,991 views 11576 7552 开始更新症状信息 - 会话ID: 1746009009821_4425, 新症状: {'plant_part': '根系', 'region': '东北'}
DEBUG 2025-04-30 18:31:49,992 views 11576 7552 从Redis获取到的现有症状: {'plant_part': '幼苗', 'growth_stage': '幼苗期'}
INFO 2025-04-30 18:31:49,992 views 11576 7552 更新症状类别 - 会话ID: 1746009009821_4425, 类别: plant_part, 值: 根系
INFO 2025-04-30 18:31:49,992 views 11576 7552 更新症状类别 - 会话ID: 1746009009821_4425, 类别: region, 值: 东北
INFO 2025-04-30 18:31:49,993 views 11576 7552 保存症状信息到Redis - 会话ID: 1746009009821_4425, 症状: {'plant_part': '根系', 'growth_stage': '幼苗期', 'region': '东北'}
INFO 2025-04-30 18:31:49,993 views 11576 7552 获取现有会话: 1746009009821_4425
INFO 2025-04-30 18:31:49,994 views 11576 7552 会话已保存到 Redis: 1746009009821_4425
INFO 2025-04-30 18:31:49,994 views 11576 7552 症状信息更新完成 - 会话ID: 1746009009821_4425, 最终症状: {'plant_part': '根系', 'growth_stage': '幼苗期', 'region': '东北'}
INFO 2025-04-30 18:31:49,994 views 11576 7552 更新后的症状信息: {'plant_part': '根系', 'growth_stage': '幼苗期', 'region': '东北'}
INFO 2025-04-30 18:31:49,994 views 11576 7552 已收集的信息: 目前已经收集到的信息：
发病部位：根系，生育期：幼苗期，种植区：东北

还需要补充：气象条件
INFO 2025-04-30 18:31:52,347 services 11576 7552 查询参数: {'plant_part': '根系', 'weather': None, 'growth_stage': '幼苗期', 'region': '东北'}
INFO 2025-04-30 18:31:52,347 services 11576 7552 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) MATCH (d)-[:OCCURS_IN_STAGE]->(s:GrowthStage {name: $growth_stage}) MATCH (d)-[:OCCURS_IN_REGION]->(r:Region {name: $region}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 18:31:52,349 services 11576 7552 查询参数: {'plant_part': '根系', 'weather': None, 'growth_stage': '幼苗期', 'region': '东北'}
INFO 2025-04-30 18:31:52,570 services 11576 7552 查询结果: <neo4j._sync.work.result.Result object at 0x0000020554ECC830>
DEBUG 2025-04-30 18:32:11,740 views 11576 7552 添加历史记录成功 - 会话ID: 1746009009821_4425, 角色: user
DEBUG 2025-04-30 18:32:11,744 views 11576 7552 添加历史记录成功 - 会话ID: 1746009009821_4425, 角色: assistant
INFO 2025-04-30 18:32:11,744 basehttp 11576 7552 "GET /api/chat/stream_chat/?message=%E6%88%91%E5%9C%A8%E4%B8%9C%E5%8C%97%EF%BC%8C%E8%80%8C%E4%B8%94%E6%A0%B9%E7%B3%BB%E4%B9%9F%E6%9C%89%E9%97%AE%E9%A2%98&session_id=1746009009821_4425 HTTP/1.1" 200 4592
INFO 2025-04-30 18:32:14,472 views 11576 16544 Neo4j服务初始化成功
ERROR 2025-04-30 18:32:16,502 views 11576 16544 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:32:16,502 views 11576 16544 ChatAPI实例初始化完成
INFO 2025-04-30 18:32:16,517 views 11576 16544 获取所有历史会话 - 会话数: 6
INFO 2025-04-30 18:32:16,518 basehttp 11576 16544 "GET /api/chat/get_history/ HTTP/1.1" 200 2594
INFO 2025-04-30 18:32:42,563 views 11576 16276 Neo4j服务初始化成功
ERROR 2025-04-30 18:32:44,609 views 11576 16276 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:32:44,609 views 11576 16276 ChatAPI实例初始化完成
INFO 2025-04-30 18:32:44,609 views 11576 16276 创建新会话成功 - 会话ID: 1746009164609_5740
INFO 2025-04-30 18:32:44,609 basehttp 11576 16276 - Broken pipe from ('127.0.0.1', 60647)
INFO 2025-04-30 18:32:45,853 views 11576 17024 Neo4j服务初始化成功
ERROR 2025-04-30 18:32:47,931 views 11576 17024 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:32:47,934 views 11576 17024 ChatAPI实例初始化完成
INFO 2025-04-30 18:32:47,936 views 11576 17024 创建新会话成功 - 会话ID: 1746009167936_5130
INFO 2025-04-30 18:32:47,937 basehttp 11576 17024 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 18:32:50,309 views 11576 17024 Neo4j服务初始化成功
ERROR 2025-04-30 18:32:52,364 views 11576 17024 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:32:52,368 views 11576 17024 ChatAPI实例初始化完成
INFO 2025-04-30 18:32:52,399 views 11576 17024 获取所有历史会话 - 会话数: 6
INFO 2025-04-30 18:32:52,399 basehttp 11576 17024 "GET /api/chat/get_history/ HTTP/1.1" 200 2594
INFO 2025-04-30 18:32:54,703 views 11576 17024 Neo4j服务初始化成功
ERROR 2025-04-30 18:32:56,724 views 11576 17024 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:32:56,724 views 11576 17024 ChatAPI实例初始化完成
INFO 2025-04-30 18:32:56,739 views 11576 17024 获取所有历史会话 - 会话数: 6
INFO 2025-04-30 18:32:56,739 basehttp 11576 17024 "GET /api/chat/get_history/ HTTP/1.1" 200 2594
INFO 2025-04-30 18:33:10,423 views 11576 22444 Neo4j服务初始化成功
ERROR 2025-04-30 18:33:12,496 views 11576 22444 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:33:12,496 views 11576 22444 ChatAPI实例初始化完成
DEBUG 2025-04-30 18:33:12,500 views 11576 22444 收到stream_chat请求: {'message': ['小麦的根系和叶片存在问题'], 'session_id': ['1746009167936_5130']}
DEBUG 2025-04-30 18:33:12,500 views 11576 22444 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 18:33:12,506 views 11576 22444 处理消息: 小麦的根系和叶片存在问题, 会话ID: 1746009167936_5130
INFO 2025-04-30 18:33:12,508 views 11576 22444 获取现有会话: 1746009167936_5130
INFO 2025-04-30 18:33:12,509 views 11576 22444 获取会话历史 - 会话ID: 1746009167936_5130, 历史记录数: 0
DEBUG 2025-04-30 18:33:12,510 views 11576 22444 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '小麦的根系和叶片存在问题'}]
DEBUG 2025-04-30 18:33:12,511 views 11576 22444 构建的消息列表长度: 2
INFO 2025-04-30 18:33:12,512 views 11576 22444 检查会话状态: 1746009167936_5130
INFO 2025-04-30 18:33:12,513 views 11576 22444 创建新会话: 1746009167936_5130
INFO 2025-04-30 18:33:12,514 views 11576 22444 当前症状收集状态: {'collecting': True, 'symptoms': {}}
DEBUG 2025-04-30 18:33:12,514 views 11576 22444 当前症状信息: {}
DEBUG 2025-04-30 18:33:12,515 views 11576 22444 开始提取症状，输入消息: 小麦的根系和叶片存在问题
DEBUG 2025-04-30 18:33:12,515 views 11576 22444 分句结果: ['小麦的根系和叶片存在问题', '小麦的根系和叶片存在问题']
DEBUG 2025-04-30 18:33:12,516 views 11576 22444 提取到的发病部位: ['叶片', '根系']
DEBUG 2025-04-30 18:33:12,516 views 11576 22444 提取到的气象条件: []
DEBUG 2025-04-30 18:33:12,517 views 11576 22444 提取到的生育期: []
DEBUG 2025-04-30 18:33:12,517 views 11576 22444 提取到的种植区: []
DEBUG 2025-04-30 18:33:12,518 views 11576 22444 提取到的发病部位: ['叶片', '根系']
DEBUG 2025-04-30 18:33:12,518 views 11576 22444 提取到的气象条件: []
DEBUG 2025-04-30 18:33:12,519 views 11576 22444 提取到的生育期: []
DEBUG 2025-04-30 18:33:12,519 views 11576 22444 提取到的种植区: []
INFO 2025-04-30 18:33:12,519 views 11576 22444 症状提取结果: {'plant_part': ['叶片', '根系']}
INFO 2025-04-30 18:33:12,519 views 11576 22444 从消息中提取的新症状: {'plant_part': ['叶片', '根系']}
INFO 2025-04-30 18:33:12,520 views 11576 22444 开始更新症状信息 - 会话ID: 1746009167936_5130, 新症状: {'plant_part': ['叶片', '根系']}
DEBUG 2025-04-30 18:33:12,520 views 11576 22444 从Redis获取到的现有症状: {}
INFO 2025-04-30 18:33:12,520 views 11576 22444 更新症状类别 - 会话ID: 1746009167936_5130, 类别: plant_part, 值: ['叶片', '根系']
INFO 2025-04-30 18:33:12,521 views 11576 22444 保存症状信息到Redis - 会话ID: 1746009167936_5130, 症状: {'plant_part': ['叶片', '根系']}
INFO 2025-04-30 18:33:12,522 views 11576 22444 获取现有会话: 1746009167936_5130
INFO 2025-04-30 18:33:12,523 views 11576 22444 会话已保存到 Redis: 1746009167936_5130
INFO 2025-04-30 18:33:12,523 views 11576 22444 症状信息更新完成 - 会话ID: 1746009167936_5130, 最终症状: {'plant_part': ['叶片', '根系']}
INFO 2025-04-30 18:33:12,523 views 11576 22444 更新后的症状信息: {'plant_part': ['叶片', '根系']}
INFO 2025-04-30 18:33:12,524 views 11576 22444 已收集的信息: 目前已经收集到的信息：
发病部位：['叶片', '根系']

还需要补充：气象条件, 生育期, 种植区
INFO 2025-04-30 18:33:15,131 services 11576 22444 查询参数: {'plant_part': ['叶片', '根系'], 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 18:33:15,131 services 11576 22444 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 18:33:15,133 services 11576 22444 查询参数: {'plant_part': ['叶片', '根系'], 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 18:33:15,208 services 11576 22444 查询结果: <neo4j._sync.work.result.Result object at 0x0000020554EB17C0>
DEBUG 2025-04-30 18:33:18,374 views 11576 22444 添加历史记录成功 - 会话ID: 1746009167936_5130, 角色: user
DEBUG 2025-04-30 18:33:18,374 views 11576 22444 添加历史记录成功 - 会话ID: 1746009167936_5130, 角色: assistant
INFO 2025-04-30 18:33:18,378 basehttp 11576 22444 "GET /api/chat/stream_chat/?message=%E5%B0%8F%E9%BA%A6%E7%9A%84%E6%A0%B9%E7%B3%BB%E5%92%8C%E5%8F%B6%E7%89%87%E5%AD%98%E5%9C%A8%E9%97%AE%E9%A2%98&session_id=1746009167936_5130 HTTP/1.1" 200 1274
INFO 2025-04-30 18:33:20,778 views 11576 17024 Neo4j服务初始化成功
ERROR 2025-04-30 18:33:22,833 views 11576 17024 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:33:22,837 views 11576 17024 ChatAPI实例初始化完成
INFO 2025-04-30 18:33:22,852 views 11576 17024 获取所有历史会话 - 会话数: 7
INFO 2025-04-30 18:33:22,854 basehttp 11576 17024 "GET /api/chat/get_history/ HTTP/1.1" 200 3049
INFO 2025-04-30 18:33:46,981 views 11576 20324 Neo4j服务初始化成功
ERROR 2025-04-30 18:33:49,032 views 11576 20324 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:33:49,032 views 11576 20324 ChatAPI实例初始化完成
DEBUG 2025-04-30 18:33:49,034 views 11576 20324 收到stream_chat请求: {'message': ['我目前在西北，而且温度很低'], 'session_id': ['1746009167936_5130']}
DEBUG 2025-04-30 18:33:49,034 views 11576 20324 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 18:33:49,042 views 11576 20324 处理消息: 我目前在西北，而且温度很低, 会话ID: 1746009167936_5130
INFO 2025-04-30 18:33:49,043 views 11576 20324 获取现有会话: 1746009167936_5130
INFO 2025-04-30 18:33:49,045 views 11576 20324 获取会话历史 - 会话ID: 1746009167936_5130, 历史记录数: 2
DEBUG 2025-04-30 18:33:49,045 views 11576 20324 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '小麦的根系和叶片存在问题', 'timestamp': 1746009198.3741398}, {'role': 'assistant', 'content': '根据您提供的信息：\n发病部位：叶片、根系\n\n暂时无法确定具体病害。请补充气象条件、生育期、种植区等信息，以便我更准确地判断。', 'timestamp': 1746009198.3741398}, {'role': 'user', 'content': '我目前在西北，而且温度很低'}]
DEBUG 2025-04-30 18:33:49,046 views 11576 20324 构建的消息列表长度: 4
INFO 2025-04-30 18:33:49,046 views 11576 20324 检查会话状态: 1746009167936_5130
INFO 2025-04-30 18:33:49,047 views 11576 20324 创建新会话: 1746009167936_5130
INFO 2025-04-30 18:33:49,047 views 11576 20324 当前症状收集状态: {'collecting': True, 'symptoms': {'plant_part': ['叶片', '根系']}}
DEBUG 2025-04-30 18:33:49,048 views 11576 20324 当前症状信息: {'plant_part': ['叶片', '根系']}
DEBUG 2025-04-30 18:33:49,048 views 11576 20324 开始提取症状，输入消息: 我目前在西北，而且温度很低
DEBUG 2025-04-30 18:33:49,048 views 11576 20324 分句结果: ['我目前在西北', '而且温度很低', '我目前在西北，而且温度很低']
DEBUG 2025-04-30 18:33:49,048 views 11576 20324 提取到的发病部位: []
DEBUG 2025-04-30 18:33:49,048 views 11576 20324 提取到的气象条件: []
DEBUG 2025-04-30 18:33:49,049 views 11576 20324 提取到的生育期: []
DEBUG 2025-04-30 18:33:49,049 views 11576 20324 提取到的种植区: ['西北']
DEBUG 2025-04-30 18:33:49,049 views 11576 20324 提取到的发病部位: []
DEBUG 2025-04-30 18:33:49,049 views 11576 20324 提取到的气象条件: []
DEBUG 2025-04-30 18:33:49,049 views 11576 20324 提取到的生育期: []
DEBUG 2025-04-30 18:33:49,050 views 11576 20324 提取到的种植区: []
DEBUG 2025-04-30 18:33:49,050 views 11576 20324 提取到的发病部位: []
DEBUG 2025-04-30 18:33:49,050 views 11576 20324 提取到的气象条件: []
DEBUG 2025-04-30 18:33:49,050 views 11576 20324 提取到的生育期: []
DEBUG 2025-04-30 18:33:49,050 views 11576 20324 提取到的种植区: ['西北']
INFO 2025-04-30 18:33:49,051 views 11576 20324 症状提取结果: {'region': '西北'}
INFO 2025-04-30 18:33:49,051 views 11576 20324 从消息中提取的新症状: {'region': '西北'}
INFO 2025-04-30 18:33:49,051 views 11576 20324 开始更新症状信息 - 会话ID: 1746009167936_5130, 新症状: {'region': '西北'}
DEBUG 2025-04-30 18:33:49,051 views 11576 20324 从Redis获取到的现有症状: {'plant_part': ['叶片', '根系']}
INFO 2025-04-30 18:33:49,051 views 11576 20324 更新症状类别 - 会话ID: 1746009167936_5130, 类别: region, 值: 西北
INFO 2025-04-30 18:33:49,052 views 11576 20324 保存症状信息到Redis - 会话ID: 1746009167936_5130, 症状: {'plant_part': ['叶片', '根系'], 'region': '西北'}
INFO 2025-04-30 18:33:49,052 views 11576 20324 获取现有会话: 1746009167936_5130
INFO 2025-04-30 18:33:49,053 views 11576 20324 会话已保存到 Redis: 1746009167936_5130
INFO 2025-04-30 18:33:49,053 views 11576 20324 症状信息更新完成 - 会话ID: 1746009167936_5130, 最终症状: {'plant_part': ['叶片', '根系'], 'region': '西北'}
INFO 2025-04-30 18:33:49,054 views 11576 20324 更新后的症状信息: {'plant_part': ['叶片', '根系'], 'region': '西北'}
INFO 2025-04-30 18:33:49,055 views 11576 20324 已收集的信息: 目前已经收集到的信息：
发病部位：['叶片', '根系']，种植区：西北

还需要补充：气象条件, 生育期
INFO 2025-04-30 18:33:51,765 services 11576 20324 查询参数: {'plant_part': ['叶片', '根系'], 'weather': None, 'growth_stage': None, 'region': '西北'}
INFO 2025-04-30 18:33:51,765 services 11576 20324 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) MATCH (d)-[:OCCURS_IN_REGION]->(r:Region {name: $region}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 18:33:51,773 services 11576 20324 查询参数: {'plant_part': ['叶片', '根系'], 'weather': None, 'growth_stage': None, 'region': '西北'}
INFO 2025-04-30 18:33:51,875 services 11576 20324 查询结果: <neo4j._sync.work.result.Result object at 0x00000205550E3050>
DEBUG 2025-04-30 18:33:55,223 views 11576 20324 添加历史记录成功 - 会话ID: 1746009167936_5130, 角色: user
DEBUG 2025-04-30 18:33:55,223 views 11576 20324 添加历史记录成功 - 会话ID: 1746009167936_5130, 角色: assistant
INFO 2025-04-30 18:33:55,223 basehttp 11576 20324 "GET /api/chat/stream_chat/?message=%E6%88%91%E7%9B%AE%E5%89%8D%E5%9C%A8%E8%A5%BF%E5%8C%97%EF%BC%8C%E8%80%8C%E4%B8%94%E6%B8%A9%E5%BA%A6%E5%BE%88%E4%BD%8E&session_id=1746009167936_5130 HTTP/1.1" 200 1333
INFO 2025-04-30 18:33:57,690 views 11576 17024 Neo4j服务初始化成功
ERROR 2025-04-30 18:33:59,727 views 11576 17024 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:33:59,727 views 11576 17024 ChatAPI实例初始化完成
INFO 2025-04-30 18:33:59,746 views 11576 17024 获取所有历史会话 - 会话数: 7
INFO 2025-04-30 18:33:59,747 basehttp 11576 17024 "GET /api/chat/get_history/ HTTP/1.1" 200 3049
INFO 2025-04-30 18:34:22,143 views 11576 2392 Neo4j服务初始化成功
ERROR 2025-04-30 18:34:24,190 views 11576 2392 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:34:24,190 views 11576 2392 ChatAPI实例初始化完成
DEBUG 2025-04-30 18:34:24,193 views 11576 2392 收到stream_chat请求: {'message': ['目前气象条件是低温'], 'session_id': ['1746009167936_5130']}
DEBUG 2025-04-30 18:34:24,193 views 11576 2392 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 18:34:24,199 views 11576 2392 处理消息: 目前气象条件是低温, 会话ID: 1746009167936_5130
INFO 2025-04-30 18:34:24,200 views 11576 2392 获取现有会话: 1746009167936_5130
INFO 2025-04-30 18:34:24,201 views 11576 2392 获取会话历史 - 会话ID: 1746009167936_5130, 历史记录数: 4
DEBUG 2025-04-30 18:34:24,201 views 11576 2392 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '小麦的根系和叶片存在问题', 'timestamp': 1746009198.3741398}, {'role': 'assistant', 'content': '根据您提供的信息：\n发病部位：叶片、根系\n\n暂时无法确定具体病害。请补充气象条件、生育期、种植区等信息，以便我更准确地判断。', 'timestamp': 1746009198.3741398}, {'role': 'user', 'content': '我目前在西北，而且温度很低', 'timestamp': 1746009235.22272}, {'role': 'assistant', 'content': '根据您提供的信息：\n发病部位：叶片、根系，种植区：西北\n\n暂时无法确定具体病害。请补充气象条件、生育期等信息，以便我更准确地判断。', 'timestamp': 1746009235.2237172}, {'role': 'user', 'content': '目前气象条件是低温'}]
DEBUG 2025-04-30 18:34:24,202 views 11576 2392 构建的消息列表长度: 6
INFO 2025-04-30 18:34:24,203 views 11576 2392 检查会话状态: 1746009167936_5130
INFO 2025-04-30 18:34:24,204 views 11576 2392 创建新会话: 1746009167936_5130
INFO 2025-04-30 18:34:24,204 views 11576 2392 当前症状收集状态: {'collecting': True, 'symptoms': {'plant_part': ['叶片', '根系'], 'region': '西北'}}
DEBUG 2025-04-30 18:34:24,204 views 11576 2392 当前症状信息: {'plant_part': ['叶片', '根系'], 'region': '西北'}
DEBUG 2025-04-30 18:34:24,204 views 11576 2392 开始提取症状，输入消息: 目前气象条件是低温
DEBUG 2025-04-30 18:34:24,204 views 11576 2392 分句结果: ['目前气象条件是低温', '目前气象条件是低温']
DEBUG 2025-04-30 18:34:24,204 views 11576 2392 提取到的发病部位: []
DEBUG 2025-04-30 18:34:24,205 views 11576 2392 提取到的气象条件: ['低温']
DEBUG 2025-04-30 18:34:24,205 views 11576 2392 提取到的生育期: []
DEBUG 2025-04-30 18:34:24,205 views 11576 2392 提取到的种植区: []
DEBUG 2025-04-30 18:34:24,205 views 11576 2392 提取到的发病部位: []
DEBUG 2025-04-30 18:34:24,205 views 11576 2392 提取到的气象条件: ['低温']
DEBUG 2025-04-30 18:34:24,206 views 11576 2392 提取到的生育期: []
DEBUG 2025-04-30 18:34:24,206 views 11576 2392 提取到的种植区: []
INFO 2025-04-30 18:34:24,206 views 11576 2392 症状提取结果: {'weather': '低温'}
INFO 2025-04-30 18:34:24,207 views 11576 2392 从消息中提取的新症状: {'weather': '低温'}
INFO 2025-04-30 18:34:24,207 views 11576 2392 开始更新症状信息 - 会话ID: 1746009167936_5130, 新症状: {'weather': '低温'}
DEBUG 2025-04-30 18:34:24,207 views 11576 2392 从Redis获取到的现有症状: {'plant_part': ['叶片', '根系'], 'region': '西北'}
INFO 2025-04-30 18:34:24,207 views 11576 2392 更新症状类别 - 会话ID: 1746009167936_5130, 类别: weather, 值: 低温
INFO 2025-04-30 18:34:24,208 views 11576 2392 保存症状信息到Redis - 会话ID: 1746009167936_5130, 症状: {'plant_part': ['叶片', '根系'], 'region': '西北', 'weather': '低温'}
INFO 2025-04-30 18:34:24,208 views 11576 2392 获取现有会话: 1746009167936_5130
INFO 2025-04-30 18:34:24,209 views 11576 2392 会话已保存到 Redis: 1746009167936_5130
INFO 2025-04-30 18:34:24,209 views 11576 2392 症状信息更新完成 - 会话ID: 1746009167936_5130, 最终症状: {'plant_part': ['叶片', '根系'], 'region': '西北', 'weather': '低温'}
INFO 2025-04-30 18:34:24,209 views 11576 2392 更新后的症状信息: {'plant_part': ['叶片', '根系'], 'region': '西北', 'weather': '低温'}
INFO 2025-04-30 18:34:24,209 views 11576 2392 已收集的信息: 目前已经收集到的信息：
发病部位：['叶片', '根系']，气象条件：低温，种植区：西北

还需要补充：生育期
INFO 2025-04-30 18:34:27,018 services 11576 2392 查询参数: {'plant_part': ['叶片', '根系'], 'weather': '低温', 'growth_stage': None, 'region': '西北'}
INFO 2025-04-30 18:34:27,018 services 11576 2392 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) MATCH (d)-[:OCCURS_IN_WEATHER]->(w:Weather {name: $weather}) MATCH (d)-[:OCCURS_IN_REGION]->(r:Region {name: $region}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 18:34:27,019 services 11576 2392 查询参数: {'plant_part': ['叶片', '根系'], 'weather': '低温', 'growth_stage': None, 'region': '西北'}
INFO 2025-04-30 18:34:27,146 services 11576 2392 查询结果: <neo4j._sync.work.result.Result object at 0x00000205550E6E10>
DEBUG 2025-04-30 18:34:30,617 views 11576 2392 添加历史记录成功 - 会话ID: 1746009167936_5130, 角色: user
DEBUG 2025-04-30 18:34:30,619 views 11576 2392 添加历史记录成功 - 会话ID: 1746009167936_5130, 角色: assistant
INFO 2025-04-30 18:34:30,619 basehttp 11576 2392 "GET /api/chat/stream_chat/?message=%E7%9B%AE%E5%89%8D%E6%B0%94%E8%B1%A1%E6%9D%A1%E4%BB%B6%E6%98%AF%E4%BD%8E%E6%B8%A9&session_id=1746009167936_5130 HTTP/1.1" 200 1392
INFO 2025-04-30 18:34:33,081 views 11576 17024 Neo4j服务初始化成功
ERROR 2025-04-30 18:34:35,131 views 11576 17024 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:34:35,131 views 11576 17024 ChatAPI实例初始化完成
INFO 2025-04-30 18:34:35,172 views 11576 17024 获取所有历史会话 - 会话数: 7
INFO 2025-04-30 18:34:35,173 basehttp 11576 17024 "GET /api/chat/get_history/ HTTP/1.1" 200 3049
INFO 2025-04-30 18:40:44,132 autoreload 11576 12120 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-04-30 18:40:44,933 autoreload 2108 12960 Watching for file changes with StatReloader
INFO 2025-04-30 18:43:30,780 autoreload 9432 11668 Watching for file changes with StatReloader
INFO 2025-04-30 18:43:53,377 views 9432 9712 Neo4j服务初始化成功
ERROR 2025-04-30 18:43:55,426 views 9432 9712 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:43:55,426 views 9432 9712 ChatAPI实例初始化完成
INFO 2025-04-30 18:43:55,446 views 9432 9712 创建新会话成功 - 会话ID: 1746009835426_2032
INFO 2025-04-30 18:43:55,448 basehttp 9432 9712 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-04-30 18:43:57,813 views 9432 9712 Neo4j服务初始化成功
ERROR 2025-04-30 18:43:59,857 views 9432 9712 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:43:59,858 views 9432 9712 ChatAPI实例初始化完成
INFO 2025-04-30 18:43:59,870 views 9432 9712 获取所有历史会话 - 会话数: 7
INFO 2025-04-30 18:43:59,871 basehttp 9432 9712 "GET /api/chat/get_history/ HTTP/1.1" 200 3049
INFO 2025-04-30 18:44:02,189 views 9432 9712 Neo4j服务初始化成功
ERROR 2025-04-30 18:44:04,238 views 9432 9712 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:44:04,238 views 9432 9712 ChatAPI实例初始化完成
INFO 2025-04-30 18:44:04,251 views 9432 9712 获取所有历史会话 - 会话数: 7
INFO 2025-04-30 18:44:04,252 basehttp 9432 9712 "GET /api/chat/get_history/ HTTP/1.1" 200 3049
INFO 2025-04-30 18:44:14,991 views 9432 21900 Neo4j服务初始化成功
ERROR 2025-04-30 18:44:17,055 views 9432 21900 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:44:17,056 views 9432 21900 ChatAPI实例初始化完成
DEBUG 2025-04-30 18:44:17,056 views 9432 21900 收到stream_chat请求: {'message': ['小麦的根系有问题'], 'session_id': ['1746009835426_2032']}
DEBUG 2025-04-30 18:44:17,060 views 9432 21900 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 18:44:17,064 views 9432 21900 处理消息: 小麦的根系有问题, 会话ID: 1746009835426_2032
INFO 2025-04-30 18:44:17,066 views 9432 21900 获取现有会话: 1746009835426_2032
INFO 2025-04-30 18:44:17,067 views 9432 21900 获取会话历史 - 会话ID: 1746009835426_2032, 历史记录数: 0
DEBUG 2025-04-30 18:44:17,068 views 9432 21900 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '小麦的根系有问题'}]
DEBUG 2025-04-30 18:44:17,070 views 9432 21900 构建的消息列表长度: 2
INFO 2025-04-30 18:44:17,072 views 9432 21900 检查会话状态: 1746009835426_2032
INFO 2025-04-30 18:44:17,073 views 9432 21900 创建新会话: 1746009835426_2032
INFO 2025-04-30 18:44:17,074 views 9432 21900 当前症状收集状态: {'collecting': True, 'symptoms': {}}
DEBUG 2025-04-30 18:44:17,075 views 9432 21900 当前症状信息: {}
DEBUG 2025-04-30 18:44:17,076 views 9432 21900 开始提取症状，输入消息: 小麦的根系有问题
DEBUG 2025-04-30 18:44:17,076 views 9432 21900 分句结果: ['小麦的根系有问题', '小麦的根系有问题']
DEBUG 2025-04-30 18:44:17,077 views 9432 21900 提取到的发病部位: ['根系']
DEBUG 2025-04-30 18:44:17,077 views 9432 21900 提取到的气象条件: []
DEBUG 2025-04-30 18:44:17,078 views 9432 21900 提取到的生育期: []
DEBUG 2025-04-30 18:44:17,078 views 9432 21900 提取到的种植区: []
DEBUG 2025-04-30 18:44:17,079 views 9432 21900 提取到的发病部位: ['根系']
DEBUG 2025-04-30 18:44:17,079 views 9432 21900 提取到的气象条件: []
DEBUG 2025-04-30 18:44:17,079 views 9432 21900 提取到的生育期: []
DEBUG 2025-04-30 18:44:17,079 views 9432 21900 提取到的种植区: []
INFO 2025-04-30 18:44:17,080 views 9432 21900 症状提取结果: {'plant_part': '根系'}
INFO 2025-04-30 18:44:17,080 views 9432 21900 从消息中提取的新症状: {'plant_part': '根系'}
INFO 2025-04-30 18:44:17,080 views 9432 21900 开始更新症状信息 - 会话ID: 1746009835426_2032, 新症状: {'plant_part': '根系'}
DEBUG 2025-04-30 18:44:17,081 views 9432 21900 从Redis获取到的现有症状: {}
INFO 2025-04-30 18:44:17,081 views 9432 21900 更新症状类别 - 会话ID: 1746009835426_2032, 类别: plant_part, 值: 根系
INFO 2025-04-30 18:44:17,081 views 9432 21900 保存症状信息到Redis - 会话ID: 1746009835426_2032, 症状: {'plant_part': '根系'}
INFO 2025-04-30 18:44:17,082 views 9432 21900 获取现有会话: 1746009835426_2032
INFO 2025-04-30 18:44:17,082 views 9432 21900 会话已保存到 Redis: 1746009835426_2032
INFO 2025-04-30 18:44:17,082 views 9432 21900 症状信息更新完成 - 会话ID: 1746009835426_2032, 最终症状: {'plant_part': '根系'}
INFO 2025-04-30 18:44:17,083 views 9432 21900 更新后的症状信息: {'plant_part': '根系'}
INFO 2025-04-30 18:44:17,083 views 9432 21900 已收集的信息: 目前已经收集到的信息：
发病部位：根系

还需要补充：气象条件, 生育期, 种植区
INFO 2025-04-30 18:44:19,183 services 9432 21900 查询参数: {'plant_part': '根系', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 18:44:19,183 services 9432 21900 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 18:44:19,183 services 9432 21900 查询参数: {'plant_part': '根系', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 18:44:19,187 services 9432 21900 查询结果: <neo4j._sync.work.result.Result object at 0x000001780B453AA0>
DEBUG 2025-04-30 18:44:37,930 views 9432 21900 添加历史记录成功 - 会话ID: 1746009835426_2032, 角色: user
DEBUG 2025-04-30 18:44:37,930 views 9432 21900 添加历史记录成功 - 会话ID: 1746009835426_2032, 角色: assistant
INFO 2025-04-30 18:44:37,930 basehttp 9432 21900 "GET /api/chat/stream_chat/?message=%E5%B0%8F%E9%BA%A6%E7%9A%84%E6%A0%B9%E7%B3%BB%E6%9C%89%E9%97%AE%E9%A2%98&session_id=1746009835426_2032 HTTP/1.1" 200 4432
INFO 2025-04-30 18:44:40,623 views 9432 9712 Neo4j服务初始化成功
ERROR 2025-04-30 18:44:42,701 views 9432 9712 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:44:42,701 views 9432 9712 ChatAPI实例初始化完成
INFO 2025-04-30 18:44:42,717 views 9432 9712 获取所有历史会话 - 会话数: 8
INFO 2025-04-30 18:44:42,718 basehttp 9432 9712 "GET /api/chat/get_history/ HTTP/1.1" 200 3456
INFO 2025-04-30 18:44:56,886 views 9432 9536 Neo4j服务初始化成功
ERROR 2025-04-30 18:44:58,941 views 9432 9536 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:44:58,941 views 9432 9536 ChatAPI实例初始化完成
DEBUG 2025-04-30 18:44:58,941 views 9432 9536 收到stream_chat请求: {'message': ['叶片上也有问题'], 'session_id': ['1746009835426_2032']}
DEBUG 2025-04-30 18:44:58,941 views 9432 9536 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Microsoft Edge";v="135", "Not-A.Brand";v="8", "Chromium";v="135"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36 Edg/135.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-04-30 18:44:58,944 views 9432 9536 处理消息: 叶片上也有问题, 会话ID: 1746009835426_2032
INFO 2025-04-30 18:44:58,944 views 9432 9536 获取现有会话: 1746009835426_2032
INFO 2025-04-30 18:44:58,944 views 9432 9536 获取会话历史 - 会话ID: 1746009835426_2032, 历史记录数: 2
DEBUG 2025-04-30 18:44:58,944 views 9432 9536 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '小麦的根系有问题', 'timestamp': 1746009877.9307427}, {'role': 'assistant', 'content': '根据目前掌握的信息：\n发病部位：根系\n\n可能的病害有：\n1. 小麦黄矮病毒病\n   主要特征: 叶片典型症状是新叶发病从叶尖渐向叶基扩展变黄，黄化部分占全叶的1/3 - 1/2，叶基仍为绿色，且保持较长时间，有时出现与叶脉平行但不受叶脉限制的黄绿相间条纹，病叶较光滑，发病早植株矮化严重，但因品种...\n2. 小麦雪霉叶枯病\n   主要特征: 芽腐和苗枯：种子萌发后，胚根、胚根鞘、胚芽鞘等腐烂变色，胚根少，根短，胚芽鞘上生条形至长圆形黑褐色斑，严重的烂腐，表生白色菌丝，病菌基部的叶鞘变褐坏死，且向叶片基部发展，致整叶变褐或变黄枯死，病苗生长...\n3. 小麦雪腐病\n   主要特征: 病株上初生浅绿色水渍状病斑，布满灰白色松软霉层，后产生大量黑褐色的菌核，病部组织烂腐、病叶极易破碎...\n\n请补充更多信息，以便我更准确地判断。', 'timestamp': 1746009877.9307427}, {'role': 'user', 'content': '叶片上也有问题'}]
DEBUG 2025-04-30 18:44:58,944 views 9432 9536 构建的消息列表长度: 4
INFO 2025-04-30 18:44:58,944 views 9432 9536 检查会话状态: 1746009835426_2032
INFO 2025-04-30 18:44:58,947 views 9432 9536 创建新会话: 1746009835426_2032
INFO 2025-04-30 18:44:58,947 views 9432 9536 当前症状收集状态: {'collecting': True, 'symptoms': {'plant_part': '根系'}}
DEBUG 2025-04-30 18:44:58,947 views 9432 9536 当前症状信息: {'plant_part': '根系'}
DEBUG 2025-04-30 18:44:58,948 views 9432 9536 开始提取症状，输入消息: 叶片上也有问题
DEBUG 2025-04-30 18:44:58,948 views 9432 9536 分句结果: ['叶片上也有问题', '叶片上也有问题']
DEBUG 2025-04-30 18:44:58,948 views 9432 9536 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 18:44:58,948 views 9432 9536 提取到的气象条件: []
DEBUG 2025-04-30 18:44:58,949 views 9432 9536 提取到的生育期: []
DEBUG 2025-04-30 18:44:58,949 views 9432 9536 提取到的种植区: []
DEBUG 2025-04-30 18:44:58,950 views 9432 9536 提取到的发病部位: ['叶片']
DEBUG 2025-04-30 18:44:58,950 views 9432 9536 提取到的气象条件: []
DEBUG 2025-04-30 18:44:58,950 views 9432 9536 提取到的生育期: []
DEBUG 2025-04-30 18:44:58,951 views 9432 9536 提取到的种植区: []
INFO 2025-04-30 18:44:58,951 views 9432 9536 症状提取结果: {'plant_part': '叶片'}
INFO 2025-04-30 18:44:58,951 views 9432 9536 从消息中提取的新症状: {'plant_part': '叶片'}
INFO 2025-04-30 18:44:58,951 views 9432 9536 开始更新症状信息 - 会话ID: 1746009835426_2032, 新症状: {'plant_part': '叶片'}
DEBUG 2025-04-30 18:44:58,952 views 9432 9536 从Redis获取到的现有症状: {'plant_part': '根系'}
INFO 2025-04-30 18:44:58,952 views 9432 9536 更新症状类别 - 会话ID: 1746009835426_2032, 类别: plant_part, 值: 叶片
INFO 2025-04-30 18:44:58,952 views 9432 9536 保存症状信息到Redis - 会话ID: 1746009835426_2032, 症状: {'plant_part': '叶片'}
INFO 2025-04-30 18:44:58,953 views 9432 9536 获取现有会话: 1746009835426_2032
INFO 2025-04-30 18:44:58,953 views 9432 9536 会话已保存到 Redis: 1746009835426_2032
INFO 2025-04-30 18:44:58,954 views 9432 9536 症状信息更新完成 - 会话ID: 1746009835426_2032, 最终症状: {'plant_part': '叶片'}
INFO 2025-04-30 18:44:58,954 views 9432 9536 更新后的症状信息: {'plant_part': '叶片'}
INFO 2025-04-30 18:44:58,954 views 9432 9536 已收集的信息: 目前已经收集到的信息：
发病部位：叶片

还需要补充：气象条件, 生育期, 种植区
INFO 2025-04-30 18:45:01,049 services 9432 9536 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 18:45:01,049 services 9432 9536 执行查询: 
                MATCH (d:Disease)
                MATCH (d)-[:AFFECTS_PART]->(p:PlantPart {name: $plant_part}) 
                RETURN d.name as name, 
                       d.alias as alias,
                       d.pathogen as pathogen,
                       d.symptoms as symptoms,
                       d.treatment as treatment,
                       count(*) as matched_symptoms,
                       1.0 as match_ratio
                LIMIT 3
                
INFO 2025-04-30 18:45:01,050 services 9432 9536 查询参数: {'plant_part': '叶片', 'weather': None, 'growth_stage': None, 'region': None}
INFO 2025-04-30 18:45:01,054 services 9432 9536 查询结果: <neo4j._sync.work.result.Result object at 0x000001780B6CF710>
DEBUG 2025-04-30 18:45:22,260 views 9432 9536 添加历史记录成功 - 会话ID: 1746009835426_2032, 角色: user
DEBUG 2025-04-30 18:45:22,262 views 9432 9536 添加历史记录成功 - 会话ID: 1746009835426_2032, 角色: assistant
INFO 2025-04-30 18:45:22,262 basehttp 9432 9536 "GET /api/chat/stream_chat/?message=%E5%8F%B6%E7%89%87%E4%B8%8A%E4%B9%9F%E6%9C%89%E9%97%AE%E9%A2%98&session_id=1746009835426_2032 HTTP/1.1" 200 4971
INFO 2025-04-30 18:45:25,274 views 9432 9712 Neo4j服务初始化成功
ERROR 2025-04-30 18:45:27,339 views 9432 9712 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-04-30 18:45:27,339 views 9432 9712 ChatAPI实例初始化完成
INFO 2025-04-30 18:45:27,355 views 9432 9712 获取所有历史会话 - 会话数: 8
INFO 2025-04-30 18:45:27,355 basehttp 9432 9712 "GET /api/chat/get_history/ HTTP/1.1" 200 3456
INFO 2025-05-10 17:52:06,631 autoreload 4444 20924 Watching for file changes with StatReloader
INFO 2025-05-10 17:56:11,517 views 4444 8320 Neo4j服务初始化成功
ERROR 2025-05-10 17:56:14,461 views 4444 8320 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-10 17:56:14,461 views 4444 8320 ChatAPI实例初始化完成
ERROR 2025-05-10 17:56:16,504 views 4444 8320 创建会话失败: Error 10061 connecting to 127.0.0.1:6379. 由于目标计算机积极拒绝，无法连接。.
ERROR 2025-05-10 17:56:16,505 log 4444 8320 Internal Server Error: /api/chat/create_session/
ERROR 2025-05-10 17:56:16,505 basehttp 4444 8320 "POST /api/chat/create_session/ HTTP/1.1" 500 179
INFO 2025-05-10 17:56:18,850 views 4444 8320 Neo4j服务初始化成功
ERROR 2025-05-10 17:56:22,944 views 4444 8320 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-10 17:56:22,945 views 4444 8320 ChatAPI实例初始化完成
ERROR 2025-05-10 17:56:24,995 views 4444 8320 获取历史记录失败: Error 10061 connecting to 127.0.0.1:6379. 由于目标计算机积极拒绝，无法连接。.
ERROR 2025-05-10 17:56:24,996 log 4444 8320 Internal Server Error: /api/chat/get_history/
INFO 2025-05-10 17:56:24,996 basehttp 4444 8320 - Broken pipe from ('127.0.0.1', 57610)
INFO 2025-05-10 17:56:25,543 views 4444 25172 Neo4j服务初始化成功
ERROR 2025-05-10 17:56:29,626 views 4444 25172 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-10 17:56:29,627 views 4444 25172 ChatAPI实例初始化完成
ERROR 2025-05-10 17:56:31,676 views 4444 25172 创建会话失败: Error 10061 connecting to 127.0.0.1:6379. 由于目标计算机积极拒绝，无法连接。.
ERROR 2025-05-10 17:56:31,677 log 4444 25172 Internal Server Error: /api/chat/create_session/
ERROR 2025-05-10 17:56:31,677 basehttp 4444 25172 "POST /api/chat/create_session/ HTTP/1.1" 500 179
INFO 2025-05-10 17:56:34,027 views 4444 25172 Neo4j服务初始化成功
ERROR 2025-05-10 17:56:38,131 views 4444 25172 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-10 17:56:38,132 views 4444 25172 ChatAPI实例初始化完成
ERROR 2025-05-10 17:56:40,179 views 4444 25172 获取历史记录失败: Error 10061 connecting to 127.0.0.1:6379. 由于目标计算机积极拒绝，无法连接。.
ERROR 2025-05-10 17:56:40,179 log 4444 25172 Internal Server Error: /api/chat/get_history/
ERROR 2025-05-10 17:56:40,180 basehttp 4444 25172 "GET /api/chat/get_history/ HTTP/1.1" 500 179
INFO 2025-05-10 17:59:54,007 views 4444 25172 Neo4j服务初始化成功
ERROR 2025-05-10 17:59:56,063 views 4444 25172 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-10 17:59:56,064 views 4444 25172 ChatAPI实例初始化完成
ERROR 2025-05-10 17:59:56,065 views 4444 25172 创建会话失败: Client sent AUTH, but no password is set
ERROR 2025-05-10 17:59:56,065 log 4444 25172 Internal Server Error: /api/chat/create_session/
ERROR 2025-05-10 17:59:56,066 basehttp 4444 25172 "POST /api/chat/create_session/ HTTP/1.1" 500 74
INFO 2025-05-10 17:59:58,436 views 4444 25172 Neo4j服务初始化成功
ERROR 2025-05-10 18:00:00,485 views 4444 25172 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-10 18:00:00,486 views 4444 25172 ChatAPI实例初始化完成
ERROR 2025-05-10 18:00:00,487 views 4444 25172 获取历史记录失败: Client sent AUTH, but no password is set
ERROR 2025-05-10 18:00:00,487 log 4444 25172 Internal Server Error: /api/chat/get_history/
ERROR 2025-05-10 18:00:00,488 basehttp 4444 25172 "GET /api/chat/get_history/ HTTP/1.1" 500 74
INFO 2025-05-10 18:04:26,514 views 4444 25172 Neo4j服务初始化成功
ERROR 2025-05-10 18:04:28,555 views 4444 25172 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-10 18:04:28,555 views 4444 25172 ChatAPI实例初始化完成
INFO 2025-05-10 18:04:28,556 views 4444 25172 创建新会话成功 - 会话ID: 1746871468556_9750
INFO 2025-05-10 18:04:28,557 basehttp 4444 25172 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-05-10 18:04:30,877 views 4444 25172 Neo4j服务初始化成功
ERROR 2025-05-10 18:04:32,940 views 4444 25172 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-10 18:04:32,941 views 4444 25172 ChatAPI实例初始化完成
INFO 2025-05-10 18:04:32,954 views 4444 25172 获取所有历史会话 - 会话数: 8
INFO 2025-05-10 18:04:32,954 basehttp 4444 25172 "GET /api/chat/get_history/ HTTP/1.1" 200 3456
INFO 2025-05-10 18:04:35,292 views 4444 25172 Neo4j服务初始化成功
ERROR 2025-05-10 18:04:37,343 views 4444 25172 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-10 18:04:37,343 views 4444 25172 ChatAPI实例初始化完成
INFO 2025-05-10 18:04:37,357 views 4444 25172 获取所有历史会话 - 会话数: 8
INFO 2025-05-10 18:04:37,358 basehttp 4444 25172 "GET /api/chat/get_history/ HTTP/1.1" 200 3456
INFO 2025-05-10 18:06:42,812 basehttp 4444 25172 "GET /api/knowledge/graph/ HTTP/1.1" 200 134148
INFO 2025-05-10 18:06:43,136 basehttp 4444 8604 "OPTIONS /api/knowledge/graph/ HTTP/1.1" 200 0
WARNING 2025-05-10 18:06:47,253 log 4444 8604 Unauthorized: /api/knowledge/graph/
WARNING 2025-05-10 18:06:47,253 basehttp 4444 8604 "GET /api/knowledge/graph/ HTTP/1.1" 401 171
INFO 2025-05-10 18:07:05,998 basehttp 4444 8604 "OPTIONS /api/users/login/ HTTP/1.1" 200 0
INFO 2025-05-10 18:07:06,741 basehttp 4444 8604 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-10 18:07:06,747 basehttp 4444 8604 "OPTIONS /api/knowledge/init/ HTTP/1.1" 200 0
INFO 2025-05-10 18:07:10,916 basehttp 4444 8604 "POST /api/knowledge/init/ HTTP/1.1" 200 134148
INFO 2025-05-10 18:07:15,087 basehttp 4444 25172 "GET /api/knowledge/graph/ HTTP/1.1" 200 134148
INFO 2025-05-10 18:07:19,231 basehttp 4444 8604 "GET /api/knowledge/graph/ HTTP/1.1" 200 134148
INFO 2025-05-10 18:07:33,919 basehttp 4444 8604 "OPTIONS /api/users/ HTTP/1.1" 200 0
INFO 2025-05-10 18:07:33,945 basehttp 4444 8604 "GET /api/users/ HTTP/1.1" 200 226
INFO 2025-05-11 16:44:59,051 autoreload 26444 2696 Watching for file changes with StatReloader
INFO 2025-05-11 16:47:57,405 views 26444 8272 Neo4j服务初始化成功
ERROR 2025-05-11 16:47:59,480 views 26444 8272 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-11 16:47:59,483 views 26444 8272 ChatAPI实例初始化完成
INFO 2025-05-11 16:47:59,490 views 26444 8272 创建新会话成功 - 会话ID: 1746953279483_1249
INFO 2025-05-11 16:47:59,490 basehttp 26444 8272 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-05-11 16:48:01,806 views 26444 8272 Neo4j服务初始化成功
ERROR 2025-05-11 16:48:03,873 views 26444 8272 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-11 16:48:03,874 views 26444 8272 ChatAPI实例初始化完成
INFO 2025-05-11 16:48:03,887 views 26444 8272 获取所有历史会话 - 会话数: 8
INFO 2025-05-11 16:48:03,887 basehttp 26444 8272 "GET /api/chat/get_history/ HTTP/1.1" 200 3456
INFO 2025-05-11 16:48:06,202 views 26444 8272 Neo4j服务初始化成功
ERROR 2025-05-11 16:48:08,282 views 26444 8272 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-11 16:48:08,282 views 26444 8272 ChatAPI实例初始化完成
INFO 2025-05-11 16:48:08,295 views 26444 8272 获取所有历史会话 - 会话数: 8
INFO 2025-05-11 16:48:08,296 basehttp 26444 8272 "GET /api/chat/get_history/ HTTP/1.1" 200 3456
INFO 2025-05-11 16:48:24,253 views 26444 6776 Neo4j服务初始化成功
ERROR 2025-05-11 16:48:26,302 views 26444 6776 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-11 16:48:26,302 views 26444 6776 ChatAPI实例初始化完成
DEBUG 2025-05-11 16:48:26,303 views 26444 6776 收到stream_chat请求: {'message': ['小麦赤霉病有哪些症状？'], 'session_id': ['1746953279483_1249']}
DEBUG 2025-05-11 16:48:26,303 views 26444 6776 请求头: {'Content-Length': '', 'Content-Type': 'text/plain', 'X-Forwarded-Host': 'localhost:8080', 'X-Forwarded-Proto': 'http', 'X-Forwarded-Port': '8080', 'X-Forwarded-For': '127.0.0.1', 'Cookie': 'ajs_anonymous_id=4046ded4-a48b-487f-9944-cdc8d57bc6c5; _xsrf=2|325da970|9607d9ae7fe36e171da36e7a61efcb22|1746344484; username-localhost-8888=2|1:0|10:1746357489|23:username-localhost-8888|188:eyJ1c2VybmFtZSI6ICIwZDVkM2U2MGZmMzI0MWI2OGVkODQ1ZGZjZTVlMTFkMCIsICJuYW1lIjogIkFub255bW91cyBMZWRhIiwgImRpc3BsYXlfbmFtZSI6ICJBbm9ueW1vdXMgTGVkYSIsICJpbml0aWFscyI6ICJBTCIsICJjb2xvciI6IG51bGx9|50e3a5a89ce6b2ce88cbe4fbff162d59315576119b37464b2bf7cfe1c35ad597; username-localhost-8889=2|1:0|10:1746371472|23:username-localhost-8889|212:eyJ1c2VybmFtZSI6ICIzNzhiODM4ODNlZDc0ZmNmYTVjMzA0YzRiZmI1YzI2NSIsICJuYW1lIjogIkFub255bW91cyBQaGlsb3Bocm9zeW5lIiwgImRpc3BsYXlfbmFtZSI6ICJBbm9ueW1vdXMgUGhpbG9waHJvc3luZSIsICJpbml0aWFscyI6ICJBUCIsICJjb2xvciI6IG51bGx9|a53fe3be6f8f2720b1e0699276e5d30483f05f4fdda13f901ccab38a97bc7633; username-localhost-8890="2|1:0|10:1746372328|23:username-localhost-8890|200:eyJ1c2VybmFtZSI6ICJiNWNiZjU2NTZjNDg0MzExYTQyMWExN2U4MTcxZDE5MyIsICJuYW1lIjogIkFub255bW91cyBBZHJhc3RlYSIsICJkaXNwbGF5X25hbWUiOiAiQW5vbnltb3VzIEFkcmFzdGVhIiwgImluaXRpYWxzIjogIkFBIiwgImNvbG9yIjogbnVsbH0=|4e993ba5184f87d30d5a35835a318270bcf147acf1f0f409c924d1b19fde3d7d"; username-localhost-8891=2|1:0|10:1746426215|23:username-localhost-8891|196:eyJ1c2VybmFtZSI6ICJmMjRlZDZmOTRiNmE0YjY1ODBmNWI3YzEwZDNhZTgyZSIsICJuYW1lIjogIkFub255bW91cyBUYXlnZXRlIiwgImRpc3BsYXlfbmFtZSI6ICJBbm9ueW1vdXMgVGF5Z2V0ZSIsICJpbml0aWFscyI6ICJBVCIsICJjb2xvciI6IG51bGx9|18633c879e8a5f39a5d74de053336274fad15aaf12b9ecce1fdf31227c3ac4f8; username-localhost-8892="2|1:0|10:1746426505|23:username-localhost-8892|196:eyJ1c2VybmFtZSI6ICJhYzRiYjAwYzNjNWE0ZTg0YTAwZWFmYWU5MzFlZDA0ZSIsICJuYW1lIjogIkFub255bW91cyBUaHlvbmUiLCAiZGlzcGxheV9uYW1lIjogIkFub255bW91cyBUaHlvbmUiLCAiaW5pdGlhbHMiOiAiQVQiLCAiY29sb3IiOiBudWxsfQ==|ff5539fa3ed5867ed46b74db884bd64d17786736e830509e38d8887cf54b9fdf"', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Referer': 'http://localhost:8080/chat', 'Sec-Fetch-Dest': 'empty', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Site': 'same-origin', 'Sec-Ch-Ua-Mobile': '?0', 'Dnt': '1', 'Sec-Ch-Ua': '"Chromium";v="136", "Microsoft Edge";v="136", "Not.A/Brand";v="99"', 'Accept': 'text/event-stream', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36 Edg/136.0.0.0', 'Cache-Control': 'no-cache', 'Sec-Ch-Ua-Platform': '"Windows"', 'Connection': 'close', 'Host': '127.0.0.1:8000'}
DEBUG 2025-05-11 16:48:26,305 views 26444 6776 处理消息: 小麦赤霉病有哪些症状？, 会话ID: 1746953279483_1249
INFO 2025-05-11 16:48:26,306 views 26444 6776 获取现有会话: 1746953279483_1249
INFO 2025-05-11 16:48:26,306 views 26444 6776 获取会话历史 - 会话ID: 1746953279483_1249, 历史记录数: 0
DEBUG 2025-05-11 16:48:26,307 views 26444 6776 构建的消息: [{'role': 'system', 'content': '你是一个专业的小麦病害诊断助手。请遵循以下步骤进行诊断：\n                1. 仔细分析用户描述的症状\n                2. 列出可能的病害类型及其特征\n                3. 给出诊断结果的可信度评估\n                4. 提供具体的防治建议\n                5. 如果症状描述不够清晰，请询问更多细节,例如从哪个部位开始发病，发病气象条件，发病的生育期，发病的种植区等\n                \n                请使用专业但易懂的语言，必要时解释专业术语。'}, {'role': 'user', 'content': '小麦赤霉病有哪些症状？'}]
DEBUG 2025-05-11 16:48:26,307 views 26444 6776 构建的消息列表长度: 2
INFO 2025-05-11 16:48:26,308 views 26444 6776 检查会话状态: 1746953279483_1249
INFO 2025-05-11 16:48:26,309 views 26444 6776 创建新会话: 1746953279483_1249
INFO 2025-05-11 16:48:26,309 views 26444 6776 当前症状收集状态: {'collecting': True, 'symptoms': {}}
DEBUG 2025-05-11 16:48:26,309 views 26444 6776 当前症状信息: {}
DEBUG 2025-05-11 16:48:26,310 views 26444 6776 开始提取症状，输入消息: 小麦赤霉病有哪些症状？
DEBUG 2025-05-11 16:48:26,310 views 26444 6776 分句结果: ['小麦赤霉病有哪些症状？', '小麦赤霉病有哪些症状？']
DEBUG 2025-05-11 16:48:26,310 views 26444 6776 提取到的发病部位: []
DEBUG 2025-05-11 16:48:26,310 views 26444 6776 提取到的气象条件: []
DEBUG 2025-05-11 16:48:26,311 views 26444 6776 提取到的生育期: []
DEBUG 2025-05-11 16:48:26,311 views 26444 6776 提取到的种植区: []
DEBUG 2025-05-11 16:48:26,311 views 26444 6776 提取到的发病部位: []
DEBUG 2025-05-11 16:48:26,311 views 26444 6776 提取到的气象条件: []
DEBUG 2025-05-11 16:48:26,311 views 26444 6776 提取到的生育期: []
DEBUG 2025-05-11 16:48:26,312 views 26444 6776 提取到的种植区: []
INFO 2025-05-11 16:48:26,312 views 26444 6776 症状提取结果: {}
INFO 2025-05-11 16:48:26,312 views 26444 6776 从消息中提取的新症状: {}
DEBUG 2025-05-11 16:48:40,769 views 26444 6776 添加历史记录成功 - 会话ID: 1746953279483_1249, 角色: user
DEBUG 2025-05-11 16:48:40,770 views 26444 6776 添加历史记录成功 - 会话ID: 1746953279483_1249, 角色: assistant
INFO 2025-05-11 16:48:40,771 basehttp 26444 6776 "GET /api/chat/stream_chat/?message=%E5%B0%8F%E9%BA%A6%E8%B5%A4%E9%9C%89%E7%97%85%E6%9C%89%E5%93%AA%E4%BA%9B%E7%97%87%E7%8A%B6%EF%BC%9F&session_id=1746953279483_1249 HTTP/1.1" 200 5795
INFO 2025-05-11 16:48:43,713 views 26444 8272 Neo4j服务初始化成功
ERROR 2025-05-11 16:48:45,782 views 26444 8272 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-11 16:48:45,782 views 26444 8272 ChatAPI实例初始化完成
INFO 2025-05-11 16:48:45,796 views 26444 8272 获取所有历史会话 - 会话数: 9
INFO 2025-05-11 16:48:45,796 basehttp 26444 8272 "GET /api/chat/get_history/ HTTP/1.1" 200 3882
INFO 2025-05-11 16:50:04,082 views 26444 26800 Neo4j服务初始化成功
ERROR 2025-05-11 16:50:06,164 views 26444 26800 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-11 16:50:06,164 views 26444 26800 ChatAPI实例初始化完成
INFO 2025-05-11 16:50:06,166 basehttp 26444 26800 "GET /api/chat/get_session_history/?session_id=1746005714225_7968 HTTP/1.1" 200 6424
INFO 2025-05-11 16:50:08,511 views 26444 10784 Neo4j服务初始化成功
ERROR 2025-05-11 16:50:10,575 views 26444 10784 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-11 16:50:10,575 views 26444 10784 ChatAPI实例初始化完成
INFO 2025-05-11 16:50:10,576 basehttp 26444 10784 "GET /api/chat/get_session_history/?session_id=1746005714225_7968 HTTP/1.1" 200 6424
INFO 2025-05-11 16:50:18,060 views 26444 10784 Neo4j服务初始化成功
ERROR 2025-05-11 16:50:20,123 views 26444 10784 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-11 16:50:20,123 views 26444 10784 ChatAPI实例初始化完成
INFO 2025-05-11 16:50:20,125 basehttp 26444 10784 "GET /api/chat/get_session_history/?session_id=1746008535556_3922 HTTP/1.1" 200 7903
INFO 2025-05-11 16:52:45,577 basehttp 26444 4756 "OPTIONS /api/users/ HTTP/1.1" 200 0
INFO 2025-05-11 16:52:45,620 basehttp 26444 4756 "GET /api/users/ HTTP/1.1" 200 226
INFO 2025-05-11 16:54:21,560 autoreload 26444 2696 D:\GraduationProject\wheatdisease\users\models.py changed, reloading.
INFO 2025-05-11 16:54:22,708 autoreload 20128 24688 Watching for file changes with StatReloader
INFO 2025-05-11 16:54:28,913 autoreload 20128 24688 D:\GraduationProject\wheatdisease\users\models.py changed, reloading.
INFO 2025-05-11 16:54:30,016 autoreload 24864 23848 Watching for file changes with StatReloader
INFO 2025-05-11 16:56:50,437 autoreload 24864 23848 D:\GraduationProject\wheatdisease\users\models.py changed, reloading.
INFO 2025-05-11 16:56:51,345 autoreload 22820 17656 Watching for file changes with StatReloader
INFO 2025-05-11 17:08:57,290 basehttp 22820 14636 "OPTIONS /api/users/login/ HTTP/1.1" 200 0
INFO 2025-05-11 17:08:57,989 basehttp 22820 14636 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-11 17:08:57,995 basehttp 22820 14636 "OPTIONS /api/knowledge/init/ HTTP/1.1" 200 0
INFO 2025-05-11 17:09:02,193 basehttp 22820 14636 "POST /api/knowledge/init/ HTTP/1.1" 200 132058
INFO 2025-05-11 17:09:06,387 basehttp 22820 16212 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
INFO 2025-05-11 17:09:06,396 basehttp 22820 14636 "OPTIONS /api/knowledge/graph/ HTTP/1.1" 200 0
INFO 2025-05-11 17:09:10,521 basehttp 22820 14636 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
INFO 2025-05-11 17:09:11,862 basehttp 22820 14636 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-11 17:09:16,001 basehttp 22820 14636 "POST /api/knowledge/init/ HTTP/1.1" 200 132058
INFO 2025-05-11 17:09:20,159 basehttp 22820 16212 - Broken pipe from ('127.0.0.1', 50755)
INFO 2025-05-11 17:09:34,373 views 22820 10152 Neo4j服务初始化成功
INFO 2025-05-11 17:09:34,731 basehttp 22820 14636 "POST /api/users/login/ HTTP/1.1" 200 526
ERROR 2025-05-11 17:09:36,420 views 22820 10152 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-11 17:09:36,420 views 22820 10152 ChatAPI实例初始化完成
INFO 2025-05-11 17:09:36,422 views 22820 10152 创建新会话成功 - 会话ID: 1746954576421_6500
INFO 2025-05-11 17:09:36,423 basehttp 22820 10152 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-05-11 17:09:38,760 views 22820 10152 Neo4j服务初始化成功
INFO 2025-05-11 17:09:38,898 basehttp 22820 14636 "POST /api/knowledge/init/ HTTP/1.1" 200 132058
ERROR 2025-05-11 17:09:40,808 views 22820 10152 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-11 17:09:40,808 views 22820 10152 ChatAPI实例初始化完成
INFO 2025-05-11 17:09:40,822 views 22820 10152 获取所有历史会话 - 会话数: 9
INFO 2025-05-11 17:09:40,823 basehttp 22820 10152 "GET /api/chat/get_history/ HTTP/1.1" 200 3883
INFO 2025-05-11 17:09:43,054 basehttp 22820 16380 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
INFO 2025-05-11 17:09:43,154 views 22820 10152 Neo4j服务初始化成功
ERROR 2025-05-11 17:09:45,204 views 22820 10152 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-11 17:09:45,205 views 22820 10152 ChatAPI实例初始化完成
INFO 2025-05-11 17:09:45,219 views 22820 10152 获取所有历史会话 - 会话数: 9
INFO 2025-05-11 17:09:45,220 basehttp 22820 10152 "GET /api/chat/get_history/ HTTP/1.1" 200 3883
INFO 2025-05-11 17:09:47,193 basehttp 22820 14636 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
INFO 2025-05-11 17:09:55,297 basehttp 22820 14636 "OPTIONS /api/knowledge/get_disease_subgraph/?disease=%E5%B0%8F%E9%BA%A6%E7%81%B0%E9%9C%89%E7%97%85 HTTP/1.1" 200 0
INFO 2025-05-11 17:09:59,473 basehttp 22820 14636 "GET /api/knowledge/get_disease_subgraph/?disease=%E5%B0%8F%E9%BA%A6%E7%81%B0%E9%9C%89%E7%97%85 HTTP/1.1" 200 2833
INFO 2025-05-11 17:11:31,730 basehttp 22820 14636 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-11 17:11:35,891 basehttp 22820 14636 "POST /api/knowledge/init/ HTTP/1.1" 200 132058
INFO 2025-05-11 17:11:40,015 basehttp 22820 10152 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
INFO 2025-05-11 17:11:44,180 basehttp 22820 14636 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
INFO 2025-05-11 17:11:46,351 views 22820 10152 Neo4j服务初始化成功
INFO 2025-05-11 17:11:48,008 views 22820 16380 Neo4j服务初始化成功
ERROR 2025-05-11 17:11:48,400 views 22820 10152 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-11 17:11:48,400 views 22820 10152 ChatAPI实例初始化完成
INFO 2025-05-11 17:11:48,401 views 22820 10152 创建新会话成功 - 会话ID: 1746954708401_2976
INFO 2025-05-11 17:11:48,402 basehttp 22820 10152 "POST /api/chat/create_session/ HTTP/1.1" 200 57
ERROR 2025-05-11 17:11:50,046 views 22820 16380 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-11 17:11:50,046 views 22820 16380 ChatAPI实例初始化完成
INFO 2025-05-11 17:11:50,047 views 22820 16380 创建新会话成功 - 会话ID: 1746954710047_5133
INFO 2025-05-11 17:11:50,048 basehttp 22820 16380 "POST /api/chat/create_session/ HTTP/1.1" 200 57
INFO 2025-05-11 17:11:50,714 views 22820 10152 Neo4j服务初始化成功
ERROR 2025-05-11 17:11:52,762 views 22820 10152 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-11 17:11:52,762 views 22820 10152 ChatAPI实例初始化完成
INFO 2025-05-11 17:11:52,775 views 22820 10152 获取所有历史会话 - 会话数: 9
INFO 2025-05-11 17:11:52,776 basehttp 22820 10152 "GET /api/chat/get_history/ HTTP/1.1" 200 3883
INFO 2025-05-11 17:11:55,117 views 22820 16380 Neo4j服务初始化成功
ERROR 2025-05-11 17:11:57,164 views 22820 16380 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-11 17:11:57,164 views 22820 16380 ChatAPI实例初始化完成
INFO 2025-05-11 17:11:57,179 views 22820 16380 获取所有历史会话 - 会话数: 9
INFO 2025-05-11 17:11:57,180 basehttp 22820 16380 "GET /api/chat/get_history/ HTTP/1.1" 200 3883
INFO 2025-05-11 17:11:59,522 views 22820 10152 Neo4j服务初始化成功
ERROR 2025-05-11 17:12:01,578 views 22820 10152 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-11 17:12:01,579 views 22820 10152 ChatAPI实例初始化完成
INFO 2025-05-11 17:12:01,591 views 22820 10152 获取所有历史会话 - 会话数: 9
INFO 2025-05-11 17:12:01,592 basehttp 22820 10152 "GET /api/chat/get_history/ HTTP/1.1" 200 3883
INFO 2025-05-11 17:12:03,933 views 22820 16380 Neo4j服务初始化成功
ERROR 2025-05-11 17:12:05,982 views 22820 16380 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-11 17:12:05,982 views 22820 16380 ChatAPI实例初始化完成
INFO 2025-05-11 17:12:05,995 views 22820 16380 获取所有历史会话 - 会话数: 9
INFO 2025-05-11 17:12:05,996 basehttp 22820 16380 "GET /api/chat/get_history/ HTTP/1.1" 200 3883
INFO 2025-05-11 17:12:30,470 autoreload 23004 26920 Watching for file changes with StatReloader
INFO 2025-05-11 17:12:54,636 basehttp 23004 26100 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-11 17:12:58,821 basehttp 23004 26100 "POST /api/knowledge/init/ HTTP/1.1" 200 132058
INFO 2025-05-11 17:13:03,003 basehttp 23004 11360 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
INFO 2025-05-11 17:13:07,168 basehttp 23004 26100 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
INFO 2025-05-11 17:13:31,521 basehttp 23004 26100 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-11 17:13:35,707 basehttp 23004 26100 "POST /api/knowledge/init/ HTTP/1.1" 200 132058
INFO 2025-05-11 17:13:39,840 basehttp 23004 11360 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
INFO 2025-05-11 17:13:41,738 basehttp 23004 13256 "OPTIONS /api/users/register/ HTTP/1.1" 200 0
WARNING 2025-05-11 17:13:41,747 log 23004 13256 Bad Request: /api/users/register/
WARNING 2025-05-11 17:13:41,747 basehttp 23004 13256 "POST /api/users/register/ HTTP/1.1" 400 53
WARNING 2025-05-11 17:13:43,222 log 23004 13256 Bad Request: /api/users/register/
WARNING 2025-05-11 17:13:43,222 basehttp 23004 13256 "POST /api/users/register/ HTTP/1.1" 400 53
INFO 2025-05-11 17:13:43,976 basehttp 23004 26100 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
INFO 2025-05-15 19:48:16,984 autoreload 35528 38392 Watching for file changes with StatReloader
INFO 2025-05-15 19:50:29,350 autoreload 35528 38392 D:\GraduationProject\wheatdisease\backend\settings.py changed, reloading.
INFO 2025-05-15 19:50:30,231 autoreload 37300 32424 Watching for file changes with StatReloader
INFO 2025-05-15 19:50:50,804 autoreload 37300 32424 D:\GraduationProject\wheatdisease\backend\settings.py changed, reloading.
INFO 2025-05-15 19:50:51,665 autoreload 23928 15164 Watching for file changes with StatReloader
INFO 2025-05-15 19:51:54,721 autoreload 23928 15164 D:\GraduationProject\wheatdisease\backend\settings.py changed, reloading.
INFO 2025-05-15 19:51:55,594 autoreload 38056 25264 Watching for file changes with StatReloader
INFO 2025-05-15 19:52:04,853 basehttp 38056 38168 "OPTIONS /api/users/login/ HTTP/1.1" 200 0
WARNING 2025-05-15 19:52:04,881 log 38056 38168 Unauthorized: /api/users/login/
WARNING 2025-05-15 19:52:04,882 basehttp 38056 38168 "POST /api/users/login/ HTTP/1.1" 401 171
INFO 2025-05-15 19:53:37,656 basehttp 38056 38168 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-15 19:53:37,661 basehttp 38056 38168 "OPTIONS /api/knowledge/init/ HTTP/1.1" 200 0
INFO 2025-05-15 19:53:42,763 basehttp 38056 38168 - Broken pipe from ('127.0.0.1', 61918)
INFO 2025-05-15 19:54:35,322 basehttp 38056 23884 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-15 19:54:39,456 basehttp 38056 23884 "POST /api/knowledge/init/ HTTP/1.1" 200 132058
INFO 2025-05-15 19:54:43,656 basehttp 38056 38832 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
INFO 2025-05-15 19:54:43,665 basehttp 38056 23884 "OPTIONS /api/knowledge/graph/ HTTP/1.1" 200 0
INFO 2025-05-15 19:54:47,814 basehttp 38056 23884 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
INFO 2025-05-15 19:54:52,126 views 38056 38832 Neo4j服务初始化成功
ERROR 2025-05-15 19:54:54,184 views 38056 38832 Redis连接失败: 'Settings' object has no attribute 'REDIS_HOST'
DEBUG 2025-05-15 19:54:54,186 views 38056 38832 ChatAPI实例初始化完成
WARNING 2025-05-15 19:54:54,187 log 38056 38832 Unauthorized: /api/chat/create_session/
INFO 2025-05-15 19:54:54,188 basehttp 38056 38832 - Broken pipe from ('127.0.0.1', 62088)
INFO 2025-05-15 19:55:33,356 autoreload 38056 25264 D:\GraduationProject\wheatdisease\backend\settings.py changed, reloading.
INFO 2025-05-15 19:55:34,210 autoreload 38472 37208 Watching for file changes with StatReloader
INFO 2025-05-15 20:14:29,628 autoreload 38472 37208 D:\GraduationProject\wheatdisease\backend\settings.py changed, reloading.
INFO 2025-05-15 20:14:31,504 autoreload 36692 32424 Watching for file changes with StatReloader
INFO 2025-05-15 20:17:26,381 autoreload 36692 32424 D:\GraduationProject\wheatdisease\backend\urls.py changed, reloading.
INFO 2025-05-15 20:17:27,201 autoreload 38424 18340 Watching for file changes with StatReloader
INFO 2025-05-15 20:17:32,602 autoreload 38424 18340 D:\GraduationProject\wheatdisease\users\urls.py changed, reloading.
INFO 2025-05-15 20:17:33,461 autoreload 36432 38252 Watching for file changes with StatReloader
INFO 2025-05-15 20:18:31,660 basehttp 36432 20980 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
INFO 2025-05-15 20:18:36,170 basehttp 36432 32220 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
INFO 2025-05-15 20:18:39,197 basehttp 36432 32220 "OPTIONS /api/knowledge/get_disease_subgraph/?disease=%E5%B0%8F%E9%BA%A6%E7%81%B0%E9%9C%89%E7%97%85 HTTP/1.1" 200 0
INFO 2025-05-15 20:18:43,556 basehttp 36432 32220 "GET /api/knowledge/get_disease_subgraph/?disease=%E5%B0%8F%E9%BA%A6%E7%81%B0%E9%9C%89%E7%97%85 HTTP/1.1" 200 2833
INFO 2025-05-15 20:19:09,849 views 36432 20980 Neo4j服务初始化成功
INFO 2025-05-15 20:19:13,942 views 36432 20980 Redis连接成功
DEBUG 2025-05-15 20:19:13,944 views 36432 20980 ChatAPI实例初始化完成
WARNING 2025-05-15 20:19:13,945 log 36432 20980 Unauthorized: /api/chat/create_session/
WARNING 2025-05-15 20:19:13,945 basehttp 36432 20980 "POST /api/chat/create_session/ HTTP/1.1" 401 6
INFO 2025-05-15 20:19:16,275 views 36432 20980 Neo4j服务初始化成功
INFO 2025-05-15 20:19:20,364 views 36432 20980 Redis连接成功
DEBUG 2025-05-15 20:19:20,364 views 36432 20980 ChatAPI实例初始化完成
WARNING 2025-05-15 20:19:20,365 log 36432 20980 Unauthorized: /api/chat/get_history/
WARNING 2025-05-15 20:19:20,365 basehttp 36432 20980 "GET /api/chat/get_history/ HTTP/1.1" 401 6
INFO 2025-05-15 20:19:57,434 autoreload 36432 38252 D:\GraduationProject\wheatdisease\backend\settings.py changed, reloading.
INFO 2025-05-15 20:19:58,275 autoreload 26848 36744 Watching for file changes with StatReloader
INFO 2025-05-15 20:20:14,565 autoreload 26848 36744 D:\GraduationProject\wheatdisease\users\views.py changed, reloading.
INFO 2025-05-15 20:20:15,421 autoreload 31672 30524 Watching for file changes with StatReloader
INFO 2025-05-15 20:20:24,048 autoreload 31672 30524 D:\GraduationProject\wheatdisease\users\urls.py changed, reloading.
INFO 2025-05-15 20:20:24,902 autoreload 37660 27020 Watching for file changes with StatReloader
INFO 2025-05-15 20:24:42,783 views 37660 39220 Neo4j服务初始化成功
INFO 2025-05-15 20:24:46,869 views 37660 39220 Redis连接成功
DEBUG 2025-05-15 20:24:46,870 views 37660 39220 ChatAPI实例初始化完成
WARNING 2025-05-15 20:24:46,871 log 37660 39220 Unauthorized: /api/chat/create_session/
INFO 2025-05-15 20:24:46,875 basehttp 37660 39220 - Broken pipe from ('127.0.0.1', 63990)
INFO 2025-05-15 20:31:22,919 basehttp 37660 39452 "OPTIONS /api/users/verify-token/ HTTP/1.1" 200 0
WARNING 2025-05-15 20:31:22,972 log 37660 39452 Not Found: /api/users/verify-token/
WARNING 2025-05-15 20:31:22,973 basehttp 37660 39452 "GET /api/users/verify-token/ HTTP/1.1" 404 25
INFO 2025-05-15 20:31:29,111 autoreload 37660 27020 D:\GraduationProject\wheatdisease\users\views.py changed, reloading.
INFO 2025-05-15 20:31:29,965 autoreload 436 38604 Watching for file changes with StatReloader
INFO 2025-05-15 20:33:44,247 basehttp 436 33980 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-15 20:33:48,386 basehttp 436 33980 "POST /api/knowledge/init/ HTTP/1.1" 200 132058
WARNING 2025-05-15 20:33:48,407 log 436 33980 Not Found: /api/users/verify-token/
WARNING 2025-05-15 20:33:48,407 basehttp 436 33980 "GET /api/users/verify-token/ HTTP/1.1" 404 25
INFO 2025-05-15 20:34:26,252 basehttp 436 33980 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-15 20:34:30,385 basehttp 436 33980 "POST /api/knowledge/init/ HTTP/1.1" 200 132058
WARNING 2025-05-15 20:34:30,398 log 436 33980 Not Found: /api/users/verify-token/
WARNING 2025-05-15 20:34:30,399 basehttp 436 33980 "GET /api/users/verify-token/ HTTP/1.1" 404 25
INFO 2025-05-15 20:34:51,033 autoreload 436 38604 D:\GraduationProject\wheatdisease\users\urls.py changed, reloading.
INFO 2025-05-15 20:34:51,926 autoreload 39184 33220 Watching for file changes with StatReloader
INFO 2025-05-15 20:35:53,587 autoreload 39184 33220 D:\GraduationProject\wheatdisease\users\urls.py changed, reloading.
INFO 2025-05-15 20:35:54,551 autoreload 36528 37756 Watching for file changes with StatReloader
INFO 2025-05-15 20:36:13,797 basehttp 36528 39612 "OPTIONS /api/users/login/ HTTP/1.1" 200 0
INFO 2025-05-15 20:36:14,582 basehttp 36528 39612 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-15 20:36:14,590 basehttp 36528 39612 "OPTIONS /api/knowledge/init/ HTTP/1.1" 200 0
INFO 2025-05-15 20:36:18,711 basehttp 36528 39612 "POST /api/knowledge/init/ HTTP/1.1" 200 132058
INFO 2025-05-15 20:36:35,110 views 36528 33036 Neo4j服务初始化成功
WARNING 2025-05-15 20:36:37,576 log 36528 38332 Unauthorized: /api/knowledge/graph/
WARNING 2025-05-15 20:36:37,577 basehttp 36528 38332 "GET /api/knowledge/graph/ HTTP/1.1" 401 43
INFO 2025-05-15 20:36:39,232 views 36528 33036 Redis连接成功
DEBUG 2025-05-15 20:36:39,232 views 36528 33036 ChatAPI实例初始化完成
WARNING 2025-05-15 20:36:39,233 log 36528 33036 Unauthorized: /api/chat/create_session/
WARNING 2025-05-15 20:36:39,234 basehttp 36528 33036 "POST /api/chat/create_session/ HTTP/1.1" 401 6
INFO 2025-05-15 20:36:41,588 views 36528 33036 Neo4j服务初始化成功
INFO 2025-05-15 20:36:45,225 views 36528 38332 Neo4j服务初始化成功
INFO 2025-05-15 20:36:45,704 views 36528 33036 Redis连接成功
DEBUG 2025-05-15 20:36:45,705 views 36528 33036 ChatAPI实例初始化完成
WARNING 2025-05-15 20:36:45,708 log 36528 33036 Unauthorized: /api/chat/get_history/
WARNING 2025-05-15 20:36:45,710 basehttp 36528 33036 "GET /api/chat/get_history/ HTTP/1.1" 401 6
INFO 2025-05-15 20:36:49,317 views 36528 38332 Redis连接成功
DEBUG 2025-05-15 20:36:49,318 views 36528 38332 ChatAPI实例初始化完成
WARNING 2025-05-15 20:36:49,319 log 36528 38332 Unauthorized: /api/chat/create_session/
WARNING 2025-05-15 20:36:49,319 basehttp 36528 38332 "POST /api/chat/create_session/ HTTP/1.1" 401 6
INFO 2025-05-15 20:36:51,670 views 36528 38332 Neo4j服务初始化成功
INFO 2025-05-15 20:36:55,755 views 36528 38332 Redis连接成功
DEBUG 2025-05-15 20:36:55,756 views 36528 38332 ChatAPI实例初始化完成
WARNING 2025-05-15 20:36:55,756 log 36528 38332 Unauthorized: /api/chat/get_history/
WARNING 2025-05-15 20:36:55,757 basehttp 36528 38332 "GET /api/chat/get_history/ HTTP/1.1" 401 6
INFO 2025-05-15 20:38:55,821 basehttp 36528 39612 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-15 20:38:59,961 basehttp 36528 39612 "POST /api/knowledge/init/ HTTP/1.1" 200 132058
INFO 2025-05-15 20:43:23,000 basehttp 36528 39612 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-15 20:43:27,163 basehttp 36528 39612 "POST /api/knowledge/init/ HTTP/1.1" 200 132058
WARNING 2025-05-15 20:43:51,375 log 36528 26820 Unauthorized: /api/knowledge/graph/
WARNING 2025-05-15 20:43:51,376 basehttp 36528 26820 "GET /api/knowledge/graph/ HTTP/1.1" 401 43
WARNING 2025-05-15 20:45:31,971 log 36528 26820 Unauthorized: /api/knowledge/graph/
WARNING 2025-05-15 20:45:31,972 basehttp 36528 26820 "GET /api/knowledge/graph/ HTTP/1.1" 401 43
WARNING 2025-05-15 20:45:36,102 log 36528 26820 Unauthorized: /api/knowledge/graph/
WARNING 2025-05-15 20:45:36,102 basehttp 36528 26820 "GET /api/knowledge/graph/ HTTP/1.1" 401 43
INFO 2025-05-15 20:47:31,645 basehttp 36528 39612 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-15 20:47:35,807 basehttp 36528 39612 "POST /api/knowledge/init/ HTTP/1.1" 200 132058
INFO 2025-05-15 20:47:39,108 basehttp 36528 39612 "OPTIONS /api/users/ HTTP/1.1" 200 0
INFO 2025-05-15 20:47:39,131 basehttp 36528 39612 "GET /api/users/ HTTP/1.1" 200 226
INFO 2025-05-15 20:47:39,865 views 36528 26820 Neo4j服务初始化成功
WARNING 2025-05-15 20:47:42,462 log 36528 32188 Unauthorized: /api/knowledge/graph/
WARNING 2025-05-15 20:47:42,463 basehttp 36528 32188 "GET /api/knowledge/graph/ HTTP/1.1" 401 43
INFO 2025-05-15 20:47:43,956 views 36528 26820 Redis连接成功
DEBUG 2025-05-15 20:47:43,957 views 36528 26820 ChatAPI实例初始化完成
WARNING 2025-05-15 20:47:43,957 log 36528 26820 Unauthorized: /api/chat/create_session/
WARNING 2025-05-15 20:47:43,958 basehttp 36528 26820 "POST /api/chat/create_session/ HTTP/1.1" 401 6
INFO 2025-05-15 20:47:46,018 basehttp 36528 39612 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-15 20:47:46,289 views 36528 26820 Neo4j服务初始化成功
INFO 2025-05-15 20:47:50,182 basehttp 36528 39612 - Broken pipe from ('127.0.0.1', 65006)
INFO 2025-05-15 20:47:50,369 views 36528 26820 Redis连接成功
DEBUG 2025-05-15 20:47:50,369 views 36528 26820 ChatAPI实例初始化完成
WARNING 2025-05-15 20:47:50,370 log 36528 26820 Unauthorized: /api/chat/get_history/
INFO 2025-05-15 20:47:50,370 basehttp 36528 26820 - Broken pipe from ('127.0.0.1', 49278)
WARNING 2025-05-15 20:48:45,954 log 36528 32188 Unauthorized: /api/knowledge/graph/
WARNING 2025-05-15 20:48:45,954 basehttp 36528 32188 "GET /api/knowledge/graph/ HTTP/1.1" 401 43
WARNING 2025-05-15 20:48:50,071 log 36528 32188 Unauthorized: /api/knowledge/graph/
WARNING 2025-05-15 20:48:50,071 basehttp 36528 32188 "GET /api/knowledge/graph/ HTTP/1.1" 401 43
INFO 2025-05-15 20:49:03,606 basehttp 36528 25732 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-15 20:49:07,749 basehttp 36528 25732 "POST /api/knowledge/init/ HTTP/1.1" 200 132058
INFO 2025-05-15 20:49:13,974 basehttp 36528 25732 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-15 20:49:18,136 basehttp 36528 25732 "POST /api/knowledge/init/ HTTP/1.1" 200 132058
INFO 2025-05-15 20:49:21,877 basehttp 36528 25732 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-15 20:49:26,028 basehttp 36528 25732 "POST /api/knowledge/init/ HTTP/1.1" 200 132058
INFO 2025-05-15 20:59:53,982 autoreload 29100 36892 Watching for file changes with StatReloader
INFO 2025-05-15 21:09:04,449 basehttp 29100 34836 "OPTIONS /api/users/login/ HTTP/1.1" 200 0
INFO 2025-05-15 21:09:05,208 basehttp 29100 34836 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-15 21:09:05,216 basehttp 29100 34836 "OPTIONS /api/knowledge/init/ HTTP/1.1" 200 0
INFO 2025-05-15 21:09:09,387 basehttp 29100 34836 "POST /api/knowledge/init/ HTTP/1.1" 200 132058
INFO 2025-05-15 21:09:16,129 views 29100 32444 Neo4j服务初始化成功
INFO 2025-05-15 21:09:20,221 views 29100 32444 Redis连接成功
DEBUG 2025-05-15 21:09:20,221 views 29100 32444 ChatAPI实例初始化完成
WARNING 2025-05-15 21:09:20,222 log 29100 32444 Unauthorized: /api/chat/create_session/
WARNING 2025-05-15 21:09:20,222 basehttp 29100 32444 "POST /api/chat/create_session/ HTTP/1.1" 401 6
INFO 2025-05-15 21:09:22,552 views 29100 32444 Neo4j服务初始化成功
INFO 2025-05-15 21:09:26,625 views 29100 32444 Redis连接成功
DEBUG 2025-05-15 21:09:26,626 views 29100 32444 ChatAPI实例初始化完成
WARNING 2025-05-15 21:09:26,626 log 29100 32444 Unauthorized: /api/chat/get_history/
WARNING 2025-05-15 21:09:26,627 basehttp 29100 32444 "GET /api/chat/get_history/ HTTP/1.1" 401 6
WARNING 2025-05-15 21:09:40,229 log 29100 32444 Unauthorized: /api/knowledge/graph/
WARNING 2025-05-15 21:09:40,230 basehttp 29100 32444 "GET /api/knowledge/graph/ HTTP/1.1" 401 43
INFO 2025-05-15 21:09:43,164 basehttp 29100 34836 "OPTIONS /api/users/ HTTP/1.1" 200 0
INFO 2025-05-15 21:09:43,181 basehttp 29100 34836 "GET /api/users/ HTTP/1.1" 200 226
INFO 2025-05-15 21:09:57,277 basehttp 29100 34836 "OPTIONS /api/users/2/disable_account/ HTTP/1.1" 200 0
INFO 2025-05-15 21:09:57,293 basehttp 29100 34836 "POST /api/users/2/disable_account/ HTTP/1.1" 200 29
INFO 2025-05-15 21:09:57,308 basehttp 29100 34836 "GET /api/users/ HTTP/1.1" 200 227
INFO 2025-05-15 21:09:58,391 basehttp 29100 34836 "OPTIONS /api/users/2/enable_account/ HTTP/1.1" 200 0
INFO 2025-05-15 21:09:58,402 basehttp 29100 34836 "POST /api/users/2/enable_account/ HTTP/1.1" 200 29
INFO 2025-05-15 21:09:58,416 basehttp 29100 34836 "GET /api/users/ HTTP/1.1" 200 226
INFO 2025-05-15 21:10:04,188 views 29100 35576 Neo4j服务初始化成功
WARNING 2025-05-15 21:10:04,889 log 29100 32444 Unauthorized: /api/knowledge/graph/
WARNING 2025-05-15 21:10:04,889 basehttp 29100 32444 "GET /api/knowledge/graph/ HTTP/1.1" 401 43
INFO 2025-05-15 21:10:08,300 views 29100 35576 Redis连接成功
DEBUG 2025-05-15 21:10:08,300 views 29100 35576 ChatAPI实例初始化完成
WARNING 2025-05-15 21:10:08,301 log 29100 35576 Unauthorized: /api/chat/create_session/
WARNING 2025-05-15 21:10:08,302 basehttp 29100 35576 "POST /api/chat/create_session/ HTTP/1.1" 401 6
WARNING 2025-05-15 21:10:09,483 log 29100 32444 Unauthorized: /api/knowledge/graph/
WARNING 2025-05-15 21:10:09,483 basehttp 29100 32444 "GET /api/knowledge/graph/ HTTP/1.1" 401 43
INFO 2025-05-15 21:10:12,684 views 29100 35576 Neo4j服务初始化成功
INFO 2025-05-15 21:10:18,821 views 29100 35576 Redis连接成功
DEBUG 2025-05-15 21:10:18,822 views 29100 35576 ChatAPI实例初始化完成
WARNING 2025-05-15 21:10:18,823 log 29100 35576 Unauthorized: /api/chat/get_history/
WARNING 2025-05-15 21:10:18,823 basehttp 29100 35576 "GET /api/chat/get_history/ HTTP/1.1" 401 6
INFO 2025-05-15 21:11:31,376 basehttp 29100 34836 "OPTIONS /api/users/register/ HTTP/1.1" 200 0
INFO 2025-05-15 21:11:32,071 basehttp 29100 34836 "POST /api/users/register/ HTTP/1.1" 201 44
WARNING 2025-05-15 21:11:36,067 log 29100 34836 Unauthorized: /api/users/login/
WARNING 2025-05-15 21:11:36,067 basehttp 29100 34836 "POST /api/users/login/ HTTP/1.1" 401 24
INFO 2025-05-15 21:11:42,681 basehttp 29100 34836 "POST /api/users/login/ HTTP/1.1" 200 525
ERROR 2025-05-15 21:11:50,881 log 29100 34836 Internal Server Error: /api/knowledge/init/
INFO 2025-05-15 21:11:50,881 basehttp 29100 34836 - Broken pipe from ('127.0.0.1', 51319)
INFO 2025-05-15 21:11:51,340 basehttp 29100 35540 "POST /api/users/login/ HTTP/1.1" 200 525
ERROR 2025-05-15 21:11:59,519 log 29100 35540 Internal Server Error: /api/knowledge/init/
INFO 2025-05-15 21:11:59,519 basehttp 29100 35540 - Broken pipe from ('127.0.0.1', 51680)
INFO 2025-05-15 21:12:02,262 basehttp 29100 34436 "POST /api/users/login/ HTTP/1.1" 200 526
ERROR 2025-05-15 21:12:10,456 log 29100 34436 Internal Server Error: /api/knowledge/init/
INFO 2025-05-15 21:12:10,457 basehttp 29100 34436 - Broken pipe from ('127.0.0.1', 51683)
INFO 2025-05-15 21:12:13,682 basehttp 29100 11192 "GET /api/users/ HTTP/1.1" 200 338
INFO 2025-05-15 21:12:17,072 views 29100 32444 Neo4j服务初始化成功
WARNING 2025-05-15 21:12:20,063 log 29100 35576 Unauthorized: /api/knowledge/graph/
WARNING 2025-05-15 21:12:20,064 basehttp 29100 35576 "GET /api/knowledge/graph/ HTTP/1.1" 401 43
INFO 2025-05-15 21:12:23,218 views 29100 32444 Redis连接成功
DEBUG 2025-05-15 21:12:23,218 views 29100 32444 ChatAPI实例初始化完成
WARNING 2025-05-15 21:12:23,219 log 29100 32444 Unauthorized: /api/chat/create_session/
WARNING 2025-05-15 21:12:23,219 basehttp 29100 32444 "POST /api/chat/create_session/ HTTP/1.1" 401 6
INFO 2025-05-15 21:12:27,667 views 29100 32444 Neo4j服务初始化成功
INFO 2025-05-15 21:12:28,773 views 29100 36548 Neo4j服务初始化成功
WARNING 2025-05-15 21:12:32,025 log 29100 35576 Unauthorized: /api/knowledge/graph/
WARNING 2025-05-15 21:12:32,026 basehttp 29100 35576 "GET /api/knowledge/graph/ HTTP/1.1" 401 43
INFO 2025-05-15 21:12:33,809 views 29100 32444 Redis连接成功
DEBUG 2025-05-15 21:12:33,809 views 29100 32444 ChatAPI实例初始化完成
WARNING 2025-05-15 21:12:33,810 log 29100 32444 Unauthorized: /api/chat/get_history/
WARNING 2025-05-15 21:12:33,810 basehttp 29100 32444 "GET /api/chat/get_history/ HTTP/1.1" 401 6
INFO 2025-05-15 21:12:34,925 views 29100 36548 Redis连接成功
DEBUG 2025-05-15 21:12:34,926 views 29100 36548 ChatAPI实例初始化完成
WARNING 2025-05-15 21:12:34,926 log 29100 36548 Unauthorized: /api/chat/create_session/
WARNING 2025-05-15 21:12:34,927 basehttp 29100 36548 "POST /api/chat/create_session/ HTTP/1.1" 401 6
INFO 2025-05-15 21:12:39,304 views 29100 36548 Neo4j服务初始化成功
INFO 2025-05-15 21:12:43,404 basehttp 29100 11192 "POST /api/users/login/ HTTP/1.1" 200 525
INFO 2025-05-15 21:12:45,410 views 29100 36548 Redis连接成功
DEBUG 2025-05-15 21:12:45,410 views 29100 36548 ChatAPI实例初始化完成
WARNING 2025-05-15 21:12:45,411 log 29100 36548 Unauthorized: /api/chat/get_history/
WARNING 2025-05-15 21:12:45,412 basehttp 29100 36548 "GET /api/chat/get_history/ HTTP/1.1" 401 6
ERROR 2025-05-15 21:12:51,618 log 29100 11192 Internal Server Error: /api/knowledge/init/
INFO 2025-05-15 21:12:51,619 basehttp 29100 11192 - Broken pipe from ('127.0.0.1', 51718)
INFO 2025-05-16 19:11:37,709 autoreload 41052 46156 Watching for file changes with StatReloader
INFO 2025-05-16 19:13:00,874 basehttp 41052 44900 "OPTIONS /api/users/login/ HTTP/1.1" 200 0
INFO 2025-05-16 19:13:01,571 basehttp 41052 44900 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-16 19:13:01,580 basehttp 41052 44900 "OPTIONS /api/knowledge/init/ HTTP/1.1" 200 0
INFO 2025-05-16 19:13:06,689 basehttp 41052 44900 - Broken pipe from ('127.0.0.1', 60001)
INFO 2025-05-16 19:13:13,341 basehttp 41052 35396 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-16 19:13:17,496 basehttp 41052 35396 "POST /api/knowledge/init/ HTTP/1.1" 200 132058
WARNING 2025-05-16 19:13:24,036 log 41052 41412 Unauthorized: /api/knowledge/graph/
WARNING 2025-05-16 19:13:24,036 basehttp 41052 41412 "GET /api/knowledge/graph/ HTTP/1.1" 401 43
WARNING 2025-05-16 19:14:11,692 log 41052 41412 Unauthorized: /api/knowledge/graph/
WARNING 2025-05-16 19:14:11,693 basehttp 41052 41412 "GET /api/knowledge/graph/ HTTP/1.1" 401 43
INFO 2025-05-16 19:14:44,384 basehttp 41052 35396 "OPTIONS /api/knowledge/graph/ HTTP/1.1" 200 0
INFO 2025-05-16 19:14:48,545 basehttp 41052 35396 "GET /api/knowledge/graph/ HTTP/1.1" 200 132058
INFO 2025-05-16 19:14:52,709 basehttp 41052 35396 - Broken pipe from ('127.0.0.1', 60003)
INFO 2025-05-16 19:14:53,574 basehttp 41052 44384 - Broken pipe from ('127.0.0.1', 60311)
INFO 2025-05-16 19:14:53,917 basehttp 41052 46340 - Broken pipe from ('127.0.0.1', 60316)
INFO 2025-05-16 19:16:28,294 autoreload 41052 46156 D:\GraduationProject\wheatdisease\backend\settings.py changed, reloading.
INFO 2025-05-16 19:16:34,962 autoreload 42252 37632 Watching for file changes with StatReloader
ERROR 2025-05-16 19:16:56,719 log 42252 10996 Internal Server Error: /api/knowledge/graph/
Traceback (most recent call last):
  File "D:\Python\Python312\Lib\site-packages\django\core\handlers\exception.py", line 55, in inner
    response = get_response(request)
               ^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\django\core\handlers\base.py", line 197, in _get_response
    response = wrapped_callback(request, *callback_args, **callback_kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\django\views\decorators\csrf.py", line 65, in _view_wrapper
    return view_func(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\rest_framework\viewsets.py", line 124, in view
    return self.dispatch(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 509, in dispatch
    response = self.handle_exception(exc)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 469, in handle_exception
    self.raise_uncaught_exception(exc)
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 480, in raise_uncaught_exception
    raise exc
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 497, in dispatch
    self.initial(request, *args, **kwargs)
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 415, in initial
    self.check_permissions(request)
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 331, in check_permissions
    for permission in self.get_permissions():
                      ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 278, in get_permissions
    return [permission() for permission in self.permission_classes]
            ^^^^^^^^^^^^
TypeError: 'str' object is not callable
ERROR 2025-05-16 19:16:56,725 basehttp 42252 10996 "GET /api/knowledge/graph/ HTTP/1.1" 500 107028
ERROR 2025-05-16 19:17:00,836 log 42252 45376 Internal Server Error: /api/knowledge/graph/
Traceback (most recent call last):
  File "D:\Python\Python312\Lib\site-packages\django\core\handlers\exception.py", line 55, in inner
    response = get_response(request)
               ^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\django\core\handlers\base.py", line 197, in _get_response
    response = wrapped_callback(request, *callback_args, **callback_kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\django\views\decorators\csrf.py", line 65, in _view_wrapper
    return view_func(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\rest_framework\viewsets.py", line 124, in view
    return self.dispatch(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 509, in dispatch
    response = self.handle_exception(exc)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 469, in handle_exception
    self.raise_uncaught_exception(exc)
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 480, in raise_uncaught_exception
    raise exc
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 497, in dispatch
    self.initial(request, *args, **kwargs)
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 415, in initial
    self.check_permissions(request)
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 331, in check_permissions
    for permission in self.get_permissions():
                      ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 278, in get_permissions
    return [permission() for permission in self.permission_classes]
            ^^^^^^^^^^^^
TypeError: 'str' object is not callable
ERROR 2025-05-16 19:17:00,841 basehttp 42252 45376 "GET /api/knowledge/graph/ HTTP/1.1" 500 107028
INFO 2025-05-16 19:17:48,389 autoreload 31712 44188 Watching for file changes with StatReloader
ERROR 2025-05-16 19:18:08,431 log 31712 35712 Internal Server Error: /api/knowledge/graph/
Traceback (most recent call last):
  File "D:\Python\Python312\Lib\site-packages\django\core\handlers\exception.py", line 55, in inner
    response = get_response(request)
               ^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\django\core\handlers\base.py", line 197, in _get_response
    response = wrapped_callback(request, *callback_args, **callback_kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\django\views\decorators\csrf.py", line 65, in _view_wrapper
    return view_func(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\rest_framework\viewsets.py", line 124, in view
    return self.dispatch(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 509, in dispatch
    response = self.handle_exception(exc)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 469, in handle_exception
    self.raise_uncaught_exception(exc)
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 480, in raise_uncaught_exception
    raise exc
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 497, in dispatch
    self.initial(request, *args, **kwargs)
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 415, in initial
    self.check_permissions(request)
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 331, in check_permissions
    for permission in self.get_permissions():
                      ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 278, in get_permissions
    return [permission() for permission in self.permission_classes]
            ^^^^^^^^^^^^
TypeError: 'str' object is not callable
ERROR 2025-05-16 19:18:08,435 basehttp 31712 35712 "GET /api/knowledge/graph/ HTTP/1.1" 500 107028
INFO 2025-05-16 19:18:23,229 basehttp 31712 45876 "POST /api/users/login/ HTTP/1.1" 200 526
ERROR 2025-05-16 19:18:27,380 log 31712 45876 Internal Server Error: /api/knowledge/init/
Traceback (most recent call last):
  File "D:\Python\Python312\Lib\site-packages\django\core\handlers\exception.py", line 55, in inner
    response = get_response(request)
               ^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\django\core\handlers\base.py", line 197, in _get_response
    response = wrapped_callback(request, *callback_args, **callback_kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\django\views\decorators\csrf.py", line 65, in _view_wrapper
    return view_func(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\rest_framework\viewsets.py", line 124, in view
    return self.dispatch(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 509, in dispatch
    response = self.handle_exception(exc)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 469, in handle_exception
    self.raise_uncaught_exception(exc)
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 480, in raise_uncaught_exception
    raise exc
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 497, in dispatch
    self.initial(request, *args, **kwargs)
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 415, in initial
    self.check_permissions(request)
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 331, in check_permissions
    for permission in self.get_permissions():
                      ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 278, in get_permissions
    return [permission() for permission in self.permission_classes]
            ^^^^^^^^^^^^
TypeError: 'str' object is not callable
ERROR 2025-05-16 19:18:27,386 basehttp 31712 45876 "POST /api/knowledge/init/ HTTP/1.1" 500 107335
INFO 2025-05-16 19:19:46,130 basehttp 31712 45876 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-16 19:19:50,435 views 31712 35712 Neo4j服务初始化成功
INFO 2025-05-16 19:19:54,559 views 31712 35712 Redis连接成功
DEBUG 2025-05-16 19:19:54,560 views 31712 35712 ChatAPI实例初始化完成
WARNING 2025-05-16 19:19:54,560 log 31712 35712 Unauthorized: /api/chat/create_session/
WARNING 2025-05-16 19:19:54,561 basehttp 31712 35712 "POST /api/chat/create_session/ HTTP/1.1" 401 6
INFO 2025-05-16 19:19:56,913 views 31712 35712 Neo4j服务初始化成功
INFO 2025-05-16 19:20:00,982 views 31712 35712 Redis连接成功
DEBUG 2025-05-16 19:20:00,983 views 31712 35712 ChatAPI实例初始化完成
WARNING 2025-05-16 19:20:00,986 log 31712 35712 Unauthorized: /api/chat/get_history/
WARNING 2025-05-16 19:20:00,988 basehttp 31712 35712 "GET /api/chat/get_history/ HTTP/1.1" 401 6
INFO 2025-05-16 19:20:26,429 basehttp 31712 45876 "OPTIONS /api/chat/create_session/ HTTP/1.1" 200 0
INFO 2025-05-16 19:20:28,802 views 31712 45876 Neo4j服务初始化成功
INFO 2025-05-16 19:20:31,739 basehttp 31712 42860 "OPTIONS /api/chat/history/ HTTP/1.1" 200 0
WARNING 2025-05-16 19:20:31,761 log 31712 42860 Not Found: /api/chat/history/
WARNING 2025-05-16 19:20:31,761 basehttp 31712 42860 "GET /api/chat/history/ HTTP/1.1" 404 8949
INFO 2025-05-16 19:20:32,909 views 31712 45876 Redis连接成功
DEBUG 2025-05-16 19:20:32,911 views 31712 45876 ChatAPI实例初始化完成
INFO 2025-05-16 19:20:34,974 views 31712 45876 创建新会话成功 - 用户ID: 1, 会话ID: 1747394432924_6101
INFO 2025-05-16 19:20:34,978 basehttp 31712 45876 - Broken pipe from ('127.0.0.1', 60816)
INFO 2025-05-16 19:21:25,829 basehttp 31712 42860 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-16 19:21:29,554 views 31712 42860 Neo4j服务初始化成功
WARNING 2025-05-16 19:21:32,513 log 31712 44956 Not Found: /api/chat/history/
WARNING 2025-05-16 19:21:32,514 basehttp 31712 44956 "GET /api/chat/history/ HTTP/1.1" 404 8949
INFO 2025-05-16 19:21:33,656 views 31712 42860 Redis连接成功
DEBUG 2025-05-16 19:21:33,656 views 31712 42860 ChatAPI实例初始化完成
INFO 2025-05-16 19:21:33,660 views 31712 42860 创建新会话成功 - 用户ID: 1, 会话ID: 1747394493660_2617
INFO 2025-05-16 19:21:33,661 basehttp 31712 42860 - Broken pipe from ('127.0.0.1', 61030)
INFO 2025-05-16 19:26:02,184 views 31712 44956 Neo4j服务初始化成功
INFO 2025-05-16 19:26:03,438 views 31712 36432 Neo4j服务初始化成功
WARNING 2025-05-16 19:26:05,101 log 31712 42360 Not Found: /api/chat/history/
WARNING 2025-05-16 19:26:05,102 basehttp 31712 42360 "GET /api/chat/history/ HTTP/1.1" 404 8949
WARNING 2025-05-16 19:26:05,762 log 31712 42360 Not Found: /api/chat/history/
WARNING 2025-05-16 19:26:05,763 basehttp 31712 42360 "GET /api/chat/history/ HTTP/1.1" 404 8949
INFO 2025-05-16 19:26:06,283 views 31712 44956 Redis连接成功
DEBUG 2025-05-16 19:26:06,284 views 31712 44956 ChatAPI实例初始化完成
INFO 2025-05-16 19:26:06,296 views 31712 44956 创建新会话成功 - 用户ID: 1, 会话ID: 1747394766295_1223
INFO 2025-05-16 19:26:06,298 basehttp 31712 44956 - Broken pipe from ('127.0.0.1', 61147)
INFO 2025-05-16 19:26:07,557 views 31712 36432 Redis连接成功
DEBUG 2025-05-16 19:26:07,557 views 31712 36432 ChatAPI实例初始化完成
INFO 2025-05-16 19:26:07,575 views 31712 36432 创建新会话成功 - 用户ID: 1, 会话ID: 1747394767575_9895
INFO 2025-05-16 19:26:07,576 basehttp 31712 36432 - Broken pipe from ('127.0.0.1', 61744)
INFO 2025-05-16 19:26:19,864 basehttp 31712 42360 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-16 19:26:31,348 views 31712 42360 Neo4j服务初始化成功
WARNING 2025-05-16 19:26:34,332 log 31712 43404 Not Found: /api/chat/history/
WARNING 2025-05-16 19:26:34,333 basehttp 31712 43404 "GET /api/chat/history/ HTTP/1.1" 404 8949
INFO 2025-05-16 19:26:35,430 views 31712 42360 Redis连接成功
DEBUG 2025-05-16 19:26:35,430 views 31712 42360 ChatAPI实例初始化完成
INFO 2025-05-16 19:26:35,434 views 31712 42360 创建新会话成功 - 用户ID: 1, 会话ID: 1747394795434_3164
INFO 2025-05-16 19:26:35,435 basehttp 31712 42360 - Broken pipe from ('127.0.0.1', 61767)
INFO 2025-05-16 19:26:44,020 views 31712 43404 Neo4j服务初始化成功
INFO 2025-05-16 19:26:48,124 views 31712 43404 Redis连接成功
DEBUG 2025-05-16 19:26:48,124 views 31712 43404 ChatAPI实例初始化完成
INFO 2025-05-16 19:26:48,130 views 31712 43404 创建新会话成功 - 用户ID: 1, 会话ID: 1747394808130_6561
INFO 2025-05-16 19:26:48,131 basehttp 31712 43404 - Broken pipe from ('127.0.0.1', 61812)
INFO 2025-05-16 19:26:49,307 views 31712 42308 Neo4j服务初始化成功
INFO 2025-05-16 19:26:53,422 views 31712 42308 Redis连接成功
DEBUG 2025-05-16 19:26:53,422 views 31712 42308 ChatAPI实例初始化完成
WARNING 2025-05-16 19:26:53,423 log 31712 42308 Unauthorized: /api/chat/stream_chat/
WARNING 2025-05-16 19:26:53,424 basehttp 31712 42308 "GET /api/chat/stream_chat/?message=%E4%BD%A0%E5%A5%BD&session_id=default HTTP/1.1" 401 6
WARNING 2025-05-16 19:26:53,737 log 31712 8496 Not Found: /api/chat/history/
WARNING 2025-05-16 19:26:53,738 basehttp 31712 8496 "GET /api/chat/history/ HTTP/1.1" 404 8949
INFO 2025-05-16 19:28:08,677 views 31712 8496 Neo4j服务初始化成功
INFO 2025-05-16 19:28:09,045 views 31712 44876 Neo4j服务初始化成功
INFO 2025-05-16 19:28:11,128 views 31712 33296 Neo4j服务初始化成功
INFO 2025-05-16 19:28:11,128 views 31712 46844 Neo4j服务初始化成功
WARNING 2025-05-16 19:28:11,659 log 31712 24640 Not Found: /api/chat/history/
WARNING 2025-05-16 19:28:11,659 basehttp 31712 24640 "GET /api/chat/history/ HTTP/1.1" 404 8949
WARNING 2025-05-16 19:28:11,665 log 31712 24640 Not Found: /api/chat/history/
WARNING 2025-05-16 19:28:11,666 basehttp 31712 24640 "GET /api/chat/history/ HTTP/1.1" 404 8949
INFO 2025-05-16 19:28:12,789 views 31712 8496 Redis连接成功
DEBUG 2025-05-16 19:28:12,789 views 31712 8496 ChatAPI实例初始化完成
INFO 2025-05-16 19:28:12,796 views 31712 8496 创建新会话成功 - 用户ID: 1, 会话ID: 1747394892796_2523
INFO 2025-05-16 19:28:12,797 basehttp 31712 8496 - Broken pipe from ('127.0.0.1', 61858)
INFO 2025-05-16 19:28:13,165 views 31712 44876 Redis连接成功
DEBUG 2025-05-16 19:28:13,166 views 31712 44876 ChatAPI实例初始化完成
INFO 2025-05-16 19:28:13,171 views 31712 44876 创建新会话成功 - 用户ID: 1, 会话ID: 1747394893171_6720
INFO 2025-05-16 19:28:13,172 basehttp 31712 44876 - Broken pipe from ('127.0.0.1', 61995)
INFO 2025-05-16 19:28:13,361 basehttp 31712 24640 "OPTIONS /api/chat/get_history/ HTTP/1.1" 200 0
INFO 2025-05-16 19:28:13,363 basehttp 31712 13288 "OPTIONS /api/chat/get_history/ HTTP/1.1" 200 0
INFO 2025-05-16 19:28:15,223 views 31712 33296 Redis连接成功
INFO 2025-05-16 19:28:15,224 views 31712 46844 Redis连接成功
DEBUG 2025-05-16 19:28:15,224 views 31712 33296 ChatAPI实例初始化完成
DEBUG 2025-05-16 19:28:15,224 views 31712 46844 ChatAPI实例初始化完成
INFO 2025-05-16 19:28:15,229 views 31712 33296 创建新会话成功 - 用户ID: 1, 会话ID: 1747394895228_2360
INFO 2025-05-16 19:28:15,230 basehttp 31712 33296 - Broken pipe from ('127.0.0.1', 62003)
INFO 2025-05-16 19:28:15,230 views 31712 46844 创建新会话成功 - 用户ID: 1, 会话ID: 1747394895230_6572
INFO 2025-05-16 19:28:15,231 basehttp 31712 46844 - Broken pipe from ('127.0.0.1', 62004)
INFO 2025-05-16 19:28:15,710 views 31712 24640 Neo4j服务初始化成功
INFO 2025-05-16 19:28:19,833 views 31712 24640 Redis连接成功
DEBUG 2025-05-16 19:28:19,834 views 31712 24640 ChatAPI实例初始化完成
INFO 2025-05-16 19:28:19,864 views 31712 24640 获取所有历史会话 - 会话数: 9
INFO 2025-05-16 19:28:19,865 basehttp 31712 24640 - Broken pipe from ('127.0.0.1', 62022)
INFO 2025-05-16 19:28:20,711 views 31712 13288 Neo4j服务初始化成功
INFO 2025-05-16 19:28:24,827 views 31712 13288 Redis连接成功
DEBUG 2025-05-16 19:28:24,828 views 31712 13288 ChatAPI实例初始化完成
INFO 2025-05-16 19:28:24,850 views 31712 13288 获取所有历史会话 - 会话数: 9
INFO 2025-05-16 19:28:24,851 basehttp 31712 13288 - Broken pipe from ('127.0.0.1', 62027)
INFO 2025-05-16 19:29:40,280 autoreload 31712 44188 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-05-16 19:29:46,737 autoreload 43528 46008 Watching for file changes with StatReloader
INFO 2025-05-16 19:29:53,780 views 43528 42012 Neo4j服务初始化成功
INFO 2025-05-16 19:29:53,811 views 43528 23492 Neo4j服务初始化成功
INFO 2025-05-16 19:29:57,154 autoreload 43528 46008 D:\GraduationProject\wheatdisease\backend\settings.py changed, reloading.
INFO 2025-05-16 19:30:03,616 autoreload 45444 18020 Watching for file changes with StatReloader
INFO 2025-05-16 19:30:49,865 basehttp 45444 45288 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-16 19:30:53,925 views 45444 45288 Neo4j服务初始化成功
INFO 2025-05-16 19:30:58,053 views 45444 45288 Redis连接成功
DEBUG 2025-05-16 19:30:58,054 views 45444 45288 ChatAPI实例初始化完成
INFO 2025-05-16 19:30:58,848 views 45444 46276 Neo4j服务初始化成功
INFO 2025-05-16 19:31:00,098 views 45444 45288 创建新会话成功 - 用户ID: 1, 会话ID: 1747395058056_1095
INFO 2025-05-16 19:31:00,100 basehttp 45444 45288 - Broken pipe from ('127.0.0.1', 62411)
INFO 2025-05-16 19:31:02,906 views 45444 46276 Redis连接成功
DEBUG 2025-05-16 19:31:02,906 views 45444 46276 ChatAPI实例初始化完成
INFO 2025-05-16 19:31:02,913 views 45444 46276 获取用户 1 的历史会话 - 会话数: 0
INFO 2025-05-16 19:31:02,914 basehttp 45444 46276 - Broken pipe from ('127.0.0.1', 62413)
ERROR 2025-05-16 19:31:48,018 log 45444 3388 Internal Server Error: /api/knowledge/graph/
Traceback (most recent call last):
  File "D:\Python\Python312\Lib\site-packages\django\core\handlers\exception.py", line 55, in inner
    response = get_response(request)
               ^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\django\core\handlers\base.py", line 197, in _get_response
    response = wrapped_callback(request, *callback_args, **callback_kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\django\views\decorators\csrf.py", line 65, in _view_wrapper
    return view_func(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\rest_framework\viewsets.py", line 124, in view
    return self.dispatch(request, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 509, in dispatch
    response = self.handle_exception(exc)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 469, in handle_exception
    self.raise_uncaught_exception(exc)
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 480, in raise_uncaught_exception
    raise exc
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 497, in dispatch
    self.initial(request, *args, **kwargs)
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 415, in initial
    self.check_permissions(request)
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 331, in check_permissions
    for permission in self.get_permissions():
                      ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\Python312\Lib\site-packages\rest_framework\views.py", line 278, in get_permissions
    return [permission() for permission in self.permission_classes]
            ^^^^^^^^^^^^
TypeError: 'str' object is not callable
ERROR 2025-05-16 19:31:48,024 basehttp 45444 3388 "GET /api/knowledge/graph/ HTTP/1.1" 500 107366
INFO 2025-05-16 19:31:50,697 autoreload 45444 18020 D:\GraduationProject\wheatdisease\backend\settings.py changed, reloading.
INFO 2025-05-16 19:31:57,514 autoreload 45248 436 Watching for file changes with StatReloader
INFO 2025-05-16 19:32:08,018 views 45248 48016 Neo4j服务初始化成功
INFO 2025-05-16 19:32:08,024 views 45248 48020 Neo4j服务初始化成功
INFO 2025-05-16 19:32:12,125 views 45248 48020 Redis连接成功
DEBUG 2025-05-16 19:32:12,126 views 45248 48020 ChatAPI实例初始化完成
INFO 2025-05-16 19:32:12,141 views 45248 48016 Redis连接成功
DEBUG 2025-05-16 19:32:12,142 views 45248 48016 ChatAPI实例初始化完成
ERROR 2025-05-16 19:32:12,173 views 45248 48020 创建会话失败: Module "redis.connection" does not define a "HiredisParser" attribute/class
ERROR 2025-05-16 19:32:12,174 views 45248 48016 创建会话失败: Module "redis.connection" does not define a "HiredisParser" attribute/class
ERROR 2025-05-16 19:32:12,174 log 45248 48020 Internal Server Error: /api/chat/create_session/
ERROR 2025-05-16 19:32:12,175 log 45248 48016 Internal Server Error: /api/chat/create_session/
INFO 2025-05-16 19:32:12,175 basehttp 45248 48020 - Broken pipe from ('127.0.0.1', 62624)
INFO 2025-05-16 19:32:12,176 basehttp 45248 48016 - Broken pipe from ('127.0.0.1', 62623)
INFO 2025-05-16 19:32:12,590 views 45248 48028 Neo4j服务初始化成功
INFO 2025-05-16 19:32:16,697 views 45248 48028 Redis连接成功
DEBUG 2025-05-16 19:32:16,697 views 45248 48028 ChatAPI实例初始化完成
ERROR 2025-05-16 19:32:16,703 views 45248 48028 获取历史记录失败: Module "redis.connection" does not define a "HiredisParser" attribute/class
ERROR 2025-05-16 19:32:16,704 log 45248 48028 Internal Server Error: /api/chat/get_history/
INFO 2025-05-16 19:32:16,705 basehttp 45248 48028 - Broken pipe from ('127.0.0.1', 62626)
INFO 2025-05-16 19:34:16,722 autoreload 45248 436 D:\GraduationProject\wheatdisease\manage.py changed, reloading.
INFO 2025-05-16 19:34:23,177 autoreload 44448 43148 Watching for file changes with StatReloader
INFO 2025-05-16 19:34:46,067 autoreload 44448 43148 D:\GraduationProject\wheatdisease\manage.py changed, reloading.
INFO 2025-05-16 19:34:47,234 autoreload 44232 38940 Watching for file changes with StatReloader
INFO 2025-05-16 19:36:17,226 autoreload 44232 38940 D:\GraduationProject\wheatdisease\manage.py changed, reloading.
INFO 2025-05-16 19:36:18,071 autoreload 40784 45848 Watching for file changes with StatReloader
INFO 2025-05-16 19:37:50,690 autoreload 16704 45068 Watching for file changes with StatReloader
INFO 2025-05-16 19:38:35,279 autoreload 16704 45068 D:\GraduationProject\wheatdisease\backend\settings.py changed, reloading.
INFO 2025-05-16 19:39:23,579 autoreload 38676 47128 Watching for file changes with StatReloader
INFO 2025-05-16 19:40:58,342 autoreload 38676 47128 D:\GraduationProject\wheatdisease\backend\settings.py changed, reloading.
INFO 2025-05-16 19:40:59,224 autoreload 44956 34048 Watching for file changes with StatReloader
INFO 2025-05-16 19:42:35,365 basehttp 44956 45592 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-16 19:42:53,516 views 44956 45592 Neo4j服务初始化成功
INFO 2025-05-16 19:42:57,593 views 44956 45592 Redis连接成功
DEBUG 2025-05-16 19:42:57,595 views 44956 45592 ChatAPI实例初始化完成
ERROR 2025-05-16 19:42:57,603 views 44956 45592 创建会话失败: Module "redis.connection" does not define a "HiredisParser" attribute/class
ERROR 2025-05-16 19:42:57,604 log 44956 45592 Internal Server Error: /api/chat/create_session/
INFO 2025-05-16 19:42:57,605 basehttp 44956 45592 - Broken pipe from ('127.0.0.1', 63728)
INFO 2025-05-16 19:42:58,450 views 44956 16324 Neo4j服务初始化成功
INFO 2025-05-16 19:43:02,537 views 44956 16324 Redis连接成功
DEBUG 2025-05-16 19:43:02,537 views 44956 16324 ChatAPI实例初始化完成
ERROR 2025-05-16 19:43:02,540 views 44956 16324 获取历史记录失败: Module "redis.connection" does not define a "HiredisParser" attribute/class
ERROR 2025-05-16 19:43:02,541 log 44956 16324 Internal Server Error: /api/chat/get_history/
INFO 2025-05-16 19:43:02,542 basehttp 44956 16324 - Broken pipe from ('127.0.0.1', 63730)
INFO 2025-05-16 19:44:12,796 autoreload 44956 34048 D:\GraduationProject\wheatdisease\backend\settings.py changed, reloading.
INFO 2025-05-16 19:44:13,696 autoreload 34740 45320 Watching for file changes with StatReloader
INFO 2025-05-16 19:44:24,594 autoreload 34740 45320 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-05-16 19:44:25,448 autoreload 46176 48092 Watching for file changes with StatReloader
INFO 2025-05-16 19:45:03,784 basehttp 46176 43356 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-16 19:45:07,066 views 46176 43356 Neo4j服务初始化成功
INFO 2025-05-16 19:45:11,161 views 46176 43356 Redis连接成功
DEBUG 2025-05-16 19:45:11,161 views 46176 43356 ChatAPI实例初始化完成
INFO 2025-05-16 19:45:11,164 views 46176 43356 创建新会话成功 - 用户ID: 1, 会话ID: 1747395911164_5711
INFO 2025-05-16 19:45:11,166 basehttp 46176 43356 - Broken pipe from ('127.0.0.1', 63987)
INFO 2025-05-16 19:45:12,019 views 46176 37988 Neo4j服务初始化成功
INFO 2025-05-16 19:45:14,092 views 46176 37988 Redis连接成功
DEBUG 2025-05-16 19:45:14,093 views 46176 37988 ChatAPI实例初始化完成
INFO 2025-05-16 19:45:14,099 views 46176 37988 获取用户 1 的历史会话 - 会话数: 0
INFO 2025-05-16 19:45:14,100 basehttp 46176 37988 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-05-16 19:53:38,159 autoreload 46176 48092 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-05-16 19:53:39,053 autoreload 47508 38988 Watching for file changes with StatReloader
INFO 2025-05-16 19:55:29,172 autoreload 47508 38988 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-05-16 19:55:30,165 autoreload 44588 34748 Watching for file changes with StatReloader
INFO 2025-05-16 19:57:29,611 basehttp 44588 2916 "POST /api/users/login/ HTTP/1.1" 200 526
INFO 2025-05-16 19:57:32,920 views 44588 2916 Neo4j服务初始化成功
INFO 2025-05-16 19:57:37,028 views 44588 2916 Redis连接成功
DEBUG 2025-05-16 19:57:37,028 views 44588 2916 ChatAPI实例初始化完成
INFO 2025-05-16 19:57:37,032 views 44588 2916 创建新会话成功 - 用户ID: 1, 会话ID: 1747396657032_8427
INFO 2025-05-16 19:57:37,033 basehttp 44588 2916 - Broken pipe from ('127.0.0.1', 65057)
INFO 2025-05-16 19:57:37,887 views 44588 44300 Neo4j服务初始化成功
INFO 2025-05-16 19:57:39,943 views 44588 44300 Redis连接成功
DEBUG 2025-05-16 19:57:39,943 views 44588 44300 ChatAPI实例初始化完成
INFO 2025-05-16 19:57:39,949 views 44588 44300 获取用户 1 的历史会话 - 会话数: 0
INFO 2025-05-16 19:57:39,949 basehttp 44588 44300 "GET /api/chat/get_history/ HTTP/1.1" 200 37
INFO 2025-05-16 20:00:34,238 autoreload 44588 34748 D:\GraduationProject\wheatdisease\chat\views.py changed, reloading.
INFO 2025-05-16 20:00:35,122 autoreload 45456 13144 Watching for file changes with StatReloader
INFO 2025-05-16 20:07:15,825 autoreload 45456 13144 D:\GraduationProject\wheatdisease\backend\settings.py changed, reloading.
